define(["jquery","components/uds-sdk","managers/page-vars","translations/interest","version!fly/managers/debug","managers/recommendation","managers/recommendation-data","components/urban-airship","managers/events","managers/client-storage","version!fly/components/base"],function(e,t,n,s,i,a,o,r,l,d){i=i.init("interest");const c=d.localStorageSupported();e.widget("cnet.interest",e.fly.base,{interest:null,options:{id:null,name:null,type:null,eventSubscriptions:{interestChange:{interestChange:"_displayInterestChange"}}},_create:function(){var t=this;this._setup(),t.interest={id:t.options.id,name:t.options.name,type:t.options.type},window.UA?this._onLoadUrbanAirship():e(window).on("urban-airship-loaded",function(){t._onLoadUrbanAirship()})},_displayInterestChange:function(){t&&t.enabled&&(t._isInterestActive(this.interest.id)?this._displayRemoveInterest():this._displayFollowInterest())},_displayFollowInterest:function(){this.$element.removeClass("followedInterest"),this.$element.addClass("nonFollowedInterest"),this.$element.find("[data-follow-text]").text(s.follow)},_displayRemoveInterest:function(){this.$element.addClass("followedInterest"),this.$element.removeClass("nonFollowedInterest"),this.$element.find("[data-follow-text]").text(s.following)},_onLoadUrbanAirship:function(){var n=this;window.UA.then(function(s){if(c&&s.canRegister&&n.interest&&"none"!==n.interest.id){let r=!0;if("true"!==localStorage.getItem("CnetUdsEnabled")){var a=o.getTagGroupByInterest(n.interest.type);s.channel&&(s.channel.tags.has(n.interest.name.toUpperCase(),a)||s.channel.tags.has("Interest_"+n.interest.name.toUpperCase(),"device"))&&(n._displayRemoveInterest(),r=!1)}else t&&t.enabled&&t._isInterestActive(n.interest.id)&&(n._displayRemoveInterest(),r=!1);if(r&&(n._displayFollowInterest(),"true"!==localStorage.getItem("CnetHasSeenInterestBanner"))){n.$element.prev().removeClass("hidden");try{localStorage.setItem("CnetHasSeenInterestBanner","true")}catch(e){i.error("Writing to localStorage failed for interest banner view state.")}}e(".es-header").addClass("interestDisplayed"),n.$element.removeClass("hidden"),n._setupEvents(s)}else n.$element.addClass("hidden")})},_setupEvents:function(e){var t=this;e.addEventListener("channel",function(n){if("true"!==localStorage.getItem("CnetUdsEnabled")&&t.$element.hasClass("followedInterest")){var s=o.getTagGroupByInterest(t.interest.type);n.channel&&!n.channel.tags.has(t.interest.name.toUpperCase(),s)&&a.addExplicitInterest(e,t.interest)}}),this.$element.prev().on("click",function(){t.$element.prev().addClass("hidden")}),this.$element.on("click",function(n){if("denied"!==Notification.permission&&n.preventDefault(),e&&!e.channel||"default"===Notification.permission){r.trackEvent("message","notification");let t=Notification.permission;e.register().then(function(n){"default"!==e.permission&&"default"===t&&r.trackEvent("tap",(n.optedIn,"opt-in"))}).catch(function(){"default"===t&&"denied"===Notification.permission&&airship.trackEvent("tap","notification|opt-out")})}t.$element[0].className.includes("nonFollowedInterest")?(a.addExplicitInterest(e,t.interest),t._displayRemoveInterest()):(a.removeExplicitInterest(e,t.interest),t._displayFollowInterest())}),l.subscribe(this,this.options.eventSubscriptions)}})});