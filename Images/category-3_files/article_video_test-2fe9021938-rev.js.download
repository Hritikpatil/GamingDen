define("fly/utils/object-helper-1.0",["jquery"],function(e){return{deepFind:function(e,t){if(!e||!t)return null;var s=t.split("."),n=s.length;for(i=0;i<n;i++){if(!e.hasOwnProperty(s[i]))return null;e=e[s[i]]}return e}}}),define("fly/managers/components-1.0",["jquery","version!fly/utils/string-helper","version!fly/utils/object-helper","version!fly/managers/debug","version!fly/components/base"],function(e,t,i,s,n){var a,r={attr:"data-component",includeContext:!0},o=s.init("components"),l={};return e(document).on("domUpdated",function(e,t){t=t||{},a.process(t.$context)}),a={process:function(i){var s=this;this.findByAttr(i).each(function(i,n){var a=e(n),r=a.data(),o=t.toCleanArray(r.component);e.each(o,function(e,t){s.init(t,a)})})},init:function(t,i,s){var n,a,r=l[t];r&&(s=s||{},n=e.makeArray(r.require)||[],a=t,r.alias&&(a=r.alias,s=e.extend(!0,{},r.options||{},s)),require(n,function(){i&&i.length&&e.isFunction(i[a])&&i[a](s)}),o.log("init: ",t,i,s))},setConfig:function(t){if(!e.isPlainObject(t))throw new Error("Component setConfig failure. Map is in the wrong format.");e.extend(r,t)},register:function(t){if(!e.isPlainObject(t))throw new Error("Component register failure. Map is in the wrong format.");e.each(t,function(e,t){l[e]=t,t.options&&n.setDefaultOptions(e,t.options),t.events&&n.addDefaultEvents(e,t.events)}),o.log("register: ",t)},findByAttr:function(t,i,s){var n,a="";return(i=i&&!e.isArray(i)?[i]:i)?e.each(i,function(e,t){a+=e>0?", ":"",a+="["+r.attr+'="'+t+'"], ['+r.attr+"*='\""+t+"\"']"}):a="["+r.attr+"]",n=(t=t||e(document.body)).find(a),(s=void 0!==s?s:r.includeContext)&&(n=n.addBack(a)),n}}}),define("managers/third-party/playbuzz",["jquery","version!fly/managers/debug"],function(e,t){return t=t.init("playbuzz"),{init:function(){document.body.addEventListener("pbItemEvent",function(e){try{switch(e.detail.name){case"pb.item.scroll-top-into-view":this.quizName=e.detail.data.title||"unknown quiz name","object"==typeof om&&"function"==typeof om.trackPlayBuzz?om.trackPlayBuzz("view",this.quizName):window.pl_buzz_name=this.quizName;break;case"pb.section.poll-vote":this.quizName=this.quizName||window.pl_buzz_name||"unknown quiz name";var i=e.detail.data.component.questions[0].text||"unknown question text",s=e.detail.data.text||"unknown answer text";"object"==typeof om&&"function"==typeof om.trackPlayBuzz&&om.trackPlayBuzz("answer",[this.quizName,i,s].join("|"))}t.log("Playbuzz event",e)}catch(e){t.error("Playbuzz data error",e)}})}}}),define("managers/tealium",["jquery","version!fly/managers/debug","managers/page-vars","managers/client-storage","managers/third-party/playbuzz","managers/tracking","optional!"+(window.CnetPageVars.services.tealium&&window.CnetPageVars.services.tealium.enabled?"tealium":"feature-disabled")],function(e,t,i,s,n,a){var r=t.get("tealium"),o={timeThreshold:4e3,requestThreshold:10,requestCount:0},l={_getCollectionId:function(){var e="";return"object"==typeof i.tracking.data.collectionId?e=i.tracking.data.collectionId[0]:"string"==typeof i.tracking.data.collectionId&&(e=i.tracking.data.collectionId),e},getDwTag:function(e,t){var i=[];t=t||3;do{(e=e.parents("[section],[id]")).attr("section")?i.push(e.attr("section")):e.attr("id")&&i.push(e.attr("id"))}while(i.length<t&&0<e.length);return i.reverse().join("|")},getHbParams:function(t){utag_data.videoAutoPlay="off"===s.read("autoplayEnabled")?"off":"on";var n=new Array("articleId","articleType","articleTitle","brand","channel_id","contact_id","mediaAutoPlay","mfr","pageType","pageTypeId","pageOntologyId","pageViewGuid","productId","productName","productSeriesId","productSeriesName","productSlug","productType","showId","showTitle","showEpisodeId","showEpisodeTitle","siteEdition","siteSection","siteType","userState","userId","userType","userRegId","deviceType","dwAnonId","videoAutoPlay"),a=new Array,r={};t=t||{};for(var o=0;o<n.length;o++)utag_data[n[o]]&&(a[n[o]]=utag_data[n[o]]);var l=i.tracking.data;return e.extend(r,a,{siteRsids:l.reportSuiteId,siteCode:l.brand,pageName:l.siteName?l.siteName+":"+window.location.pathname:void 0,pageUrl:window.location.href,sitePrimaryRsid:l.reportSuiteId,userStatus:l.userType,siteHier:l.siteName&&l.siteHier?l.siteName+":"+l.siteHier.join("|"):void 0,topicPrimaryId:l.topicId&&l.topicId.length>=0?l.topicId[0]:void 0,authorList:l.articleAuthorId?l.articleAuthorId.join("|"):void 0,test:l.testName?l.testName+"|"+l.testVersion+"|"+l.testGroup:""},t),r},_getUdoStockData:function(){var e=i.tracking.data;return{siteEdition:e.siteEdition,pageViewGuid:e.pageViewGuid,pageType:e.pageType,siteHier:e.siteHier,siteType:e.siteType,deviceType:e.deviceType,articleId:e.articleId,articleTitle:e.articleTitle,articleType:e.articleType,articlePubDate:e.articlePubDate,articleAuthorId:e.articleAuthorId,articleAuthorName:e.articleAuthorName,topicId:e.topicId,topicName:e.topicName}},_initRequestTracking:function(){if("article"===i.tracking.data.pageType){var e=0,t=this;window.setInterval(function(){try{var i=window.performance.getEntriesByType("resource");for(e=e>=i.length?0:e;e<i.length;){var s=i[e];t._trackServiceRequest(s),e++}}catch(e){r.error("Failed to monitor tracking requests:",e)}},500)}},_trackClickViaUtag:function(t,s,n,o,l){try{if(!0===i.tracking.enabled){l="object"!=typeof l?{}:l;var d={_test:i.tracking.data.testName?i.tracking.data.testName+"|"+i.tracking.data.testVersion+"|"+i.tracking.data.testGroup:"",userState:i.tracking.data.userState,userType:i.tracking.data.userType,message_id:i.tracking.data.message_id,contact_id:i.tracking.data.contact_id,channel_id:i.tracking.data.channel_id,oneTrustGroup1:window.utag_data.oneTrustGroup1,oneTrustGroup2:window.utag_data.oneTrustGroup2,oneTrustGroup3:window.utag_data.oneTrustGroup3,oneTrustGroup4:window.utag_data.oneTrustGroup4,oneTrustGroup5:window.utag_data.oneTrustGroup5};if(o="object"!=typeof o?{}:o,o=e.extend({},l,d,o,a.getServiceVars()),e.inArray(t,["om","omnitureMgr","utag"])>=0){r.info(n+" ping: ",o);var u=r.enabled?e.extend({},o):{};if("view"===s?a.trackPageView({path:window.location.pathname,data:o}):a.trackPageEvent({path:window.location.pathname,data:o}),o.dwLinkTag?window.dwTag=o.dwLinkTag:window.dwTag&&(o.dwLinkTag=window.dwTag),window[t][s](o),delete window.dwTag,"object"==typeof window.s&&(window.s.events="",window.s.eVar21="",window.s.eVar37="",window.s.eVar38=""),r.enabled){for(var c in u)o[c]!==u[c]&&r.warn("Tealium overrode our data: "+c+' was changed from "'+u[c]+'" to "'+o[c]+'"');var h={};for(var c in o)void 0===u[c]&&(h[c]=o[c]);0!==h.length&&r.log("Tealium added the following data to the tracking call: ",h)}}else r.error("Invalid tracking object",t)}else r.info(n+" aborted; tracking is not enabled!")}catch(e){r.error(n+" failed:",e)}},trackComment:function(t,s,n){var a={link_text:t,_clickAction:n||t,socialService:"cnet",brand:i.tracking.data.brand,_collectionPrimaryId:this._getCollectionId(),dwLinkTag:s.sharebarSection};this._trackClickViaUtag("utag","link",t,s,e.extend({},this._getUdoStockData(),a))},trackCustomEvent:function(e,t,i){var s={link_text:e,_clickAction:i||"trackClick"};this._trackClickViaUtag("utag","link",e,t,s)},trackExternalLink:function(e){this._trackClickViaUtag("om","trackClick","trackExternalLink",e)},trackForum:function(e,t){this._trackClickViaUtag("om","trackForum",e,t)},trackLead:function(e){var t=jQuery.extend({},i.tracking.data,{_merchantId:e.merid,_merchantName:e.merchantName,_leadType:e.ltype,_destCat:e.destcat,_destUrl:e.destUrl,leadCpc:e.leadcpc,mfr:e.manufacturer,productName:e.productTitle,productSeriesId:e.seriesGuid,productId:void 0!==e.productId?";"+e.productId+";;;;":"",commerceClickId:window.utag_data.commerceClickId,_videoAction:"",videoSegments:"",_leadProdPrice:e.productPrice,videoTime:0,_clickAction:"leadClick",link_text:"clickLead"},e);this._trackClickViaUtag("utag","link","trackLeadClick",e,t)},trackPageLoad:function(t){this._trackClickViaUtag("utag","view","Track view",t,i.tracking.data),e(window).trigger("dynamicloadcomplete"),a.trackChartbeatPageView()},trackPodcast:function(e){this._trackClickViaUtag("om","trackPodcast","trackPodcast",e)},_trackServiceRequest:function(t){for(var s in this.monitoredServices){var n=this.monitoredServices[s];n.fireCount<n.maxFireCount&&-1!==t.name.indexOf(n.requestPrefix)&&(r.info("Tracking the request: "+n.timerName,t.fetchStart),this.trackCustomEvent(n.timerName,e.extend({},i.tracking.data)),n.fireCount++)}},_trackSlaRequest:function(t){if(o.timeThreshold<=t.duration&&o.requestThreshold>o.requestCount){var s=document.createElement("a");if(s.href=t.name,"".endsWith&&!s.host.endsWith(".cnet.com")&&!s.pathname.endsWith(".mp4")){o.requestCount++;var n=Math.round(t.duration/1e3);r.info("slow request ("+n+" seconds)",t.name),this.trackCustomEvent("trackSlaEnforcement",e.extend({serviceWorkerDomain:s.host,serviceWorkerRequestTime:n,serviceWorkerConnection:window.navigator.connection?window.navigator.connection.effectiveType:"unsupported"},i.tracking.data))}}},trackSocial:function(e){var t={brand:i.tracking.data.brand,_collectionPrimaryId:this._getCollectionId(),dwLinkTag:e.sharebarSection};this._trackClickViaUtag("om","trackSocialClick","trackSocialClick",e,t)},trackSuggestedSearch:function(e){this._trackClickViaUtag("om","trackSuggestedSearchClick","trackSuggestedSearchClick",e)},trackVideo:function(e,t,s){var n=e.charAt(0).toUpperCase()+e.slice(1),a="pause"===e?"videoTime":"video"+n+(0===t?"Start":100===t?"Complete":t+"Percent"),r=i.tracking.data,o={_videoAction:a,link_text:a,siteHier:r.siteHier,siteSection:r.siteSection,siteEdition:r.siteEdition,brand:r.brand,siteType:r.siteType,deviceType:r.deviceType,pageType:r.pageType,pageNum:null!=r.pageNum?r.pageNum:1,topicId:r.topicId,pageViewGuid:r.pageViewGuid,articleAuthorId:r.articleAuthorId,articleAuthorName:r.articleAuthorName,articleId:r.articleId,articleTitle:r.articleTitle,articleType:r.articleType,productId:r.productId,productName:r.productName};this._trackClickViaUtag("utag","link",a,s,o)}};return n.init(),l._initRequestTracking(),l}),function(){var e,t=this;if("function"==typeof t.require)try{var i=t.require("crypto").randomBytes;e=i&&function(){return i(16)}}catch(e){}if(!e&&t.crypto&&crypto.getRandomValues){var s=new Uint8Array(16);e=function(){return crypto.getRandomValues(s),s}}if(!e){var n=new Array(16);e=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),n[t]=e>>>((3&t)<<3)&255;return n}}for(var a="function"==typeof t.Buffer?t.Buffer:Array,r=[],o={},l=0;l<256;l++)r[l]=(l+256).toString(16).substr(1),o[r[l]]=l;function d(e,t){var i=t||0,s=r;return s[e[i++]]+s[e[i++]]+s[e[i++]]+s[e[i++]]+"-"+s[e[i++]]+s[e[i++]]+"-"+s[e[i++]]+s[e[i++]]+"-"+s[e[i++]]+s[e[i++]]+"-"+s[e[i++]]+s[e[i++]]+s[e[i++]]+s[e[i++]]+s[e[i++]]+s[e[i++]]}var u=e(),c=[1|u[0],u[1],u[2],u[3],u[4],u[5]],h=16383&(u[6]<<8|u[7]),p=0,g=0;function f(t,i,s){var n=i&&s||0;"string"==typeof t&&(i="binary"==t?new a(16):null,t=null);var r=(t=t||{}).random||(t.rng||e)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,i)for(var o=0;o<16;o++)i[n+o]=r[o];return i||d(r)}var v=f;v.v1=function(e,t,i){var s=t&&i||0,n=t||[],a=null!=(e=e||{}).clockseq?e.clockseq:h,r=null!=e.msecs?e.msecs:(new Date).getTime(),o=null!=e.nsecs?e.nsecs:g+1,l=r-p+(o-g)/1e4;if(l<0&&null==e.clockseq&&(a=a+1&16383),(l<0||r>p)&&null==e.nsecs&&(o=0),o>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");p=r,g=o,h=a;var u=(1e4*(268435455&(r+=122192928e5))+o)%4294967296;n[s++]=u>>>24&255,n[s++]=u>>>16&255,n[s++]=u>>>8&255,n[s++]=255&u;var f=r/4294967296*1e4&268435455;n[s++]=f>>>8&255,n[s++]=255&f,n[s++]=f>>>24&15|16,n[s++]=f>>>16&255,n[s++]=a>>>8|128,n[s++]=255&a;for(var v=e.node||c,m=0;m<6;m++)n[s+m]=v[m];return t||d(n)},v.v4=f,v.parse=function(e,t,i){var s=t&&i||0,n=0;for(t=t||[],e.toLowerCase().replace(/[0-9a-f]{2}/g,function(e){n<16&&(t[s+n++]=o[e])});n<16;)t[s+n++]=0;return t},v.unparse=d,v.BufferClass=a;var m=t.uuid;v.noConflict=function(){return t.uuid=m,v},t.uuid=v}.call(this),define("fly/libs/guid-1.0",function(){}),define("managers/recommendation-data",["jquery","managers/page-vars","version!fly/managers/debug","version!fly/libs/guid"],function(e,t,i){var s={APPLE:"17cf639e-36ce-4e2e-8ea8-a093af98d566",CARS:"b122d23f-29eb-493e-83e6-e9fbfeaf79c8",DEALS:"cc98b5a4-d3a9-4e35-b6d7-625e8289a152",GOOGLE:"303efe12-c4e2-4abd-af02-f99b9d1b2828","HOW TO":"787724c6-2b1e-4f6a-90d9-afa0eebd1abb",MOBILE:"d1753851-e519-4744-897e-9b6ea3b1c04b","SMART HOME":"5787016e-17a5-438f-8690-70ca531844fb","TV & AUDIO":"a13a6b57-a74a-4eaf-be94-c72b9dc931c2",CULTURE:"7b5fc82b-deb8-4e73-8a23-70461cd49a63"},n={broad:"broad-interest",specific:"specific-interest",video:"video-interest",general:"general"};i=i.init("recommendationDataManager");var a={testForLocalStorage:function(){try{return localStorage.setItem("test","test"),localStorage.removeItem("test"),!0}catch(e){return!1}},pruneViews:function(e){for(;e.length>=2e3;)e.shift();var t=Date.now();if(e.length>0)for(var i=e[0];i&&i.date_created&&i.date_created+158112e5<t;)e.shift(),i=e[0];for(var s=[],n=e.length-1;n>=0;n--){s.some(function(t){return t.content_entity_id===e[n].content_entity_id&&t.content_type===e[n].content_type})||s.push(e[n])}return s.reverse()},createNewViewEvent:function(e){var i=t.tracking.data;return{content_entity_id:i.contentId,content_type:"content_"+i.contentType,site:i.brand,dev:i.isDev,view_guid:i.pageViewGuid,page_type:i.pageType,user_id:i.userId,is_logged_in:!!e&&e.isLoggedIn,anon_id:this.getAnon(),deviceType:i.deviceType,date_created:Date.now(),interest:i.interest?i.interest:this.getNoneInterest(),annotations:i.annotations||[],edition:i.siteEdition}},getAnon:function(){var e=localStorage.getItem("CnetAnon");e||(e=window.uuid.v4());try{localStorage.setItem("CnetAnon",e)}catch(t){i.error("Writing to localStorage for anon failed."),e="00000000-0000-0000-0000-000000000000"}return e},writeViewsArray:function(e){var t=!1;try{localStorage.setItem("CnetViewList",JSON.stringify(e)),t=!0}catch(n){i.error("Writing to localStorage failed, attempting to prune view data...");for(var s=0;s<e.length/10;s++)e.shift();try{localStorage.setItem("CnetViewList",JSON.stringify(e)),t=!0}catch(e){i.error("Writing to localStorage failed, even after pruning 10% of view data."),t=!1}}return t},writeExplicitInterestToLocalStorage:function(e){var t=localStorage.getItem("CnetExplicitList");t=t?JSON.parse(t):[];for(var i=!1,s=0;s<t.length;s++)if(e.interest_name&&t[s].interest_name&&e.interest_name===t[s].interest_name&&e.type&&t[s].type&&e.type===t[s].type&&e.implicit===t[s].implicit){if(e.date_created<t[s].date_created)return;t[s]=e,i=!0;break}return i||t.push(e),localStorage.setItem("CnetExplicitList",JSON.stringify(t)),{all:t,new:e}},createExplicitInterestObject:function(e,t,i){var s=this.createNewViewEvent(i);return s=this.normalizeView(s),t&&t.id&&(s.interest=t),{anon_id:s.anon_id,implicit:!1,date_created:s.date_created,type:s.interest?s.interest.type:"none",interest_name:s.interest?s.interest.name.toUpperCase():"none",interest_id:s.interest?s.interest.id:"none",site:s.site,edition:s.edition,action:e,user_id:s.user_id}},createMockExplicitInterestObject:function(e){var t=this.createNewViewEvent();return{anon_id:(t=this.normalizeView(t)).anon_id,implicit:!1,date_created:t.date_created,type:"broad",interest_name:e,interest_id:s[e]?s[e]:"interest_id",site:t.site,edition:t.edition,action:"unfollow"}},createImplicitInterestObject:function(e){return e||(e=this.createNewViewEvent()),{anon_id:(e=this.normalizeView(e)).anon_id,implicit:!0,date_created:e.date_created,type:e.interest.type,interest_name:e.interest.name.toUpperCase(),interest_id:e.interest.id,site:e.site,edition:e.edition,action:"follow",urs_id:e.user_id}},normalizeView:function(e){return e.broad_interest?e.interest={id:s[e.broad_interest]?s[e.broad_interest]:"interest_id",type:"broad",name:e.broad_interest}:e.interest||(e.interest=this.getNoneInterest()),null!=e.is_logged_in&&0!=e.is_logged_in||(e.user_id=""),e},repopulateInterestDB:function(e,t){var s=this.getExplicitInterests(),n=s.filter(function(e){return"unfollow"!==e.action&&!1===e.implicit}),a=this.getViewEvents(),r=this.buildImplicitInterestObjectsFromViews(a),o=s.filter(function(e){return"unfollow"!==e.action&&!0===e.implicit}),l=r.concat(o),d=[];l.forEach(function(e){s.some(function(t){return e.interest_id===t.interest_id&&"unfollow"===t.action})||d.push(e)});var u=n.concat(d);i.log("Backfilling interests"),this.sendInterestsToBackend(u,e,t)},sendInterestsToBackend:function(t,i,s){if(!t||!t.length||t.length<1)i();else{t.sort(function(e,t){return t.date_created-e.date_created});var n=[];t.forEach(function(e){e=r(e),n.some(function(t){return e.interest_id===t.interest_id&&e.action===t.action&&e.implicit===t.implicit})||("video"===e.type&&(e.type="specific"),void 0!==e.user_id&&delete e.user_id,n.push(e))});var a="/personalization/interest/",o=[];s&&o.push("excludeUrsInfo=true"),"true"===localStorage.getItem("CnetUdsEnabled")&&o.push("udsEnabled=true"),o.length&&(a+="?"+o.join("&")),e.post(a,JSON.stringify(n),i)}},syncInterestsWithBackend:function(t,s){var n=this;return!!t.isLoggedIn&&(e.ajax({method:"GET",dataType:"json",url:"/personalization/interest/"}).done(function(e){if(!e.results)return;var t=e.results[0].interests;if(!t||0===t.length)return;t.sort(function(e,t){return e.lastViewed-t.lastViewed});let a=[];t.forEach(function(e){var t;t=e.broadInterestId?"broad":"collection"===e.type?"video":"specific";var i="follow";e.isImplicit||e.isActive||(i="unfollow");var r={action:i,anon_id:n.getAnon(),date_created:e.lastViewed,edition:e.edition,implicit:e.isImplicit,interest_id:e.broadInterestId?e.broadInterestId:e.interestId,interest_name:e.name.toUpperCase(),site:"cnet",type:t};const o=n.writeExplicitInterestToLocalStorage(r);"true"===localStorage.getItem("CnetUdsEnabled")&&o&&a.push(r),"true"!==localStorage.getItem("CnetUdsEnabled")&&s.channel&&("follow"===i?s.channel.tags.add(e.name.toUpperCase(),n.getTagGroupByInterest(t)):s.channel.tags.remove(e.name.toUpperCase(),n.getTagGroupByInterest(t)))}),"true"===localStorage.getItem("CnetUdsEnabled")&&a.length&&window.uds_sdk.addInterest(a,"sync",!1),i.log("Interest Sync complete")}),!0)},buildImplicitInterestObjectsFromViews:function(e){var t=[],i=function(e){var t={};return e.forEach(function(e){e.interest&&"none"!==e.interest.id&&(t[e.interest.id]?t[e.interest.id].push(e):t[e.interest.id]=[e])}),t}(e);if(i){Object.keys(i).forEach(function(e){var s=i[e];if(!(s.length<2))for(var n=0;n<s.length-1;n++)if(s[n].date_created+2592e6>s[n+1].date_created){var o=a.createImplicitInterestObject(s[s.length-1]);o=r(o),t.push(o);break}})}return t},getNoneInterest:function(){return{id:"none",type:"none",name:"none"}},getViewEvents:function(){var e=localStorage.getItem("CnetViewList");return e?JSON.parse(e):[]},getExplicitInterests:function(){var e=localStorage.getItem("CnetExplicitList");return e?e=(e=JSON.parse(e)).map(function(e){return r(e)}):[]},getTagGroupByInterest:function(e){return n[e]?n[e]:"device"},triggerPeriodicBackfillSync:function(t,i){var s=localStorage.getItem("CnetInterestSyncTime");if(!s||Number.parseInt(s)+36e5<Date.now())if(t.isLoggedIn)a.repopulateInterestDB(function(){window.UA?window.UA.then(function(e){a.syncInterestsWithBackend(t,e)&&localStorage.setItem("CnetInterestSyncTime",Date.now())}):e(window).on("urban-airship-loaded",function(){window.UA.then(function(e){a.syncInterestsWithBackend(t,e)&&localStorage.setItem("CnetInterestSyncTime",Date.now())})})});else{var n=a.buildImplicitInterestObjectsFromViews(i),r=a.getExplicitInterests().concat(n);if(0===r.length)return;for(var o=r.sort(function(e,t){return t.date_created-e.date_created}),l=null,d=0;d<o.length;d++){if(!o[d].implicit){l=o[d];break}if(!r.some(function(e){return e.interest_id===o[d].interest_id&&"unfollow"===e.action&&!e.implicit})){l=o[d];break}}var u=Date.now()-2592e6;l&&l.date_created<u&&a.repopulateInterestDB(function(){localStorage.setItem("CnetInterestSyncTime",Date.now())})}}};function r(e){return e.interest_id=e.interest_id.replace("cnet_tag","CNET_TAG").replace("cnet_cat_topic","CNET_CAT_TOPIC"),e}return a}),define("translations/form-validate",["managers/edition"],function(e){return e.getTranslation({en:{required:{field:"This field is required",radio:"One of these fields is required"},availableEmail:"This e-mail address is already in use. Please choose another.",availableUsername:"That username is already taken. Try another.",validPassword:"Your password needs at least 6 characters, and 3 of these 4: special characters, numbers, or upper or lowercase letters.",minlength:"This field must be at least {minlength} characters",maxlength:"This field must be no more than {maxlength} characters",email:"Oops! Please enter a valid email.",mailcheck:"Did you mean",noUrl:"A url is not allowed in this field",noSpecialCharacters:"The special characters @, &, and % are not allowed in this field",equalTo:"Fields do not match",usernameSpecialCharacters:'Please use only alphanumeric characters, underscores "_", and dashes "-"',usernameCharacterLength:"Your username must be between 3 and 25 characters.",atLeastOneAlphanumeric:"You must include at least one alphanumeric character",generic:"Oops! Something went wrong, try again.","invalid.loginpassword":"Oops! That’s not the password for this account, try again.","locked.account":"Too many attempts. Wait 5 minutes and try again, or reset your password.","invalid.email":"Oops! Please enter a valid email.","inuse.userName":"That username is already taken. Try another.","required.email":"We're sorry that you do not wish to create a CNET account.","notallowed.socialLink":'We\'re sorry, we\'ve encountered a problem with this email address. Please contact our customer service team at <a href="mailto:support.cnet@cbsinteractive.com">support.cnet@cbsinteractive.com</a>, and reference issue "log4383"'},es:{required:{field:"Campo requerido",radio:"One of these fields is required"},availableEmail:"Este email esta en uso.  Elige otro.",availableUsername:"Ese nombre de usuario ya existe. Inténtalo de nuevo.",validPassword:"Tu contraseña debe incluir al menos seis caracteres sin espacios y contar con un número, un símbolo especial y una mayúscula.",minlength:"Este campo debe tener al menos {minlength} caracteres",maxlength:"This field must be no more than {maxlength} characters",email:"Por favor utiliza un correo válido",mailcheck:"¿Te refieres a",noUrl:"A url is not allowed in this field",noSpecialCharacters:"The special characters @, &, and % are not allowed in this field",equalTo:"Fields do not match",usernameSpecialCharacters:'Por favor, usa solamente caracteres alfanuméricos, guiones bajos "_", y guiones "-"',usernameCharacterLength:"Tu nombre de usuario debe contener entre 3 y 23 letras.",atLeastOneAlphanumeric:"You must include at least one alphanumeric character",generic:"¡Lo sentimos! Algo no está funcionando, inténtalo más tarde.","invalid.loginpassword":"¡Lo sentimos! Esa no es la contraseña correcta. Inténtalo de nuevo.","locked.account":"Ingresaste una contraseña equivocada demasiadas veces. Espera 5 minutos para intentarlo de nuevo o restablece tu contraseña.","invalid.email":"Tu cuenta de e-mail no es válida, inténtalo de nuevo.","inuse.userName":"Ese nombre de usuario ya existe. Inténtalo de nuevo.","required.email":"Sentimos mucho que no quieras crear una cuenta con CNET en este momento. ¡Gracias por visitarnos!"}})}),define("utils/urs-helper",["jquery","version!fly/managers/debug","managers/page-vars","optional!urs"],function(e,t,i){t=t.init("ursHelper");var s={16:257,103:259,222:263,225:265,242:266,256:268,295:298,358:359,363:361,364:362,368:365,369:366,370:367,372:371,403:401,404:402,9:269,36:270,74:278,305:304,27:280,374:373,376:375,202:394,393:394,395:396,397:398};return{getSocialAppId:function(e){return s[e]},getUrs:function(e,t){var s={};return"object"==typeof window.URS&&"function"==typeof URS.getInstance&&"function"==typeof URS.newInstance&&((s=URS.getInstance(e,"v2.2"))||(s=URS.newInstance({appId:e,clientToken:"12d6d06e118e4a90",environment:i.environment.indexOf("prod")>-1?URS.ursEnvironments.LIVE:URS.ursEnvironments.QA,version:"v2.2"}),t&&t(s))),s}}}),define("fly/utils/string-vars-1.0",["jquery"],function(e){return{compile:function(t,i,s){var n=this;return"string"!=typeof t?"":(s=e.makeArray(s),t=t.replace(/\{([^}]+)\}/g,function(t){var a=s,r="";return t=t.replace(/\|[^\}|]+/g,function(e){return a.push(e.substr(1)),""}),r=i[t.replace(/[{}]+/g,"")]||"",e.each(a,function(e,t){r=n.modify(t,r)}),r}))},modify:function(e,t){switch(e){case"lower":t=t.toLowerCase();break;case"upper":t=t.toUpperCase();break;case"urlencode":t=encodeURIComponent(t)}return t}}}),define("fly/libs/mailcheck-1.1",["jquery"],function(e){var t={mailcheck:{threshold:3,defaultDomains:["yahoo.com","google.com","hotmail.com","gmail.com","me.com","aol.com","mac.com","live.com","comcast.net","googlemail.com","msn.com","hotmail.co.uk","yahoo.co.uk","facebook.com","verizon.net","sbcglobal.net","att.net","gmx.com","mail.com"],defaultTopLevelDomains:["co.uk","com","net","org","info","edu","gov","mil"],run:function(e){e.domains=e.domains||t.mailcheck.defaultDomains,e.topLevelDomains=e.topLevelDomains||t.mailcheck.defaultTopLevelDomains,e.distanceFunction=e.distanceFunction||t.sift3Distance;var i=t.mailcheck.suggest(encodeURI(e.email),e.domains,e.topLevelDomains,e.distanceFunction);i?e.suggested&&e.suggested(i):e.empty&&e.empty()},suggest:function(e,t,i,s){e=e.toLowerCase();var n=this.splitEmail(e),a=this.findClosestDomain(n.domain,t,s);if(a){if(a!=n.domain)return{address:n.address,domain:a,full:n.address+"@"+a}}else{var r=this.findClosestDomain(n.topLevelDomain,i);if(n.domain&&r&&r!=n.topLevelDomain){var o=n.domain;return a=o.substring(0,o.lastIndexOf(n.topLevelDomain))+r,{address:n.address,domain:a,full:n.address+"@"+a}}}return!1},findClosestDomain:function(e,t,i){var s,n=99,a=null;if(!e||!t)return!1;i||(i=this.sift3Distance);for(var r=0;r<t.length;r++){if(e===t[r])return e;(s=i(e,t[r]))<n&&(n=s,a=t[r])}return n<=this.threshold&&null!==a&&a},sift3Distance:function(e,t){if(null==e||0===e.length)return null==t||0===t.length?0:t.length;if(null==t||0===t.length)return e.length;for(var i=0,s=0,n=0,a=0;i+s<e.length&&i+n<t.length;){if(e.charAt(i+s)==t.charAt(i+n))a++;else{s=0,n=0;for(var r=0;r<5;r++){if(i+r<e.length&&e.charAt(i+r)==t.charAt(i)){s=r;break}if(i+r<t.length&&e.charAt(i)==t.charAt(i+r)){n=r;break}}}i++}return(e.length+t.length)/2-a},splitEmail:function(e){var t=e.split("@");if(t.length<2)return!1;for(var i=0;i<t.length;i++)if(""===t[i])return!1;var s=t.pop(),n=s.split("."),a="";if(0==n.length)return!1;if(1==n.length)a=n[0];else{for(i=1;i<n.length;i++)a+=n[i]+".";n.length>=2&&(a=a.substring(0,a.length-1))}return{topLevelDomain:a,domain:s,address:t.join("@")}}}};jQuery.fn.mailcheck=function(e){var i=this;if(e.suggested){var s=e.suggested;e.suggested=function(e){s(i,e)}}if(e.empty){var n=e.empty;e.empty=function(){n.call(null,i)}}e.email=this.val(),t.mailcheck.run(e)}}),define("fly/components/form-validate-1.0",["jquery","version!fly/utils/string-helper","version!fly/utils/string-vars","version!fly/managers/debug","version!fly/components/base"],function(e,t,i,s){var n=e.support.touch?"vclick":"click",a=s.init("formValidate");e.widget("fly.formValidate",e.fly.base,{options:{inlineErrorTemplate:'<label for="{id}" class="validate-{type}">{message}</label>',globalErrorTemplate:'<div class="alert alert-{type}">{message}</div>',classFieldStatus:"validate-{type}",animation:"slide",fieldSelector:'[data-item="field"]',ignoreHidden:!0,ignoreSelector:null,validateOnChange:!0,scrollToErrors:!1,attributes:["required","maxlength","minlength"],rules:{},success:function(e,t){t.$form.submit()},failure:function(e,t){},placeError:function(e,t){t.is(":checkbox, :radio")&&t.parent("label").length?e.insertAfter(t.parent("label")):e.insertAfter(t)}},rules:{required:{message:function(e){return e.is(":radio")?"One of these fields is required":"This field is required"},test:function(e){return e.is(":radio")?e.closest("form").find(':radio[name="'+e.attr("name")+'"]').is(":checked"):!!(e.is(":checkbox")?e.is(":checked"):e.val())}},mailcheck:{type:"warning",message:null,test:function(e,t){var i=this,s=e.closest("form");return require(["fly/libs/mailcheck-1.1"],function(){e.mailcheck({suggested:function(a,r){i.message='Did you mean <a class="mailcheck" data-_insert="mailcheck">'+r.domain+"</a>?",s.on(n+".mailcheck",'[data-_insert="mailcheck"]',function(){e.val(r.full).trigger("change")}),t.reject("mailcheck")},empty:function(e){s.off(".mailcheck"),t.resolve()}})}),t.promise()}},availableEmail:{remote:!0,message:"Email is already in use"},availableUsername:{remote:!0,message:"User Name is already in use"},minlength:{message:function(e){return"This field must be at least "+e.attr("minlength")+" characters"},test:function(e){return e.val().length>=e.attr("minlength")}},maxlength:{message:function(e){return"This field must be no more than "+e.attr("maxlength")+" characters"},test:function(e){return e.val().length<=e.attr("maxlength")}},email:{message:"Please enter a valid email",test:function(e){return/^[A-Z0-9._%+\-]+@[A-Z0-9.\-]+\.[A-Z]{2,4}$/i.test(e.val())}},noUrl:{message:"A url is not allowed in this field",test:function(e){return!/http:\/\//i.test(e.val())}},noSpecialCharacters:{message:"The special characters @, &, and % are not allowed in this field",test:function(e){return/^[^@&%]+$/i.test(e.val())}},equalTo:{message:"Fields do not match",test:function(t){var i=e('input[name="'+t.data("validate-equal-to")+'"]');return i.length&&t.val()===i.val()}}},wasSubmitted:!1,isWorking:!1,isFormValid:!1,_create:function(){var e=this.options,t={};this._setup(),this.$form=this.$element,this.$form.attr("novalidate","novalidate"),this.globalErrors=[],this.ignoreSelector=":submit, :reset, :image, [disabled]",e.ignoreHidden&&(this.ignoreSelector+=", :hidden"),e.ignoreSelector&&(this.ignoreSelector+=", "+e.ignoreSelector),this.addRules(e.rules),this._on(this.$form,{submit:"_handleSubmit"}),e.validateOnChange&&(t["focusout :input:not("+this.ignoreSelector+", [data-_enabled])"]="_handleFocusOut",t["keyup :input:not("+this.ignoreSelector+", [readonly])"]="_handleChange",t["change :input:not("+this.ignoreSelector+")"]="_handleChange",this._on(this.$form,t))},_handleSubmit:function(e){this._off(this.$form,"focusout"),this.wasSubmitted=!0,this.isFormValid||(e.preventDefault(),e.stopImmediatePropagation(),this.validate())},_handleFocusOut:function(t){e(t.target).attr("data-_enabled","true"),this._handleChange(t)},_handleChange:function(t){var i=e(t.target);this.isFormValid=!1,(this.wasSubmitted||i.data("_enabled"))&&(i.data("_passed",!1),this.testField(i))},getRule:function(e){return void 0!==this.rules[e]&&this.rules[e]},getRulesToValidate:function(t){var i=this,s=t.data("validate")||[],n=e.isArray(s)?s:s.split(" ");return e.each(this.options.attributes,function(e,i){t.attr(i)&&n.unshift(i)}),e.grep(n,function(e,t){return i.getRule(e)})},addRules:function(t){e.isPlainObject(t)&&e.extend(this.rules,t)},removeRule:function(e){!1!==this.getRule(e)&&delete this.rules[e]},setFieldDelegate:function(e){var t=null;return e.is(":radio")&&(t=this.$form.find(':radio[name="'+e.attr("name")+'"]').first()),e.data("_field_delegate",t),e},testField:function(t){var i,s=this,n=[],r=t.data()||{},o=r.error||{},l=e.Deferred();return r._passed?(l.resolve(),l.promise()):(this.setFieldDelegate(t),r.remoteRequest&&r.remoteRequest.abort(),i=this.getRulesToValidate(t),a.log("test field: ",t," w/ rules:",i),e.each(i,function(i,r){var l,d=s.getRule(r),u=!0,c=!!d.remote,h=null;if(c&&(h=d.remoteUrl||t.data("remoteUrl"),s.removeError(t)),l=(l=function(){var i=e.Deferred(),n=null;return!1===(n=c?s.requestRemote(h,t,r,i):d.test(t,i))?(u=!1,i.reject(r)):!0===n&&i.resolve(r),i.promise()})(),n.push(l),e.when(l).fail(function(){a.log("rule failed: ",r,t)}).then(function(){o.name===r&&s.removeError(t),a.log("rule passed: ",r,t)}),!u)return!1}),e.when.apply(null,n).fail(function(e){var i=s.getRule(e),n=i.type?i.type:"error",r=t.data(),o=r.error||{};r.remoteTimeout&&clearTimeout(r.remoteTimeout),r.remoteRequest&&r.remoteRequest.abort(),o.message!=s.getMessage(e,t)&&(s.removeError(t),s.addInlineError(t,e)),"error"!==n?(l.resolve(),a.log("field passed: ",t," type: ",n)):(l.reject(),a.log("field failed: ",t))}).then(function(){t.data("_passed",!0),s.removeError(t),l.resolve(),a.log("field passed: ",t)}),l.promise())},requestRemote:function(t,i,s,n){var a,r={},o=null,l=i.data()||{};l.remoteTimeout&&(clearTimeout(l.remoteTimeout),l.remoteQueue.resolve(s)),r[i.attr("name")]=i.val(),a=setTimeout(function(){o=e.ajax({type:"POST",dataType:"json",url:t,data:r,timeout:5e3,success:function(t){switch(t){case!0:n.resolve(s);break;case!1:n.reject(s);break;default:e.isPlainObject(t)&&t.status?"success"===t.status?n.resolve(s):n.reject(s):n.resolve(s)}},complete:function(){i.data("remoteRequest",null)},error:function(e,t){n.resolve(s),i.data("_passed",!1)}}),i.data({remoteRequest:o,remoteQueue:null,remoteTimeout:null})},300),i.data({remoteQueue:n,remoteTimeout:a})},validate:function(){var t=this.options,i=this,s=[];this.isWorking||!1!==this._trigger("validate")&&(this.isWorking=!0,this.removeGlobalErrors(),this.$form.find(":input").not(this.ignoreSelector).each(function(){var t=e(this);s.push(i.testField(t))}),e.when.apply(null,s).fail(function(){a.log("validate failed"),i._trigger("failure",null,{$form:i.$form}),t.scrollToErrors&&i.scrollToErrors()}).then(function(){a.log("validate success"),i.isFormValid=!0,i._trigger("success",null,{$form:i.$form}),i.isFormValid=!1}).always(function(){i._trigger("validated"),i.isWorking=!1}))},scrollToErrors:function(){var t=this.options,i=this.$form.find("[data-validate-error]").first(),s=i.closest(t.fieldSelector),n=(s.length?s:i).offset().top;!1!==this._trigger("scroll",null,{offset:n})&&(n-=this.$window.height()/6,e("html, body").animate({scrollTop:n},"fast"))},removeError:function(t){t=t.data("_field_delegate")||t;var i=this,s=this.options,n=t.data("error");n&&("slide"===s.animation?n.$error.slideUp("fast",function(){e(this).remove(),i._completeRemoveError(n,t)}):(t.remove(),this._completeRemoveError(n,t)),t.removeClass(n.fieldClass).removeData("error"))},getMessage:function(t,i){var s=this.getRule(t),n=i.data("validate-message-"+t)||i.data("validate-message-"+t.toLowerCase());return n||!1===n||(n=e.isFunction(s.message)?s.message(i):s.message),n},addInlineError:function(t,s){t=t.data("_field_delegate")||t;var n,a,r,o=this,l=this.options,d=t.data("error")||{},u={name:s,position:"inline"};"error"!==d.type&&(a=this.getMessage(s,t),n=this.getRule(s).type||"error",r=i.compile(l.inlineErrorTemplate,{type:n,id:t.attr("id"),message:a}),e.extend(u,{type:n,message:a,$error:e(r).attr("data-validate-error",!0),fieldClass:i.compile(this.options.classFieldStatus,{type:n})}),t.addClass(u.fieldClass).data("error",u),!1!==a&&("slide"===l.animation?(u.$error=e("<div />").wrapInner(u.$error),u.$error.hide(),l.placeError.call(this,u.$error,t),u.$error.slideDown("fast",function(){o._completeAddError(u,t)})):(l.placeError.call(this,u.$error,t),this._completeAddError(u,t))))},addGlobalError:function(t,s){s=s||"error";var n,a=this,r=this.options,o={position:"global",type:s,message:t};n=i.compile(r.globalErrorTemplate,{type:s,message:t}),e.extend(o,{$error:e(n).attr("data-validate-error",!0)}),"slide"===r.animation?(o.$error=e("<div />").wrapInner(o.$error),o.$error.hide().prependTo(this.$form).slideDown("fast",function(){a._completeAddError(o)})):(this.$form.prepend(o.$error),this._completeAddError(o)),this.globalErrors.push(o)},removeGlobalErrors:function(){var t=this;e.each(this.globalErrors,function(e,i){i.$error.remove(),t._completeRemoveError(i)})},removeInlineErrors:function(){var t=this;this.$form.find("[data-validate-error]").each(function(){var i=e(this),s=i.data();s.error&&t.removeError(i),s.remoteRequest&&s.remoteRequest.abort()})},_completeAddError:function(t,i){this._trigger("errorAdded",null,e.extend(t,{$field:i})),this.$document.trigger("displayChange",{type:"errorAdded"})},_completeRemoveError:function(t,i){this._trigger("errorRemoved",null,e.extend(t,{$field:i})),this.$document.trigger("displayChange",{type:"errorRemoved"})},_disable:function(){this.removeGlobalErrors(),this.removeInlineErrors()},_destroy:function(){this._disable()}})}),define("components/form-validate",["jquery","version!fly/managers/debug","translations/form-validate","version!fly/utils/string-vars","version!fly/libs/mailcheck","version!fly/components/form-validate"],function(e,t,i,s){t.init("formValidate"),e.widget("cnet.formValidate",e.fly.formValidate,{options:{validateOnBlur:!1},rules:{required:{message:function(e){return e.is(":radio")?i.required.radio:i.required.field}},mailcheck:{message:null,test:function(t,s){var n=e.support.touch?"vclick":"click",a=this,r=t.parents("form");return t.mailcheck({suggested:function(e,o){a.message=i.mailcheck+' <a class="mailcheck" data-insert="mailcheck">'+o.domain+"</a>?",r.on(n+".mailcheck",'[data-insert="mailcheck"]',function(){t.val(o.full).trigger("change")}),s.reject("mailcheck")},empty:function(e){r.off(".mailcheck"),s.resolve()}}),s.promise()}},availableEmail:{message:i.availableEmail},availableUsername:{message:i.availableUsername},validPassword:{message:i.validPassword,test:function(e){var t=e.val(),i=0;return/[0-9]+/.test(t)&&i++,/[a-z]+/.test(t)&&i++,/[A-Z]+/.test(t)&&i++,/[\(\)\.@`!#\$%\^&*+=\-\[\]\\';,\/\{\}\|":<>\?~_]+/.test(t)&&i++,i>=3&&t.length>=6&&-1==t.indexOf(" ")}},minlength:{message:function(e){return s.compile(i.minlength,{minlength:e.attr("minlength")})}},maxlength:{message:function(e){return s.compile(i.maxlength,{maxlength:e.attr("maxlength")})}},email:{message:i.email,test:function(e){return/^[A-Z0-9._%+\-]+@[A-Z0-9.\-]+\.[A-Z]{2,}$/i.test(e.val())}},noUrl:{message:i.noUrl},noSpecialCharacters:{message:i.noSpecialCharacters},equalTo:{message:i.equalTo},usernameSpecialCharacters:{message:i.usernameSpecialCharacters,test:function(e){return/^[a-z0-9\-_]*$/i.test(e.val())}},usernameCharacterLength:{message:i.usernameCharacterLength,test:function(e){var t=e.val().length;return t>=3&&t<=25}},atLeastOneAlphanumeric:{message:i.atLeastOneAlphanumeric,test:function(e){return/.*[a-z0-9]+.*/i.test(e.val())}}},_create:function(){var e=this.options,t={};this._super(),e.validateOnBlur&&(t["focusout :input:not("+this.ignoreSelector+", [data-_enabled])"]="_handleFocusOut",t["blur :input:not("+this.ignoreSelector+", [data-_enabled])"]="_handleChange",this._on(this.$form,t))},getMessage:function(e,t){return this._super(e,t)||i[e||"generic"]||i.generic},addInlineError:function(t,i){t=t.data("_field_delegate")||t;var n,a,r,o=this.options,l={name:i,position:"inline"};"error"!==(t.data("error")||{}).type&&(a=this.getMessage(i,t),n=this.getRule(i).type||"error",r=s.compile(o.inlineErrorTemplate,{type:n,id:t.attr("id"),message:a}),e.extend(l,{type:n,message:a,$error:e(r).attr("data-validate-error",!0),fieldClass:s.compile(this.options.classFieldStatus,{type:n})}),t.addClass(l.fieldClass).data("error",l),t.attr("aria-invalid","true"),!1!==a&&("slide"===o.animation?(l.$error=e("<div />").wrapInner(l.$error),o.placeError.call(this,l.$error,t),this._completeAddError(l,t)):(o.placeError.call(this,l.$error,t),this._completeAddError(l,t))))},removeError:function(e){e=e.data("_field_delegate")||e;var t=this.options,i=e.data("error");i&&("slide"===t.animation?i.$error.remove():(e.remove(),this._completeRemoveError(i,e)),e.removeClass(i.fieldClass).removeData("error"),e.attr("aria-invalid","false"),this._completeRemoveError(i,e))}})}),define("translations/loading",["managers/edition"],function(e){return e.getTranslation({en:{loading:"Loading",end:"The End",error:"Error Encountered"},es:{loading:"Cargando",end:"Fin",error:"Error Encontrado"}})}),define("fly/components/loading-1.0",["jquery","version!fly/utils/string-vars","version!fly/components/base"],function(e,t){e.widget("fly.loading",e.fly.base,{options:{disabled:!1,delay:100,timeout:25e3,initState:"",template:'<div class="{baseClass} {stateClass}"><span class="text">{text}</span></div>',classes:{base:"loader",idle:"",loading:"loading",end:"load-end",error:"load-error"},text:{idle:"",loading:"Loading",end:"The End",error:"Error Encountered :("}},_create:function(){this._setup(),this._state=null,this._timeoutId=null},_init:function(){var e=this.options;!e.disabled&&e.initState&&(this._setContent(e.initState),this._state=e.initState)},_setContent:function(i,s){var n,a=this.options;"remove"!==i?(n=t.compile(a.template,e.extend({state:i,baseClass:a.classes.base,stateClass:a.classes[i],text:a.text[i]},s)),this.$element.html(n)):this.$element.empty()},add:function(){var t=this.options;!1!==this._trigger("add")&&(this.update("loading"),"number"==typeof t.timeout&&t.timeout>0&&(this._timeoutId=setTimeout(e.proxy(this.remove,this),t.timeout)),this._trigger("added"))},remove:function(){!1!==this._trigger("remove")&&(this.update("remove"),this._trigger("removed"))},update:function(e,t){var i=this.options,s={state:e};!1!==this._trigger("update",null,s)&&(this._state=e,i.disabled||(clearTimeout(this._timeoutId),this._setContent(e,t),this._trigger("updated",null,s)))},isLoading:function(){return"loading"===this._state},getState:function(){return this._state},_setOption:function(e,t){var i=this.options;"data"===e?this.$element.data("data",t):"disabled"===e&&(!0===t?this.$element.empty():this._setContent(i.initState)),this._super(e,t)},_destroy:function(){this.$element.remove()}})}),define("components/loading",["jquery","version!fly/managers/debug","translations/loading","version!fly/components/loading"],function(e,t,i){t=t.init("loading"),e.widget("cnet.loading",e.fly.loading,{options:{template:'<div class="{baseClass} {stateClass}"><span class="text">{text}</span></div>',classes:{base:"loader",idle:"",loading:"loadingCircle",end:"load-end",error:"load-error"},text:i},add:function(){this._super(),this.$element.parent().addClass("loadingArea")},remove:function(){this._super(),this.$element.parent().removeClass("loadingArea")}})}),define("components/authentication",["jquery","version!fly/managers/debug","managers/ad","version!fly/managers/components","utils/cookie","managers/edition","managers/page-vars","managers/tealium","managers/recommendation-data","translations/form-validate","utils/urs-helper","version!fly/utils/url-helper","managers/client-storage","version!fly/components/base","components/form-validate","components/loading"],function(e,t,i,s,n,a,r,o,l,d,u,c,h){t=t.init("authentication");const p=h.localStorageSupported();e.widget("cnet.authentication",e.fly.base,{options:{classComplete:"complete",classSelected:"selected",classShow:"show",classActive:"active",classFade:"fade",classHide:"hide"},appId:376,entryPoints:{375:"brand_nav",270:"comments",280:"forums",265:"polls",263:"my_list",367:"brand_nav",359:"my_list",394:"brand_nav",398:"comments",376:"brand_nav",36:"comments",27:"forums",225:"polls",222:"my_list",361:"sweepstakes",370:"brand_nav",358:"my_list",368:"sweepstakes",393:"brand_nav",397:"comments",386:"sweepstakes"},newsletterCodes:{375:"e245",270:"e245",280:"e245,e497",265:"e245",263:"e245",367:"e226,e231",359:"e226,e231",394:"e237,e245",398:"e237,e245",452:"e245",453:"e245",455:"e226,e231",376:"e245",36:"e245",27:"e245,e497",202:"e237,e245",225:"e245",222:"e245",361:"e239,e245,e214",370:"e226,e231",358:"e226,e231",368:"e226,e231,e148",393:"e237,e245",397:"e237,e245",386:"e237,e245",451:"e245",454:"e245",456:"e226,e231"},$form:null,$modal:null,loading:!1,nextAction:null,refresh:!1,socialRegistration:!1,step:"start",regService:"",steps:["facebookRegister","forgot","interests","login","loginOrRegister","register","start","username"],userData:null,termsRequired:!1,termsChecked:!1,_baseTrackingData:{_pageTitle:r.tracking.data._pageTitle,siteSection:r.tracking.data.siteSection,pageType:r.tracking.data.pageType,siteEdition:r.tracking.data.siteEdition,siteType:r.tracking.data.siteType,siteHier:r.tracking.data.siteHier,brand:r.tracking.data.brand,_pageChannelType:r.tracking.data._pageChannelType,audienceManagerBlob:r.tracking.data.guid,pageViewGuid:r.guid},_create:function(){this._setup(),this._setupPageEvents(),this._loadUserData(),this._checkForOpenLoginOnLoad()},_close:function(){this.$modal.removeClass(this.options.classShow),e("body").removeClass("noScroll"),this.$modal.attr({"aria-hidden":"true",tabindex:"-1"})},_completeLogin:function(){var t=this,s=r.tracking.data;this.getUserData(function(e,s){"function"==typeof t.nextAction&&(t.refresh=t.nextAction(e),t.nextAction=null),l.repopulateInterestDB(function(){window.UA.then(function(e){l.syncInterestsWithBackend(s,e)})}),t.$element.trigger("userhasloggedin",s),!0===t.refresh?window.location.reload():i.loadAds(i.getAdUnits(),r.ads.data)}),o.trackCustomEvent("trackLogin",e.extend(!0,{},this._baseTrackingData,{userId:s.userId,userState:"authenticated",userType:"registered",regService:t.regService,regDriver:t.entryPoints[t.appId]}),"login")},_displayError:function(e){var t=this.$form.find('[data-global-errors*="'+e+'"]'),i=this.$form.data("formValidate");0===t.length?i.addGlobalError(d[e||"generic"]||d.generic,"error"):i.addInlineError(t,e)},getUserData:function(e){this.userData?e(null,this.userData):this.$element.one("userdataloaded",e)},hasAccess:function(t){var i=this;(t=e.extend(!0,{nextAction:null,requireUsername:!1},t)).appId&&(i.appId=t.appId),this.getUserData(function(e,s){s.isLoggedIn?t.requireUsername&&!s.userName?(i.nextAction=t.nextAction,i._show("username")):"function"==typeof t.nextAction&&t.nextAction(s):(i.nextAction=t.nextAction,i._show("start"),i._trackCustomEvent("tap","start_authentication"))})},_loadUserData:function(){var t=this;this.userData=null,n.read("purs_1")?e.ajax({dataType:"json",url:r.user.urls.userData}).done(function(i){t.userData=e.extend(!0,i.user,{isLoggedIn:i.isLoggedIn}),window._cbq.push(["_acct","lgdin"]),t._updateDisplay(),t.$element.trigger("userdataloaded",[t.userData])}):(this.userData={isLoggedIn:!1},window._cbq.push(["_acct","anon"]))},logout:function(){var t=this;r.tracking.data;e.ajax({dataType:"json",url:e('[data-user-action="logout"]').attr("href")}).done(function(i){const s=t.userData;t.userData={isLoggedIn:!1},o.trackCustomEvent("trackLogout",e.extend(!0,{},t._baseTrackingData,{userId:"",userState:"not authenticated",userType:"anon",regService:t.regService,regDriver:t.entryPoints[t.appId]}),"logout"),window._cbq.push(["_acct","anon"]),t._updateDisplay(),t.$element.trigger("userhasloggedout"),t.$window.trigger("anonuserloaded",[s,t.userData])})},_setStep:function(t){var i=this;if(this.$modal){var s=this.$modal.find("._"+this.step+" input[type=email]").val();this.$modal.find("._"+t+" input[type=email]").val(s)}this.step=t,this.$modal&&(this.$modal.removeClass(this.steps.join(" ")).addClass(this.step).addClass(this.options.classShow),this.$modal.find("._"+this.step).addClass(this.options.classActive).attr("aria-hidden","false"),this.$modal.find("input:not([type=hidden])").attr("disabled","disabled"),this.$modal.find("._"+this.step+" input").removeAttr("disabled"),this.$modal.find("[data-app-ids]").each(function(t,s){var n=e(s);n.data("appIds").indexOf(i.appId)<0&&n.attr("disabled","disabled")}),this.$modal.attr({"aria-hidden":"false",tabindex:"0"}),e(".c-siteHeader").hasClass("-srOnly")&&this.$modal.trigger("focus"),e(".c-masthead").hasClass("-srOnly")&&this.$modal.trigger("focus"),this.$modal.find('[data-focus="'+this.step+'"]').trigger("focus"),e("body").addClass("noScroll"))},_fadeOutStep:function(){this.$modal.find(".fade").removeClass(this.options.classFade);var t=this.$modal.find(".active");t&&(e(t).removeClass(this.options.classActive),e(t).addClass(this.options.classFade),this.$modal.attr("aria-hidden","true"))},_setupModalEvents:function(){var i=this;i.termsChecked=!1,this.$modal&&(this.$modal.find('[data-action="close"]').on("click",function(e){i._close()}),this.$modal.find('[data-action="close"]').on("keydown",function(t){13!==t.keyCode&&32!==t.keyCode||(t.preventDefault(),i._close(),"mobile"===r.device?e('[data-component="nav"]').focus():e("[data-authentication]").focus())}),this.$modal.find('[data-action="urs"]').on("tap",function(e){i.regService="urs",i._trackCustomEvent("tap","choose_authentication_method")}),this.$modal.find('[data-action="facebook"]').on("tap",function(e){u.getUrs(u.getSocialAppId(i.appId),i._setupSocialEvents.bind(i)).social.authenticate("facebook"),i.regService="facebook",i._trackCustomEvent("tap","choose_authentication_method")}),this.$modal.find('[data-action="forgot"]').on("tap",function(t){var s=i.$form.data("formValidate"),n=i.$form.find("#authentication_login_email");s.testField(n)&&e.ajax({data:{email:n.val(),csrf:i.$form.find("#authentication_csrf").val()},dataType:"json",type:"POST",url:r.user.urls.forgot}).done(function(e){i._show("forgot")})}),this.$modal.find('[data-action="showHidePass"]').on("click",function(e){var t=i.$form.find("._"+i.step+" .password");""!=t.val()&&("password"==t.prop("type")?(t.prop("type","text"),i._trackCustomEvent("click","unmask pw")):(t.prop("type","password"),i._trackCustomEvent("click","mask pw")),i.$modal.find('[data-action="showHidePass"]').toggleClass("u-hidden")),t.focus()}),this.$modal.find("[data-interest]").on("tap",function(t){var s=e(this).data("interest");e(this).toggleClass(i.options.classSelected),i._trackCustomEvent("tap","mark_interest|"+s.tracking)}),this.$modal.find("#authentication_register_password").on("keyup",function(t){if(e(t.target).parent().hasClass("active")){var s=i.$form.find("."+i.options.classActive+" button"),n=i.$form.find("#authentication_register_terms"),a=i.$form.find("[data-password-validation=requirements]"),r=i.$form.find("[data-password-validation=characters]"),o=i.$form.find("[data-password-validation=letter]"),l=i.$form.find("[data-password-validation=number]"),d=i.$form.find("[data-password-validation=specialCharacter]"),u=e(this).val();i.termsChecked=n.prop("checked");var c=u.length>=6,h=/[A-Za-z]+/g.test(u),p=/[0-9]/g.test(u),g=/[\(\)\.@`!#\$%\^&*+=\-\[\]\\';,\/\{\}\|":<>\?~_]+/.test(u);u.length>0&&!(c&&h&&p&&g)?(a.addClass(i.options.classShow).removeClass(i.options.classHide),c?r.addClass(i.options.classComplete):r.removeClass(i.options.classComplete),h?o.addClass(i.options.classComplete):o.removeClass(i.options.classComplete),p?l.addClass(i.options.classComplete):l.removeClass(i.options.classComplete),g?d.addClass(i.options.classComplete):d.removeClass(i.options.classComplete)):a.addClass(i.options.classHide),c&&h&&p&&g&&(!i.termsRequired||i.termsChecked)?s.removeAttr("disabled"):s.attr("disabled","disabled")}}),this.$modal.find("#authentication_register_terms").on("change",function(t){var s=i.$form.find("."+i.options.classActive+" button"),n=e(this),a=i.$form.find("#authentication_register_password").val();i.termsChecked=n.prop("checked");var r=a.length>=6,o=/[A-Za-z]+/g.test(a),l=/[0-9]/g.test(a),d=/[\(\)\.@`!#\$%\^&*+=\-\[\]\\';,\/\{\}\|":<>\?~_]+/.test(a);r&&o&&l&&d&&(!i.termsRequired||i.termsChecked)?s.removeAttr("disabled"):s.attr("disabled","disabled")}),this.$modal.find("#authentication_facebook_terms").on("change",function(t){i.termsChecked=e(this).prop("checked")}),this.$form.formValidate({validateOnBlur:!0,validateOnChange:!1,success:function(s){s.preventDefault();var n=i.$form.serializeArray(),d={appId:i.appId},c=0===n.length?d:n.reduce(function(e,t){return e[t.name]=t.value,e},d),h=i.$form.find('[data-component="loading"]').data("cnetLoading");switch(i.step){case"start":i._show("loginOrRegister");break;case"facebookRegister":u.getUrs(u.getSocialAppId(i.appId),i._setupSocialEvents.bind(i)).social.authenticate("facebook",!0,{userName:i.$form.find("#authentication_facebook_username").val()});break;case"loginOrRegister":h.add(),e.ajax({data:c,dataType:"json",type:"POST",url:r.user.urls.checkEmail}).done(function(e){if(e.success){var t=e.taken?"signin_started":"registration_started";i._trackCustomEvent("enterData","email|"+t),i._show(e.taken?"login":"register")}else i._displayError(e.error);i.$modal.find("#authentication_csrf").val(e.csrf),h.remove()});break;case"register":h.add(),e.ajax({data:c,dataType:"json",type:"POST",url:r.user.urls.register}).done(function(t){t.success?(i._loadUserData(),a.isEspanol()?(i._close(),i._completeLogin()):i._show("interests"),i.termsChecked&&i.loadBlueHornetId(),o.trackCustomEvent("trackRegistration",e.extend(!0,{},i._baseTrackingData,{userid:r.tracking.data.userId,regService:i.regService,regDriver:i.entryPoints[i.appId],userState:"authenticated",userType:"registered",clickGenericText:"email_opt_in|"+i.termsChecked}),"confirmRegistration")):(i._displayError(t.error),"inuse.userName"===t.error?i._trackCustomEvent("enterData","username|taken"):"invalid.email"===t.error&&i._trackCustomEvent("enterData","email|invalid")),i.$modal.find("#authentication_csrf").val(t.csrf),h.remove()});break;case"interests":h.add();let s=[];var g=i.$form.find("[data-interest]."+i.options.classSelected).get().reduce(function(t,n){var a=e(n).data("interest");t.interests.push(a.interest),t.newsletters.push(a.newsletter);let r={id:a.id,name:a.tracking,type:"broad"};return i.getUserData(function(e,t){let i=l.createExplicitInterestObject("follow",r,t);l.writeExplicitInterestToLocalStorage(i),p&&"true"===localStorage.getItem("CnetUdsEnabled")&&s.push(i)}),window.UA.then(function(e){p&&"true"!==localStorage.getItem("CnetUdsEnabled")&&e.channel&&e.channel.tags&&e.channel.tags.add(r.name.toUpperCase(),l.getTagGroupByInterest(r.type))}),t},{interests:[],newsletters:[]});p&&"true"===localStorage.getItem("CnetUdsEnabled")&&window.uds_sdk&&window.uds_sdk.addInterest(s,"registration"),i._trackCustomEvent("tap","submit_interest|"+g.interests.length),i.getUserData(function(t,s){e.ajax({data:{interests:g.interests.join(","),newsletters:g.newsletters.join(","),regId:s.registrationId},dataType:"json",type:"POST",url:r.user.urls.interests}).done(function(e){e.success?(i._close(),i._completeLogin()):i._displayError(e.error),g.newsletters.length>0&&i.loadBlueHornetId(),i.$modal.find("#authentication_csrf").val(e.csrf),h.remove()})});break;case"login":h.add(),e.ajax({data:c,dataType:"json",type:"POST",url:r.user.urls.login}).done(function(e){e.success?(i._close(),i._loadUserData(),i._completeLogin()):(i._displayError(e.error),"invalid.loginpassword"===e.error&&i._trackCustomEvent("enterData","password|wrong")),i.$modal.find("#authentication_csrf").val(e.csrf),h.remove()});break;case"forgot":i._close();break;case"username":h.add(),e.ajax({data:c,dataType:"json",type:"POST",url:r.user.urls.username}).done(function(e){e.success?(i._close(),i._loadUserData(),i._completeLogin()):(i._displayError(e.error),"inuse.userName"===e.error&&i._trackCustomEvent("enterData","username|taken")),h.remove()});break;default:t.log("Current step not recognized.")}},placeError:function(e,t){t.is(":checkbox, :radio")&&t.parent("label").length?e.insertBefore(t.parent("label")):e.insertBefore(t)},errorAdded:function(e,t){"email"===t.name?i._trackCustomEvent("enterData","email|invalid"):"validPassword"===t.name?i._trackCustomEvent("enterData","password|invalid"):"usernameSpecialCharacters"!==t.name&&"usernameCharacterLength"!==t.name||i._trackCustomEvent("enterData","username|invalid")}}))},loadBlueHornetId:function(){e.ajax({dataType:"json",type:"POST",url:"/user/authentication/bluehornet/"}).done(function(e){p&&e[0].contactId&&localStorage.setItem("v77_contact_id",e[0].contactId)})},_setupPageEvents:function(){var t=this;this.$document.on("keydown","[data-authentication]",function(i){if(13===i.keyCode||32===i.keyCode){i.preventDefault();var s=e(this).data("authentication");t._setupEntryPoints(s)}}),this.$document.on("tap","[data-authentication]",function(i){var s=e(this).data("authentication");t._setupEntryPoints(s)}),this.$document.on("tap",'[data-user-action="logout"]',function(i){"true"===e('[data-user-action="logout"]').attr("data-user-suppress-refresh")&&i.preventDefault(),!window.uds_sdk||p&&"true"!==localStorage.getItem("CnetUdsEnabled")?l.repopulateInterestDB(function(){t.logout()},!0):t.logout()})},_setupEntryPoints:function(e){var t=this;e.appId&&(t.appId=e.appId),"boolean"==typeof e.refresh&&(t.refresh=e.refresh),t.socialRegistration=!1,t._trackCustomEvent("tap","start_authentication"),t.getUserData(function(i,s){s.isLoggedIn&&e.requireUsername&&!s.userName?t._show("username"):t._show("start")})},_setupSocialEvents:function(t){var i=this;t.common.addEventListener(URS.events.AUTH_COMPLETE,function(t,s){if(s.response.status.errors&&s.response.status.errors.length>0){var l=e.map(s.response.status.errors,function(e,t){return e.applicationCode});l.indexOf("invalid.noLink")>=0?(i.socialRegistration=!0,i._show("facebookRegister"),i._trackCustomEvent("enterData","facebook_credentials|registration_started")):(i._displayError(l[0]),(l.indexOf("required.email")>=0||l.indexOf("notallowed.socialLink")>=0)&&i.$modal.find("._facebookRegister").addClass("failed"),l.indexOf("inuse.userName")>=0&&i._trackCustomEvent("enterData","username|taken"))}else n.write(i.options.cookieUserRecognized,JSON.stringify({username:s.response.receipt.account.displayName,socialSite:s.response.socialSite}),{expires:365}),e.post("/user/social-login/",{email:s.response.receipt.account.emailAddress},function(t){"success"===t.status&&(i._loadUserData(),i.socialRegistration&&!a.isEspanol()?(o.trackCustomEvent("trackRegistration",e.extend(!0,{},i._baseTrackingData,{userid:r.tracking.data.userId,regService:"facebook",regDriver:i.entryPoints[i.appId],userState:"authenticated",userType:"registered",clickGenericText:"email_opt_in|"+i.termsChecked}),"confirmRegistration"),i._show("interests")):(i._close(),i._completeLogin()))},"json")})},_show:function(t){var i=this;if(!this.loading)if(["start","username"].indexOf(t)>=0)this.loading=!0,this.$modal&&this.$modal.remove(),e.ajax({url:r.user.urls.modal}).done(function(n){i.$modal=e(n.html).addClass("appId"+i.appId).appendTo(e("body")),i._setStep(t),i.$form=i.$modal.find("form"),s.process(i.$modal),i._setupModalEvents(),i.loading=!1,e(window).trigger("authenticationLoaded")});else{this.$form.data("formValidate").removeGlobalErrors();var n=100*(3*this.$modal.find("._"+this.step)[0].children.length+5);setTimeout(function(){i._setStep(t)},n),i._fadeOutStep()}},_updateDisplay:function(){var t=this,i=e("body");this.userData.isLoggedIn?(e("[data-user-var]").each(function(){var i=e(this),s=i.data("userVar"),n=i.data("userVarAttr"),a=t.userData[s];"userName"===s?(a||(a=t.userData.displayName),a.length>13&&"mobile"==r.device?a=a.substr(0,13)+"...":a.length>25&&(a=a.substr(0,22)+"...")):"profileLink"===s&&(n="href",a=i.attr("data-template").replace("__username__",t.userData.userName?t.userData.userName.replace(/ /g,"+").toLowerCase():t.userData.registrationId)),a&&(n?i.attr(n,a):"avatar"===s?i.html('<img class="avatarImg" src="'+a+'" />'):i.text(a))}),i.addClass("is-logged-in").removeClass("not-logged-in")):(e("[data-user-var]").each(function(){var i=e(this),s=i.data("userVar"),n=i.data("userVarAttr"),a=t.userData[s];"userName"===s?a=" ":"profileLink"===s&&(n="href",a="#"),a&&(n?i.attr(n,a):"avatar"===s?i.find("img").remove():i.text(a))}),i.removeClass("is-logged-in").addClass("not-logged-in"),e(".loggedIn .navMenu").removeClass("is-expanded").addClass("is-collapsed"),e(".c-siteHeader").removeClass("is-expanded").addClass("is-collapsed"),e(".c-masthead").removeClass("is-expanded").addClass("is-collapsed"),e("body").removeClass("nav-open").addClass("nav-closed"))},_newsletterSubscribe:function(){var i=this;i.termsChecked&&i.getUserData(function(s,n){n.isLoggedIn?e.ajax({data:{newsletters:i.newsletterCodes[i.appId],regId:n.registrationId},dataType:"json",type:"POST",url:r.user.urls.newsletters}).done(function(e){e.success?t.log("Successfully subscribed user to eCodes: "+i.newsletterCodes[i.appId]):t.log("Failed to subscribe user to newsletters.")}):t.log("Cannot subscribe to newsletters: User must be logged in.")})},_checkForOpenLoginOnLoad:function(){"1"==c.getParam("openLogin")&&e("[data-authentication]").first().trigger("tap")},_trackCustomEvent:function(i,s){t.log("Track custom event: "+i);r.tracking.data;o.trackCustomEvent(i,e.extend(!0,{},this._baseTrackingData,{clickGenericText:s,regService:this.regService,regDriver:this.entryPoints[this.appId]}),"trackClick")}})}),define("fly/utils/data-selector-1.0",["jquery"],function(e){e.extend(e.expr[":"],{data:e.expr.createPseudo(function(t){return function(i){return!!e.data(i,t)}})})}),define("components/tabs-modal",["jquery","managers/tealium","managers/page-vars","version!fly/components/base","version!fly/utils/data-selector"],function(e,t,i){e.widget("cnet.tabsModal",e.fly.base,{options:{classOverlay:"loadingArea",classSelected:"selected",classOpen:"modalopen",closeModalSelector:'[data-item="close"]',enableDeselect:!1,enableEsc:!1,idOverlay:"bodyWrapper",notRoadshow:!1,selectorFocus:'[data-item="focus"]',tabSelector:'[data-item="trigger"]',closeOnScroll:!1},$currentTab:null,_baseTrackingData:{_pageTitle:i.tracking.data._pageTitle,siteSection:i.tracking.data.siteSection,pageType:i.tracking.data.pageType,siteEdition:i.tracking.data.siteEdition,siteType:i.tracking.data.siteType,siteHier:i.tracking.data.siteHier,brand:i.tracking.data.brand,_pageChannelType:i.tracking.data._pageChannelType},_create:function(){var e=this.options,t={},i=this;this._setup(),t["click "+e.tabSelector]="_handleClick",this._on(this.$element,t),this.$element.on("click",this.options.closeModalSelector,function(){i._hide(i.$currentTab)}),this.options.enableEsc&&this.$element.on("keydown",function(e){27===e.keyCode&&(e.preventDefault(),i._hide(i.$currentTab))})},_handleClick:function(t){var i=this.options,s=e(t.target).closest(i.tabSelector);t.preventDefault(),this.change(s)},_handleScroll:function(){this.$window.off("scroll.tabsModal"),this._hide(this.$currentTab)},_getContent:function(t){var i,s=t.data()||{},n=s.$content||[];return n.length?n:(i=s.target||t.attr("href"),n=e(i),t.data("$content",n),n)},_show:function(i){var s,n=this.options,a=this;if(!1!==this._trigger("show",null,{$tab:i})){this.$currentTab=i,s=this._getContent(i),e("html").addClass("scrollDisabled"),i.addClass(n.classSelected),s.addClass(n.classSelected),this._trigger("shown",null,{$tab:i,$content:s});var r="false"===i.attr("aria-expanded");i.attr("aria-expanded",r),s.attr("aria-hidden",!r),this.showOverlay();var o=e.extend(a._baseTrackingData,{clickGenericText:a.$currentTab.data("clicktracking")+"|open"});t.trackCustomEvent(a.$currentTab.data("eventName"),o,"trackClick"),setTimeout(function(){s.find(a.options.selectorFocus).focus()},300),n.closeOnScroll&&this.$window.on("scroll.tabsModal",this._handleScroll.bind(this))}},_hide:function(i){var s,n=this.options;if(!1!==this._trigger("hide",null,{$tab:i})){s=this._getContent(i),i.removeClass(n.classSelected),s.removeClass(n.classSelected),e("html").removeClass("scrollDisabled"),this._trigger("hidden",null,{$tab:i,$content:s});var a="false"===i.attr("aria-expanded");if(i.attr("aria-expanded",a),s.attr("aria-hidden",!a),this.hideOverlay(),this.$currentTab){var r=e.extend(this._baseTrackingData,{clickGenericText:this.$currentTab.data("clicktracking")+"|close"});t.trackCustomEvent(this.$currentTab.data("eventName"),r,"trackClick")}this.$currentTab=null}},change:function(e){var t,i=this.options;t=this.$element.find(i.tabSelector+"."+i.classSelected),e.data(),e.hasClass(i.classSelected)?i.enableDeselect&&this._hide(t):(this._hide(t),this._show(e))},showOverlay:function(){var t=e("<div>",{id:this.options.idOverlay,class:this.options.classOverlay});this.options.notRoadshow?e("#rbHeader").addClass(this.options.classOpen):e(".autoHeader").addClass(this.options.classOpen),e("body").append(t);var i=this;t.on("click",function(){i.change(e(i.options.tabSelector+"."+i.options.classSelected,i.$element))})},hideOverlay:function(){e(".autoHeader").removeClass(this.options.classOpen),e("#rbHeader").removeClass(this.options.classOpen),e("#"+this.options.idOverlay).remove()}})}),define("components/site-header",["jquery","managers/client-storage","version!fly/managers/debug","managers/tealium","managers/page-vars","version!fly/components/base"],function(e,t,i,s,n){i=i.init("siteHeader"),e.widget("cnet.siteHeader",e.fly.base,{options:{classExpanded:"is-expanded",classCollapsed:"is-collapsed",classScreenRead:"-srOnly",selectorNav:".c-siteHeader",classLink:".menuList_link",selectorMenuContainer:'[data-item="menuContainer"]',storageName:"cnet_header_new_tag"},_baseTrackingData:{_pageTitle:n.tracking.data._pageTitle,siteSection:n.tracking.data.siteSection,pageType:n.tracking.data.pageType,siteEdition:n.tracking.data.siteEdition,siteType:n.tracking.data.siteType,siteHier:n.tracking.data.siteHier,brand:n.tracking.data.brand,_pageChannelType:n.tracking.data._pageChannelType},_create:function(){this._setup(),this._setupEvents()},_setupEvents:function(){var i=this,s=i.options,n=e(".search .navMenuItem"),a=this.$element.find('[data-item="menuItem"]'),r=this.$element.find(s.selectorMenuContainer),o=e(s.selectorNav),l=e(s.classLink);n.on("click",function(){setTimeout(function(){e("[data-search-input]").focus()},200)}),a.on("click",function(n){if(n.preventDefault(),e(n.currentTarget).closest(s.selectorMenuContainer).hasClass(s.classExpanded))e(n.currentTarget).closest(s.selectorMenuContainer).removeClass(s.classExpanded).addClass(s.classCollapsed),i._trackEvent("navClick",o.attr("section")+"|"+e(n.currentTarget).closest(s.selectorMenuContainer).attr("section")+"|close");else{for(var a=0;a<r.length;a++)r.eq(a).hasClass(s.classExpanded)&&r.eq(a).removeClass(s.classExpanded).addClass(s.classCollapsed);if(e(n.currentTarget).closest(s.selectorMenuContainer).removeClass(s.classCollapsed).addClass(s.classExpanded),i._trackEvent("navClick",o.attr("section")+"|"+e(n.currentTarget).closest(s.selectorMenuContainer).attr("section")+"|open"),"reviews"===e(n.currentTarget).closest(s.selectorMenuContainer).attr("section")){var l=t.read(i.options.storageName);l>=3?i.$element.find("[data-new-flag]").addClass("hidden"):l?t.write(i.options.storageName,parseInt(l,10)+1):t.write(i.options.storageName,1)}}}),a.on("keydown",function(t){switch(t.which){case 38:t.preventDefault(),e(t.currentTarget).closest(s.selectorMenuContainer).removeClass(s.classExpanded).addClass(s.classCollapsed);break;case 32:t.preventDefault(),e(t.currentTarget).trigger("click");break;case 40:if(t.preventDefault(),"searchMenuItem"===t.currentTarget.id)e(t.currentTarget).trigger("click");else{for(var i=0;i<r.length;i++)r.eq(i).hasClass(s.classExpanded)&&r.eq(i).removeClass(s.classExpanded).addClass(s.classCollapsed);e(t.currentTarget).closest(s.selectorMenuContainer).removeClass(s.classCollapsed).addClass(s.classExpanded)}break;case 27:t.preventDefault();for(var n=0;n<r.length;n++)r.eq(n).hasClass(s.classExpanded)&&r.eq(n).removeClass(s.classExpanded).addClass(s.classCollapsed)}}),e(this.$element).on("keydown",function(t){9===t.keyCode&&e(t.currentTarget).addClass(s.classScreenRead)}),e(this.$element).on("click",function(t){e(t.currentTarget).removeClass(s.classScreenRead)}),e(this.$element.nextAll()).click(function(){for(var e=0;e<r.length;e++)r.eq(e).hasClass(s.classExpanded)&&r.eq(e).removeClass(s.classExpanded).addClass(s.classCollapsed)}),e('[data-item="logoContainer"').click(function(){for(var e=0;e<r.length;e++)r.eq(e).hasClass(s.classExpanded)&&r.eq(e).removeClass(s.classExpanded).addClass(s.classCollapsed)}),l.on("click",function(t){i._trackEvent("navLinkClick",o.attr("section")+"|"+e(t.currentTarget).closest(s.selectorMenuContainer).attr("section")+"|"+e(t.currentTarget).text().replace(" ","-"))})},_trackEvent:function(t,i){s.trackCustomEvent(t,e.extend(this._baseTrackingData,{clickGenericText:i}),"trackClick")}})}),define("components/auto-suggest",["jquery","version!fly/managers/debug","managers/tealium","managers/page-vars","version!fly/components/base"],function(e,t,i,s){t=t.init("autoSuggest"),e.widget("cnet.autoSuggest",e.fly.base,{options:{limit:null,classMenuShow:"active",classOpen:"open",classReady:"ready",classSelected:"selected",selectorMenu:".menuWrapper",selectorSuggestions:"li:not(.hed)",url:"/autosuggest/xhr/",showLimit:10,clickable:!1},suggestXhr:null,$searchBox:null,$submitButton:null,_didTrackEnterSubmit:!1,_baseTrackingData:{_pageTitle:s.tracking.data._pageTitle,siteSection:s.tracking.data.siteSection,pageType:s.tracking.data.pageType,siteEdition:s.tracking.data.siteEdition,siteType:s.tracking.data.siteType,siteHier:s.tracking.data.siteHier,brand:s.tracking.data.brand,_pageChannelType:s.tracking.data._pageChannelType},_create:function(){this._setup(),this.$searchBox=this.$element.find("input"),this.$submitButton=this.$element.find('[type="submit"]'),this.$siteHeader=e("#rbHeader"),this._setupEvents(),this._setupTracking()},_setupEvents:function(){var t=this;this.$element.on("submit",function(i){var s=e(t.options.selectorSuggestions,t.$element).filter("."+t.options.classSelected),n=s.text(),a=s.attr("href");a?(i.preventDefault(),window.location.href=a):n&&t.$searchBox.val(n)}),this.$element.on("mousedown",this.options.selectorSuggestions,function(i){var s=e(this).attr("href");if(s)window.location=s;else{var n=e(t.options.selectorSuggestions,t.$element).filter("."+t.options.classSelected);""!==n.text()&&n.removeClass(t.options.classSelected),t._submitAutoSuggest(i)}}),this.$searchBox.on("focusout",function(i){0==e(i.relatedTarget).closest(".menuWrapper").length&&t._hideAutoSuggest()}),this.$searchBox.on("keyup",function(e){e.which>=37&&e.which<=40||t._doAutoSuggest()}),this.$searchBox.on("keydown",function(e){e.which>=37&&e.which<=40&&t._doArrowKey(e)}),e('[data-component="siteHeader"]').on("siteheadersectionchange",function(){t._updateSmartSearchTracking()}),e("#searchMenu [data-searchoverlay]").on("click",function(){t.$siteHeader.hasClass("showSearch")&&t.$siteHeader.removeClass("showSearch")})},_doAutoSuggest:function(){var i=this,s=i.options;if(i.suggestXhr&&4!=i.suggestXhr.readyState&&0!==i.suggestXhr.readyState&&i.suggestXhr.abort(),""!==i.$searchBox.val()){var n=s.url+"?query="+i.$searchBox.val();s.limit&&(n=n+"&limit="+s.limit),s.showLimit&&(n=n+"&showLimit="+s.showLimit),t.log("AutoSuggestXHR: ",n),this.$submitButton.addClass(this.options.classReady),this.$searchBox.addClass(this.options.classReady),!1===this.options.clickable&&!this.$siteHeader.hasClass("showSearch")&&this.$siteHeader.addClass("showSearch"),i.suggestXhr=e.ajax({url:n,dataType:"json",context:document.body}).done(function(t){i.$element.addClass(s.classMenuShow);var n=e(e.parseHTML(e.trim(t.html)));e(s.selectorSuggestions,n).length>0?(0===e(s.selectorMenu,i.$element).length?n.appendTo(i.$element):e(s.selectorMenu,i.$element).replaceWith(n),i._setupAdditionalResults()):(i._hideAutoSuggest(),e(s.selectorMenu,i.$element).html(""))}).fail(function(){i._hideAutoSuggest()})}else i._hideAutoSuggest(),e(s.selectorMenu,i.$element).html(""),this.$siteHeader.hasClass("showSearch")&&this.$siteHeader.removeClass("showSearch"),this.$submitButton.removeClass(this.options.classReady),this.$searchBox.removeClass(this.options.classReady)},_doArrowKey:function(t){var i=e(this.options.selectorSuggestions,this.$element),s=i.filter("."+this.options.classSelected),n=i.index(s);if(38===t.which)s.removeClass(this.options.classSelected),n<=0?i.last().addClass(this.options.classSelected):i.eq(n-1).addClass(this.options.classSelected);else if(40===t.which)s.removeClass(this.options.classSelected),n<0||n===i.length-1?i.first().addClass(this.options.classSelected):i.eq(n+1).addClass(this.options.classSelected);else if(37===t.which||39===t.which){var a=s.closest("[data-additional-results]");a.length>0&&this._toggleAdditionalResults(this.$element.find("[data-additional-results]"),a,39===t.which)}},_hideAutoSuggest:function(){var e=this.options;this.$element.removeClass(e.classMenuShow)},_updateSmartSearchTracking:function(){var t=e("#searchTab [data-searchtracking]");if(t.length>0){var i=e("#rbHeader > nav[section]").attr("section")?e("#rbHeader > nav[section]").attr("section"):"";t.attr("section",i)}},_submitAutoSuggest:function(t){var s=e(t.target),n=s.text();i.trackSuggestedSearch({searchTerm:n,dwLinkTag:"search|suggestedSearch|"+s.prevAll().length}),this.$searchBox.val(n),this.$element.submit()},_setupAdditionalResults:function(){var t=this,i=this.$element.find("[data-additional-results]");i.each(function(s,n){var a=e(n);a.find('[data-auto-suggest-item="trigger"]').on("click",function(){t._toggleAdditionalResults(i,a)})})},_toggleAdditionalResults:function(t,i,s){var n=this,a=i.find('[data-auto-suggest-item="container"]');a.html()?i.toggleClass(function(e,t,i){return i||a.find("."+n.options.classSelected).removeClass(n.options.classSelected),n.options.classOpen},s):!1!==s&&e.ajax({dataType:"json",type:"GET",url:i.data("additionalResults")}).done(function(e){e.html&&(a.html(e.html),i.addClass(n.options.classOpen))}),t.not(i).removeClass(this.options.classOpen)},_setupTracking:function(){t.log("Setting up Smart Search tracking");var i=this,s=i.$element,n=s.find('input[type="search"]'),a=s.find(".submit");e('[data-target="#search"]');n.on("keydown.smartSearchTracking",function(e){13===e.keyCode&&(i._trackSubmit("enter"),i._didTrackEnterSubmit=!0)}),a.on("click.smartSearchTracking",function(){i._didTrackEnterSubmit||i._trackSubmit("button")}),s.on("click",'[data-smartsearch="seeall"]',function(){i._didTrackEnterSubmit||i._trackSubmit("seeall")}),s.on("click.smartSearchTrackingMakeAndModel",".makesAndModels a",function(t){i._trackMakeModelClick(e(this))}),s.on("click.smartSearchTrackingContent",".results a",function(t){i._trackContentLinkClick(e(this))})},_trackSubmit:function(s){t.log("Track submit with "+s);var n=this.$element.find('input[type="search"]').val();t.log("Typed text: "+n);var a="search|submit|"+s;if(this.$element.find("button[data-smartsearch]").attr("data-smartsearch"))a="brand_nav|"+(this.$siteHeader.hasClass("fixed")?"popup":"top")+"|search|typed|"+s;i.trackCustomEvent("searchSubmit",e.extend(this._baseTrackingData,{_searchTerm:n.toLowerCase(),clickGenericText:a}),"trackClick")},_trackMakeModelClick:function(s){t.log("Track make and model click");var n=s.text(),a=(e('.autoHeader input[type="search"]').val(),"search|suggested"+s.attr("data-category")+"|"+(s.parent().index()+1)),r=e.extend(this._baseTrackingData,{searchTerm:n.toLowerCase(),clickGenericText:a});i.trackCustomEvent("searchResultClick",r,"trackClick")},_trackContentLinkClick:function(s){t.log("Track content link click");var n=e('.autoHeader input[type="search"]').val(),a="search|suggestedContent|"+(s.parent().index()+1);i.trackCustomEvent("searchResultClick",e.extend(this._baseTrackingData,{searchTerm:n,clickGenericText:a}),"trackClick")}})}),define("components/lazyload-component",["jquery","version!fly/managers/debug","version!fly/managers/components","version!fly/components/base"],function(e,t,i){t=t.init("lazyloadComponent"),e.widget("cnet.lazyloadComponent",e.fly.base,{options:{endpoint:"",slug:"",view:"",familyName:"",typeName:"",limit:""},_create:function(){this._setup();var i=this.options.endpoint+"?endpoint=%2Fapi%2Fcomponent%2Fcomponent%2F"+this.options.slug+"&view="+this.options.view+"&familyName="+this.options.familyName+"&typeName="+this.options.typeName;""!==this.options.limit&&(i+="&limit="+this.options.limit),t.log("URL: ",i),e.ajax({url:i,dataType:"json",context:{context:this}}).done(this._onSuccess).fail(this._onError)},_onSuccess:function(t){"use strict";var s=this.context.$element,n=e(e.parseHTML(e.trim(t.component.html)));s.append(n),s.removeClass("hide"),s.addClass("show"),i.process(s)},_onError:function(){}})}),define("components/mobile-footer-link",["jquery","version!fly/managers/debug","managers/client-storage","utils/cookie","version!fly/components/base"],function(e,t,i,s){t=t.init("mobileFooterLink"),e.widget("cnet.mobileFooterLink",e.fly.base,{options:{},_create:function(){this._setup();i.read("mobileRedirect")&&(this.$element.append('<li><a class="view">Switch to mobile</a></li>'),this._setEvent())},_setEvent:function(){this.$element.find("a.view").on("click",function(){s.write("fly_device","mobile"),i.erase("mobileRedirect"),window.location.reload(!0)})}})}),define("fly/components/modal-1.0",["jquery","version!fly/components/base"],function(e){var t=e.support.touch?"vclick":"click";e.widget("fly.modal",e.fly.base,{options:{content:null,position:"absolute",classModal:"modal",classBackdrop:"modal-backdrop",classShow:"show",classFixed:"fixed",enableKeyEvents:!0,openOnInit:!1,template:null},$modal:null,$backdrop:null,$body:null,isOpen:!1,eventData:{},_create:function(){var i=this.options,s="fixed"===i.position?" "+i.classFixed:"",n={},a={};this._setup(),this.$modal=this.$element.addClass(i.classModal+s),this.$backdrop=e("<div>").addClass(i.classBackdrop+s),this.$body=e(document.body),this.top=parseInt(this.$modal.css("top"),10),i.content&&this.setContent(i.content),this.eventData={$modal:this.$modal,$backdrop:this.$backdrop},n[t]="_handleClose",a[t+' [data-close="modal"]']="_handleClose",this._on(this.$backdrop,n),this._on(this.$modal,a)},_init:function(){this.options.openOnInit&&this.open()},_handleKeyboard:function(e){27==e.keyCode&&this.close()},_handleClose:function(e){e.preventDefault(),this.close()},open:function(){var e=this.options;this.isOpen||!1!==this._trigger("open",null,this.eventData)&&(this.$backdrop.addClass(e.classShow).appendTo(this.$body),this.$modal.addClass(e.classShow).appendTo(this.$body),this.position(),e.enableKeyEvents&&this._on(this.$document,{keyup:"_handleKeyboard"}),this.isOpen=!0,this._trigger("opened",null,this.eventData))},close:function(){var e=this.options;this.isOpen&&!1!==this._trigger("close",null,this.eventData)&&(this.$backdrop.removeClass(e.classShow),this.$modal.removeClass(e.classShow),this._off(this.$document,"keyup"),this.isOpen=!1,this._trigger("closed",null,this.eventData))},setContent:function(t){var i,s=this.options,n=this,a=e(t);a.hasClass(s.classModal)&&(a.removeClass(s.classModal),i=a.prop("attributes"),e.each(i,function(){"class"===this.name?n.$modal.addClass(this.value):n.$modal.attr(this.name,this.value)}),a=a.children()),this.$modal.empty().append(a),this._trigger("contentSet",null,e.extend({},this.eventData,{$modal:this.$modal,$content:a}))},position:function(){var e=this.options,t=this.$window.height(),i=isNaN(this.top)?(t-this.$modal.outerHeight())/3:this.top;i<20&&(i=20),"absolute"==e.position&&(i+=this.$window.scrollTop(),this.$backdrop.css({height:this.$document.height()})),this.$modal.css({top:i}),this._trigger("positioned",null,{$modal:this.$modal})},_destroy:function(){this.$backdrop.remove()}}),e(document).on(t+".modal-api.data-api",'[data-open="modal"]',function(t){var i=e(this),s=i.data(),n=s.$modal;t.preventDefault(),n||(n=e(s.target||i.attr("href")),i.data("$modal",n)),n.length&&n.modal().modal("open")})}),define("components/global-modal",["jquery","managers/tealium","managers/page-vars","version!fly/managers/components","version!fly/components/modal"],function(e,t,i,s){e.widget("cnet.globalModal",e.fly.modal,{options:{modalTemplate:'<svg class="close" data-close="modal"><use xlink:href="#close" /></svg>{{content}}',container:null,setContentOnInit:!0,trackModal:null},_baseTrackingData:{_pageTitle:i.tracking.data._pageTitle,siteSection:i.tracking.data.siteSection,pageType:i.tracking.data.pageType,siteEdition:i.tracking.data.siteEdition,siteType:i.tracking.data.siteType,siteHier:i.tracking.data.siteHier,brand:i.tracking.data.brand,_pageChannelType:i.tracking.data._pageChannelType},_create:function(){var i=this,s=null;this.options.setContentOnInit||(s=this.options.content,this.options.content=null),this._super(),this.options.setContentOnInit||(this.options.content=s,this.$element.on("modalopen",function(){if(!i.options.setContentOnInit&&i.options.content&&(i.setContent(i.options.content),i.options.trackModal)){var s=e.extend({},i._baseTrackingData,{clickGenericText:i.options.trackModal+"|open"});t.trackCustomEvent("modalTracking",s,"trackClick")}})),this.$body=this.options.container?e(this.options.container):this.$body},close:function(){if(this._super(),this.options.trackModal){var i=e.extend({},this._baseTrackingData,{clickGenericText:this.options.trackModal+"|close"});t.trackCustomEvent("modalTracking",i,"trackClick")}},setContent:function(t){var i,n=this.options,a=this;if("string"==typeof t){var r=e(t);this.$modal.html(n.modalTemplate.replace("{{content}}",null!=r.context?r.html():t))}else t.hasClass(n.classModal)&&(t.removeClass(n.classModal),i=t.prop("attributes"),e.each(i,function(){"class"===this.name?a.$modal.addClass(this.value):a.$modal.attr(this.name,this.value)}),t=n.modalTemplate.replace("{{content}}",t.html())),this.$modal.empty().append(t),this._trigger("contentSet",null,e.extend({},this.eventData,{$modal:this.$modal,$content:t}));s.process(this.$element)},position:function(){var t,i,s,n,a,r,o=this.options;this.$body.is(e(document.body))?(t=this.$window.height(),s=this.$window.scrollTop(),a=this.$document.height(),r=this.$window.width()/2,n=this.$window.scrollLeft()):(t=this.$body.height(),s=this.$body.scrollTop(),a=t,r=this.$body.width()/2,n=this.$body.scrollLeft()),(i=isNaN(this.top)?(t-this.$modal.outerHeight())/2:this.top)<20&&(i=20),"absolute"==o.position&&(i+=s,this.$backdrop.css({height:a})),this.$modal.css({top:i}),this._trigger("positioned",null,{$modal:this.$modal}),this.$element.css("left",r+n-this.$element.outerWidth()/2)}})}),define("fly/components/modal-iframe-1.0",["jquery","version!fly/utils/object-helper","version!fly/utils/url-helper","version!fly/components/modal","version!fly/components/loading"],function(e,t,i){e.support.touch;e.widget("fly.modalIframe",e.fly.modal,{options:{url:null,requestData:{},messages:{},loader:{disabled:!1}},messenger:null,_create:function(){this._super(),this._setupLoader()},_setupLoader:function(){var t=this;this.loader=e.fly.loading(e.extend(this.options.loader,{shown:function(){t.$element.addClass(t.loader.options.classes.loading)},hidden:function(){t.$element.removeClass(t.loader.options.classes.loading)}})),this.loader.$element.appendTo(this.$element)},open:function(){this.isOpen||(this.loader.add(),this.loadContent(),this._super())},_getUrl:function(){var t=this.options,i=t.url;return t.requestData&&(i=i+(i.indexOf("?")>0?"&":"?")+e.param(t.requestData)),i},loadContent:function(){var t=this.options,i=this;this.messenger=this.$element.iframeMessenger({remoteUrl:this._getUrl(),receivableMessages:e.extend({},t.messages,{ready:function(){i._trigger("iframeReady"),i.loader.remove()},closeModal:function(){i.close()},scroll:function(t){var s=i.$element.offset().top+t.offset;s-=i.$window.height()/6,e("html, body").animate({scrollTop:s},"fast")}})})}})}),define("components/modal-iframe",["jquery","version!fly/managers/debug","version!fly/components/modal-iframe","components/loading"],function(e,t){t=t.init("modalIframe"),e.widget("fly.modalIframe",e.fly.modalIframe,{options:{modalTemplate:'<svg class="close" data-close="modal"><use xlink:href="#close" /></svg>{{content}}',loader:{classes:{loading:"loadingCircle"}}},$body:null,_create:function(){this._super(),this.$body=e(document.body),this.setContent('<a class="close" data-close="modal"></a>'),this._setupLoader()},_setupLoader:function(){var t=this;this.loader=e.cnet.loading(e.extend(this.options.loader,{shown:function(){t.$element.addClass(t.loader.options.classes.loading)},hidden:function(){t.$element.removeClass(t.loader.options.classes.loading)}})),this.loader.$element.appendTo(this.$element)},open:function(){this.isOpen||(this.loader.add(),this.loadContent(),this._super(),this.centerHorizontally())},loadContent:function(){var t=this.options,i=this;this.messenger=this.$element.iframeMessenger({remoteUrl:this._getUrl(),receivableMessages:e.extend({},t.messages,{ready:function(){i._trigger("iframeReady"),i.loader.remove(),setTimeout(i.centerHorizontally.bind(i),250)},closeModal:function(){i.close()}})})},centerHorizontally:function(){this.$element.css("margin-left",-this.$element.width()/2)},position:function(){var e=this.options,t=this.$window.height(),i=isNaN(this.top)?(t-this.$modal.outerHeight())/3:this.top;i<20&&(i=20),"absolute"==e.position&&(i+=this.$window.scrollTop(),this.$backdrop.css({height:this.$document.height()})),this.$modal.css({top:i}),this._trigger("positioned",null,{$modal:this.$modal})}})}),define("managers/user",["jquery","components/authentication"],function(e){return e.cnet.authentication()}),define("translations/modal-email",["managers/edition"],function(e){return e.getTranslation({en:{confirmation:"Your e-mail was sent successfully!",incorrectCaptcha:"The response you entered was incorrect.  Please try again.",notice:"Keep your friends up to date on your wish list.",messageA:"Click the",messageB:"to share the products you want with your friends.",ok:"OK, Got it"},es:{confirmation:"Tu email fue enviado exitosamente!",incorrectCaptcha:"La Captcha no es correcta. Por favor, inténtalo otra vez.",notice:"Mantén a tus amigos informados sobre tu lista.",messageA:"Haz clic en el",messageB:"para que tus amigos vean los productos que quieres.",ok:"De acuerdo"}})}),define("components/modal-email",["jquery","version!fly/managers/debug","version!fly/managers/components","managers/edition","managers/user","translations/modal-email","components/global-modal","components/loading","version!fly/components/form-validate"],function(e,t,i,s,n,a){t=t.init("modalEmail"),e.widget("cnet.modalEmail",e.cnet.globalModal,{options:{emailType:"friend",pageTitle:function(){return document.title},pageUrl:function(){return window.location.href},recipientId:null,recipientName:"",messageThankYou:a.confirmation},emailTypes:{friend:{url:{us:"/email/friend/",es:"/es/email/friend/"},requireUsername:!1},friendRoadshow:{url:{us:"/email/friend/roadshow/",es:"/es/email/friend/roadshow/"},requireUsername:!1},member:{url:{us:"/email/member/",es:"/es/email/member/"},requireUsername:!0},editor:{url:{us:"/email/editor/",es:"/es/email/editor/"},requireUsername:!1},flag:{url:{us:"/email/flag/",es:"/es/email/flag/"},requireUsername:!0},video:{url:{us:"/email/video-feedback/",es:"/es/email/video-feedback/"},requireUsername:!1}},errorMessages:{"cnet.notsent":"There was an error attempting to send your e-mail.  Please try again.","cnet.nousername":"You must have a valid username to send an e-mail.","cnet.notloggedin":"You must be logged in to send an e-mail.","cnet_recaptcha.incorrect-captcha-sol":a.incorrectCaptcha,"cnet_recaptcha.missing-input-response":a.incorrectCaptcha},_create:function(){this._super(),this.setContent('<a class="close" data-close="modal"></a>'),this._setupLoader()},_setupLoader:function(){this.loader=e.cnet.loading(),this.loader.$element.addClass("modal-content")},open:function(){var e=this,t=this.emailTypes[this.options.emailType];this.isOpen||(t.requireUsername?(n.hasAccess({requireUsername:!0,nextAction:function(i){e._openEmailType(t)}}),e._super()):(this._openEmailType(t),e._super()))},_openEmailType:function(t){var n=this;this.setContent(""),this.loader.$element.appendTo(this.$element),this.loader.add(),e.ajax({url:t.url[s.getEdition()],data:this.options.recipientId?{regId:this.options.recipientId}:null,dataType:"text"}).done(function(t){n.loader.remove(),n.setContent(t),n.position(),n._setupEvents(),e("[data-email-var]",n.$element).each(function(t,i){var s=e(i),a=s.data("emailVar");"pageTitle"===a?s.text(n.options.pageTitle):"recipientName"===a&&s.text(n.options.recipientName)}),e('input[name="emailFriend[pageTitle]"]',n.$element).val(n.options.pageTitle);var s="string"==typeof n.options.pageUrl?n.options.pageUrl:n.options.pageUrl();e('input[name="emailFriend[pageUrl]"]',n.$element).val(s),i.process(n.$element)}).always(function(){n.loader.remove()})},_setupEvents:function(){var t=this,i=e("form",this.$element),s=e('[data-component="recaptcha"], .g-recaptcha',t.$element),n=e('[data-email-var="error"]',i);i.formValidate({success:function(a){a.preventDefault(),e.ajax({dataType:"json",type:"POST",url:i.attr("action"),data:i.serialize()}).done(function(e){"success"===e.status?(i.html(t.options.messageThankYou),t.position()):(e.errors?n.text(e.errors[0]):n.text(t.errorMessages[e.message]),s.recaptcha("reload"))})}})}}),e(document).on("click.modalEmail-api.data-api",'[data-open="modalEmail"]',function(t){var i,s=e(this),n=s.data().$modal;t.preventDefault(),n?n.open():(i=s.data("modalEmailOptions")||s.dataPrefix("modalEmail"),s.data("$modal",e.cnet.modalEmail(e.extend(i,{openOnInit:!0,destroy:function(){s.data("$modal",null)}}))))})}),define("managers/events",["jquery","version!fly/managers/debug"],function(e,t){t=t.init("events");var i={};return{publish:function(e,t){for(var s=0;s<e.length;s++)if(i[e[s]]&&i[e[s]][t])for(var n=0;n<i[e[s]][t].length;n++)i[e[s]][t][n]()},subscribe:function(e,t){for(var s in t)if(t.hasOwnProperty(s))for(var n in i[s]=i[s]||{},t[s])t[s].hasOwnProperty(n)&&(i[s][n]=i[s][n]||[],i[s][n].push(e[t[s][n]].bind(e)))}}}),define("components/uds-sdk",["jquery","managers/user","managers/tealium","managers/events","version!fly/managers/debug","managers/client-storage","@firebase/app","@firebase/auth","@firebase/firestore","@firebase/functions"],function(e,t,i,s,n,a,r){let o=void 0,l=void 0,d=void 0,u=!1;n=n.init("uds-sdk");const c=a.localStorageSupported();var h={enabled:void 0,_optInInterests:[],_firebaseConfig:{apiKey:void 0,authDomain:void 0,projectId:void 0},_unsubListener:void 0,_signInFunctionQueue:[],_snapshotListenerStatus:"uninitialized",options:{eventChannel:["interestChange"]},_collections:{registered:{users:void 0,interests_summary:void 0},anonymous:{users:void 0,interests_summary:void 0}},_authStatus:{localPersistenceChecked:!1,complete:void 0,type:void 0,userCollection:void 0,interestsSummaryCollection:void 0,notifyLogin:!1},_platform:void 0,_environment:void 0,activeInterests:{},_init:function(){let i=this,s=void 0;if(c&&this._enableUDS()){if(this.enabled=!0,window.CnetPageVars.personalization&&window.CnetPageVars.personalization.firebase&&window.CnetPageVars.personalization.firebase.config&&window.CnetPageVars.personalization.functions){if(s=window.CnetPageVars.personalization.firebase.config,r.initializeApp(s),o=r.firestore(),window.CnetPageVars.personalization.firestore&&window.CnetPageVars.personalization.firestore.settings&&o.settings(window.CnetPageVars.personalization.firestore.settings),l=r.functions(),window.CnetPageVars.personalization.functions.override&&window.CnetPageVars.personalization.functions.origin&&l.useFunctionsEmulator(window.CnetPageVars.personalization.functions.origin),!window.CnetPageVars.personalization)return void n.log("Invalid UDS configuration");if(!window.CnetPageVars.personalization.functions)return void n.log("Invalid UDS functions configuration");if(u=!0,window.CnetPageVars.personalization.firestore&&window.CnetPageVars.personalization.firestore.collections){let e=window.CnetPageVars.personalization.firestore.collections;if(!(e.registered&&e.registered.users&&e.registered.interests_summary&&e.anonymous&&e.anonymous.users&&e.anonymous.interests_summary))return void n.log("Invalid UDS collection configuration");i._collections.registered.users=e.registered.users,i._collections.registered.interests_summary=e.registered.interests_summary,i._collections.anonymous.users=e.anonymous.users,i._collections.anonymous.interests_summary=e.anonymous.interests_summary}window.CnetPageVars.personalization.base&&(this._platform=window.CnetPageVars.personalization.base.platform,this._environment=window.CnetPageVars.personalization.base.environment),r.auth().onAuthStateChanged(function(e){this._localPersistenceAuth()}.bind(this)),n.log("Firestore loaded")}else n.error("Firebase SDK Failed to load");t.$element.on("userhasloggedin",function(e,t){this._regAuth(t,!0)}.bind(this)),e(window).on("anonuserloaded",function(e,t,i){this._anonAuth(!0)}.bind(this)),e(window).on("userhasexpired",function(e,t,i){this._anonAuth(!0)}.bind(this))}else this.enabled=!1},processView:function(t,i,s){let a=this;if(null==i&&(i="view-add"),null==s&&(s=!0),!(t=Array.isArray(t)?e.extend(!0,[],t):[t=e.extend(!0,{},t)]).length)return new Promise(function(e){n.warn("Empty array passed in to processView"),e("Empty array passed in to processView")});if(o||r.apps&&r.apps.length>=1&&(o=r.apps[0].firestore()),!this._authStatus.complete){if(this._signInFunctionQueue){n.warn("Trying to add view but user not signed into firebase. Adding view to sign in queue");let e={functionName:"processView"};e.views=t,e.event=i,e.shouldFireTracking=s,this._signInFunctionQueue.push(e)}return new Promise(function(e){e("View not added to firestore, current user is not the signed in user")})}let u={};if(t.forEach(function(e){const t="cnet_"+e.edition;u[t]?u[t].push(e):u[t]=[e]}),Object.keys(u).length>1)return n.warn("Multiple site edition combinations passed in on views to be added. Splitting on site-edition and reprocessing seperated lists"),Object.keys(u).forEach(function(e){a.processView(u[e],i,s)}),new Promise(function(e){e("Multiple site edition combinations passed in on views to be added. Splitting on site-edition and reprocessing seperated lists")});if(t.forEach(function(e){a._normalizeView(e)}),"view-add"===i){if(d&&d.content_entity_id===t[0].content_entity_id)return n.warn("TRYING TO ADD A VIEW FOR THE SAME PIECE OF CONTENT MULTIPLE TIMES ON ONE PAGE VIEW: "+JSON.stringify(t[0])),new Promise(function(e){e("TRYING TO ADD A VIEW FOR THE SAME PIECE OF CONTENT MULTIPLE TIMES ON ONE PAGE VIEW: "+JSON.stringify(t[0]))});d=t[0]}return new Promise(function(e,r){a._getAirshipChannelId().then(function(o){const d={event:i,site:"cnet",edition:t[0].edition,views:t,channel_id:o,platform:a._platform,environment:a._environment,should_fire_tracking:s};"anonymous"===a._authStatus.type&&(d.anon_id=a._getUserId());const u=JSON.stringify(d);l.httpsCallable("viewAddRequestedProxy")(u).then(function(t){n.log(t),e(t)}).catch(function(e){e.message?(n.log(e.message),r(e.message)):r(e)})})})},addInterest:function(t,i,s){const a=this;if(null==s&&(s=!0),0===(t=Array.isArray(t)?e.extend(!0,[],t):[t=e.extend(!0,{},t)]).length)return n.warn("Not processing request to add interests. Empty interest array passed."),new Promise(function(e){e("Not processing request to add interests. Empty interest array passed.")});if(!u)return new Promise(function(e,t){e("Explicit Interest not added, invalid UDS configuration")});if(!this._authStatus.complete){if(n.warn("Trying to add interests but user not signed in to firebase. Adding intrerest to sign in queue"),this._signInFunctionQueue){let e={functionName:"addInterest"};e.interests=t,e.event=i,e.shouldFireTracking=s,this._signInFunctionQueue.push(e)}return new Promise(function(e,t){e("Explicit Interest not added to firestore, current user is not the signed in user")})}let r={};if(t.forEach(function(e){const t="cnet_"+e.edition;r[t]?r[t].push(e):r[t]=[e]}),Object.keys(r).length>1)return n.warn("Multiple site edition combinations passed in on interests to be added. Splitting on site-edition and reprocessing seperated lists"),Object.keys(r).forEach(function(e){a.addInterest(r[e],i,s)}),new Promise(function(e){e("Multiple site edition combinations passed in on interests to be added. Splitting on site-edition and reprocessing seperated lists")});if("registration"===i&&"anonymous"===this._authStatus.type){if(n.warn("Trying to add interest to anon user, even though interest should go to signed in user. Adding interest to sign in queue"),this._signInFunctionQueue){let e={functionName:"addInterest"};e.interests=t,e.event=i,e.shouldFireTracking=s,this._signInFunctionQueue.push(e)}return new Promise(function(e,t){e("Explicit Interest not added to firestore, trying to add registration event to anon user")})}const o=this._getUserId();if("opt-in"===i){if("uninitialized"===a._snapshotListenerStatus){if(n.warn("Trying to add opt-in interests but snapshot listener not configured yet. Adding to sign in queue"),this._signInFunctionQueue){let e={functionName:"addInterest"};e.interests=t,e.event=i,e.shouldFireTracking=s,this._signInFunctionQueue.push(e)}return new Promise(function(e,t){e("Adding interest add to sign in queue, trying to add opt-in event before snapshot listener hooked up.")})}let e=t.filter(function(e){return!h._optInInterests.includes(e.interest_id)});if(0===e.length)return n.log("Already sent opt-in events for user "+o+". Not sending again"),new Promise(function(e){e("Already sent opt-in event interest for user "+o+". Not sending again")});t=e}return t.forEach(function(e){delete e.anon_id,delete e.urs_id,delete e.user_id,"roadshow"===t.site&&(t.site="cnet"),e.should_fire_tracking=!1}),new Promise(function(e,r){a._getAirshipChannelId().then(function(o){const d={site:"cnet",event:i,edition:t[0].edition,interests:t,channel_id:o,platform:a._platform,environment:a._environment};"anonymous"===a._authStatus.type&&(d.anon_id=a._getUserId());const u=JSON.stringify(d);l.httpsCallable("interestAddRequestedProxy")(u).then(function(a){if(n.log(a),!s)return e(a);if("registration"===i){const e=t.map(function(e){return e.interest_name}).join("|");h._trackEvent("tap","submit_interest|broad_interest",e)}else t.forEach(function(e){const t="video"===i?"background":"tap",s=("follow"===e.action?"add":"remove")+"_interest|"+("video"===e.type?"video_series":e.type)+"_interest";h._trackEvent(t,s,e.interest_name)});e(a)}).catch(function(e){e.message?(n.log(e.message),r(e.message)):r(e)})})})},_enableUDS:function(){let e=localStorage.getItem("CnetUdsEnabled"),t=parseInt(localStorage.getItem("CnetUdsVersion"));return isNaN(t)&&(t=0),6===t?"true"===e:"true"===e||Math.random()<=1?(localStorage.setItem("CnetUdsEnabled","true"),localStorage.setItem("CnetUdsVersion",6..toString()),!0):(localStorage.setItem("CnetUdsEnabled","false"),localStorage.setItem("CnetUdsVersion",6..toString()),!1)},_notifyLogin:function(e,t){const i=this;return u?(this._authStatus.notifyLogin=!1,new Promise(function(e,t){i._getAirshipChannelId().then(function(e){const t=i._getAnon();i._notifyLoginStatusChange(e,t,"login","loginNotify")}).catch(function(e){n.error("Error when trying to get user channel from airship. "+e),t(e)})})):new Promise(function(e,t){t("Login event not submitted, invalid UDS configuration")})},_notifyLogout:function(){const e=this;return u?new Promise(function(t,i){e._getAirshipChannelId().then(function(e){h._notifyLoginStatusChange(e,null,"logout","logoutNotify")}).then(function(e){t(e)}).catch(function(e){n.error("Error when trying to get user channel from airship. "+e),i(e)})}):new Promise(function(e,t){t("Logout event not submitted, invalid UDS configuration")})},_notifyLoginStatusChange:function(e,t,i,s){return new Promise(function(a,r){const o={data:{channel_id:e,action:i,site:"cnet",edition:window.CnetPageVars.edition.code},event:i,platform:this._platform,environment:this._environment};t&&(o.data.anon_id=t);const d=JSON.stringify(o);l.httpsCallable(s)(d).then(function(e){n.log(e),a("Event "+i+" notified")}).catch(function(e){e.message&&n.log(e.message),a("Event "+i+" not notified")})}.bind(this))},_notifyMigrate:function(t,i,s){const a=this;if(window.UA)return new Promise(function(e,t){window.UA.then(function(t){let r=!1,o=!1;s=JSON.parse(s);const l=a._getAirshipInterests(t);s=s.concat(l),localStorage.setItem("CnetUserMigrationVersion",1..toString()),a.addInterest(s,"interest-migration",!1).then(function(){if(o=!0,r)return n.log("Views and Interests successfully sent to firestore."),e("Views and Interests successfully sent to firestore.");n.log("Interests successfuly sent for migration")}).catch(function(t){return n.error("Migration failed to add interests. Reason: "+t),localStorage.setItem("CnetUserMigrationVersion","0"),e("Migration failed to add interests. Reason: "+t)}),a.processView(JSON.parse(i),"view-migration",!1).then(function(){if(r=!0,o)return n.log("Views and Interests successfully sent to firestore."),e("Views and Interests successfully sent to firestore.");n.log("views successfuly sent for migration")}).catch(function(t){return n.error("Migration failed to add views. Reason: "+t),localStorage.setItem("CnetUserMigrationVersion","0"),e("Migration failed to add views. Reason: "+t)})})});e(window).on("urban-airship-loaded",function(){a._notifyMigrate(t,i,s)})},_userMigration:function(){if(!u)return new Promise(function(e,t){t("Migrate event not submitted, invalid UDS configuration")});let e=parseInt(localStorage.getItem("CnetUserMigrationVersion"),10);if(!isNaN(e)&&e>=1)return new Promise(function(e,t){e("Migration event not required")});e=0;const t=localStorage.getItem("CnetViewList"),i=localStorage.getItem("CnetExplicitList");let s=[],a=[];try{s=t?JSON.parse(t):[]}catch(e){n.log("Invalid view data for user migration")}try{a=i?JSON.parse(i):[]}catch(e){n.log("Invalid interests data for user migration")}return Array.isArray(s)||(s=[]),Array.isArray(a)||(a=[]),h._notifyMigrate(e,s.length>0?t:"[]",a.length>0?i:"[]")},_localPersistenceAuth:function(){this._authStatus.localPersistenceChecked||(this._authStatus.localPersistenceChecked=!0,this._authStatus.complete=!1,this._authStatus.type=void 0,this._authStatus.userCollection=void 0,this._authStatus.interestsSummaryCollection=void 0,t.getUserData(function(e,t){t&&t.isLoggedIn&&t.jwt?this._regAuth(t,!1):this._anonAuth(!1)}.bind(this)))},_regAuth:function(e,t){if(e&&e.isLoggedIn&&e.jwt){this._authStatus.complete=!1,this._authStatus.type="registered",this._authStatus.userCollection=this._collections.registered.users,this._authStatus.interestsSummaryCollection=this._collections.registered.interests_summary,this._authStatus.notifyLogin=t,"true"===localStorage.getItem("CnetRegEnabled")||localStorage.setItem("CnetRegEnabled","true");const i=r.auth().currentUser?r.auth().currentUser:null;i&&!i.isAnonymous&&e.isLoggedIn&&e.registrationId&&i.uid===e.registrationId?(this._authStatus.complete=!0,this._initEventManager(),this._userMigration(),this._authStatus.notifyLogin&&(this._authStatus.notifyLogin=!1,this._notifyLogin(i.uid,{}))):this._regSignIn(e,this._initEventManager,null)}},_anonAuth:function(e){this._authStatus.complete=!1,this._authStatus.type="anonymous",this._authStatus.userCollection=this._collections.anonymous.users,this._authStatus.interestsSummaryCollection=this._collections.anonymous.interests_summary,"true"===localStorage.getItem("CnetRegEnabled")&&(localStorage.removeItem("CnetRegEnabled"),e||(e=!0)),e?this._notifyLogout().then(function(e){this._anonSignIn(this._initEventManager,null)}.bind(this)).catch(function(e){n.log("Error sending logout notification"),this._anonSignIn(this._initEventManager,null)}.bind(this)):this._anonSignIn(this._initEventManager,null)},_initEventManager:function(){const e="granted"!==Notification.permission,t=window.utag_data.interest&&"none"!==window.utag_data.interest.id;if(e&&!t)return h._snapshotListenerStatus="awaiting-opt-in",n.warn("User is opted out of notifications and no page interest exists. Not hooking up snapshot listener"),void h._invokeFunctions();const i=h._getUserId();if(!i||!h._authStatus.complete){n.warn("User not signed in but attempting to setup snapshot listener. Adding snapshot setup onto sign in queue");let e={functionName:"_initEventManager"};return void h._signInFunctionQueue.unshift(e)}"function"==typeof h._unsubListener&&(h._unsubListener(),h._snapshotListenerStatus="uninitialized");const a=window.CnetPageVars.edition.code,r=o.collection(h._authStatus.userCollection).doc(i).collection("site").doc("cnet").collection("edition").doc(a);h._unsubListener=r.collection(h._authStatus.interestsSummaryCollection).doc("summary").onSnapshot(function(e){if(!e.exists)return n.warn("Doc does not exist, not tracking change"),void("uninitialized"===h._snapshotListenerStatus&&(n.log("Snapshot listener successfuly hooked up for user "+i),h._snapshotListenerStatus="initialized",h._invokeFunctions()));let t=e.data().active_map?e.data().active_map:{},r=e.data().inactive_map?e.data().inactive_map:{};h.activeInterests=t;const o="b122d23f-29eb-493e-83e6-e9fbfeaf79c8",d=Object.keys(t),u=Object.keys(r);if(r[o]&&h._optInInterests.push(o),!d.length&&!u.length)return n.log("Empty summary maps for user. Returning"),void("uninitialized"===h._snapshotListenerStatus&&(n.log("Snapshot listener successfuly hooked up for user "+i),h._snapshotListenerStatus="initialized",h._invokeFunctions()));s.publish(h.options.eventChannel,"interestChange");let c=[];if(d.forEach(function(e){const i=t[e],s=i.id,n=i.type;if("general"===n&&h._optInInterests.push(s),s===o&&h._optInInterests.push(s),!i.should_fire_tracking)return;const a=i.name;const r="add_interest|"+("video"===n?"video_series":n)+"_interest";h._trackEvent("background",r,a),c.push(s)}),"uninitialized"===h._snapshotListenerStatus&&(n.log("Snapshot listener successfuly hooked up for user "+i),h._snapshotListenerStatus="initialized",h._invokeFunctions()),!c.length)return;let p={site:"cnet",edition:a,interests:c,platform:h._platform,environment:h._environment};"anonymous"===h._authStatus.type&&(p.anon_id=h._getAnon()),l.httpsCallable("updateInterestTracking")(JSON.stringify(p)).then(function(e){n.log(e)}).catch(function(e){e.message?n.error(e.message):n.error(e)})})},_isInterestActive:function(e){return!!this.activeInterests[e]},_getAirshipChannelId:function(){return new Promise(function(t){window.UA?window.UA.then(function(e){t(e.channel&&e.channel.channel_id?e.channel.channel_id:null)}).catch(function(e){n.log(e),t(null)}):(n.warn("Airship not loaded yet. Will continue once airship is initialized."),e(window).on("urban-airship-loaded",function(){window.UA.then(function(e){t(e.channel&&e.channel.channel_id?e.channel.channel_id:null)}).catch(function(e){n.log(e),t(null)})}))})},_normalizeView:function(e){e.date_created||(e.date_created=Date.now()),e.site?"roadshow"===e.site&&(e.site="cnet"):e.site="cnet",e.edition||(e.edition="us"),delete e.anon_id,delete e.user_id,delete e.urs_id,Object.keys(e).forEach(function(t){void 0===e[t]&&(e[t]="undefined")})},_anonSignIn:function(e,t){let i=this;const s=i._getAnon();r.auth().currentUser?r.auth().signOut().then(function(){i._authStatus.complete=!0,e&&e(s,t),i._userMigration()}).catch(function(e){i._authStatus.complete=!1,n.log("Sign out error")}):(i._authStatus.complete=!0,e&&e(s,t),i._userMigration())},_regSignIn:function(e,t,i){let s=this;r.auth().signInWithCustomToken(e.jwt).then(function(){s._authStatus.complete=!0,n.log("user signed in: ",r.auth().currentUser.uid),t&&e.registrationId&&t(e.registrationId,i),s._authStatus.notifyLogin&&(s._authStatus.notifyLogin=!1,s._notifyLogin(e.registrationId,{})),s._userMigration()}).catch(function(e){s._authStatus.complete=!1,n.error("Failed signing in to firebase with a custom token",e)})},_getUserId:function(){const e=r.auth().currentUser;return"registered"===this._authStatus.type&&this._authStatus.complete&&e&&(void 0===window.CnetPageVars.tracking.data.userId||window.CnetPageVars.tracking.data.userId&&window.CnetPageVars.tracking.data.userId===e.uid)?e.uid:"anonymous"===this._authStatus.type&&this._authStatus.complete?this._getAnon():window.CnetPageVars.tracking.data.userId?window.CnetPageVars.tracking.data.userId:"00000000-0000-0000-0000-000000000000"},_getAnon:function(){var e=localStorage.getItem("CnetAnon");e||(e=window.uuid.v4());try{localStorage.setItem("CnetAnon",e)}catch(t){n.error("Writing to localStorage for anon failed."),e="00000000-0000-0000-0000-000000000000"}return e},_invokeFunctions:function(){if(!this._signInFunctionQueue.length)return;const e=this._getUserId();n.log("Clearing function queue. Adding views/interests to user "+e+". Processing "+this._signInFunctionQueue.length+" functions."),this._signInFunctionQueue.forEach(function(e){switch(e.functionName){case"_initEventManager":h._initEventManager();break;case"addInterest":h.addInterest(e.interests,e.event,e.shouldFireTracking);break;case"processView":h.processView(e.views,e.event,e.shouldFireTracking);break;default:n.error("Improper function name "+e.functionName+"passed in to be ran on sign in. Entire map: "+JSON.stringify(e))}}),this._signInFunctionQueue=[]},_getAirshipInterests:function(e){const t=e&&e.channel&&e.channel.tags?e.channel.tags.list:{};let i=[];return Object.keys(t).forEach(function(e){if(!e.includes("-interest"))return;const s=e.includes("-es")?"es":"us",n=e.split("-")[0],a=t[e].map(function(e){return{is_airship_interest:!0,name:e,site:"cnet",edition:s,type:n,implicit:!0,action:"follow"}});i=i.concat(a)}),i},_trackEvent:function(e,t,s){var n=window.CnetPageVars.tracking.data;i.trackCustomEvent(e,{pageViewGuid:n.pageViewGuid,_dwAnonId:n._dwAnonId,articleId:n.articleId,clickGenericText:t,pageType:n.pageType,siteEdition:n.siteEdition,siteHier:n.siteHier,siteSection:n.siteSection,interests:s},"trackClick")}};return h._init(),window.uds_sdk=h,h}),define("components/urban-airship",["jquery","version!fly/managers/debug","managers/edition","managers/page-vars","managers/global-functions","managers/tealium","managers/recommendation-data","managers/user","components/uds-sdk","version!fly/components/base"],function(e,t,i,s,n,a,r,o,l){t=t.init("urbanAirship");var d={trackEvent:function(e,t,i){let n=localStorage.getItem("CnetNotificationPromptTimer");if("message"===e&&!i){if(n&&!(Date.now()-n>18e5))return;localStorage.setItem("CnetNotificationPromptTimer",Date.now())}var r=s.tracking.data;a.trackCustomEvent(e,{pageViewGuid:r.pageViewGuid,_dwAnonId:r._dwAnonId,articleId:r.articleId,clickGenericText:t,pageType:r.pageType,siteEdition:r.siteEdition,siteHier:r.siteHier,siteSection:r.siteSection},"trackClick")}};return s.services.urban_airship&&s.services.urban_airship.enabled&&n.gdprConsentCallback("script_urban_airship",function(){!function(e,t,i,s,n){var a,r,o=[],l=[],d={then:h,catch:function(e){return h(!1,e)},_async_setup:function(e){var t;try{t=e(n)}catch(e){return r=e,void c(l,e)}t.then(function(e){c(o,a=e)}).catch(function(e){r=e,c(defferedErrors,r)})}};e.UA=d;var u=t.createElement("script");function c(e,t){for(var i=0;i<e.length;i++)p(e[i],t)}function h(e,t){return e&&(a?p(e,a):o.push(e)),t&&(r?p(t,r):l.push(t)),d}function p(t,i){e.setTimeout(function(){t(i)},0)}u.src="https://aswpsdkus.com/notify/v1/ua-sdk.min.js",u.async=!0,u.id="_uasdk",u.rel="UA",t.head.appendChild(u)}(window,document,0,0,{workerUrl:"/bundles/cnetjs/js/libs/ua-push-worker.js",websitePushId:"web.com.cnet.urbanairship",appKey:s.personalization.urbanAirship.appKey,token:s.personalization.urbanAirship.token,vapidPublicKey:s.personalization.urbanAirship.vapidPublicKey}),e.widget("cnet.urbanAirship",e.fly.base,{options:{},urbanAirship:null,_create:function(){var e=this;this._setup(),window.UA.then(function(n){e.urbanAirship=n,e._setupEvents(n);var a=n.permission;"default"===a&&d.trackEvent("message","notification|automatic"),e.urbanAirship.register().then(function(t){let u=[];if("default"===a&&"default"!==n.permission){var c="granted"===n.permission?"opt-in":"opt-out";d.trackEvent("tap","notification|"+c+"|automatic")}if(t&&t.tags){if(i.isEspanol()){const i=e._createGeneralInterest("Edition_ES","Edition_ES");l&&l.enabled?u.push(i):t.tags.add("Edition_ES",r.getTagGroupByInterest("general"))}else{const i=e._createGeneralInterest("Edition_US","Edition_US");l&&l.enabled?u.push(i):t.tags.add("Edition_US",r.getTagGroupByInterest("general"))}if(t.optedIn&&t.tags){const i=e._createGeneralInterest("EDITORSPICKS","EDITORSPICKS");l&&l.enabled?u.push(i):t.tags.add("EDITORSPICKS",r.getTagGroupByInterest("general")),"roadshow"===s.tracking.data.brand&&o.getUserData(function(e,i){let s=r.createNewViewEvent(i);s.broad_interest="CARS";const n=r.createImplicitInterestObject(s);l&&l.enabled?u.push(n):t.tags.add("CARS",r.getTagGroupByInterest("broad")),r.getExplicitInterests().some(function(e){return e.implicit&&"CARS"===e.interest_name&&"broad"===e.type})||(l&&l.enabled||d.trackEvent("background","add_interest|broad_interest|CARS"),r.writeExplicitInterestToLocalStorage(n),r.sendInterestsToBackend([n]))})}l&&l.enabled&&u.length&&l.addInterest(u,"opt-in",!1),t.id&&"undefined"!=typeof Storage&&null===localStorage.getItem("v78_channel_id")&&localStorage.setItem("v78_channel_id",t.id)}}).catch(function(e){t.error("Error when trying to register user: "+e),"default"===a&&"denied"===Notification.permission&&d.trackEvent("tap","notification|opt-out|automatic")})})},_setupEvents:function(t){e(window).trigger("urban-airship-loaded"),o.getUserData(function(e,t){var i=r.getViewEvents();r.triggerPeriodicBackfillSync(t,i)})},_createGeneralInterest:function(e,t){return{action:"follow",type:"general",interest_name:e,interest_id:t,date_created:Date.now(),site:"cnet",edition:i.isEspanol()?"es":"us",implicit:!0}}})},{},"targeting"),d}),define("managers/components.desktop",["jquery","version!fly/managers/components","version!fly/managers/debug","managers/tealium","managers/page-vars","components/authentication","components/tabs-modal","components/site-header","components/auto-suggest","components/lazyload-component","components/mobile-footer-link","components/global-modal","components/modal-iframe","components/modal-email","components/urban-airship"],function(e,t,i,s,n){i=i.init("componentManager");var a="uvpjs_upgrade"===n.tracking.data.testName&&"test"===n.tracking.data.testGroup;return t.register({authentication:{},tabsModal:{},siteHeader:{},autoSuggest:{},lazyloadComponent:{},mobileFooterLink:{},globalModal:{},modalIframe:{},modalEmail:{},accordion:{require:"version!fly/components/accordion"},addthisevent:{require:"components/add-this-event"},alert:{require:"version!fly/components/alert"},amazonAd:{require:"components/amazon-ad"},article:{require:"components/article"},audioPlayer:{require:"components/audio-player"},autoLocalPricing:{require:"components/auto-local-pricing"},backgroundVideo:{require:"components/background-video"},bestFitVideoPromo:{require:"components/best-fit-video-promo"},bestList:{require:"components/best-list"},bestListing:{require:"components/best-listing"},breakingNews:{require:"components/breaking-news"},interest:{require:"components/interest"},buyingProgram:{require:"components/buyingProgram"},carFinder:{require:"components/car-finder"},carousel:{require:"version!fly/components/carousel",options:{slidechanged:function(t){e(window).trigger("scroll")}}},carouselDesktop:{require:"components/carousel.desktop"},carouselFull:{require:"components/carousel-full"},cbsiFeedWidget:{require:"components/cbsi-feed-widget"},clipboard:{require:"components/clipboard"},commands:{require:"components/commands"},commentDownloader:{require:"components/comment-downloader"},connectComponent:{require:"components/connect-es-component"},contactUs:{require:"components/contact-us"},couponsDesktop:{require:"components/coupons-page.desktop"},dropdown:{require:"components/dropdown"},dealsActivator:{require:"components/deals-activator.desktop"},dealsUpdater:{require:"components/deals-updater"},dfllActivator:{require:"components/dfll-activator.desktop"},dfllActivatorV2:{require:"components/dfll-activator-v2.desktop"},dfllUpdater:{require:"components/dfll-updater.desktop"},dfllUpdaterV2:{require:"components/dfll-updater-v2.desktop"},displayCookie:{require:"components/display-cookie"},disqusCount:{require:"components/disqus-count"},editorsChoiceToggle:{require:"components/editors-choice-toggle"},ellipsis:{require:"components/ellipsis"},expando:{require:"components/expando"},fadeOnScroll:{require:"components/fade-on-scroll"},inlineProductCarousel:{require:"components/inline-product-carousel"},topStories:{require:"components/top-stories"},errorModal:{require:"components/error-modal"},expiredDealModal:{require:"components/expired-deal-modal.desktop"},externalLink:{require:"components/external-link"},autoCalcIframe:{require:"components/auto-calc-iframe"},fixate:{require:"components/fixate"},formAjax:{require:"components/form-ajax"},formTrim:{require:"components/form-trim"},formValidate:{require:"components/form-validate"},forumsBestAnswer:{require:"components/forums-best-answer"},forumsEditPost:{require:"components/forums-edit-post"},forumsMarkAsRead:{require:"components/forums-mark-as-read"},forumsRealtime:{require:"components/forums-realtime"},forumsPostToggle:{require:"components/forums-post-toggle"},forumsPostPreview:{require:"components/forums-post-preview"},forumsPostFlag:{require:"components/forums-post-flag"},forumsPermalink:{require:"components/forums-permalink"},forumsLoadForm:{require:"components/forums-load-form"},forumsSearchUpdater:{require:"components/forums-search-updater"},forumsTools:{require:"components/forums-tools"},forumsTrack:{require:"components/forums-track"},forumsVote:{require:"components/forums-vote"},fullScreenSlides:{require:"components/full-screen-slides"},genericTracker:{require:"components/generic-tracker"},googleCsa:{require:"components/google-csa"},howlerAudioPlayer:{require:"components/howler-audio-player"},iframeAdTracker:{require:"components/iframe-ad-tracker"},iframeHoverFix:{require:"components/iframe-hover-fix"},iframeResizer:{require:"components/iframe-resizer"},imageGallery:{require:"components/image-gallery"},imageGalleryAuto:{require:"components/image-gallery-auto"},imageGalleryModal:{require:"components/image-gallery-modal"},indepthReview:{require:"components/indepth-review"},instagramFetcher:{require:"components/instagram-fetcher"},interactiveFloorPlans:{require:"components/interactive-floor-plans"},interactiveFloorPlansV2:{require:"components/interactive-floor-plans-v2"},interactiveVideoPlayer:{require:"components/interactive-video-player"},inviewElement:{require:"quantum/inviewElement"},joinCnet:{require:"components/join-cnet"},lazyloadImages:{require:"components/lazyload-images"},lazyloadElement:{require:"components/lazyload-element"},leadsTracker:{require:"components/leads-tracker"},linkCallback:{require:"components/link-callback"},linkTracker:{require:"components/link-tracker"},liveStreamPlayer:{require:"components/live-stream-player"},loading:{require:"components/loading"},loadMore:{require:"components/load-more"},loadNewest:{require:"components/load-newest",options:{clickGenericText:"refresh-river"}},longform:{require:"components/longform"},modal:{require:"version!fly/components/modal"},modalEnlargeImage:{require:"components/modal-enlarge-image"},modalNewsletter:{require:"components/modal-newsletter"},moduleAssetTracker:{require:"components/module-asset-tracker"},mostPopularDeal:{require:"components/most-popular-deal.desktop"},mostPopularDealListing:{require:"components/most-popular-deal-listing.desktop",options:{contentSet:function(e){t.process(e.$content)}}},newsletterAndInterest:{require:"components/newsletter-and-interest"},newsletterSubscription:{require:"components/newsletter-subscription"},newsCarousel:{require:"components/news-carousel"},page:{require:"components/page"},pageHeader:{require:"components/page-header"},parallaxReveal:{require:"components/parallax-reveal"},poll:{require:"components/poll"},pricesByZip:{require:"components/prices-by-zip"},productMediaCarousel:{require:"components/product-media-carousel"},productSeriesModal:{require:"components/product-series",options:{contentSet:function(e,i){t.process(i.$content)}}},productSpecs:{require:"components/product-specs"},productReviewVideo:{require:"components/product-review-video"},profileReauth:{require:"components/profile-reauth"},progressiveAd:{require:"components/progressive-ad"},popOnScroll:{require:"components/pop-on-scroll"},profileSubscriptions:{require:"components/profile-subscriptions",options:{contentSet:function(e){t.process(e.$content)}}},profileModal:{require:"components/profile-modal",options:{contentSet:function(e){t.process(e.$content)}}},profileUpdate:{require:"components/profile-update",options:{contentSet:function(e){t.process(e.$content)}}},profileUgc:{require:"components/profile-ugc",options:{contentSet:function(e){t.process(e.$content)}}},profileDiscussions:{require:"components/profile-discussions"},radio:{require:"components/radio"},readMore:{require:"components/read-more"},realtimeData:{require:"components/realtime-data"},realtimeDrawer:{require:"components/realtime-drawer"},realtimeTicker:{require:"components/realtime-ticker"},recaptcha:{require:"components/recaptcha"},reposition:{require:"components/reposition"},resetPassword:{require:"components/reset-password"},scrollbarArea:{require:"components/scrollbar-area"},scrollTracking:{require:"components/scroll-tracking"},searchBar:{require:"components/search-bar"},searchPagination:{require:"components/search-paginator",options:{contentSet:function(e){t.process(e.$content)}}},searchSort:{require:"components/search-sort"},selfishScroll:{require:"components/selfish-scroll"},sharebar:{require:"components/sharebar"},shortcodeGallery:{require:"components/shortcode-gallery"},shortcodeGalleryController:{require:"components/shortcode-gallery-controller"},showcaseHeroTabs:{require:"components/showcase-hero-tabs"},showcaseRailBody:{require:"components/showcase-rail-body"},showcaseVideos:{require:"components/showcase-videos"},sideNav:{require:"components/side-nav"},sideqik:{require:"components/sideqik"},slider:{require:"components/slider"},slidingElement:{require:"components/sliding-element"},snappyCarousel:{require:"quantum/snappyCarousel"},stacklaEvents:{require:"components/stackla-events"},stimulusCalculator:{require:"components/stimulus-calculator"},uiSlider:{require:"version!libs/jquery/ui/jquery.ui.slider"},socialButton:{require:"version!fly/components/social-button"},socialCounts:{require:"components/social-counts"},socialMenu:{require:"components/social-menu"},socialTracking:{require:"components/social-tracking"},stickyColumn:{require:"components/sticky-column"},stickyElement:{require:"components/sticky-element"},stickyLeader:{require:"components/sticky-leader"},subratingModalToggle:{require:"components/subrating-modal-toggle"},swipeAway:{require:"quantum/swipeAway"},tableSorter:{require:"components/table-sorter"},tabs:{require:"version!fly/components/tabs"},tabsAsync:{require:"components/tabs-async",options:{contentSet:function(e){t.process(e.$content)}}},tabsRefresh:{require:"components/tabs-refresh"},tagLetterSorter:{require:"components/tag-letter-sorter"},textCounter:{require:"components/text-counter"},tileSpecialNav:{require:"components/tile-special-nav"},tocNav:{require:"components/toc-nav"},toggle:{require:"components/toggle"},tooltip:{require:"components/tooltip"},touchMenuHover:{require:"components/touch-menu-hover"},trackDownload:{require:"components/track-download"},trackImpression:{require:"components/track-impression"},tvFeature:{require:"components/tv-feature"},twitterFetcher:{require:"components/twitter-fetcher"},updateArea:{require:"components/update-area"},videoPlaceholder:{require:"components/video-placeholder"},videoPlayer:{require:a?"quantum/videoPlayer_upgrade":"quantum/videoPlayer"},videoListing:{require:"components/video-listing"},videoPlaylistConnector:{require:"components/video-playlist-connector"},videoShowGallery:{require:"components/video-show-gallery"},waypointPromo:{require:"component/waypoint-promo"},zipCode:{require:"components/zip-code"},zoom:{require:"quantum/zoom"},profileNewsletterSubscription:{require:"components/profile-newsletter-subscription"},bandwidthMeterBar:{require:"components/bandwidth-meter-bar"}}),t}),define("managers/edition-notifications",["jquery","version!fly/managers/debug","managers/device","components/global-modal"],function(e,t,i,s){return t=t.init("editionNotifications"),{init:function(){if(i.isDesktop()){var t=e("body").data("edition-redirect-alert");t&&t.length>0&&e.cnet.globalModal({content:t,openOnInit:!0})}}}}),define("managers/promotionals.desktop",["jquery","version!fly/managers/debug","managers/client-storage","utils/cookie","managers/edition","managers/global-functions","managers/page-vars","managers/user","version!libs/modernizr.custom"],function(e,t,i,s,n,a,r,o){(t=t.init("promotionals")).log("promos here");var l=null,d={cookiesNotification:{limit:3,isActive:function(){return!1},init:function(){require(["components/cookies-notification.desktop"],function(){e.cnet.cookiesNotification(),l.cookiesNotification++,i.write("promotionalSettings",l),i.write("suppressCookiesNotification",!0,!0)})}},autoSocialPromo:{limit:4,isActive:function(){"front_door"==r.tracking.data._pageType&&r.tracking.data.slug,l.autoSocialPromo,d.autoSocialPromo.limit;return!1},init:function(){require(["components/waypoint-promo"],function(){e.cnet.waypointPromo()})}},urbanAirshipPromo:{isActive:function(){return!0},init:function(){require(["components/urban-airship"],function(){try{a.gdprConsentCallback("script_urban_airship_promo",function(){e.cnet.urbanAirship()},{},"targeting")}catch(e){t.log("UrbanAirship component not available")}})}}};return{init:function(){var t=function(){!1===e.cnet.breakingNewsActive&&(d.cookiesNotification.isActive()?d.cookiesNotification.init():d.espanolPromo.isActive()&&d.espanolPromo.init())};for(var s in l=i.read("promotionalSettings")||{},d)d.hasOwnProperty(s)&&(l[s]=l[s]||0);d.autoSocialPromo.isActive()&&d.autoSocialPromo.init(),d.urbanAirshipPromo.isActive()&&d.urbanAirshipPromo.init(),void 0===e.cnet.breakingNewsActive?e(window).on("breakingNewsComplete",function(){t()}):t()},suppress:function(e){l[e]=d[e].limit,i.write("promotionalSettings",l)},increment:function(e){l[e]++,i.write("promotionalSettings",l)}}}),define("managers/third-party/social",["version!fly/managers/debug","managers/page-vars","managers/global-functions"],function(e,t,i){e=e.init("social");var s={linkedIn:"managers/third-party/linked-in",pinterest:"managers/third-party/pinterest",twitter:"managers/third-party/twitter",disqus:"managers/third-party/disqus"};function n(e,t="social"){"string"==typeof s[e]&&i.gdprConsentCallback("script_"+e,function(){require([s[e]],function(t){s[e]=t,t.init()})},{},t)}return{init:function(){t.services.linkedin.enabled&&$('[data-social="linkedIn"]').length>0&&n("linkedIn"),t.services.pinterest.enabled&&$('[data-social="pinterest"]').length>0&&n("pinterest"),t.services.twitterwidget.enabled&&$('[data-social="twitter"]').length>0&&n("twitter"),t.services.disqus.enabled&&$('[data-social="disqus"]').length>0&&"comments_permalink"==t.pageType&&n("disqus","functional")},parse:function(e){e=e||null,t.services.linkedin.enabled&&$('[data-social="linkedIn"]',e).length>0&&("string"==typeof s.linkedIn?n("linkedIn"):s.linkedIn.parse(e)),t.services.pinterest.enabled&&$('[data-social="pinterest"]',e).length>0&&"string"==typeof s.pinterest&&n("pinterest"),t.services.twitterwidget.enabled&&$('[data-social="twitter"]',e).length>0&&("string"==typeof s.twitter?n("twitter"):s.twitter.parse()),t.services.disqus.enabled&&$('[data-social="disqus"]',e).length>0&&("string"==typeof s.disqus?n("disqus","functional"):s.disqus.parse(e))}}}),function(e){"use strict";void 0===e&&(e={}),void 0===e.performance?e.performance={}:"performance"in e&&e.performance&&e.performance.setResourceTimingBufferSize&&performance.setResourceTimingBufferSize(400),e._perfRefForUserTimingPolyfill=e.performance,e.performance.userTimingJsNow=!1,e.performance.userTimingJsNowPrefixed=!1,e.performance.userTimingJsUserTiming=!1,e.performance.userTimingJsUserTimingPrefixed=!1,e.performance.userTimingJsPerformanceTimeline=!1,e.performance.userTimingJsPerformanceTimelinePrefixed=!1;var t,i,s=[],n=[],a=null;if("function"!=typeof e.performance.now){for(e.performance.userTimingJsNow=!0,n=["webkitNow","msNow","mozNow"],t=0;t<n.length;t++)if("function"==typeof e.performance[n[t]]){e.performance.now=e.performance[n[t]],e.performance.userTimingJsNowPrefixed=!0;break}var r=+new Date;e.performance.timing&&e.performance.timing.navigationStart&&(r=e.performance.timing.navigationStart),"function"!=typeof e.performance.now&&(Date.now?e.performance.now=function(){return Date.now()-r}:e.performance.now=function(){return+new Date-r})}var o=function(){},l=function(){},d=[],u=!1,c=!1;if("function"!=typeof e.performance.getEntries||"function"!=typeof e.performance.mark){for("function"==typeof e.performance.getEntries&&"function"!=typeof e.performance.mark&&(c=!0),e.performance.userTimingJsPerformanceTimeline=!0,s=["webkit","moz"],n=["getEntries","getEntriesByName","getEntriesByType"],t=0;t<n.length;t++)for(i=0;i<s.length;i++)a=s[i]+n[t].substr(0,1).toUpperCase()+n[t].substr(1),"function"==typeof e.performance[a]&&(e.performance[n[t]]=e.performance[a],e.performance.userTimingJsPerformanceTimelinePrefixed=!0);o=function(e){d.push(e),"measure"===e.entryType&&(u=!0)};var h=function(){u&&(d.sort(function(e,t){return e.startTime-t.startTime}),u=!1)};if(l=function(e,i){for(t=0;t<d.length;)d[t].entryType===e&&(void 0===i||d[t].name===i)?d.splice(t,1):t++},"function"!=typeof e.performance.getEntries||c){var p=e.performance.getEntries;e.performance.getEntries=function(){h();var t=d.slice(0);return c&&p&&(Array.prototype.push.apply(t,p.call(e.performance)),t.sort(function(e,t){return e.startTime-t.startTime})),t}}if("function"!=typeof e.performance.getEntriesByType||c){var g=e.performance.getEntriesByType;e.performance.getEntriesByType=function(i){if(void 0===i||"mark"!==i&&"measure"!==i)return c&&g?g.call(e.performance,i):[];"measure"===i&&h();var s=[];for(t=0;t<d.length;t++)d[t].entryType===i&&s.push(d[t]);return s}}if("function"!=typeof e.performance.getEntriesByName||c){var f=e.performance.getEntriesByName;e.performance.getEntriesByName=function(i,s){if(s&&"mark"!==s&&"measure"!==s)return c&&f?f.call(e.performance,i,s):[];void 0!==s&&"measure"===s&&h();var n=[];for(t=0;t<d.length;t++)void 0!==s&&d[t].entryType!==s||d[t].name===i&&n.push(d[t]);return c&&f&&(Array.prototype.push.apply(n,f.call(e.performance,i,s)),n.sort(function(e,t){return e.startTime-t.startTime})),n}}}if("function"!=typeof e.performance.mark){for(e.performance.userTimingJsUserTiming=!0,s=["webkit","moz","ms"],n=["mark","measure","clearMarks","clearMeasures"],t=0;t<n.length;t++)for(i=0;i<s.length;i++)a=s[i]+n[t].substr(0,1).toUpperCase()+n[t].substr(1),"function"==typeof e.performance[a]&&(e.performance[n[t]]=e.performance[a],e.performance.userTimingJsUserTimingPrefixed=!0);var v={};"function"!=typeof e.performance.mark&&(e.performance.mark=function(t){var i=e.performance.now();if(void 0===t)throw new SyntaxError("Mark name must be specified");if(e.performance.timing&&t in e.performance.timing)throw new SyntaxError("Mark name is not allowed");v[t]||(v[t]=[]),v[t].push(i),o({entryType:"mark",name:t,startTime:i,duration:0})}),"function"!=typeof e.performance.clearMarks&&(e.performance.clearMarks=function(e){e?v[e]=[]:v={},l("mark",e)}),"function"!=typeof e.performance.measure&&(e.performance.measure=function(t,i,s){var n=e.performance.now();if(void 0===t)throw new SyntaxError("Measure must be specified");if(i){var a=0;if(e.performance.timing&&i in e.performance.timing){if("navigationStart"!==i&&0===e.performance.timing[i])throw new Error(i+" has a timing of 0");a=e.performance.timing[i]-e.performance.timing.navigationStart}else{if(!(i in v))throw new Error(i+" mark not found");a=v[i][v[i].length-1]}var r=n;if(s)if(r=0,e.performance.timing&&s in e.performance.timing){if("navigationStart"!==s&&0===e.performance.timing[s])throw new Error(s+" has a timing of 0");r=e.performance.timing[s]-e.performance.timing.navigationStart}else{if(!(s in v))throw new Error(s+" mark not found");r=v[s][v[s].length-1]}o({entryType:"measure",name:t,startTime:a,duration:r-a})}else o({entryType:"measure",name:t,startTime:0,duration:n})}),"function"!=typeof e.performance.clearMeasures&&(e.performance.clearMeasures=function(e){l("measure",e)})}"undefined"!=typeof define&&define.amd?define("libs/usertiming-0.1.6",[],function(){return e.performance}):"undefined"!=typeof module&&void 0!==module.exports&&(module.exports=e.performance)}("undefined"!=typeof window?window:void 0),define("utils/function-natives",["version!libs/usertiming"],function(){Function.prototype.bind||(Function.prototype.bind=function(e){var t=this,i=arguments.length>1?arguments.slice(1):null,s=function(){},n=function(){var a=e,r=arguments.length;this instanceof n&&(s.prototype=t.prototype,a=new s);var o=i||r?t.apply(a,i&&r?i.concat(arguments.slice()):i||arguments):t.call(a);return a==e?o:a};return n}),Array.prototype.find||(Array.prototype.find=function(e){if(null===this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t,i=Object(this),s=i.length>>>0,n=arguments[1],a=0;a<s;a++)if(t=i[a],e.call(n,t,a,i))return t})}),function(e,t,i){"function"==typeof define&&define.amd?define("libs/jquery/mobile-1.4.0a1",["jquery"],function(s){return i(s,e,t),s.mobile}):i(e.jQuery,e,t)}(this,document,function(e,t,i,s){!function(e,t,i,s){var n,a,r="virtualMouseBindings",o="virtualTouchID",l="vmouseover vmousedown vmousemove vmouseup vclick vmouseout vmousecancel".split(" "),d="clientX clientY pageX pageY screenX screenY".split(" "),u=e.event.mouseHooks?e.event.mouseHooks.props:[],c=e.event.props.concat(u),h={},p=0,g=0,f=0,v=!1,m=[],_=!1,E=!1,A="addEventListener"in i,y=e(i),S=1,b=0;function T(e){for(;e&&void 0!==e.originalEvent;)e=e.originalEvent;return e}function C(t){for(var i,s,n={};t;){for(s in i=e.data(t,r))i[s]&&(n[s]=n.hasVirtualBinding=!0);t=t.parentNode}return n}function I(){E=!0}function D(){E=!1}function R(){P(),p=setTimeout(function(){p=0,b=0,m.length=0,_=!1,I()},e.vmouse.resetTimerDuration)}function P(){p&&(clearTimeout(p),p=0)}function M(t,i,n){var a;return(n&&n[t]||!n&&function(t,i){for(var s;t;){if((s=e.data(t,r))&&(!i||s[i]))return t;t=t.parentNode}return null}(i.target,t))&&(a=function(t,i){var n,a,r,o,l,u,h,p,g,f=t.type;if((t=e.Event(t)).type=i,n=t.originalEvent,a=e.event.props,f.search(/^(mouse|click)/)>-1&&(a=c),n)for(h=a.length;h;)t[o=a[--h]]=n[o];if(f.search(/mouse(down|up)|click/)>-1&&!t.which&&(t.which=1),-1!==f.search(/^touch/)&&(f=(r=T(n)).touches,l=r.changedTouches,u=f&&f.length?f[0]:l&&l.length?l[0]:s))for(p=0,g=d.length;p<g;p++)t[o=d[p]]=u[o];return t}(i,t),e(i.target).trigger(a)),a}function k(t){var i,s=e.data(t.target,o);_||b&&b===s||(i=M("v"+t.type,t))&&(i.isDefaultPrevented()&&t.preventDefault(),i.isPropagationStopped()&&t.stopPropagation(),i.isImmediatePropagationStopped()&&t.stopImmediatePropagation())}function w(t){var i,s,n,a=T(t).touches;a&&1===a.length&&(s=C(i=t.target)).hasVirtualBinding&&(b=S++,e.data(i,o,b),P(),D(),v=!1,n=T(t).touches[0],g=n.pageX,f=n.pageY,M("vmouseover",t,s),M("vmousedown",t,s))}function O(e){E||(v||M("vmousecancel",e,C(e.target)),v=!0,R())}function L(t){if(!E){var i=T(t).touches[0],s=v,n=e.vmouse.moveDistanceThreshold,a=C(t.target);(v=v||Math.abs(i.pageX-g)>n||Math.abs(i.pageY-f)>n)&&!s&&M("vmousecancel",t,a),M("vmousemove",t,a),R()}}function N(e){if(!E){I();var t,i,s=C(e.target);M("vmouseup",e,s),v||(t=M("vclick",e,s))&&t.isDefaultPrevented()&&(i=T(e).changedTouches[0],m.push({touchID:b,x:i.clientX,y:i.clientY}),_=!0),M("vmouseout",e,s),v=!1,R()}}function U(t){var i,s=e.data(t,r);if(s)for(i in s)if(s[i])return!0;return!1}function B(){}function j(t){var i=t.substr(1);return{setup:function(){U(this)||e.data(this,r,{}),e.data(this,r)[t]=!0,h[t]=(h[t]||0)+1,1===h[t]&&y.bind(i,k),e(this).bind(i,B),A&&(h.touchstart=(h.touchstart||0)+1,1===h.touchstart&&y.bind("touchstart",w).bind("touchend",N).bind("touchmove",L).bind("scroll",O))},teardown:function(){--h[t],h[t]||y.unbind(i,k),A&&(--h.touchstart,h.touchstart||y.unbind("touchstart",w).unbind("touchmove",L).unbind("touchend",N).unbind("scroll",O));var s=e(this),n=e.data(this,r);n&&(n[t]=!1),s.unbind(i,B),U(this)||s.removeData(r)}}}for(e.vmouse={moveDistanceThreshold:10,clickDistanceThreshold:10,resetTimerDuration:1500},a=0;a<l.length;a++)e.event.special[l[a]]=j(l[a]);A&&i.addEventListener("click",function(t){var i,s,a,r,l,d=m.length,u=t.target;if(d)for(i=t.clientX,s=t.clientY,n=e.vmouse.clickDistanceThreshold,a=u;a;){for(r=0;r<d;r++)if(l=m[r],0,a===u&&Math.abs(l.x-i)<n&&Math.abs(l.y-s)<n||e.data(a,o)===l.touchID)return t.preventDefault(),void t.stopPropagation();a=a.parentNode}},!0)}(e,0,i),e.mobile={},function(e,t){var s={touch:"ontouchend"in i};e.mobile.support=e.mobile.support||{},e.extend(e.support,s),e.extend(e.mobile.support,s)}(e),function(e,t,s){var n=e(i),a=e.mobile.support.touch,r=a?"touchstart":"mousedown",o=a?"touchend":"mouseup",l=a?"touchmove":"mousemove";function d(t,i,s){var n=s.type;s.type=i,e.event.dispatch.call(t,s),s.type=n}e.each("touchstart touchmove touchend tap taphold swipe swipeleft swiperight scrollstart scrollstop".split(" "),function(t,i){e.fn[i]=function(e){return e?this.bind(i,e):this.trigger(i)},e.attrFn&&(e.attrFn[i]=!0)}),e.event.special.scrollstart={enabled:!0,setup:function(){var t,i,s=this;function n(e,i){d(s,(t=i)?"scrollstart":"scrollstop",e)}e(s).bind("touchmove scroll",function(s){e.event.special.scrollstart.enabled&&(t||n(s,!0),clearTimeout(i),i=setTimeout(function(){n(s,!1)},50))})},teardown:function(){e(this).unbind("touchmove scroll")}},e.event.special.tap={tapholdThreshold:750,emitTapOnTaphold:!0,setup:function(){var t=this,i=e(t),s=!1;i.bind("vmousedown",function(a){if(s=!1,a.which&&1!==a.which)return!1;var r,o=a.target;function l(){clearTimeout(r)}function u(){l(),i.unbind("vclick",c).unbind("vmouseup",l),n.unbind("vmousecancel",u)}function c(e){u(),s||o!==e.target?s&&e.stopPropagation():d(t,"tap",e)}i.bind("vmouseup",l).bind("vclick",c),n.bind("vmousecancel",u),r=setTimeout(function(){e.event.special.tap.emitTapOnTaphold&&(s=!0),d(t,"taphold",e.Event("taphold",{target:o}))},e.event.special.tap.tapholdThreshold)})},teardown:function(){e(this).unbind("vmousedown").unbind("vclick").unbind("vmouseup"),n.unbind("vmousecancel")}},e.event.special.swipe={scrollSupressionThreshold:30,durationThreshold:1e3,horizontalDistanceThreshold:10,verticalDistanceThreshold:75,start:function(t){var i=t.originalEvent.touches?t.originalEvent.touches[0]:t;return{time:(new Date).getTime(),coords:[i.pageX,i.pageY],origin:e(t.target)}},stop:function(e){var t=e.originalEvent.touches?e.originalEvent.touches[0]:e;return{time:(new Date).getTime(),coords:[t.pageX,t.pageY]}},handleSwipe:function(t,i,s,n){if(i.time-t.time<e.event.special.swipe.durationThreshold&&Math.abs(t.coords[0]-i.coords[0])>e.event.special.swipe.horizontalDistanceThreshold&&Math.abs(t.coords[1]-i.coords[1])<e.event.special.swipe.verticalDistanceThreshold){var a=t.coords[0]>i.coords[0]?"swipeleft":"swiperight";return d(s,"swipe",e.Event("swipe",{target:n,swipestart:t,swipestop:i})),d(s,a,e.Event(a,{target:n,swipestart:t,swipestop:i})),!0}return!1},setup:function(){var t=this,i=e(t);i.bind(r,function(s){var n,a=e.event.special.swipe.start(s),r=s.target,d=!1;i.bind(l,function(i){a&&(n=e.event.special.swipe.stop(i),d||(d=e.event.special.swipe.handleSwipe(a,n,t,r)),Math.abs(a.coords[0]-n.coords[0])>e.event.special.swipe.scrollSupressionThreshold&&i.preventDefault())}).one(o,function(){d=!0})})},teardown:function(){e(this).unbind(r).unbind(l).unbind(o)}},e.each({scrollstop:"scrollstart",taphold:"tap",swipeleft:"swipe",swiperight:"swipe"},function(t,i){e.event.special[t]={setup:function(){e(this).bind(i,e.noop)},teardown:function(){e(this).unbind(i)}}})}(e)}),define("main.desktop",["jquery","managers/client-storage","managers/components.desktop","managers/device","managers/edition-notifications","managers/page-vars","managers/promotionals.desktop","managers/third-party/social","managers/tracking","managers/tealium","version!libs/modernizr.custom","version!fly/utils/data-prefix","utils/function-natives","version!libs/jquery/mobile","managers/user"],function(e,t,i,s,n,a,r,o,l){e(document).ready(function(){l.resetTrackingData(a.tracking.data),s.init(a.device),t.init(),i.process(e("body")),r.init(),n.init(),o.init()})}),define("fly/libs/jquery.throttle-debounce-1.1",["jquery"],function(e){var t;e.throttle=t=function(t,i,s,n){var a,r=0;function o(){var e=this,o=+new Date-r,l=arguments;function d(){r=+new Date,s.apply(e,l)}n&&!a&&d(),a&&clearTimeout(a),void 0===n&&o>t?d():!0!==i&&(a=setTimeout(n?function(){a=void 0}:d,void 0===n?t-o:t))}return"boolean"!=typeof i&&(n=s,s=i,i=void 0),e.guid&&(o.guid=s.guid=s.guid||e.guid++),o},e.debounce=function(e,i,s){return void 0===s?t(e,i,!1):t(e,s,!1!==i)}}),define("managers/recommendation",["jquery","components/uds-sdk","managers/page-vars","managers/global-functions","managers/tealium","managers/user","managers/recommendation-data","version!fly/managers/debug","version!fly/libs/jquery.throttle-debounce"],function(e,t,i,s,n,a,r,o){var l="CnetUnfollowList",d=2;function u(e){var s=JSON.parse(localStorage.getItem(l));s&&(s.forEach(function(e){var t=r.createMockExplicitInterestObject(e);r.writeExplicitInterestToLocalStorage(t)}),localStorage.removeItem(l));var a=r.getExplicitInterests();if(a.length)for(var d=0;d<a.length;d++)if(a[d].type===e.interest.type&&a[d].interest_name===e.interest.name.toUpperCase()&&"unfollow"===a[d].action)return void o.log("Did not add tag "+a[d].interest_name+" due to being explicitly unfollowed");window.UA.then(function(s){if(s.channel){var a=e.interest.name.toUpperCase(),l=r.getTagGroupByInterest(e.interest.type);if(!s.channel.tags.has(a,l)){o.log("Adding interests in UA API: "+a),t&&t.enabled||s.channel.tags.add(a,l);var d=i.tracking.data;t&&t.enabled||n.trackCustomEvent("background",{pageViewGuid:d.pageViewGuid,_dwAnonId:d._dwAnonId,articleId:d.articleId,clickGenericText:"add_interest|"+e.interest.type+"_interest|"+e.interest.name.toUpperCase(),pageType:d.pageType,siteEdition:d.siteEdition,siteHier:d.siteHier,siteSection:d.siteSection},"trackClick")}e.ua_channel_id=s.channel.id}}),r.sendInterestsToBackend([r.createImplicitInterestObject(e)])}function c(e,t,s){var a=i.tracking.data;n.trackCustomEvent("tap",{pageViewGuid:a.pageViewGuid,_dwAnonId:a._dwAnonId,articleId:a.articleId,clickGenericText:(s?"add":"remove")+"_interest|"+t+"_interest|"+e,pageType:a.pageType,siteEdition:a.siteEdition,siteHier:a.siteHier,siteSection:a.siteSection},"trackClick")}return o=o.init("recommendationManager"),{registerPageView:function(){if(r.testForLocalStorage()&&"us"===i.tracking.data.siteEdition){var n=r.getViewEvents();a.getUserData(function(i,a){var o=r.createNewViewEvent(a);n.push(o),t&&t.enabled&&t.processView(o),function(t,i){var n=function(e){var t={},i=Date.now()-2592e6;return e.forEach(function(e){!(e=r.normalizeView(e)).interest||"none"===e.interest.id||!e.date_created||i>e.date_created||(t[e.user_id]||(t[e.user_id]={}),t[e.user_id][e.interest.type]||(t[e.user_id][e.interest.type]={}),t[e.user_id][e.interest.type][e.interest.name]?t[e.user_id][e.interest.type][e.interest.name].push(e):t[e.user_id][e.interest.type][e.interest.name]=[e])}),t}(t);if("none"===i.interest.id)return;n&&n[i.user_id]&&n[i.user_id][i.interest.type]&&n[i.user_id][i.interest.type][i.interest.name]&&n[i.user_id][i.interest.type][i.interest.name].length>=d&&s.gdprConsentCallback("UAInterestAdd",function(){window.UA?u(i):e(window).on("urban-airship-loaded",function(){u(i)})},{},"targeting")}(n=r.pruneViews(n,o),o),r.writeViewsArray(n)})}},registerOnScroll:function(t){var s=this;t||(t=window);var n=e(t);n.on("scroll.recommendationManager",e.throttle(500,function(){i.tracking&&i.tracking.data&&i.tracking.data.contentId&&s.registerPageView(),n.off("scroll.recommendationManager")}))},onVideoComplete:function(){const s=i.tracking.data.pageType;s&&-1!==["video_page","video_list"].indexOf(s)?a.getUserData(function(i,s){var n=r.createNewViewEvent(s);if("none"===n.interest.id)return;const a=r.createImplicitInterestObject(n);window.UA?(o.log("Page video completed. Adding page interest"),u(n),t&&t.enabled&&t.addInterest(a,"video")):e(window).on("urban-airship-loaded",function(){o.log("Page video completed. Adding page interest"),u(n),t&&t.enabled&&t.addInterest(a,"video")})}):o.warn("Attempted to add video completion interest on non-video page. Not adding page interest. Current page type: "+s)},addExplicitInterest:function(e,i){a.getUserData(function(s,n){var a=r.createExplicitInterestObject("follow",i,n);if(e.channel){var l=r.getTagGroupByInterest(a.type);o.log("Adding "+a.interest_name+" to UA"),t&&t.enabled||(e.channel.tags.add(a.interest_name.toUpperCase(),l),c(a.interest_name.toUpperCase(),a.type,!0))}return r.writeExplicitInterestToLocalStorage(a),t&&t.enabled&&t.addInterest(a,"tap"),r.sendInterestsToBackend([a],function(e){o.log("Successfully added follow interest "+a.interest_name+" to DB")}),a})},removeExplicitInterest:function(e,i){a.getUserData(function(s,n){var a=r.createExplicitInterestObject("unfollow",i,n);if(e.channel){var l=r.getTagGroupByInterest(a.type);o.log("Removing UA interest "+a.interest_name.toUpperCase()),t&&t.enabled||(e.channel.tags.remove(a.interest_name.toUpperCase(),l),c(a.interest_name.toUpperCase(),a.type,!1))}return r.writeExplicitInterestToLocalStorage(a),t&&t.enabled&&t.addInterest(a,"tap"),r.sendInterestsToBackend([a],function(e){o.log("Successfully added unfollow interest "+a.interest_name+" to DB")}),a})}}}),define("fly/components/fixate-1.0",["jquery","version!fly/components/base"],function(e){e.widget("fly.fixate",e.fly.base,{options:{classFixed:"fixed",classUnfixed:"unfixed",primaryEdge:"top",offset:{top:20,bottom:20},stickToLeft:!1,stickToRight:!1,guideTop:null,guideBottom:null,guideLeft:null,guideRight:null},hasEvents:!1,isFixed:!1,boundary:{top:-1,bottom:-1,left:-1,right:-1},$element:null,$window:e(window),$document:e(document),_create:function(){this._super("_create"),this._setBoundaries(),this._addEvents(),this.checkPosition()},_addEvents:function(){this.options;this.hasEvents||this.disabled||(this.hasEvents=!0,this.$window.on("scroll.fixate",e.proxy(this.checkPosition,this)),this.$window.on("resize.fixate",e.proxy(this.checkPosition,this)))},_removeEvents:function(){this.hasEvents=!1},_setBoundaries:function(){var t=this.options,i=null,s=null,n=null,a=null;this.boundary={top:-1,bottom:-1,left:-1,right:-1},t.guideTop&&(i=(s=e(t.guideTop)).offset(),this.boundary.top=i.top+s.outerHeight()),t.guideBottom&&(i=e(t.guideBottom).offset(),this.boundary.bottom=i.top),t.guideLeft&&(i=(n=e(t.guideLeft)).offset(),t.stickToLeft&&((this.boundary.top<0||i.top>this.boundary.top)&&(this.boundary.top=i.top),(this.boundary.bottom<0||i.top+n.outerHeight()<this.boundary.bottom)&&(this.boundary.bottom=i.top+n.outerHeight()))),t.guideRight&&(i=(a=e(t.guideRight)).offset(),t.stickToRight&&((this.boundary.top<0||i.top>this.boundary.top)&&(this.boundary.top=i.top),(this.boundary.bottom<0||i.top+a.outerHeight()<this.boundary.bottom)&&(this.boundary.bottom=i.top+a.outerHeight())))},_fix:function(){var e=this.options;this.isFixed=!0,this.$element.addClass(e.classFixed).removeClass(e.classUnfixed),"top"===e.primaryEdge?this.$element.css("top",e.offset.top):this.$element.css("top",this.$window.height()-e.offset.bottom-this.$element.height()),this._placeHorizontally()},_unfix:function(e){var t=this.options;this.isFixed=!1,this.$element.addClass(t.classUnfixed).removeClass(t.classFixed),"top"===e?this.$element.css("top",this.boundary.top+t.offset.top-this.$window.scrollTop()):this.$element.css("top",this.boundary.bottom-t.offset.bottom-this.$element.height()-this.$window.scrollTop()),this._placeHorizontally()},_placeHorizontally:function(){var t=this.options,i=this.$window.scrollLeft(),s=null,n=null;t.guideLeft?(s=e(t.guideLeft),this.$element.css("left",s.offset().left+s.outerWidth()-i)):t.guideRight&&(n=e(t.guideRight),this.$element.css("left",n.offset().left-this.$element.width()-i))},checkPosition:function(){var e=this.options,t=this.$window.scrollTop(),i=t+this.$window.height(),s=this.$element.height();this._setBoundaries(),"top"===e.primaryEdge?t<this.boundary.top?this._unfix("top"):this.boundary.bottom>=0&&t+e.offset.top+s+e.offset.bottom>this.boundary.bottom?this._unfix("bottom"):this._fix():i>this.boundary.bottom?this._unfix("bottom"):i-e.offset.bottom-s-e.offset.top<this.boundary.top?this._unfix("top"):this._fix()},destroy:function(){this._removeEvents(),this._super("destroy")}})}),define("components/fixate",["jquery","version!fly/managers/debug","version!fly/components/fixate"],function(e,t){t=t.init("fixate"),e.widget("fly.fixate",e.fly.fixate,{options:{classFixedParent:"fixed-parent",guideContainer:null,guideTopPlus:null,innerGuideLeft:null,classTop:"top",classBottom:"bottom",offset:{topPlus:0},minHeight:null},_create:function(){this._super();var t=this.options,i=null;if(t.guideBottom&&t.minHeight){i=e(t.guideBottom).offset();var s=this.$element.offset();i.top-s.top<t.minHeight&&this.$element.addClass("cancelfix")}},_setBoundaries:function(){this._super();var t=this.options,i=null;this.options.guideContainer&&(this.options.guideContainer=e(this.options.guideContainer),i=this.options.guideContainer.offset(),(this.boundary.top<0||i.top>this.boundary.top)&&(this.boundary.top=i.top),(this.boundary.bottom<0||i.top+this.options.guideContainer.outerHeight()<this.boundary.bottom)&&(this.boundary.bottom=i.top+this.options.guideContainer.outerHeight())),t.guideTopPlus&&(t.guideTopPlus=e(t.guideTopPlus),i=t.guideTopPlus.offset(),this.boundary.top=i.top+t.guideTopPlus.outerHeight()-t.offset.topPlus)},_fix:function(){var e=this.options;this.isFixed=!0,this.$element.addClass(e.classFixed).removeClass(e.classUnfixed).removeClass(e.classBottom).removeClass(e.classTop),"top"===e.primaryEdge?this.$element.css("top",e.offset.top):this.$element.css("top",this.$window.height()-e.offset.bottom-this.$element.height()),this._placeHorizontally(),this.$element.parent().addClass(this.options.classFixedParent)},_unfix:function(e){var t=this.options;this.isFixed=!1,this.$element.addClass(t.classUnfixed).removeClass(t.classFixed),"top"===e?(this.$element.css("top",this.boundary.top-this.$window.scrollTop()),this.$element.addClass(t.classTop).removeClass(t.classBottom)):(this.$element.css("top",this.boundary.bottom-this.$element.height()-this.$window.scrollTop()),this.$element.addClass(t.classBottom).removeClass(t.classTop)),this._placeHorizontally(),this.$element.parent().removeClass(this.options.classFixedParent)},_placeHorizontally:function(){var t=this.options,i=null,s=this.$window.scrollLeft();t.innerGuideLeft&&(i=e(t.innerGuideLeft),this.$element.css("left",i.offset().left-s))}})}),define("components/iframe-hover-fix",["jquery","version!fly/managers/debug","version!fly/components/base"],function(e,t){t=t.init("iframeHoverFix"),e.widget("cnet.iframeHoverFix",e.fly.base,{options:{},_create:function(){var t=this;this._setup(),e.browser.msie&&(this.$element.live("mouseenter",function(){t.$element.addClass("hover")}),this.$element.find("iframe").live("hover",function(){t.$element.addClass("hover")}),this.$element.live("mouseleave",function(){t.$element.removeClass("hover")}))}})}),function(){"use strict";var e=0,t={};function i(s){if(!s)throw new Error("No options passed to Waypoint constructor");if(!s.element)throw new Error("No element option passed to Waypoint constructor");if(!s.handler)throw new Error("No handler option passed to Waypoint constructor");this.key="waypoint-"+e,this.options=i.Adapter.extend({},i.defaults,s),this.element=this.options.element,this.adapter=new i.Adapter(this.element),this.callback=s.handler,this.axis=this.options.horizontal?"horizontal":"vertical",this.enabled=this.options.enabled,this.triggerPoint=null,this.group=i.Group.findOrCreate({name:this.options.group,axis:this.axis}),this.context=i.Context.findOrCreateByElement(this.options.context),i.offsetAliases[this.options.offset]&&(this.options.offset=i.offsetAliases[this.options.offset]),this.group.add(this),this.context.add(this),t[this.key]=this,e+=1}i.prototype.queueTrigger=function(e){this.group.queueTrigger(this,e)},i.prototype.trigger=function(e){this.enabled&&this.callback&&this.callback.apply(this,e)},i.prototype.destroy=function(){this.context.remove(this),this.group.remove(this),delete t[this.key]},i.prototype.disable=function(){return this.enabled=!1,this},i.prototype.enable=function(){return this.context.refresh(),this.enabled=!0,this},i.prototype.next=function(){return this.group.next(this)},i.prototype.previous=function(){return this.group.previous(this)},i.invokeAll=function(e){var i=[];for(var s in t)i.push(t[s]);for(var n=0,a=i.length;n<a;n++)i[n][e]()},i.destroyAll=function(){i.invokeAll("destroy")},i.disableAll=function(){i.invokeAll("disable")},i.enableAll=function(){i.invokeAll("enable")},i.refreshAll=function(){i.Context.refreshAll()},i.viewportHeight=function(){return window.innerHeight||document.documentElement.clientHeight},i.viewportWidth=function(){return document.documentElement.clientWidth},i.adapters=[],i.defaults={context:window,continuous:!0,enabled:!0,group:"default",horizontal:!1,offset:0},i.offsetAliases={"bottom-in-view":function(){return this.context.innerHeight()-this.adapter.outerHeight()},"right-in-view":function(){return this.context.innerWidth()-this.adapter.outerWidth()}},window.Waypoint=i}(),function(){"use strict";function e(e){window.setTimeout(e,1e3/60)}var t=0,i={},s=window.Waypoint,n=window.onload;function a(e){this.element=e,this.Adapter=s.Adapter,this.adapter=new this.Adapter(e),this.key="waypoint-context-"+t,this.didScroll=!1,this.didResize=!1,this.oldScroll={x:this.adapter.scrollLeft(),y:this.adapter.scrollTop()},this.waypoints={vertical:{},horizontal:{}},e.waypointContextKey=this.key,i[e.waypointContextKey]=this,t+=1,this.createThrottledScrollHandler(),this.createThrottledResizeHandler()}a.prototype.add=function(e){var t=e.options.horizontal?"horizontal":"vertical";this.waypoints[t][e.key]=e,this.refresh()},a.prototype.checkEmpty=function(){var e=this.Adapter.isEmptyObject(this.waypoints.horizontal),t=this.Adapter.isEmptyObject(this.waypoints.vertical);e&&t&&(this.adapter.off(".waypoints"),delete i[this.key])},a.prototype.createThrottledResizeHandler=function(){var e=this;function t(){e.handleResize(),e.didResize=!1}this.adapter.on("resize.waypoints",function(){e.didResize||(e.didResize=!0,s.requestAnimationFrame(t))})},a.prototype.createThrottledScrollHandler=function(){var e=this;function t(){e.handleScroll(),e.didScroll=!1}this.adapter.on("scroll.waypoints",function(){e.didScroll&&!s.isTouch||(e.didScroll=!0,s.requestAnimationFrame(t))})},a.prototype.handleResize=function(){s.Context.refreshAll()},a.prototype.handleScroll=function(){var e={},t={horizontal:{newScroll:this.adapter.scrollLeft(),oldScroll:this.oldScroll.x,forward:"right",backward:"left"},vertical:{newScroll:this.adapter.scrollTop(),oldScroll:this.oldScroll.y,forward:"down",backward:"up"}};for(var i in t){var s=t[i],n=s.newScroll>s.oldScroll?s.forward:s.backward;for(var a in this.waypoints[i]){var r=this.waypoints[i][a],o=s.oldScroll<r.triggerPoint,l=s.newScroll>=r.triggerPoint;(o&&l||!o&&!l)&&(r.queueTrigger(n),e[r.group.id]=r.group)}}for(var d in e)e[d].flushTriggers();this.oldScroll={x:t.horizontal.newScroll,y:t.vertical.newScroll}},a.prototype.innerHeight=function(){return this.element==this.element.window?s.viewportHeight():this.adapter.innerHeight()},a.prototype.remove=function(e){delete this.waypoints[e.axis][e.key],this.checkEmpty()},a.prototype.innerWidth=function(){return this.element==this.element.window?s.viewportWidth():this.adapter.innerWidth()},a.prototype.destroy=function(){var e=[];for(var t in this.waypoints)for(var i in this.waypoints[t])e.push(this.waypoints[t][i]);for(var s=0,n=e.length;s<n;s++)e[s].destroy()},a.prototype.refresh=function(){var e,t=this.element==this.element.window,i=this.adapter.offset(),s={};for(var n in this.handleScroll(),e={horizontal:{contextOffset:t?0:i.left,contextScroll:t?0:this.oldScroll.x,contextDimension:this.innerWidth(),oldScroll:this.oldScroll.x,forward:"right",backward:"left",offsetProp:"left"},vertical:{contextOffset:t?0:i.top,contextScroll:t?0:this.oldScroll.y,contextDimension:this.innerHeight(),oldScroll:this.oldScroll.y,forward:"down",backward:"up",offsetProp:"top"}}){var a=e[n];for(var r in this.waypoints[n]){var o,l,d,u,c=this.waypoints[n][r],h=c.options.offset,p=c.triggerPoint,g=0,f=null==p;c.element!==c.element.window&&(g=c.adapter.offset()[a.offsetProp]),"function"==typeof h?h=h.apply(c):"string"==typeof h&&(h=parseFloat(h),c.options.offset.indexOf("%")>-1&&(h=Math.ceil(a.contextDimension*h/100))),o=a.contextScroll-a.contextOffset,c.triggerPoint=g+o-h,l=p<a.oldScroll,d=c.triggerPoint>=a.oldScroll,u=!l&&!d,!f&&(l&&d)?(c.queueTrigger(a.backward),s[c.group.id]=c.group):!f&&u?(c.queueTrigger(a.forward),s[c.group.id]=c.group):f&&a.oldScroll>=c.triggerPoint&&(c.queueTrigger(a.forward),s[c.group.id]=c.group)}}for(var v in s)s[v].flushTriggers();return this},a.findOrCreateByElement=function(e){return a.findByElement(e)||new a(e)},a.refreshAll=function(){for(var e in i)i[e].refresh()},a.findByElement=function(e){return i[e.waypointContextKey]},window.onload=function(){n&&n(),a.refreshAll()},s.requestAnimationFrame=function(t){(window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||e).call(window,t)},s.Context=a}(),function(){"use strict";function e(e,t){return e.triggerPoint-t.triggerPoint}function t(e,t){return t.triggerPoint-e.triggerPoint}var i={vertical:{},horizontal:{}},s=window.Waypoint;function n(e){this.name=e.name,this.axis=e.axis,this.id=this.name+"-"+this.axis,this.waypoints=[],this.clearTriggerQueues(),i[this.axis][this.name]=this}n.prototype.add=function(e){this.waypoints.push(e)},n.prototype.clearTriggerQueues=function(){this.triggerQueues={up:[],down:[],left:[],right:[]}},n.prototype.flushTriggers=function(){for(var i in this.triggerQueues){var s=this.triggerQueues[i],n="up"===i||"left"===i;s.sort(n?t:e);for(var a=0,r=s.length;a<r;a+=1){var o=s[a];(o.options.continuous||a===s.length-1)&&o.trigger([i])}}this.clearTriggerQueues()},n.prototype.next=function(t){this.waypoints.sort(e);var i=s.Adapter.inArray(t,this.waypoints);return i===this.waypoints.length-1?null:this.waypoints[i+1]},n.prototype.previous=function(t){this.waypoints.sort(e);var i=s.Adapter.inArray(t,this.waypoints);return i?this.waypoints[i-1]:null},n.prototype.queueTrigger=function(e,t){this.triggerQueues[t].push(e)},n.prototype.remove=function(e){var t=s.Adapter.inArray(e,this.waypoints);t>-1&&this.waypoints.splice(t,1)},n.prototype.first=function(){return this.waypoints[0]},n.prototype.last=function(){return this.waypoints[this.waypoints.length-1]},n.findOrCreate=function(e){return i[e.axis][e.name]||new n(e)},s.Group=n}(),function(){"use strict";var e=window.jQuery,t=window.Waypoint;function i(t){this.$element=e(t)}e.each(["innerHeight","innerWidth","off","offset","on","outerHeight","outerWidth","scrollLeft","scrollTop"],function(e,t){i.prototype[t]=function(){var e=Array.prototype.slice.call(arguments);return this.$element[t].apply(this.$element,e)}}),e.each(["extend","inArray","isEmptyObject"],function(t,s){i[s]=e[s]}),t.adapters.push({name:"jquery",Adapter:i}),t.Adapter=i}(),function(){"use strict";var e=window.Waypoint;function t(t){return function(){var i=[],s=arguments[0];return t.isFunction(arguments[0])&&((s=t.extend({},arguments[1])).handler=arguments[0]),this.each(function(){var n=t.extend({},s,{element:this});"string"==typeof n.context&&(n.context=t(this).closest(n.context)[0]),i.push(new e(n))}),i}}window.jQuery&&(window.jQuery.fn.waypoint=t(window.jQuery)),window.Zepto&&(window.Zepto.fn.waypoint=t(window.Zepto))}(),define("libs/waypoints/jquery.waypoints-3.1.1",function(){}),define("managers/waypoints",["jquery","version!fly/managers/debug","version!libs/waypoints/jquery.waypoints","version!fly/libs/jquery.throttle-debounce"],function(e,t){t=t.init("waypoints");var i=!1;return{init:function(){i||(i=!0,e(window).on("scroll",e.throttle(500,function(){Waypoint.refreshAll()})))}}}),define("libs/waypoints/inview-3.1.1",["version!libs/waypoints/jquery.waypoints"],function(){"use strict";function e(){}var t=window.Waypoint;function i(e){this.options=t.Adapter.extend({},i.defaults,e),this.axis=this.options.horizontal?"horizontal":"vertical",this.waypoints=[],this.createWaypoints()}i.prototype.createWaypoints=function(){for(var e={vertical:[{down:"enter",up:"exited",offset:"100%"},{down:"entered",up:"exit",offset:"bottom-in-view"},{down:"exit",up:"entered",offset:-1},{down:"exited",up:"enter",offset:function(){return-this.adapter.outerHeight()}}],horizontal:[{right:"enter",left:"exited",offset:"100%"},{right:"entered",left:"exit",offset:"right-in-view"},{right:"exit",left:"entered",offset:0},{right:"exited",left:"enter",offset:function(){return-this.adapter.outerWidth()}}]},t=0,i=e[this.axis].length;t<i;t++){var s=e[this.axis][t];this.createWaypoint(s)}},i.prototype.createWaypoint=function(e){var i=this;this.waypoints.push(new t({element:this.options.element,handler:function(e){return function(t){i.options[e[t]].call(this,t)}}(e),offset:e.offset,horizontal:this.options.horizontal}))},i.prototype.destroy=function(){for(var e=0,t=this.waypoints.length;e<t;e++)this.waypoints[e].destroy();this.waypoints=[]},i.defaults={enter:e,entered:e,exit:e,exited:e},t.Inview=i}),define("components/toc-nav",["jquery","version!fly/managers/debug","managers/page-vars","managers/tealium","managers/waypoints","version!libs/jquery/mobile","version!libs/waypoints/inview"],function(e,t,i,s,n){var a=t.init("tocNav");n.init(),e.widget("cnet.tocNav",e.fly.base,{options:{applyClassOnHover:!0,closeOnSelect:!0,isIntegratedWithHeader:!0,isExpandableOnHover:!0,isExpandableOnSwipe:!1,isExpandableOnClick:!0,isVisibleOnLoad:!1,stopTouchPropagation:!1,adjustHeight:!1},$header:null,$body:null,_create:function(){a.log("Initializing"),this._setup(),this.$body=e("body"),this.$header=e("#rbHeader .fixation, #cesHeaderWrap.fixation, .headerContainer, #specialHeader .fixation"),this._setupEvents(),this.options.isVisibleOnLoad||this.options.isIntegratedWithHeader&&(e("img[data-original]").each(function(t,i){i.src=e(i).data("original")}),this.$header.hasClass("fixed"))},_setupEvents:function(){var t=this;this.options.isIntegratedWithHeader&&(this.$header.on("stickyElementStuck",function(){}),this.$header.on("stickyElementUnstuck",function(){t.$body.removeClass("tocNavOpen"),t.$body.removeClass("tocNavVisible")})),this.options.isExpandableOnHover&&this.$element.hover(function(){t._trackCustomEvent("expandToc","expandToc"),t.$header.hasClass("fixed")||!t.options.isIntegratedWithHeader?(t.options.applyClassOnHover&&t.$body.addClass("tocNavOpen"),t._trigger("open")):(t.options.applyClassOnHover&&t.$body.removeClass("tocNavOpen"),t._trigger("closed"))},function(){t.options.applyClassOnHover&&t.$body.removeClass("tocNavOpen"),t._trigger("closed")}),this.options.isExpandableOnSwipe&&(this.$element.on("swiperight",function(){t.$body.addClass("tocNavOpen"),t._trigger("open"),t._trackCustomEvent("expandToc","expandToc")}),this.$element.on("swipeleft",function(){t.$body.removeClass("tocNavOpen"),t._trigger("closed")})),this.options.isExpandableOnClick&&e(".expand",this.$element).click(function(){t.$body.hasClass("tocNavOpen")?(t.$body.removeClass("tocNavOpen"),t._trigger("closed")):(t.$body.addClass("tocNavOpen"),t._trigger("open")),t._trackCustomEvent("expandToc","expandToc"),t.$body.on("click.tocNav",function(i){0===e(i.target).closest(t.$element).length&&(t.$body.removeClass("tocNavOpen"),t._trigger("closed"),t.$body.off("click.tocNav"))})}),e("[data-toc-asset-options]",this.$element).click(function(i){i.preventDefault();var s=e(this);if(s.parent().hasClass("selected"))a.log("Element already selected; ignoring click.");else{var n=s.data("toc-asset-options").id;a.log("Firing event to request asset "+n),t.$element.trigger("tocNavRequest",{assetId:n})}t.options.closeOnSelect&&(t.$body.removeClass("tocNavOpen"),t._trigger("closed"))}),this.$element.on("tocNavSelection",function(i,s){a.log("Updating selected asset to #"+s.index),e("li.selected",t.$element).removeClass("selected");var n=e(e("[data-toc-asset-options]",t.$element)[s.index]).parent("li");n.addClass("selected");var r=n.parent("ul"),o=r.scrollTop()+n.position().top;r.animate({scrollTop:o},500)}),this.options.stopTouchPropagation&&this.$element.on("touchmove",function(e){e.stopPropagation()}),this.options.adjustHeight&&new Waypoint.Inview({element:e("#rbFooter")[0],enter:function(i){t.$element.height(e(window).height()-85),window.setTimeout(function(){t.$element.find("ul").first().scrollTop(t.$element.find(".selected").position().top)},500)},exited:function(e){t.$element.height("100%")}})},_trackCustomEvent:function(e,t){a.log("Track custom event: "+e);var n=i.tracking.data;s.trackCustomEvent(e,{articleTitle:n.articleTitle,articleType:n.articleType,articleId:n.articleId,_authorPrimaryName:n._authorPrimaryName,_pageType:n.pageType,brand:n.brand,pageNum:n.pageNum,_test:n._test,siteEdition:n._siteEdition,siteSection:n._siteSection,_siteTypeDevice:n._siteTypeDevice,_siteHier:n._siteHier,_pageViewGuid:n._pageViewGuid,browserTitle:document.title,topicId:n.topicId,collectionId:n.collectionId?n.collectionId:"",articleAuthorName:n.articleAuthorName,articleAuthorGuid:n.articleAuthorId,clickGenericText:t},"trackClick")}})}),define("fly/components/dropdown-1.0",["jquery","version!fly/components/base"],function(e){var t="ontouchstart"in window||"onmsgesturechange"in window,i=e.mobile?"vclick":"click";e.widget("fly.dropdown",e.fly.base,{options:{classSelected:"selected",event:"click",selectorTrigger:'[data-item="trigger"]'},$element:null,$trigger:null,enterTimeout:null,leaveTimeout:null,_create:function(){var e=this.options,s={};this._setup(),t&&(e.event="click"),this.$element=this.$element,this.$trigger=this.$element.find(e.selectorTrigger).first(),"click"===e.event?(s[i]="_handleClick",this._on(this.$trigger,s)):"hover"===e.event&&this._on(this.$element,{mouseenter:"_handleMouseEnter",mouseleave:"_handleMouseLeave"})},_handleClick:function(e){e.preventDefault(),this.toggle()},_handleMouseEnter:function(e){var t=this;clearTimeout(this.leaveTimeout),this.enterTimeout=setTimeout(function(){t.show()},50)},_handleMouseLeave:function(e){var t=this;clearTimeout(this.enterTimeout),this.leaveTimeout=setTimeout(function(){t.hide()},150)},_handleDocClick:function(t){var i=e(t.target);0===this.$element.has(i).length&&e.contains(document.documentElement,i[0])&&this.hide()},show:function(){var e=this,t=this.options,s={};this.$element.addClass(t.classSelected),setTimeout(function(){s[i]="_handleDocClick",e._on(e.$document,s)},1),this._trigger("shown",null,{$element:this.$element,$trigger:this.$trigger})},hide:function(){var e=this.options;this.$element.removeClass(e.classSelected),this._off(this.$document,i),this._trigger("hidden",null,{$element:this.$element,$trigger:this.$trigger})},toggle:function(){var e=this.options;this[this.$element.hasClass(e.classSelected)?"hide":"show"]()}})}),define("components/dropdown",["jquery","version!fly/managers/debug","managers/tealium","managers/page-vars","version!fly/components/dropdown"],function(e,t,i,s){(t=t.init("dropdown")).log("dropdown"),e.widget("cnet.dropdown",e.fly.dropdown,{options:{trackingOptions:{trackDropdown:!1,dropdownIndex:null,trackNameShow:"show",trackNameHide:"hide",ariaExpand:'[data-item="ariaDropdown"]'},disableClose:!1,disableCloseOutsideElement:null},$ariaExpand:null,_create:function(){t.log("create");var e=this.options,i={};this._setup(),("ontouchstart"in window||"onmsgesturechange"in window)&&(e.event="click"),this.$trigger=this.$element.find(e.selectorTrigger).first(),this.$ariaExpand=this.$element.find(e.ariaExpand).first(),"click"===e.event?(i.tap="_handleClick",t.log("this.$trigger",this.$trigger,i),this._on(this.$trigger,i)):"hover"===e.event&&this._on(this.$element,{mouseenter:"_handleMouseEnter",mouseleave:"_handleMouseLeave"})},_handleDocClick:function(i){var s=e(i.target);t.log("handleDocClick",s,this.$element,this),t.log("disabledCloseOutsideElement",e(this.options.disableCloseOutsideElement)),this.options.disableCloseOutsideElement?1===e(this.options.disableCloseOutsideElement).has(s).length&&(t.log("Click inside target element"),this.hide()):0===this.$element.has(s).length&&e.contains(document.documentElement,s[0])&&!this.options.disableClose&&(t.log("Click inside DOM"),this.hide())},show:function(){t.log("show",this.$element);var e=this,i=this.options,s={};this.$element.addClass(i.classSelected),setTimeout(function(){s.tap="_handleDocClick",e._on(e.$document,s)},1),this._trigger("shown",null,{$element:this.$element,$trigger:this.$trigger}),this.toggleAriaState(!0),i.trackingOptions.trackDropdown&&this._trackToggle("show")},hide:function(){t.log("hide:");var e=this.options;this.$element.removeClass(e.classSelected),this._off(this.$document,"tap"),this._trigger("hidden",null,{$element:this.$element,$trigger:this.$trigger}),this.toggleAriaState(!1),e.trackingOptions.trackDropdown&&this._trackToggle("hide")},toggleAriaState:function(e){t.log("toggleAS"),this.$trigger.attr("aria-expanded",e),this.$ariaExpand.attr("aria-hidden",!e)},_trackToggle:function(e){t.log("trackToggle");var n="",a=this.options;n="show"==e?a.trackingOptions.trackNameShow:a.trackingOptions.trackNameHide,a.trackingOptions.dropdownIndex&&(n+="."+a.trackingOptions.dropdownIndex),t.log("Track dropdown event: "+n),trackingData=s.tracking.data,i.trackCustomEvent("dropdownEvent",{siteEdition:trackingData.siteEdition,siteHier:trackingData.siteHier,pageType:trackingData.pageType,articleTitle:trackingData.articleTitle,articleType:trackingData.articleType,topicId:trackingData.topicId,pageViewGuid:trackingData.pageViewGuid,collectionId:trackingData.collectionId,_dwAnonId:trackingData._dwAnonId,clickGenericText:n},"trackClick")}})}),define("components/toggle",["jquery","version!fly/managers/debug","components/dropdown"],function(e,t){t=t.init("toggle"),e.widget("cnet.toggle",e.cnet.dropdown,{options:{closeOnUrlChange:!1,openOnInit:!1,scrollToToggle:!1},_create:function(){var e=this;this._super(),this.options.closeOnUrlChange&&this.$window.on("urlChanged",function(){e.hide()}),this.options.openOnInit&&this.show()},show:function(){this.$element.addClass(this.options.classSelected),this._trigger("shown",null,{$element:this.$element,$trigger:this.$trigger}),this.options.trackingOptions.trackDropdown&&this._trackToggle("show")},hide:function(){this._super(),this.options.scrollToToggle&&e("html, body").animate({scrollTop:this.$element.offset().top},1e3)}})}),define("components/touch-menu-hover",["jquery","version!fly/managers/debug","managers/device","managers/page-vars","version!fly/components/base"],function(e,t,i,s){t=t.init("touchMenuHover"),e.widget("cnet.touchMenuHover",e.fly.base,{options:{hoverClass:"hover",moreButton:"moreButton",header:!1},_create:function(){(this._setup(),"mobile"!=s.tracking.data.deviceType)&&(!!navigator.userAgent.match(/(iPad|iPhone|iPod)/g)&&e(".social-login").css("display","none"));Modernizr.touch&&this._setupEvents()},_setupEvents:function(){var s=this,n=s.$element,a=e('[data-trigger="menu"]',n);0===a.length&&(a=n),a.on(i.getImmediateClickType(),function(a){e(":cnet-touchMenuHover").not(n).removeClass(s.options.hoverClass),s.options.header&&(e("#rbHeader").removeClass("passthru intentionalHover"),e("#rbHeader").addClass("fadeOut")),n.hasClass(s.options.hoverClass)?n.hasClass(s.options.moreButton)?(t.log("Link click on active more share menu : leaving hover class"),e(document).on(i.getImmediateClickType(),null,{self:s},s._handleClickOutsideMenu)):(n.removeClass(s.options.hoverClass),t.log("Link click on active : removing hover class"),s.options.header&&(e("#rbHeader").removeClass("passthru intentionalHover"),e("#rbHeader").addClass("fadeOut")),e(document).off(i.getImmediateClickType(),null,s._handleClickOutsideMenu)):(a.preventDefault(),n.addClass(s.options.hoverClass),s.options.header&&(e("#rbHeader").removeClass("fadeOut"),e("#rbHeader").addClass("passthru intentionalHover")),t.log("Link click on non-active : preventing link and adding hover class"),e(document).on(i.getImmediateClickType(),null,{self:s},s._handleClickOutsideMenu))})},_handleClickOutsideMenu:function(s){var n=s.data.self;0===e(s.target).parents(":cnet-touchMenuHover").length&&(t.log("Body click : removing hover class"),n.$element.removeClass(n.options.hoverClass),n.options.header&&(e("#rbHeader").removeClass("passthru intentionalHover"),e("#rbHeader").addClass("fadeOut")),e(document).off(i.getImmediateClickType(),null,n._handleClickOutsideMenu))}})}),define("components/sticky-element",["jquery","version!fly/managers/debug","managers/waypoints","version!fly/components/base","version!libs/waypoints/inview"],function(e,t,i){t=t.init("stickyElement"),i.init(),e.widget("cnet.stickyElement",e.fly.base,{options:{classFixed:"fixed",classHidden:"hidden",classPlaceholder:"sticky-element-placeholder",offset:0,placeholderElement:"",primaryEdge:"top",selectorElementHide:"",selectorPageBottom:"",hideDirection:"top",unstickAtPageBottom:!1},$placeholder:null,$placeholderLocation:null,waypoint:null,endWaypoint:null,_create:function(){this._setup(),this._setupPlaceholder(),this._setupEvents()},_setupPlaceholder:function(){this.$placeholder=e('<div class="'+this.options.classPlaceholder+" "+this.options.classHidden+'"></div>'),this.$placeholder.height(this.$element.outerHeight(!0)),this.$placeholderLocation=this.options.placeholderElement?e(this.options.placeholderElement):this.$element,"top"===this.options.primaryEdge?this.$placeholderLocation.before(this.$placeholder):"bottom"===this.options.primaryEdge&&this.$placeholderLocation.after(this.$placeholder)},_setupEvents:function(){var t=this;t.pauseFlag=!1,0===this.options.offset||t.options.selectorElementHide?this.waypoint=new Waypoint.Inview({element:this.$placeholder[0],entered:function(e){"top"===t.options.primaryEdge&&"up"===e?t._unstick(e):"bottom"===t.options.primaryEdge&&"down"===e&&(t._stick(e),t.pauseFlag=!0)},exit:function(e){"top"===t.options.primaryEdge&&"down"===e?t._stick(e):"bottom"===t.options.primaryEdge&&"up"===e&&t._unstick(e)}}):t.options.selectorElementHide||(this.waypoint=new Waypoint({element:this.$placeholder[0],handler:function(e){"top"===t.options.primaryEdge&&"up"===e||"bottom"===t.options.primaryEdge&&"down"===e?t._unstick():t._stick()},offset:this.options.offset})),t.options.selectorElementHide&&(this.endWaypoint=new Waypoint({element:t.$element.closest(t.options.selectorElementHide),handler:function(e){"top"==t.options.hideDirection?1==t.pauseFlag&&"down"==e?t._unstick(e):t._stick(e):1==t.pauseFlag&&"down"==e?t._stick(e):t._unstick(e)},offset:0==t.options.offset?"bottom-in-view":t.options.offset})),t.options.selectorPageBottom&&(this.endWaypoint=new Waypoint.Inview({element:e(t.options.selectorPageBottom),entered:function(e){"top"===t.options.primaryEdge&&"down"===e&&t._unstick()},exit:function(e){"top"===t.options.primaryEdge&&"up"===e&&t._stick()}})),t.options.unstickAtPageBottom&&(this.endWaypoint=new Waypoint({element:t.$element.parents("[data-page-options]").find(".pageBottom"),handler:function(e){"down"==e?t._unstick():"up"==e&&t._stick()},offset:e(".shortLeader").length?76:100}))},_stick:function(e){this.$placeholder.removeClass(this.options.classHidden),this.$element.addClass(this.options.classFixed),this.$element.trigger("stickyElementStuck"),"up"==e?(this.$element.removeClass("down"),this.$element.addClass("up")):"down"==e&&(this.$element.removeClass("up"),this.$element.addClass("down"))},_unstick:function(e){this.$placeholder.addClass(this.options.classHidden),this.$element.removeClass(this.options.classFixed),this.$element.trigger("stickyElementUnstuck"),"up"==e?(this.$element.removeClass("down"),this.$element.addClass("up")):"down"==e&&(this.$element.removeClass("up"),this.$element.addClass("down"))}})}),define("components/form-trim",["jquery","version!fly/managers/debug","version!fly/components/base"],function(e,t){t=t.init("formTrim"),e.widget("cnet.formTrim",e.fly.base,{options:{},_create:function(){var t=this;t._setup(),t.$element.on("submit",e.proxy(function(i){e("input[type=text]",t.$element).each(function(){e(this).val(e(this).val().replace(/\s+/g," ").trim())})},this))}})}),function(e,t,i,s){var n=e(t);e.fn.lazyload=function(i){var s,a=this,r={threshold:0,failure_limit:0,event:"scroll.lazyload",effect:"show",container:t,data_attribute:"original",data_srcset:"srcset",skip_invisible:!1,appear:null,load:null,placeholder:"data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=",overrideEvent:!1};function o(){var t=0;a.each(function(){var i=e(this);if(!r.skip_invisible||i.is(":visible"))if(e.abovethetop(this,r)||e.leftofbegin(this,r));else if(e.belowthefold(this,r)||e.rightoffold(this,r)){if(++t>r.failure_limit)return!1}else i.trigger("appear"),t=0})}return i&&(void 0!==i.failurelimit&&(i.failure_limit=i.failurelimit,delete i.failurelimit),void 0!==i.effectspeed&&(i.effect_speed=i.effectspeed,delete i.effectspeed),e.extend(r,i)),s=void 0===r.container||r.container===t?n:e(r.container),0===r.event.indexOf("scroll")&&(r.overrideEvent&&s.off(r.event),s.on(r.event,function(){return o()})),this.each(function(){var t=this,i=e(t);t.loaded=!1,void 0!==i.attr("src")&&!1!==i.attr("src")||i.is("img")&&i.attr("src",r.placeholder),i.one("appear",function(){if(!this.loaded){if(r.appear){var s=a.length;r.appear.call(t,s,r)}e("<img />").one("load",function(){var s=i.attr("data-"+r.data_attribute),n=i.attr("data-"+r.data_srcset);s!==i.attr("src")&&(i.hide(),i.is("img")?(i.attr("src",s),null!==n&&i.attr("srcset",n)):i.is("video")?i.attr("poster",s):i.css("background-image","url('"+s+"')"),i[r.effect](r.effect_speed)),t.loaded=!0;var o=e.grep(a,function(e){return!e.loaded});if(a=e(o),r.load){var l=a.length;r.load.call(t,l,r)}}).bind("error",function(){e(t).trigger("error")}).attr({src:i.attr("data-"+r.data_attribute),srcset:i.attr("data-"+r.data_srcset)||""})}}),0!==r.event.indexOf("scroll")&&i.off(r.event).on(r.event,function(){t.loaded||i.trigger("appear")})}),n.off("resize.lazyload").bind("resize.lazyload",function(){o()}),/(?:iphone|ipod|ipad).*os 5/gi.test(navigator.appVersion)&&n.on("pageshow",function(t){t.originalEvent&&t.originalEvent.persisted&&a.each(function(){e(this).trigger("appear")})}),e(function(){o()}),this},e.belowthefold=function(i,s){return(void 0===s.container||s.container===t?(t.innerHeight?t.innerHeight:n.height())+n.scrollTop():e(s.container).offset().top+e(s.container).height())<=e(i).offset().top-s.threshold},e.rightoffold=function(i,s){return(void 0===s.container||s.container===t?n.width()+n.scrollLeft():e(s.container).offset().left+e(s.container).width())<=e(i).offset().left-s.threshold},e.abovethetop=function(i,s){return(void 0===s.container||s.container===t?n.scrollTop():e(s.container).offset().top)>=e(i).offset().top+s.threshold+e(i).height()},e.leftofbegin=function(i,s){return(void 0===s.container||s.container===t?n.scrollLeft():e(s.container).offset().left)>=e(i).offset().left+s.threshold+e(i).width()},e.inviewport=function(t,i){return!(e.rightoffold(t,i)||e.leftofbegin(t,i)||e.belowthefold(t,i)||e.abovethetop(t,i))},e.extend(e.expr[":"],{"below-the-fold":function(t){return e.belowthefold(t,{threshold:0})},"above-the-top":function(t){return!e.belowthefold(t,{threshold:0})},"right-of-screen":function(t){return e.rightoffold(t,{threshold:0})},"left-of-screen":function(t){return!e.rightoffold(t,{threshold:0})},"in-viewport":function(t){return e.inviewport(t,{threshold:0})},"above-the-fold":function(t){return!e.belowthefold(t,{threshold:0})},"right-of-fold":function(t){return e.rightoffold(t,{threshold:0})},"left-of-fold":function(t){return!e.rightoffold(t,{threshold:0})}})}(jQuery,window,document),define("libs/jquery/lazyload-1.10.0.custom",function(){}),define("components/lazyload-images",["jquery","version!fly/components/base","version!libs/jquery/lazyload"],function(e){e.widget("cnet.lazyloadImages",e.fly.base,{options:{threshold:200,skip_invisible:!1},_create:function(){this._super(),this._setupEvents(),this._lazyLoadImages()},_setupEvents:function(){this._on(this.$element,{ajaxStop:this._lazyLoadImages})},_lazyLoadImages:function(){window.HTMLImageElement&&"loading"in window.HTMLImageElement.prototype?this.$element.find("img.lazy").each(function(t){var i=e(this);i.attr("src",i.attr("data-original")),i.attr("srcset",i.attr("data-srcset")),i.attr("sizes",i.attr("data-sizes")),i.attr("data-original",null),i.attr("data-srcset",null),i.attr("data-sizes",null),i.attr("loading","lazy"),i.removeClass("lazy")}):this.$element.find("img.lazy").lazyload(this.options).removeClass("lazy")}})}),define("components/modal-enlarge-image",["jquery","managers/page-vars","managers/tealium","version!fly/components/base","components/global-modal"],function(e,t,i){e.widget("cnet.modalEnlargeImage",e.cnet.globalModal,{options:{},_create:function(){this._super();var s=this.$element.data().target;this._on(e(s),{modalopened:function(t){e("body").addClass("modalImage")},modalclosed:function(t){e("body").removeClass("modalImage")}}),this.$element.on("click",function(){var e=t.tracking.data;i.trackCustomEvent("trackClickToEnlarge",{_articleTitle:e.articleTitle,articleTitle:e.articleTitle,_articleId:e.articleId,articleId:e.articleId,_authorPrimaryName:e._authorPrimaryName,articleType:e.articleType,_articleType:e.articleType,_pageType:e.pageType,siteSection:e.siteSection,_test:e._test,_topicPrimaryId:e.topicId.toString(),siteEdition:e._siteEdition,_siteTypeDevice:e._siteTypeDevice,_siteHier:e._siteHier,pageViewGuid:e._pageViewGuid,_pageViewGuid:e._pageViewGuid,_dwAnonId:e._dwAnonId,dwAnonId:e._dwAnonId,_collectionPrimaryId:e._collectionPrimaryId,viewguid:e.pageViewGuid,clickGenericText:"click-to-enlarge"},"trackClick")})}})}),define("components/article",["jquery","version!fly/managers/debug","managers/client-storage","managers/page-vars","version!fly/utils/url-helper","version!fly/components/base"],function(e,t,i,s,n){t=t.init("article");e.widget("cnet.article",e.fly.base,{options:{autoplayVideo:!1},data:null,_create:function(){this._setup(),this._autoplayVideo()},_autoplayVideo:function(){if(t.info("Autoplay video",i.read("autoplayEnabled"),this.options.autoplayVideo),"off"!=i.read("autoplayEnabled")&&!1!==this.options.autoplayVideo&&"off"!==n.getParam("autoplayEnabled")){var s=e('.video.shortcode .videoPlayer[data-component^="cnetVideo"], #featuredVideo .videoPlayer[data-component^="cnetVideo"]').first(),a=s.find(".videoPromo");if(t.log("Autoplay video",s,a),s.length>0)try{t.log("Check popout"),this._isInViewport(s)?t.log("no popout"):(s.parent().addClass("popOut"),t.log("do popout",s)),s.cnetVideo("inited")&&(a.trigger("click",{autoplay:!0}),t.log("Click triggered",a))}catch(e){t.warn("Video not ready",e),s.on("onVideoPlayerReady",function(e){t.log("Video ready. Trigger click",e),a.trigger("click",{autoplay:!0})})}else t.info("No video to autoplay");t.log("/Autoplay")}},_isInViewport:function(t){t=e(t);var i=this.$window.scrollTop(),s=i+this.$window.height(),n=t.offset().top,a=n+t.outerHeight();return n<s&&a>i}})}),define("fly/managers/history-2.0",["jquery","version!fly/utils/string-vars"],function(e,t){"use strict";var i=window.history,s=e(window),n=0,a="pushState"in i&&"replaceState"in i&&!(window.navigator.userAgent.indexOf("Firefox")>=0&&window.top!==window),r=function(e,t){e=e||{},n+=1,this.id="history-"+n,this.title=e.title,this.route=e.route,this.originalTitle=document.title,t&&this.navigate(t,{replace:!0})};return r.prototype={constructor:r,navigate:function(s,n){if(!a)return!1;e.extend(!0,s,{historyId:this.id});var r=(n=n||{}).title||this.title,o=n.url||this.route;r=t.compile(e.isFunction(r)?r(s):r,e.extend({title:this.originalTitle},s)),o=t.compile(e.isFunction(o)?o(s):o,s),i[n.replace?"replaceState":"pushState"](s,r,o),r&&(document.title=r)},stateChange:function(t){if(!a)return!1;var n=this;s.on("popstate."+this.id,function(){var s=i.state||{};s.historyId===n.id&&e.isFunction(t)&&t(s)})},stop:function(){if(!a)return!1;s.off("popstate."+this.id)}},{init:function(e,t){return new r(e,t)}}}),define("managers/trackonomics",["jquery","version!fly/managers/debug"],function(e,t){var i=t.get("trackonomics");return{refreshTrackonomics:function(){try{if("object"==typeof window.trx){i.log("reload trackonomics");var e=window.trx;e.magicLinksEngine=new e.MagicLinks(!1),e.magicLinksEngine.run(!0)}}catch(e){i.log("trackonomics error: "+e)}}}}),define("components/page",["jquery","version!fly/managers/debug","version!fly/managers/components","version!fly/managers/history","managers/waypoints","managers/tracking","managers/tealium","managers/trackonomics","managers/ad","managers/guid","managers/page-vars","version!fly/utils/url-helper","version!fly/utils/string-helper","version!fly/components/base","version!libs/waypoints/inview"],function(e,t,i,s,n,a,r,o,l,d,u,c,h){t=t.init("page"),n.init();var p=!1;e.widget("cnet.page",e.fly.base,{options:{ajaxOffset:0,ajaxUrl:null,allowAds:!1,amlTrackingCallback:null,browserTitle:null,browserUrl:null,chartbeatTracking:!0,classCurrent:"current",cmsUrl:null,dwPostPend:"",dwTagOverride:null,hasSubPages:!1,initialPage:!1,limit:-1,loadParentAd:!1,manuallyRefreshClearedAds:!0,manuallyRefreshUnclearedAds:!0,onlyViewPageOnce:!0,preserveQueryString:!0,redirectUrl:null,refreshViewGuid:!0,replaceState:!1,resetAdPosition:!1,trackingEventData:null,trackingPageLoadData:null,trackPageviewUp:!1,trackPageChange:!1,unloadAdsOutOfView:!1,trackScroll25:!1,trackScroll50:!1,trackScroll75:!1,trackScroll100:!1},$parentPage:null,adData:null,adInterval:null,adsCleared:!1,adsInitialized:!0,ajaxWaypoint:null,destructorWaypoints:null,inviewWaypoints:null,inviewWaypointTriggered:!1,loaded:!1,scrollPercentageWaypoints:null,trackingData:null,viewed:!1,_create:function(){this._setup(),this._initHistoryManager(),this.options.chartbeatTracking||(u.services.chartbeat_tracking.enabled=!1),this.viewed=this.options.initialPage,this.loaded=!this.options.ajaxUrl,this.$parentPage=this.$element.parents("[data-page-options]"),this.$parentPage.length>0&&this.$parentPage.data("page")&&!this.$parentPage.data("page").adsInitialized&&(this.adsInitialized=!1),this.adData=u.ads.data,this.trackingData=u.tracking.data,this._initWaypoints(),u.services.vertical_galleries&&u.services.vertical_galleries.enabled&&window.location.pathname===this.options.browserUrl&&this.options.trackingPageLoadData&&this.options.trackingPageLoadData.pageNum&&e("html, body").scrollTop(e("[data-slide-num='"+this.options.trackingPageLoadData.pageNum+"']").offset().top-20)},_initHistoryManager:function(){window.history.scrollRestoration="manual",this.history=s.init(),this.history.stateChange(function(t){if(t.id){var i=e("#"+t.id);i.length>0&&(p=!0,e("html, body").animate({scrollTop:i.offset().top},250,function(){p=!1}))}})},_initWaypoints:function(){var e=this;if(this.options.redirectUrl?this.ajaxWaypoint=new Waypoint({element:this.$element[0],handler:function(t){e._redirect()},offset:this.options.ajaxOffset}):this.options.ajaxUrl&&(this.ajaxWaypoint=new Waypoint({element:this.$element[0],handler:function(t){e._ajaxContent(),this.destroy()},offset:this.options.ajaxOffset})),this.inviewWaypoints=[],this.inviewWaypoints.push(new Waypoint({enabled:!this.loaded||this.$parentPage.length>0,element:this.$element[0],handler:function(t){"down"===t&&(e.inviewWaypointTriggered=!0,e.loaded&&e._viewPage(t))},offset:function(){var t=.5*window.innerHeight;return e.$parentPage.length>0&&(t=window.innerHeight),t}})),this.inviewWaypoints.push(new Waypoint({enabled:!this.loaded||this.$parentPage.length>0,element:this.$element[0],handler:function(t){"up"===t&&(e.inviewWaypointTriggered=!0,e.loaded&&e._viewPage(t))},offset:function(){var t=.5*window.innerHeight-this.element.clientHeight;return e.$parentPage.length>0&&(t=-this.element.clientHeight),t}})),this.options.ajaxUrl||this._initTrackingWaypoints(),this.loaded)for(var t=0;t<this.inviewWaypoints.length;t++)this.inviewWaypoints[t].enable();this.options.unloadAdsOutOfView&&(this.destructorWaypoints=[],this.destructorWaypoints.push(new Waypoint({element:this.$element[0],handler:function(t){"down"===t&&e._unloadAds(e.$element)},offset:"-200%"})),this.destructorWaypoints.push(new Waypoint({element:this.$element[0],handler:function(t){"up"===t&&e._unloadAds(e.$element)},offset:"200%"})))},_initTrackingWaypoints:function(){this.scrollPercentageWaypoints=[],this.options.trackScroll25&&this._setupScrollTrackingWayPoint(.25,"scroll25"),this.options.trackScroll50&&this._setupScrollTrackingWayPoint(.5,"scroll50"),this.options.trackScroll75&&this._setupScrollTrackingWayPoint(.75,"scroll75"),this.options.trackScroll100&&this._setupScrollTrackingWayPoint(1,"scroll100")},_setupGalleryWaypoint:function(){var t=e(".stickyColumnElement .ad-mpu-top").parent(),i=e(".ad-leader-top").parent(),s=new Waypoint.Inview({element:e(".image-gallery .ad-incontent-ad-bottom"),enter:function(e){s&&"none"!==s.options.element.css("display")&&(i.addClass("hidden"),t.addClass("hidden"))},exit:function(e){s&&"none"!==s.options.element.css("display")&&(i.addClass("hidden"),t.addClass("hidden"))},exited:function(e){s&&"none"!==s.options.element.css("display")&&(i.removeClass("hidden"),t.removeClass("hidden"))}})},_setupScrollTrackingWayPoint:function(e,t){var i=this;this.scrollPercentageWaypoints.push(new Waypoint({element:this.$element[0],offset:function(){return-this.element.clientHeight*e+window.innerHeight},handler:function(e){"down"===e&&(i._customTrackingCall("percentageScrollTracking",t),this.destroy())}}))},_redirect:function(){var t=this.options.redirectUrl;if(this.options.preserveQueryString){var i=e.extend({},c.getAllParams(),c.getAllParams(this.options.ajaxUrl));t=c.buildUrl("",c.getPath(t),i)}window.location=t},_ajaxContent:function(){var s=this,n=this.options.ajaxUrl;if(this.options.preserveQueryString){var a=e.extend({},c.getAllParams(),c.getAllParams(this.options.ajaxUrl));n=c.buildUrl("",c.getPath(n),a)}t.log("Loading new page: "+n),e.ajax({dataType:"json",url:n}).done(function(n){if(n.template){s.loaded=!0,s.adData=n.adData,s.adsInitialized=!1,s.trackingData=n.trackingData,s.$element.html(n.template),n.featureFlags&&(u.services=n.featureFlags),i.process(s.$element),window.cbsoptanon&&(window.cbsoptanon.onIframesReady(function(){window.cbsoptanon.tags.load("IFRAME")}),window.cbsoptanon.onScriptsReady(function(){window.cbsoptanon.ot.getState(function(t,i,n,a){s.$element.find("[class^=optanon-category-]").each(function(){var s=!1;switch(parseInt(e(this).prop("className").slice(-1))){case 2:s=i;break;case 3:s=n;break;case 4:s=t;break;case 5:s=a}if(s&&("SCRIPT"===e(this).prop("tagName")&&"text/plain"===e(this).attr("type"))){e(this).attr("type","application/javascript");var r=e(this).clone();e(this).html(r)}})})})),s.inviewWaypointTriggered&&s._viewPage("down"),s._initTrackingWaypoints();var a=e("[data-page-options]").filter(function(t,i){return 0===e(i).parent().closest("[data-page-options]").length});if(n.after&&(s.options.limit<0||a.length<s.options.limit)){var r=e(n.after);s.$element.after(r),i.process(r)}}else t.log("No content template found.")})},_viewPage:function(t){var i=this;if(this._updateUrl(),!this.options.onlyViewPageOnce||!this.viewed||this.options.trackPageviewUp&&"up"==t){if(this.viewed=!0,this.options.hasSubPages)this.options.trackingEventData&&this._trackEvent(t);else{if(this._updatePageVars(),(this.options.trackingPageLoadData||this.options.trackPageviewUp)&&this._trackPV(t),this.options.allowAds){var s=this.options.loadParentAd?this.$parentPage:this.$element;this._loadAds(s)}if(u.services.vertical_galleries&&u.services.vertical_galleries.enabled){var n=l.getAdUnits(u.ads.data.gpt.containerId,null,["mpu-top"]);i.adInterval=setInterval(function(){clearInterval(i.adInterval),i.$element.hasClass("current")&&1!==i.$element.data("slide-num")&&l.loadAds(n,this.adData,{})},250)}}this.options.amlTrackingCallback&&e.ajax(this.options.amlTrackingCallback)}this.options.trackPageChange&&this.options.trackingEventData&&this._trackEvent(t)},_loadAds:function(i){var s=!1,n=e.extend({},this.adData);e.extend(n.gpt.targeting,i.data("customAdVars")),this.$parentPage.length>0&&this.$parentPage.data("page")&&this.$parentPage.data("page").adsInitialized&&(this.adsInitialized=!0);var a=u.services.skybox&&u.services.skybox.enabled,r=e(window.document.body).hasClass("skybox-loaded"),d=[];if(a&&r&&(d=l.getAdUnits(null,null,["nav-ad-plus","mobile-nav-ad","mobile-nav-ad-plus","nav-ad-plus-leader"])),!this.adsInitialized){t.log("loading all ads for the current container/page");var c=l.getAdUnits(u.ads.data.gpt.containerId).concat(d);l.loadAds(c,n,{resetIncrementalPosition:this.options.resetAdPosition,excludeDisabled:!0,incrementPageView:!0}),this.adsInitialized=!0,s=!0,this.$parentPage.length>0&&this.$parentPage.data("page")&&(this.$parentPage.data("page").adsInitialized=!0)}if(this.options.manuallyRefreshClearedAds&&this.adsCleared||this.options.manuallyRefreshUnclearedAds&&!this.adsCleared){t.log("refreshing all ads contained within the page",i);c=l.getAdUnits(null,null,null,i.get(0)).concat(d).filter(function(t){var i=e(t),n=u.ads.data.gpt.adConfig.adUnits[h.toCamelCase(i.data("ad"))],a=n.disableInitialLoad||n.delayLoad||!0===i.data("disableInitialLoad");return!0!==s||a});l.loadAds(c,n,{resetIncrementalPosition:this.options.resetAdPosition,incrementPageView:!0!==s}),this.adsCleared=!1}o.refreshTrackonomics()},_unloadAds:function(e){if(this.adsInitialized){t.log("Unloading all ads contained within",e),l.removeAds(l.getAdUnits(null,null,null,e.get(0)),!1),this.adsCleared=!0}},_updatePageVars:function(){this.trackingData?a.resetTrackingData(this.trackingData):this.$parentPage.length>0&&this.$parentPage.data("page")&&this.$parentPage.data("page").trackingData&&(this.trackingData=e.extend(!0,{},u.tracking.data,this.$parentPage.data("page").trackingData),a.resetTrackingData(this.trackingData)),this.adData?u.ads.data=this.adData:this.$parentPage.length>0&&this.$parentPage.data("page")&&this.$parentPage.data("page").adData&&(u.ads.data=this.adData=this.$parentPage.data("page").adData),this.options.refreshViewGuid&&d.resetViewGuid()},_updateUrl:function(){if(this.options.browserUrl&&!p){var t=this.options.browserUrl;if(this.options.preserveQueryString){var i=e.extend({},c.getAllParams(),c.getAllParams(this.options.browserUrl));t=c.buildUrl("",c.getPath(t),i)}this.history.navigate({id:this.$element.attr("id")},{title:this.options.browserTitle||document.title,url:t,replace:this.options.replaceState}),e("[data-page-options]").removeClass(this.options.classCurrent),this.$element.addClass(this.options.classCurrent),this.options.cmsUrl&&e("body").attr("data-cms-edit",'{"url":"'+this.options.cmsUrl+'"}'),this.$window.trigger("urlChanged")}},_trackEvent:function(t){var i=t+"."+(e("[data-page-options]").filter(function(t,i){return 0===e(i).parent().closest("[data-page-options]").length}).index(this.$element)+("up"===t?1:0));this._customTrackingCall("trackPageEvent",i)},_trackPV:function(t){var i=e("[data-page-options]").filter(function(t,i){return 0===e(i).parent().closest("[data-page-options]").length}).index(this.$element)+("up"===t?1:0);"up"==t&&(this.options.trackPageviewUp=!1,i-=1),u.tracking.data.pageNum=i+1;var s="";this.options.dwTagOverride?s=this.options.dwTagOverride:i>=0&&(s=t+"."+i+this.options.dwPostPend);var n=u.tracking.data;r.trackPageLoad(e.extend(!0,{articleId:n.articleId,articleTitle:n.articleTitle,articleType:n.articleType,articleAuthorName:n.articleAuthorName,brand:n.brand,clickGenericText:"",collectionId:n.collectionId,dwLinkTag:s,event:"log",mfr:n.mfr,pageTitle:n.articleTitle,riaevent:"view",siteEdition:n.siteEdition,siteHier:n.siteHier,siteSection:n.siteSection,_pageFindingMethods:"",_pageNumber:n.pageNum,_pageViewGuid:n.pageViewGuid,_siteEdition:n.siteEdition,_topicPrimaryId:n.topicId?n.topicId[0]:null},this.options.trackingPageLoadData||{}))},_customTrackingCall:function(t,i){var s=u.tracking.data;r.trackCustomEvent(t,e.extend(!0,{articleId:s.articleId,articleTitle:s.articleTitle,articleType:s.articleType,clickGenericText:i,collectionId:s.collectionId,pageTitle:s.photoGalleryTitle,pageType:s.pageType,pageViewGuid:s.pageViewGuid,siteEdition:s.siteEdition,siteHier:s.siteHier,siteSection:s.siteSection,topicId:s.topicId,_dwAnonId:s._dwAnonId},this.options.trackingEventData||{}),"trackClick")}})}),define("components/sliding-element",["jquery","version!fly/managers/debug","managers/waypoints","version!fly/components/base"],function(e,t,i){t=t.init("slidingElement"),i.init(),e.widget("cnet.slidingElement",e.fly.base,{options:{classFixed:"fixed",classReady:"ready",offset:0,offsetGuideParallelBottom:0,offsetGuideParallelTop:0,selectorGuideBottom:null,selectorGuideParallel:null,selectorGuideTop:null,stickTo:"top"},$guideBottom:null,$guideParallel:null,$guideTop:null,$html:null,boundaryBottom:0,boundaryTop:0,stickToBottom:!1,waypoints:null,_create:function(){this._setup(),this.stickToBottom="bottom"===this.options.stickTo,this._setupElements(),this._setupEvents(),this.$element.addClass(this.options.classReady)},_setupElements:function(){this.$html=e("html"),this.options.selectorGuideBottom&&(this.$guideBottom=e(this.options.selectorGuideBottom)),this.options.selectorGuideParallel&&(this.$guideParallel=e(this.options.selectorGuideParallel)),this.options.selectorGuideTop&&(this.$guideTop=e(this.options.selectorGuideTop)),this.$guideParallel&&!this.$guideTop&&(this.boundaryTop="string"==typeof this.options.offsetGuideParallelTop?parseInt(this.options.offsetGuideParallelTop,10)*this.$guideParallel.outerHeight()/100:this.options.offsetGuideParallelTop,this.$element.css({top:this.boundaryTop+"px"}))},_setupEvents:function(){var e=this;this.waypoints=[],this.$guideTop?this.waypoints.push(new Waypoint({element:this.$guideTop,handler:this._topWaypointHandler.bind(this),offset:function(){var t=e.$html.css("zoom")||1,i=e.options.offset-e.$guideTop.outerHeight();return e.stickToBottom&&(i=(i-e.$element.outerHeight())*t+e.$window.height()),i}})):this.$guideParallel&&this.waypoints.push(new Waypoint({element:this.$guideParallel,handler:this._topWaypointHandler.bind(this),offset:function(){var t=e.$html.css("zoom")||1,i=e.options.offset-e.boundaryTop;return e.stickToBottom&&(i=(i-e.$element.outerHeight())*t+e.$window.height()),i}})),this.$guideBottom?this.waypoints.push(new Waypoint({element:this.$guideBottom,handler:this._bottomWaypointHandler.bind(this),offset:function(){var t=e.$html.css("zoom")||1,i=e.options.offset+e.$element.outerHeight();return e.stickToBottom&&(i=(i-e.$element.outerHeight())*t+e.$window.height()),i}})):this.$guideParallel&&this.waypoints.push(new Waypoint({element:this.$guideParallel,handler:this._bottomWaypointHandler.bind(this),offset:function(){var t=e.$html.css("zoom")||1;e.boundaryBottom=e.$guideParallel.outerHeight()-e.$element.outerHeight()-("string"==typeof e.options.offsetGuideParallelBottom?parseInt(e.options.offsetGuideParallelBottom,10)*e.$guideParallel.outerHeight()/100:e.options.offsetGuideParallelBottom);var i=e.options.offset-e.boundaryBottom;return e.stickToBottom&&(i=(i-e.$element.outerHeight())*t+e.$window.height()),i}}))},_topWaypointHandler:function(e){if("down"===e)this.$element.addClass(this.options.classFixed);else{var t=this.boundaryTop;if(this.$guideTop){var i=this.$guideTop.offset(),s=this.$element.parent().offset();t=i.top+this.$guideTop.outerHeight()-s.top}this.$element.removeClass(this.options.classFixed).css({top:t+"px"})}},_bottomWaypointHandler:function(e){if("down"===e){var t=this.boundaryBottom;if(this.$guideBottom){var i=this.$guideBottom.offset(),s=this.$element.parent().offset();t=i.top-s.top-this.$element.outerHeight()}this.$element.removeClass(this.options.classFixed).css({top:t+"px"})}else this.$element.addClass(this.options.classFixed)}})}),define("components/sticky-column",["jquery","managers/tealium","managers/events","version!fly/managers/debug","managers/waypoints","version!fly/libs/jquery.throttle-debounce","version!fly/components/base"],function(e,t,i,s,n){s=s.init("stickyColumn"),n.init(),e.widget("cnet.stickyColumn",e.fly.base,{options:{classFixed:"fixed",classReady:"ready",enableWaypoints:!0,minimumGap:250,offset:0,selectorHeightConstraint:"",selectorHideElement:"",eventChannels:null,eventSubscriptions:null},$constraint:null,divisionSize:0,height:0,waypoints:null,$fixedChild:null,_create:function(){this._setup();var t=this;t._setupElements(),t._setupEvents(),s.log("First sticky column setup"),e(window).on("resize",e.throttle(250,function(){t._resizeStickyCol(),s.log("Resized sticky column setup")})),this.$constraint.find("img.lazy[loading='lazy']").on("load",function(){t._resizeStickyCol(),s.log("lazy image sticky column setup")})},_resizeStickyCol:function(){e(this.waypoints).each(function(){this.destroy()}),this._clearHeight(),this._setupElements(),this._setupEvents()},_setupElements:function(){this.$constraint=this.$element.closest(this.options.selectorHeightConstraint),0===this.$constraint.length&&(this.$constraint=e(this.options.selectorHeightConstraint).first()),this._setHeight(),this._hideExtraOptionalElements(),this._createElementDivisions(),this.$element.addClass(this.options.classReady)},_setHeight:function(){var t=this.$element.children('[data-meta*="type":"static"], [data-meta*="type":"required"]'),i=(t.length-1)*this.options.minimumGap;t.each(function(t,s){var n=e(s);i+=n.data("meta").height||n.outerHeight()}),this.height=Math.max(i,this.$constraint.outerHeight()),this.$element.height(this.height),s.log("Height: ",this.height),s.log("Min-height: ",i),s.log("Required children: ",t.length)},_clearHeight:function(){this.height=0,this.$element.height("auto")},_hideExtraOptionalElements:function(){var t=this.$element.children(),i=t.filter('[data-meta*="type":"optional"]');if(i.length>0){var n=(t.length-1)*this.options.minimumGap;for(t.each(function(t,i){var s=e(i);n+=s.data("meta").height||s.outerHeight()});n>this.height&&i&&i.length>0;){var a=i.last();n-=a.outerHeight()+this.options.minimumGap,i=i.slice(0,-1),a.remove()}}s.log("Opt. children: ",i.length)},_createElementDivisions:function(){var t=this.$element.children();this.divisionSize=this.height/t.length,this.options.selectorHideElement&&(this.divisionSize=e(this.options.selectorHideElement).offset().top-this.options.offset);for(var i=1;i<t.length;i++){var n=i*this.divisionSize,a=t.eq(i),r=t.eq(i-1),o=a.data("meta")&&a.data("meta").height?a.data("meta").height:a.outerHeight(),l=r.data("meta")&&r.data("meta").height?r.data("meta").height:r.outerHeight();l+=r.position().top;var d=o-this.divisionSize;d>0?n-=d:l>n&&(n=l),a.css("top",n+"px")}s.log("Division size: ",this.divisionSize)},_setupEvents:function(){if(this.options.enableWaypoints){var i=this.$element.children();this.waypoints=[];for(var n=this,a=0;a<i.length;a++){var r=i.eq(a);if(r.data("meta")&&"static"!==r.data("meta").type){var o=r.data("meta").height||r.outerHeight(),l=a*this.divisionSize,d=(a+1)*this.divisionSize-o,u=a+1===i.length;this.divisionSize>o&&(this.waypoints.push(new Waypoint({element:this.$element,handler:this._topWaypointHandler.bind(this,r,l),offset:this.options.offset-l})),this.waypoints.push(new Waypoint({element:this.$element,handler:this._bottomWaypointHandler.bind(this,r,d,o,u),offset:u?this._getLastBottomOffset.bind(this,o):this.options.offset-d})))}}new Waypoint({element:this.$element,handler:function(s){if("down"===s)for(var n=0;n<i.length;n++){var a=i.eq(n);if(a.data("meta")&&a.data("meta").trackingData){var r=e.extend(!0,{},this._baseTrackingData,a.data("meta").trackingData);t.trackCustomEvent("impression",r,"trackClick")}}},offset:"100%"});if(""!==this.options.selectorHideElement)new Waypoint({element:e(this.options.selectorHideElement),group:"hideElement",handler:function(e){n.$fixedChild&&("down"===e?(s.log("tophandle - down"),n.$element.children(".fixed").addClass("hidden")):(s.log("tophandle - up"),n.$element.children(".hidden").removeClass("hidden")))},offset:function(){return n.$fixedChild?n.$fixedChild.offset().top-e(window).scrollTop()+n.$fixedChild.height():"0"}}),new Waypoint({element:e(this.options.selectorHideElement),group:"hideElement",handler:function(e){n.$fixedChild&&("down"===e?(s.log("bottomhandle - down"),n.$element.children(".hidden").removeClass("hidden")):(s.log("bottomhandle - up"),n.$element.children(".fixed").addClass("hidden")))},offset:function(){return n.$fixedChild?n.$fixedChild.offset().top-e(window).scrollTop()-e(n.options.selectorHideElement).height():"0"}})}},_topWaypointHandler:function(e,t,i){"down"===i?(e.addClass(this.options.classFixed),this.$fixedChild=e):(e.removeClass(this.options.classFixed).css({top:t+"px"}),this.$fixedChild=null)},_bottomWaypointHandler:function(e,t,i,s,n){s&&(t=this.$constraint.outerHeight()-i),"down"===n?(e.removeClass(this.options.classFixed).css({top:t+"px"}),this.$fixedChild=null):(e.addClass(this.options.classFixed),this.$fixedChild=e)},_getLastBottomOffset:function(e){var t=this.$constraint.outerHeight()-e;return s.log("Bottom offset: ",this.options.offset-t),this.options.offset-t}})}),define("components/selfish-scroll",["jquery","version!fly/managers/debug","version!fly/components/base"],function(e,t){t=t.init("selfishScroll"),e.widget("cnet.selfishScroll",e.fly.base,{options:{threshold:5},_create:function(){this._setup(),this._setupEvents()},_setupEvents:function(){var e=this;this.$element.on("scroll wheel",function(){var t=e.options.threshold<5?5:e.options.threshold,i=t,s=this.scrollHeight-t;Math.floor(this.scrollTop)<=i?this.scrollTop=i:Math.ceil(this.scrollTop+this.clientHeight)>=s&&(this.scrollTop=s-this.clientHeight)})}})}),define("components/update-area",["jquery","version!fly/managers/debug","version!fly/managers/components","version!fly/components/base"],function(e,t,i){t=t.init("updateArea"),e.widget("cnet.updateArea",e.fly.base,{options:{url:""},_create:function(){this._super(),this._setupEvents()},_setupEvents:function(){this.options.url.length>0&&this.doAjax(this.options.url)},doAjax:function(t){var i=this;e.ajax({url:t,dataType:"json"}).done(function(t){e.each(t.pageElements,function(e){var s=t.pageElements[e].html;i.updateView(s,e)})})},updateView:function(t,s){var n=e("[data-update-area="+s+"]");n.html(t),i.process(n);var a=n.find("[data-video-playlist]");a.length>0&&require(["quantum/videoPlayer","quantum/inviewElement"],function(){e("body").hasClass("videoPlayerReady")?e(window).trigger("appendPlaylist",{data:a.data("videoPlaylist")}):e('[data-component="videoPlayer"]').one("onVideoPlayerReady",function(){e(window).trigger("appendPlaylist",{data:a.data("videoPlaylist")})})})}})}),define("components/sticky-leader",["jquery","version!fly/managers/debug","managers/page-vars","components/sticky-element","version!libs/waypoints/jquery.waypoints"],function(e,t,i){t=t.init("stickyLeader"),e.widget("cnet.stickyLeader",e.cnet.stickyElement,{options:{classFadeOut:"fadeOut",duration:0,selectorUnstick:null,topOffset:null,bottomOffset:-60,alwaysSticky:!1},beginWaypoint:null,endWaypoint:null,_create:function(){this._super()},_setupEvents:function(){var t=this,i=this.$placeholder[0];this.beginWaypoint=new Waypoint({element:i,handler:function(e){"down"===e?(t.$placeholder.removeClass(t.options.classHidden),t.$element.addClass(t.options.classFixed)):(t.$placeholder.addClass(t.options.classHidden),t.$element.removeClass(t.options.classFixed))},offset:t.options.topOffset}),t.options.duration>0?setTimeout(function(){t.beginWaypoint.disable(),t.$element.addClass(t.options.classFadeOut),setTimeout(function(){t.$placeholder.addClass(t.options.classHidden),t.$element.removeClass(t.options.classFixed+" "+t.options.classFadeOut)},500)},t.options.duration):this.options.selectorUnstick?this.endWaypoint=new Waypoint({element:e(this.options.selectorUnstick),handler:function(e){"down"===e&&(t.beginWaypoint.disable(),t.endWaypoint.disable(),t.$element.addClass(t.options.classFadeOut),setTimeout(function(){t.$placeholder.addClass(t.options.classHidden),t.$element.removeClass(t.options.classFixed+" "+t.options.classFadeOut)},500))},offset:0}):0==t.options.alwaysSticky&&(this.endWaypoint=new Waypoint({element:i,handler:function(e){"down"===e&&(t.beginWaypoint.disable(),t.endWaypoint&&t.endWaypoint.disable(),t.$element.addClass("fadeOut"),setTimeout(function(){t.$placeholder.addClass(t.options.classHidden),t.$element.removeClass(t.options.classFixed+" fadeOut")},500))},offset:t.options.bottomOffset}))}})}),define("components/track-download",["jquery","version!fly/managers/debug","managers/tealium","managers/page-vars","version!fly/components/base"],function(e,t,i,s){t=t.init("trackDownload"),e.widget("cnet.trackDownload",e.fly.base,{options:{},_create:function(){this._super(),this.$element.on("click",function(){i.trackCustomEvent("trackDownload",{clickGenericText:"HeadertoDL",_siteSection:s.tracking.data.siteSection,siteEdition:s.tracking.data.siteEdition,_siteTypeDevice:s.tracking.data.deviceType,_pageType:s.tracking.data.pageType},"trackClick")})}})}),define("components/social-tracking",["jquery","version!fly/managers/debug","managers/tealium","version!fly/components/base"],function(e,t,i){t=t.init("socialTracking"),e.widget("cnet.socialTracking",e.fly.base,{options:{socialSite:"notSet"},_create:function(){this._setup(),this._setupTracking()},_setupTracking:function(){t.log("Setting up social tracking");var s=this.options;e(this.$element).on("click",function(n){t.log("Social Element Clicked, Tracking Now");var a=s.socialSite,r=i.getDwTag(e(n.target));i.trackSocial({socialService:a,event:"share",eventt:"socialsite",socialId:{facebooksend:1,facebook:2,googlePlus:3,linkedin:21,pinterest:5,reddit:6,stumbleupon:7,twitter:8,twitterfollow:9,email:10,delicious:12,tumblr:14}[a],wd:"sharelink",dwLinkTag:r,sharebarSection:r}),t.log("Social Element Tracked")})}})}),define("components/external-link",["jquery","version!fly/managers/debug","managers/tealium","managers/page-vars","version!fly/components/base"],function(e,t,i,s){var n=t.init("externalLink");e.widget("cnet.externalLink",e.fly.base,{options:{appendViewguid:!0},viewguid:null,commerceClickPlaceholder:"___COM_CLICK_ID___",_create:function(){this._setup(),this.viewguid=s.guid,this.options.appendViewguid&&this.viewguid&&this.$element.attr("href",this.$element.attr("href").replace("___VIEW_GUID___",this.viewguid)),this._setupEvents()},_setupEvents:function(){var t=this;this.$element.on("mousedown",function(a){0!=a.button&&1!=a.button&&2!=a.button||(n.log("External link clicked."),t._setCommerceClickId(),s.tracking.data.commerceClickId&&e(this).attr("href",e(this).attr("href").replace(t.commerceClickPlaceholder,s.tracking.data.commerceClickId.replaceAll("-",""))),i.trackExternalLink({clickGenericText:"trackExternalLink"}),setTimeout(e.proxy(function(){s.tracking.data.commerceClickId&&e(this).attr("href",e(this).attr("href").replace(s.tracking.data.commerceClickId.replaceAll("-",""),t.commerceClickPlaceholder))},this),500))})},_setCommerceClickId:function(){var e=window.uuid();utag_data.commerceClickId=e,s.tracking.data.commerceClickId=e}})}),define("translations/video",["managers/edition"],function(e){return e.getTranslation({en:{resume:"Your video will resume in ",resumeShortly:"Your video will resume shortly",seconds:" seconds",adBlock:{title:"Sorry about that",message:"It looks like you're using an ad blocker. We know you don't love ads. But they allow us to pay the writers, editors and producers who work to make your favorite CNET videos. To watch this video, please disable your ad blocker and refresh the page. Thanks for tuning in. You're the best."},firefoxUpgrade:{title:"Your version of Firefox is no longer supported.",message:'<a href="http://download.cnet.com/s/firefox/" target="_blank">Click here to download the latest version.</a>'},videoNotAvailable:{title:"We're sorry, but this video is no longer available.",message:"Please watch this next video instead."},upnext:"up next",autoplay:"Autoplay",on:"on",off:"off",cannotPlay:"This device is unable to play the requested video.",by:"by",playSound:"Play Sound",watch_now:"Watch now"},es:{resume:"El vídeo se reanudará en ",resumeShortly:"El vídeo se reanudará en breve",seconds:" segundos",adBlock:{title:"Lo sentimos",message:"Parece que estás usando un software para bloquear anuncios. Sabemos que a mucha gente no lo encantan los anuncios, pero nos ayudan a pagarle a nuestro equipo de profesionales que hacen tus videos favoritos. Para ver este video, por favor desactiva el software y vuelve a cargar la página. ¡Mil gracias!"},firefoxUpgrade:{title:"La versión de Firefox que usas no está actualizada.",message:'<a href="http://download.cnet.com/s/firefox/" target="_blank">Por favor descarga la versión más reciente.</a>'},videoNotAvailable:{title:"Lo sentimos, pero este video ya no está disponible.",message:"Por favor, vea el siguiente video en su lugar."},upnext:"Siguiente",autoplay:"Autoplay",on:"Sí",off:"No",cannotPlay:"Este dispositivo no puede reproducir el video solicitado.",by:"por",playSound:"¿Reproducir sonido?",watch_now:"Ve el video"}})}),function(){var e,t,s,n,a,r;(function(){var e,t=200,i="Expected a function",s="__lodash_hash_undefined__",n=500,a="__lodash_placeholder__",r=1,o=2,l=4,d=1,u=2,c=1,h=2,p=4,g=8,f=16,v=32,m=64,_=128,E=512,A=800,y=16,S=1,b=2,T=1/0,C=9007199254740991,I=1.7976931348623157e308,D=NaN,R=4294967295,P=[["ary",_],["bind",c],["bindKey",h],["curry",g],["curryRight",f],["flip",E],["partial",v],["partialRight",m],["rearg",256]],M="[object Arguments]",k="[object Array]",w="[object AsyncFunction]",O="[object Boolean]",L="[object Date]",N="[object DOMException]",U="[object Error]",B="[object Function]",j="[object GeneratorFunction]",x="[object Map]",F="[object Number]",G="[object Null]",V="[object Object]",H="[object Proxy]",$="[object RegExp]",q="[object Set]",W="[object String]",K="[object Symbol]",z="[object Undefined]",Y="[object WeakMap]",X="[object ArrayBuffer]",J="[object DataView]",Q="[object Float32Array]",Z="[object Float64Array]",ee="[object Int8Array]",te="[object Int16Array]",ie="[object Int32Array]",se="[object Uint8Array]",ne="[object Uint8ClampedArray]",ae="[object Uint16Array]",re="[object Uint32Array]",oe=/\b__p \+= '';/g,le=/\b(__p \+=) '' \+/g,de=/(__e\(.*?\)|\b__t\)) \+\n'';/g,ue=/[&<>"']/g,ce=RegExp(ue.source),he=/<%=([\s\S]+?)%>/g,pe=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ge=/^\w*$/,fe=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ve=/^\s+|\s+$/g,me=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,_e=/\{\n\/\* \[wrapped with (.+)\] \*/,Ee=/,? & /,Ae=/\\(\\)?/g,ye=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Se=/\w*$/,be=/^[-+]0x[0-9a-f]+$/i,Te=/^0b[01]+$/i,Ce=/^\[object .+?Constructor\]$/,Ie=/^0o[0-7]+$/i,De=/^(?:0|[1-9]\d*)$/,Re=/($^)/,Pe=/['\n\r\u2028\u2029\\]/g,Me="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",ke="[\\ud800-\\udfff]",we="["+Me+"]",Oe="\\ud83c[\\udffb-\\udfff]",Le="[^\\ud800-\\udfff]",Ne="(?:\\ud83c[\\udde6-\\uddff]){2}",Ue="[\\ud800-\\udbff][\\udc00-\\udfff]",Be="(?:"+we+"|"+Oe+")"+"?",je="[\\ufe0e\\ufe0f]?"+Be+("(?:\\u200d(?:"+[Le,Ne,Ue].join("|")+")[\\ufe0e\\ufe0f]?"+Be+")*"),xe="(?:"+[Le+we+"?",we,Ne,Ue,ke].join("|")+")",Fe=RegExp(Oe+"(?="+Oe+")|"+xe+je,"g"),Ge=RegExp("[\\u200d\\ud800-\\udfff"+Me+"\\ufe0e\\ufe0f]"),Ve=-1,He={};He[Q]=He[Z]=He[ee]=He[te]=He[ie]=He[se]=He[ne]=He[ae]=He[re]=!0,He[M]=He[k]=He[X]=He[O]=He[J]=He[L]=He[U]=He[B]=He[x]=He[F]=He[V]=He[$]=He[q]=He[W]=He[Y]=!1;var $e={};$e[M]=$e[k]=$e[X]=$e[J]=$e[O]=$e[L]=$e[Q]=$e[Z]=$e[ee]=$e[te]=$e[ie]=$e[x]=$e[F]=$e[V]=$e[$]=$e[q]=$e[W]=$e[K]=$e[se]=$e[ne]=$e[ae]=$e[re]=!0,$e[U]=$e[B]=$e[Y]=!1;var qe={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},We=parseInt,Ke="object"==typeof global&&global&&global.Object===Object&&global,ze="object"==typeof self&&self&&self.Object===Object&&self,Ye=Ke||ze||Function("return this")(),Xe="object"==typeof exports&&exports&&!exports.nodeType&&exports,Je=Xe&&"object"==typeof module&&module&&!module.nodeType&&module,Qe=Je&&Je.exports===Xe,Ze=Qe&&Ke.process,et=function(){try{return Ze&&Ze.binding&&Ze.binding("util")}catch(e){}}(),tt=et&&et.isDate,it=et&&et.isMap,st=et&&et.isSet,nt=et&&et.isTypedArray;function at(e,t,i){switch(i.length){case 0:return e.call(t);case 1:return e.call(t,i[0]);case 2:return e.call(t,i[0],i[1]);case 3:return e.call(t,i[0],i[1],i[2])}return e.apply(t,i)}function rt(e,t){for(var i=-1,s=null==e?0:e.length;++i<s&&!1!==t(e[i],i,e););return e}function ot(e,t){for(var i=-1,s=null==e?0:e.length;++i<s;)if(!t(e[i],i,e))return!1;return!0}function lt(e,t){for(var i=-1,s=null==e?0:e.length,n=0,a=[];++i<s;){var r=e[i];t(r,i,e)&&(a[n++]=r)}return a}function dt(e,t){return!!(null==e?0:e.length)&&vt(e,t,0)>-1}function ut(e,t,i){for(var s=-1,n=null==e?0:e.length;++s<n;)if(i(t,e[s]))return!0;return!1}function ct(e,t){for(var i=-1,s=null==e?0:e.length,n=Array(s);++i<s;)n[i]=t(e[i],i,e);return n}function ht(e,t){for(var i=-1,s=t.length,n=e.length;++i<s;)e[n+i]=t[i];return e}function pt(e,t){for(var i=-1,s=null==e?0:e.length;++i<s;)if(t(e[i],i,e))return!0;return!1}var gt=Et("length");function ft(e,t,i,s){for(var n=e.length,a=i+(s?1:-1);s?a--:++a<n;)if(t(e[a],a,e))return a;return-1}function vt(e,t,i){return t==t?function(e,t,i){var s=i-1,n=e.length;for(;++s<n;)if(e[s]===t)return s;return-1}(e,t,i):ft(e,_t,i)}function mt(e,t,i,s){for(var n=i-1,a=e.length;++n<a;)if(s(e[n],t))return n;return-1}function _t(e){return e!=e}function Et(t){return function(i){return null==i?e:i[t]}}function At(e){return function(t){return e(t)}}function yt(e,t){return ct(t,function(t){return e[t]})}function St(e,t){return e.has(t)}var bt,Tt=(bt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},function(t){return null==bt?e:bt[t]});function Ct(e){return"\\"+qe[e]}function It(e){return Ge.test(e)}function Dt(e){var t=-1,i=Array(e.size);return e.forEach(function(e,s){i[++t]=[s,e]}),i}function Rt(e,t){return function(i){return e(t(i))}}function Pt(e){var t=-1,i=Array(e.size);return e.forEach(function(e){i[++t]=e}),i}function Mt(e){return It(e)?function(e){var t=Fe.lastIndex=0;for(;Fe.test(e);)++t;return t}(e):gt(e)}function kt(e){return It(e)?function(e){return e.match(Fe)||[]}(e):function(e){return e.split("")}(e)}var wt,Ot=Array.prototype,Lt=Function.prototype,Nt=Object.prototype,Ut=Ye["__core-js_shared__"],Bt=Lt.toString,jt=Nt.hasOwnProperty,xt=(wt=/[^.]+$/.exec(Ut&&Ut.keys&&Ut.keys.IE_PROTO||""))?"Symbol(src)_1."+wt:"",Ft=Nt.toString,Gt=Bt.call(Object),Vt=Ye._,Ht=RegExp("^"+Bt.call(jt).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),$t=Qe?Ye.Buffer:e,qt=Ye.Symbol,Wt=Ye.Uint8Array,Kt=$t?$t.allocUnsafe:e,zt=Rt(Object.getPrototypeOf,Object),Yt=Object.create,Xt=Nt.propertyIsEnumerable,Jt=Ot.splice,Qt=qt?qt.isConcatSpreadable:e,Zt=qt?qt.iterator:e,ei=qt?qt.toStringTag:e,ti=function(){try{var e=Us(Object,"defineProperty");return e({},"",{}),e}catch(e){}}(),ii=Math.ceil,si=Math.floor,ni=Object.getOwnPropertySymbols,ai=$t?$t.isBuffer:e,ri=Rt(Object.keys,Object),oi=Math.max,li=Math.min,di=Date.now,ui=Ot.reverse,ci=Us(Ye,"DataView"),hi=Us(Ye,"Map"),pi=Us(Ye,"Promise"),gi=Us(Ye,"Set"),fi=Us(Ye,"WeakMap"),vi=Us(Object,"create"),mi=fi&&new fi,_i={},Ei=nn(ci),Ai=nn(hi),yi=nn(pi),Si=nn(gi),bi=nn(fi),Ti=qt?qt.prototype:e,Ci=Ti?Ti.valueOf:e,Ii=Ti?Ti.toString:e;function Di(e){if(Ln(e)&&!Cn(e)&&!(e instanceof ki)){if(e instanceof Mi)return e;if(jt.call(e,"__wrapped__"))return an(e)}return new Mi(e)}var Ri=function(){function t(){}return function(i){if(!On(i))return{};if(Yt)return Yt(i);t.prototype=i;var s=new t;return t.prototype=e,s}}();function Pi(){}function Mi(t,i){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!i,this.__index__=0,this.__values__=e}function ki(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=R,this.__views__=[]}function wi(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var s=e[t];this.set(s[0],s[1])}}function Oi(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var s=e[t];this.set(s[0],s[1])}}function Li(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var s=e[t];this.set(s[0],s[1])}}function Ni(e){var t=-1,i=null==e?0:e.length;for(this.__data__=new Li;++t<i;)this.add(e[t])}function Ui(e){var t=this.__data__=new Oi(e);this.size=t.size}function Bi(e,t){var i=Cn(e),s=!i&&Tn(e),n=!i&&!s&&Rn(e),a=!i&&!s&&!n&&Gn(e),r=i||s||n||a,o=r?function(e,t){for(var i=-1,s=Array(e);++i<e;)s[i]=t(i);return s}(e.length,String):[],l=o.length;for(var d in e)!t&&!jt.call(e,d)||r&&("length"==d||n&&("offset"==d||"parent"==d)||a&&("buffer"==d||"byteLength"==d||"byteOffset"==d)||Vs(d,l))||o.push(d);return o}function ji(t,i,s){var n=t[i];jt.call(t,i)&&bn(n,s)&&(s!==e||i in t)||Fi(t,i,s)}function xi(e,t){for(var i=e.length;i--;)if(bn(e[i][0],t))return i;return-1}function Fi(e,t,i){"__proto__"==t&&ti?ti(e,t,{configurable:!0,enumerable:!0,value:i,writable:!0}):e[t]=i}function Gi(t,i,s){return t==t&&(s!==e&&(t=t<=s?t:s),i!==e&&(t=t>=i?t:i)),t}function Vi(t,i,s,n,a,d){var u,c=i&r,h=i&o,p=i&l;if(s&&(u=a?s(t,n,a,d):s(t)),u!==e)return u;if(!On(t))return t;var g=Cn(t);if(g){if(u=function(e){var t=e.length,i=new e.constructor(t);t&&"string"==typeof e[0]&&jt.call(e,"index")&&(i.index=e.index,i.input=e.input);return i}(t),!c)return Cs(t,u)}else{var f=xs(t),v=f==B||f==j;if(Rn(t))return function(e,t){if(t)return e.slice();var i=e.length,s=Kt?Kt(i):new e.constructor(i);return e.copy(s),s}(t,c);if(f==V||f==M||v&&!a){if(u=h||v?{}:function(e){return"function"!=typeof e.constructor||qs(e)?{}:Ri(zt(e))}(t),!c)return h?function(e,t){return Is(e,js(e),t)}(t,function(e,t){return e&&Is(t,Zn(t),e)}(u,t)):function(e,t){return Is(e,Bs(e),t)}(t,function(e,t){return e&&Is(t,Qn(t),e)}(u,t))}else{if(!$e[f])return a?t:{};u=function(e,t,i){var s=e.constructor;switch(t){case X:return bs(e);case O:case L:return new s(+e);case J:return function(e,t){var i=t?bs(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.byteLength)}(e,i);case Q:case Z:case ee:case te:case ie:case se:case ne:case ae:case re:return function(e,t){var i=t?bs(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.length)}(e,i);case x:return new s;case F:case W:return new s(e);case $:return(r=new(a=e).constructor(a.source,Se.exec(a))).lastIndex=a.lastIndex,r;case q:return new s;case K:return n=e,Ci?Object(Ci.call(n)):{}}var n;var a,r}(t,f,c)}}d||(d=new Ui);var m=d.get(t);if(m)return m;if(d.set(t,u),jn(t))return t.forEach(function(e){u.add(Vi(e,i,s,e,t,d))}),u;if(Nn(t))return t.forEach(function(e,n){u.set(n,Vi(e,i,s,n,t,d))}),u;var _=g?e:(p?h?ws:ks:h?Zn:Qn)(t);return rt(_||t,function(e,n){_&&(e=t[n=e]),ji(u,n,Vi(e,i,s,n,t,d))}),u}Di.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:he,variable:"",imports:{_:Di}},Di.prototype=Pi.prototype,Di.prototype.constructor=Di,Mi.prototype=Ri(Pi.prototype),Mi.prototype.constructor=Mi,ki.prototype=Ri(Pi.prototype),ki.prototype.constructor=ki,wi.prototype.clear=function(){this.__data__=vi?vi(null):{},this.size=0},wi.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},wi.prototype.get=function(t){var i=this.__data__;if(vi){var n=i[t];return n===s?e:n}return jt.call(i,t)?i[t]:e},wi.prototype.has=function(t){var i=this.__data__;return vi?i[t]!==e:jt.call(i,t)},wi.prototype.set=function(t,i){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=vi&&i===e?s:i,this},Oi.prototype.clear=function(){this.__data__=[],this.size=0},Oi.prototype.delete=function(e){var t=this.__data__,i=xi(t,e);return!(i<0||(i==t.length-1?t.pop():Jt.call(t,i,1),--this.size,0))},Oi.prototype.get=function(t){var i=this.__data__,s=xi(i,t);return s<0?e:i[s][1]},Oi.prototype.has=function(e){return xi(this.__data__,e)>-1},Oi.prototype.set=function(e,t){var i=this.__data__,s=xi(i,e);return s<0?(++this.size,i.push([e,t])):i[s][1]=t,this},Li.prototype.clear=function(){this.size=0,this.__data__={hash:new wi,map:new(hi||Oi),string:new wi}},Li.prototype.delete=function(e){var t=Ns(this,e).delete(e);return this.size-=t?1:0,t},Li.prototype.get=function(e){return Ns(this,e).get(e)},Li.prototype.has=function(e){return Ns(this,e).has(e)},Li.prototype.set=function(e,t){var i=Ns(this,e),s=i.size;return i.set(e,t),this.size+=i.size==s?0:1,this},Ni.prototype.add=Ni.prototype.push=function(e){return this.__data__.set(e,s),this},Ni.prototype.has=function(e){return this.__data__.has(e)},Ui.prototype.clear=function(){this.__data__=new Oi,this.size=0},Ui.prototype.delete=function(e){var t=this.__data__,i=t.delete(e);return this.size=t.size,i},Ui.prototype.get=function(e){return this.__data__.get(e)},Ui.prototype.has=function(e){return this.__data__.has(e)},Ui.prototype.set=function(e,i){var s=this.__data__;if(s instanceof Oi){var n=s.__data__;if(!hi||n.length<t-1)return n.push([e,i]),this.size=++s.size,this;s=this.__data__=new Li(n)}return s.set(e,i),this.size=s.size,this};var Hi,$i,qi=(Hi=Yi,function(e,t){if(null==e)return e;if(!In(e))return Hi(e,t);for(var i=e.length,s=$i?i:-1,n=Object(e);($i?s--:++s<i)&&!1!==t(n[s],s,n););return e});function Wi(e,t){var i=!0;return qi(e,function(e,s,n){return i=!!t(e,s,n)}),i}function Ki(e,t,i,s,n){var a=-1,r=e.length;for(i||(i=Gs),n||(n=[]);++a<r;){var o=e[a];t>0&&i(o)?t>1?Ki(o,t-1,i,s,n):ht(n,o):s||(n[n.length]=o)}return n}var zi=function(e){return function(t,i,s){for(var n=-1,a=Object(t),r=s(t),o=r.length;o--;){var l=r[e?o:++n];if(!1===i(a[l],l,a))break}return t}}();function Yi(e,t){return e&&zi(e,t,Qn)}function Xi(e,t){return lt(t,function(t){return kn(e[t])})}function Ji(t,i){for(var s=0,n=(i=ys(i,t)).length;null!=t&&s<n;)t=t[sn(i[s++])];return s&&s==n?t:e}function Qi(e,t,i){var s=t(e);return Cn(e)?s:ht(s,i(e))}function Zi(t){return null==t?t===e?z:G:ei&&ei in Object(t)?function(t){var i=jt.call(t,ei),s=t[ei];try{t[ei]=e;var n=!0}catch(e){}var a=Ft.call(t);n&&(i?t[ei]=s:delete t[ei]);return a}(t):function(e){return Ft.call(e)}(t)}function es(e,t){return null!=e&&jt.call(e,t)}function ts(e,t){return null!=e&&t in Object(e)}function is(t,i,s){var n=null==(t=function(e,t){return t.length<2?e:Ji(e,ms(t,0,-1))}(t,i=ys(i,t)))?t:t[sn(ln(i))];return null==n?e:at(n,t,s)}function ss(e){return Ln(e)&&Zi(e)==M}function ns(t,i,s,n,a){return t===i||(null==t||null==i||!Ln(t)&&!Ln(i)?t!=t&&i!=i:function(t,i,s,n,a,r){var o=Cn(t),l=Cn(i),c=o?k:xs(t),h=l?k:xs(i),p=(c=c==M?V:c)==V,g=(h=h==M?V:h)==V,f=c==h;if(f&&Rn(t)){if(!Rn(i))return!1;o=!0,p=!1}if(f&&!p)return r||(r=new Ui),o||Gn(t)?Ms(t,i,s,n,a,r):function(e,t,i,s,n,a,r){switch(i){case J:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case X:return!(e.byteLength!=t.byteLength||!a(new Wt(e),new Wt(t)));case O:case L:case F:return bn(+e,+t);case U:return e.name==t.name&&e.message==t.message;case $:case W:return e==t+"";case x:var o=Dt;case q:var l=s&d;if(o||(o=Pt),e.size!=t.size&&!l)return!1;var c=r.get(e);if(c)return c==t;s|=u,r.set(e,t);var h=Ms(o(e),o(t),s,n,a,r);return r.delete(e),h;case K:if(Ci)return Ci.call(e)==Ci.call(t)}return!1}(t,i,c,s,n,a,r);if(!(s&d)){var v=p&&jt.call(t,"__wrapped__"),m=g&&jt.call(i,"__wrapped__");if(v||m){var _=v?t.value():t,E=m?i.value():i;return r||(r=new Ui),a(_,E,s,n,r)}}if(!f)return!1;return r||(r=new Ui),function(t,i,s,n,a,r){var o=s&d,l=ks(t),u=l.length,c=ks(i).length;if(u!=c&&!o)return!1;for(var h=u;h--;){var p=l[h];if(!(o?p in i:jt.call(i,p)))return!1}var g=r.get(t);if(g&&r.get(i))return g==i;var f=!0;r.set(t,i),r.set(i,t);for(var v=o;++h<u;){p=l[h];var m=t[p],_=i[p];if(n)var E=o?n(_,m,p,i,t,r):n(m,_,p,t,i,r);if(!(E===e?m===_||a(m,_,s,n,r):E)){f=!1;break}v||(v="constructor"==p)}if(f&&!v){var A=t.constructor,y=i.constructor;A!=y&&"constructor"in t&&"constructor"in i&&!("function"==typeof A&&A instanceof A&&"function"==typeof y&&y instanceof y)&&(f=!1)}return r.delete(t),r.delete(i),f}(t,i,s,n,a,r)}(t,i,s,n,ns,a))}function as(e){return!(!On(e)||(t=e,xt&&xt in t))&&(kn(e)?Ht:Ce).test(nn(e));var t}function rs(t){return"function"==typeof t?t:null==t?ra:"object"==typeof t?Cn(t)?function(t,i){if($s(t)&&Ws(i))return Ks(sn(t),i);return function(s){var n=Xn(s,t);return n===e&&n===i?Jn(s,t):ns(i,n,d|u)}}(t[0],t[1]):function(t){var i=function(e){var t=Qn(e),i=t.length;for(;i--;){var s=t[i],n=e[s];t[i]=[s,n,Ws(n)]}return t}(t);if(1==i.length&&i[0][2])return Ks(i[0][0],i[0][1]);return function(s){return s===t||function(t,i,s,n){var a=s.length,r=a,o=!n;if(null==t)return!r;for(t=Object(t);a--;){var l=s[a];if(o&&l[2]?l[1]!==t[l[0]]:!(l[0]in t))return!1}for(;++a<r;){var c=(l=s[a])[0],h=t[c],p=l[1];if(o&&l[2]){if(h===e&&!(c in t))return!1}else{var g=new Ui;if(n)var f=n(h,p,c,t,i,g);if(!(f===e?ns(p,h,d|u,n,g):f))return!1}}return!0}(s,t,i)}}(t):ua(t)}function os(e){if(!qs(e))return ri(e);var t=[];for(var i in Object(e))jt.call(e,i)&&"constructor"!=i&&t.push(i);return t}function ls(e){if(!On(e))return function(e){var t=[];if(null!=e)for(var i in Object(e))t.push(i);return t}(e);var t=qs(e),i=[];for(var s in e)("constructor"!=s||!t&&jt.call(e,s))&&i.push(s);return i}function ds(e,t){return e<t}function us(e,t){var i=-1,s=In(e)?Array(e.length):[];return qi(e,function(e,n,a){s[++i]=t(e,n,a)}),s}function cs(e,t,i){var s=-1;return t=ct(t.length?t:[ra],At(Ls())),function(e,t){var i=e.length;for(e.sort(t);i--;)e[i]=e[i].value;return e}(us(e,function(e,i,n){return{criteria:ct(t,function(t){return t(e)}),index:++s,value:e}}),function(e,t){return function(e,t,i){var s=-1,n=e.criteria,a=t.criteria,r=n.length,o=i.length;for(;++s<r;){var l=Ts(n[s],a[s]);if(l){if(s>=o)return l;var d=i[s];return l*("desc"==d?-1:1)}}return e.index-t.index}(e,t,i)})}function hs(e,t){var i="";if(!e||t<1||t>C)return i;do{t%2&&(i+=e),(t=si(t/2))&&(e+=e)}while(t);return i}function ps(e,t){return Xs(zs(e,t,ra),e+"")}function gs(t,i,s,n){if(!On(t))return t;for(var a=-1,r=(i=ys(i,t)).length,o=r-1,l=t;null!=l&&++a<r;){var d=sn(i[a]),u=s;if(a!=o){var c=l[d];(u=n?n(c,d,l):e)===e&&(u=On(c)?c:Vs(i[a+1])?[]:{})}ji(l,d,u),l=l[d]}return t}var fs=mi?function(e,t){return mi.set(e,t),e}:ra,vs=ti?function(e,t){return ti(e,"toString",{configurable:!0,enumerable:!1,value:aa(t),writable:!0})}:ra;function ms(e,t,i){var s=-1,n=e.length;t<0&&(t=-t>n?0:n+t),(i=i>n?n:i)<0&&(i+=n),n=t>i?0:i-t>>>0,t>>>=0;for(var a=Array(n);++s<n;)a[s]=e[s+t];return a}function _s(e,t){var i;return qi(e,function(e,s,n){return!(i=t(e,s,n))}),!!i}function Es(e){if("string"==typeof e)return e;if(Cn(e))return ct(e,Es)+"";if(Fn(e))return Ii?Ii.call(e):"";var t=e+"";return"0"==t&&1/e==-T?"-0":t}function As(e,t){var i=e;return i instanceof ki&&(i=i.value()),function(e,t,i,s){var n=-1,a=null==e?0:e.length;for(s&&a&&(i=e[++n]);++n<a;)i=t(i,e[n],n,e);return i}(t,function(e,t){return t.func.apply(t.thisArg,ht([e],t.args))},i)}function ys(e,t){return Cn(e)?e:$s(e,t)?[e]:tn(Wn(e))}function Ss(t,i,s){var n=t.length;return s=s===e?n:s,!i&&s>=n?t:ms(t,i,s)}function bs(e){var t=new e.constructor(e.byteLength);return new Wt(t).set(new Wt(e)),t}function Ts(t,i){if(t!==i){var s=t!==e,n=null===t,a=t==t,r=Fn(t),o=i!==e,l=null===i,d=i==i,u=Fn(i);if(!l&&!u&&!r&&t>i||r&&o&&d&&!l&&!u||n&&o&&d||!s&&d||!a)return 1;if(!n&&!r&&!u&&t<i||u&&s&&a&&!n&&!r||l&&s&&a||!o&&a||!d)return-1}return 0}function Cs(e,t){var i=-1,s=e.length;for(t||(t=Array(s));++i<s;)t[i]=e[i];return t}function Is(t,i,s,n){var a=!s;s||(s={});for(var r=-1,o=i.length;++r<o;){var l=i[r],d=n?n(s[l],t[l],l,s,t):e;d===e&&(d=t[l]),a?Fi(s,l,d):ji(s,l,d)}return s}function Ds(t){return ps(function(i,s){var n=-1,a=s.length,r=a>1?s[a-1]:e,o=a>2?s[2]:e;for(r=t.length>3&&"function"==typeof r?(a--,r):e,o&&Hs(s[0],s[1],o)&&(r=a<3?e:r,a=1),i=Object(i);++n<a;){var l=s[n];l&&t(i,l,n,r)}return i})}function Rs(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var i=Ri(e.prototype),s=e.apply(i,t);return On(s)?s:i}}function Ps(t,i,s,n){return t===e||bn(t,Nt[s])&&!jt.call(n,s)?i:t}function Ms(t,i,s,n,a,r){var o=s&d,l=t.length,c=i.length;if(l!=c&&!(o&&c>l))return!1;var h=r.get(t);if(h&&r.get(i))return h==i;var p=-1,g=!0,f=s&u?new Ni:e;for(r.set(t,i),r.set(i,t);++p<l;){var v=t[p],m=i[p];if(n)var _=o?n(m,v,p,i,t,r):n(v,m,p,t,i,r);if(_!==e){if(_)continue;g=!1;break}if(f){if(!pt(i,function(e,t){if(!St(f,t)&&(v===e||a(v,e,s,n,r)))return f.push(t)})){g=!1;break}}else if(v!==m&&!a(v,m,s,n,r)){g=!1;break}}return r.delete(t),r.delete(i),g}function ks(e){return Qi(e,Qn,Bs)}function ws(e){return Qi(e,Zn,js)}var Os=mi?function(e){return mi.get(e)}:da;function Ls(){var e=Di.iteratee||oa;return e=e===oa?rs:e,arguments.length?e(arguments[0],arguments[1]):e}function Ns(e,t){var i,s,n=e.__data__;return("string"==(s=typeof(i=t))||"number"==s||"symbol"==s||"boolean"==s?"__proto__"!==i:null===i)?n["string"==typeof t?"string":"hash"]:n.map}function Us(t,i){var s=function(t,i){return null==t?e:t[i]}(t,i);return as(s)?s:e}var Bs=ni?function(e){return null==e?[]:(e=Object(e),lt(ni(e),function(t){return Xt.call(e,t)}))}:ca,js=ni?function(e){for(var t=[];e;)ht(t,Bs(e)),e=zt(e);return t}:ca,xs=Zi;function Fs(e,t,i){for(var s=-1,n=(t=ys(t,e)).length,a=!1;++s<n;){var r=sn(t[s]);if(!(a=null!=e&&i(e,r)))break;e=e[r]}return a||++s!=n?a:!!(n=null==e?0:e.length)&&wn(n)&&Vs(r,n)&&(Cn(e)||Tn(e))}function Gs(e){return Cn(e)||Tn(e)||!!(Qt&&e&&e[Qt])}function Vs(e,t){var i=typeof e;return!!(t=null==t?C:t)&&("number"==i||"symbol"!=i&&De.test(e))&&e>-1&&e%1==0&&e<t}function Hs(e,t,i){if(!On(i))return!1;var s=typeof t;return!!("number"==s?In(i)&&Vs(t,i.length):"string"==s&&t in i)&&bn(i[t],e)}function $s(e,t){if(Cn(e))return!1;var i=typeof e;return!("number"!=i&&"symbol"!=i&&"boolean"!=i&&null!=e&&!Fn(e))||(ge.test(e)||!pe.test(e)||null!=t&&e in Object(t))}function qs(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Nt)}function Ws(e){return e==e&&!On(e)}function Ks(t,i){return function(s){return null!=s&&(s[t]===i&&(i!==e||t in Object(s)))}}function zs(t,i,s){return i=oi(i===e?t.length-1:i,0),function(){for(var e=arguments,n=-1,a=oi(e.length-i,0),r=Array(a);++n<a;)r[n]=e[i+n];n=-1;for(var o=Array(i+1);++n<i;)o[n]=e[n];return o[i]=s(r),at(t,this,o)}}(ci&&xs(new ci(new ArrayBuffer(1)))!=J||hi&&xs(new hi)!=x||pi&&"[object Promise]"!=xs(pi.resolve())||gi&&xs(new gi)!=q||fi&&xs(new fi)!=Y)&&(xs=function(t){var i=Zi(t),s=i==V?t.constructor:e,n=s?nn(s):"";if(n)switch(n){case Ei:return J;case Ai:return x;case yi:return"[object Promise]";case Si:return q;case bi:return Y}return i});var Ys=Js(fs),Xs=Js(vs);function Js(t){var i=0,s=0;return function(){var n=di(),a=y-(n-s);if(s=n,a>0){if(++i>=A)return arguments[0]}else i=0;return t.apply(e,arguments)}}var Qs,Zs,en,tn=(Qs=function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(fe,function(e,i,s,n){t.push(s?n.replace(Ae,"$1"):i||e)}),t},Zs=yn(Qs,function(e){return en.size===n&&en.clear(),e}),en=Zs.cache,Zs);function sn(e){if("string"==typeof e||Fn(e))return e;var t=e+"";return"0"==t&&1/e==-T?"-0":t}function nn(e){if(null!=e){try{return Bt.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function an(e){if(e instanceof ki)return e.clone();var t=new Mi(e.__wrapped__,e.__chain__);return t.__actions__=Cs(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}function rn(e,t,i){var s=null==e?0:e.length;if(!s)return-1;var n=null==i?0:$n(i);return n<0&&(n=oi(s+n,0)),ft(e,Ls(t,3),n)}function on(e){return(null==e?0:e.length)?Ki(e,1):[]}function ln(t){var i=null==t?0:t.length;return i?t[i-1]:e}var dn=ps(un);function un(e,t){return e&&e.length&&t&&t.length?function(e,t,i,s){var n=s?mt:vt,a=-1,r=t.length,o=e;for(e===t&&(t=Cs(t)),i&&(o=ct(e,At(i)));++a<r;)for(var l=0,d=t[a],u=i?i(d):d;(l=n(o,u,l,s))>-1;)o!==e&&Jt.call(o,l,1),Jt.call(e,l,1);return e}(e,t):e}function cn(e){return null==e?e:ui.call(e)}var hn=ps(function(e,i){return Dn(e)?function(e,i,s,n){var a=-1,r=dt,o=!0,l=e.length,d=[],u=i.length;if(!l)return d;s&&(i=ct(i,At(s))),n?(r=ut,o=!1):i.length>=t&&(r=St,o=!1,i=new Ni(i));e:for(;++a<l;){var c=e[a],h=null==s?c:s(c);if(c=n||0!==c?c:0,o&&h==h){for(var p=u;p--;)if(i[p]===h)continue e;d.push(c)}else r(i,h,n)||d.push(c)}return d}(e,i):[]});function pn(e){var t=Di(e);return t.__chain__=!0,t}function gn(e,t){return t(e)}!function(t){Xs(zs(t,e,on),t+"")}(function(t){var i=t.length,s=i?t[0]:0,n=this.__wrapped__,a=function(i){return function(t,i){for(var s=-1,n=i.length,a=Array(n),r=null==t;++s<n;)a[s]=r?e:Xn(t,i[s]);return a}(i,t)};return!(i>1||this.__actions__.length)&&n instanceof ki&&Vs(s)?((n=n.slice(s,+s+(i?1:0))).__actions__.push({func:gn,args:[a],thisArg:e}),new Mi(n,this.__chain__).thru(function(t){return i&&!t.length&&t.push(e),t})):this.thru(a)});var fn,vn=(fn=rn,function(t,i,s){var n=Object(t);if(!In(t)){var a=Ls(i,3);t=Qn(t),i=function(e){return a(n[e],e,n)}}var r=fn(t,i,s);return r>-1?n[a?t[r]:r]:e});function mn(e,t){return(Cn(e)?rt:qi)(e,Ls(t,3))}var _n=ps(function(e,t){if(null==e)return[];var i=t.length;return i>1&&Hs(e,t[0],t[1])?t=[]:i>2&&Hs(t[0],t[1],t[2])&&(t=[t[0]]),cs(e,Ki(t,1),[])}),En=function(){return Ye.Date.now()};function An(t,s,n){var a,r,o,l,d,u,c=0,h=!1,p=!1,g=!0;if("function"!=typeof t)throw new TypeError(i);function f(i){var s=a,n=r;return a=r=e,c=i,l=t.apply(n,s)}function v(t){var i=t-u;return u===e||i>=s||i<0||p&&t-c>=o}function m(){var e=En();if(v(e))return _(e);d=setTimeout(m,function(e){var t=s-(e-u);return p?li(t,o-(e-c)):t}(e))}function _(t){return d=e,g&&a?f(t):(a=r=e,l)}function E(){var t=En(),i=v(t);if(a=arguments,r=this,u=t,i){if(d===e)return function(e){return c=e,d=setTimeout(m,s),h?f(e):l}(u);if(p)return d=setTimeout(m,s),f(u)}return d===e&&(d=setTimeout(m,s)),l}return s=qn(s)||0,On(n)&&(h=!!n.leading,o=(p="maxWait"in n)?oi(qn(n.maxWait)||0,s):o,g="trailing"in n?!!n.trailing:g),E.cancel=function(){d!==e&&clearTimeout(d),c=0,a=u=r=d=e},E.flush=function(){return d===e?l:_(En())},E}function yn(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError(i);var s=function(){var i=arguments,n=t?t.apply(this,i):i[0],a=s.cache;if(a.has(n))return a.get(n);var r=e.apply(this,i);return s.cache=a.set(n,r)||a,r};return s.cache=new(yn.Cache||Li),s}function Sn(e){if("function"!=typeof e)throw new TypeError(i);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function bn(e,t){return e===t||e!=e&&t!=t}yn.Cache=Li;var Tn=ss(function(){return arguments}())?ss:function(e){return Ln(e)&&jt.call(e,"callee")&&!Xt.call(e,"callee")},Cn=Array.isArray;function In(e){return null!=e&&wn(e.length)&&!kn(e)}function Dn(e){return Ln(e)&&In(e)}var Rn=ai||ha,Pn=tt?At(tt):function(e){return Ln(e)&&Zi(e)==L};function Mn(e){if(!Ln(e))return!1;var t=Zi(e);return t==U||t==N||"string"==typeof e.message&&"string"==typeof e.name&&!Bn(e)}function kn(e){if(!On(e))return!1;var t=Zi(e);return t==B||t==j||t==w||t==H}function wn(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=C}function On(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function Ln(e){return null!=e&&"object"==typeof e}var Nn=it?At(it):function(e){return Ln(e)&&xs(e)==x};function Un(e){return"number"==typeof e||Ln(e)&&Zi(e)==F}function Bn(e){if(!Ln(e)||Zi(e)!=V)return!1;var t=zt(e);if(null===t)return!0;var i=jt.call(t,"constructor")&&t.constructor;return"function"==typeof i&&i instanceof i&&Bt.call(i)==Gt}var jn=st?At(st):function(e){return Ln(e)&&xs(e)==q};function xn(e){return"string"==typeof e||!Cn(e)&&Ln(e)&&Zi(e)==W}function Fn(e){return"symbol"==typeof e||Ln(e)&&Zi(e)==K}var Gn=nt?At(nt):function(e){return Ln(e)&&wn(e.length)&&!!He[Zi(e)]};function Vn(e){if(!e)return[];if(In(e))return xn(e)?kt(e):Cs(e);if(Zt&&e[Zt])return function(e){for(var t,i=[];!(t=e.next()).done;)i.push(t.value);return i}(e[Zt]());var t=xs(e);return(t==x?Dt:t==q?Pt:ta)(e)}function Hn(e){return e?(e=qn(e))===T||e===-T?(e<0?-1:1)*I:e==e?e:0:0===e?e:0}function $n(e){var t=Hn(e),i=t%1;return t==t?i?t-i:t:0}function qn(e){if("number"==typeof e)return e;if(Fn(e))return D;if(On(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=On(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(ve,"");var i=Te.test(e);return i||Ie.test(e)?We(e.slice(2),i?2:8):be.test(e)?D:+e}function Wn(e){return null==e?"":Es(e)}var Kn=Ds(function(e,t){if(qs(t)||In(t))Is(t,Qn(t),e);else for(var i in t)jt.call(t,i)&&ji(e,i,t[i])}),zn=Ds(function(e,t){Is(t,Zn(t),e)}),Yn=Ds(function(e,t,i,s){Is(t,Zn(t),e,s)});function Xn(t,i,s){var n=null==t?e:Ji(t,i);return n===e?s:n}function Jn(e,t){return null!=e&&Fs(e,t,ts)}function Qn(e){return In(e)?Bi(e):os(e)}function Zn(e){return In(e)?Bi(e,!0):ls(e)}function ea(e,t){if(null==e)return{};var i=ct(ws(e),function(e){return[e]});return t=Ls(t),function(e,t,i){for(var s=-1,n=t.length,a={};++s<n;){var r=t[s],o=Ji(e,r);i(o,r)&&gs(a,ys(r,e),o)}return a}(e,i,function(e,i){return t(e,i[0])})}function ta(e){return null==e?[]:yt(e,Qn(e))}var ia,sa=(ia="toUpperCase",function(t){var i=It(t=Wn(t))?kt(t):e,s=i?i[0]:t.charAt(0),n=i?Ss(i,1).join(""):t.slice(1);return s[ia]()+n}),na=ps(function(t,i){try{return at(t,e,i)}catch(e){return Mn(e)?e:new Error(e)}});function aa(e){return function(){return e}}function ra(e){return e}function oa(e){return rs("function"==typeof e?e:Vi(e,r))}function la(e,t,i){var s=Qn(t),n=Xi(t,s);null!=i||On(t)&&(n.length||!s.length)||(i=t,t=e,e=this,n=Xi(t,Qn(t)));var a=!(On(i)&&"chain"in i&&!i.chain),r=kn(e);return rt(n,function(i){var s=t[i];e[i]=s,r&&(e.prototype[i]=function(){var t=this.__chain__;if(a||t){var i=e(this.__wrapped__);return(i.__actions__=Cs(this.__actions__)).push({func:s,args:arguments,thisArg:e}),i.__chain__=t,i}return s.apply(e,ht([this.value()],arguments))})}),e}function da(){}function ua(e){return $s(e)?Et(sn(e)):function(e){return function(t){return Ji(t,e)}}(e)}function ca(){return[]}function ha(){return!1}var pa,ga=function(e){var t=Math[e];return function(e,i){if(e=qn(e),i=null==i?0:li($n(i),292)){var s=(Wn(e)+"e").split("e");return+((s=(Wn(t(s[0]+"e"+(+s[1]+i)))+"e").split("e"))[0]+"e"+(+s[1]-i))}return t(e)}}("round");Di.assign=Kn,Di.assignIn=zn,Di.assignInWith=Yn,Di.chain=pn,Di.compact=function(e){for(var t=-1,i=null==e?0:e.length,s=0,n=[];++t<i;){var a=e[t];a&&(n[s++]=a)}return n},Di.constant=aa,Di.debounce=An,Di.drop=function(t,i,s){var n=null==t?0:t.length;return n?ms(t,(i=s||i===e?1:$n(i))<0?0:i,n):[]},Di.flatten=on,Di.iteratee=oa,Di.keys=Qn,Di.keysIn=Zn,Di.map=function(e,t){return(Cn(e)?ct:us)(e,Ls(t,3))},Di.memoize=yn,Di.mixin=la,Di.negate=Sn,Di.omitBy=function(e,t){return ea(e,Sn(Ls(t)))},Di.pickBy=ea,Di.property=ua,Di.pull=dn,Di.pullAll=un,Di.reverse=cn,Di.sortBy=_n,Di.tap=function(e,t){return t(e),e},Di.throttle=function(e,t,s){var n=!0,a=!0;if("function"!=typeof e)throw new TypeError(i);return On(s)&&(n="leading"in s?!!s.leading:n,a="trailing"in s?!!s.trailing:a),An(e,t,{leading:n,maxWait:t,trailing:a})},Di.thru=gn,Di.toArray=Vn,Di.values=ta,Di.without=hn,Di.extend=zn,Di.extendWith=Yn,la(Di,Di),Di.attempt=na,Di.capitalize=function(e){return sa(Wn(e).toLowerCase())},Di.clone=function(e){return Vi(e,l)},Di.cloneDeep=function(e){return Vi(e,r|l)},Di.endsWith=function(t,i,s){t=Wn(t),i=Es(i);var n=t.length,a=s=s===e?n:Gi($n(s),0,n);return(s-=i.length)>=0&&t.slice(s,a)==i},Di.eq=bn,Di.escape=function(e){return(e=Wn(e))&&ce.test(e)?e.replace(ue,Tt):e},Di.every=function(t,i,s){var n=Cn(t)?ot:Wi;return s&&Hs(t,i,s)&&(i=e),n(t,Ls(i,3))},Di.find=vn,Di.findIndex=rn,Di.forEach=mn,Di.forOwn=function(e,t){return e&&Yi(e,Ls(t,3))},Di.get=Xn,Di.has=function(e,t){return null!=e&&Fs(e,t,es)},Di.hasIn=Jn,Di.identity=ra,Di.includes=function(e,t,i,s){e=In(e)?e:ta(e),i=i&&!s?$n(i):0;var n=e.length;return i<0&&(i=oi(n+i,0)),xn(e)?i<=n&&e.indexOf(t,i)>-1:!!n&&vt(e,t,i)>-1},Di.indexOf=function(e,t,i){var s=null==e?0:e.length;if(!s)return-1;var n=null==i?0:$n(i);return n<0&&(n=oi(s+n,0)),vt(e,t,n)},Di.inRange=function(t,i,s){return i=Hn(i),s===e?(s=i,i=0):s=Hn(s),function(e,t,i){return e>=li(t,i)&&e<oi(t,i)}(t=qn(t),i,s)},Di.isArguments=Tn,Di.isArray=Cn,Di.isArrayLike=In,Di.isArrayLikeObject=Dn,Di.isBoolean=function(e){return!0===e||!1===e||Ln(e)&&Zi(e)==O},Di.isBuffer=Rn,Di.isDate=Pn,Di.isEmpty=function(e){if(null==e)return!0;if(In(e)&&(Cn(e)||"string"==typeof e||"function"==typeof e.splice||Rn(e)||Gn(e)||Tn(e)))return!e.length;var t=xs(e);if(t==x||t==q)return!e.size;if(qs(e))return!os(e).length;for(var i in e)if(jt.call(e,i))return!1;return!0},Di.isError=Mn,Di.isFunction=kn,Di.isLength=wn,Di.isMap=Nn,Di.isNaN=function(e){return Un(e)&&e!=+e},Di.isNull=function(e){return null===e},Di.isNumber=Un,Di.isObject=On,Di.isObjectLike=Ln,Di.isPlainObject=Bn,Di.isSet=jn,Di.isString=xn,Di.isSymbol=Fn,Di.isTypedArray=Gn,Di.isUndefined=function(t){return t===e},Di.last=ln,Di.min=function(t){return t&&t.length?function(t,i,s){for(var n=-1,a=t.length;++n<a;){var r=t[n],o=i(r);if(null!=o&&(l===e?o==o&&!Fn(o):s(o,l)))var l=o,d=r}return d}(t,ra,ds):e},Di.stubArray=ca,Di.stubFalse=ha,Di.noConflict=function(){return Ye._===this&&(Ye._=Vt),this},Di.noop=da,Di.now=En,Di.padStart=function(t,i,s){t=Wn(t);var n=(i=$n(i))?Mt(t):0;return i&&n<i?function(t,i){var s=(i=i===e?" ":Es(i)).length;if(s<2)return s?hs(i,t):i;var n=hs(i,ii(t/Mt(i)));return It(i)?Ss(kt(n),0,t).join(""):n.slice(0,t)}(i-n,s)+t:t},Di.round=ga,Di.some=function(t,i,s){var n=Cn(t)?pt:_s;return s&&Hs(t,i,s)&&(i=e),n(t,Ls(i,3))},Di.startsWith=function(e,t,i){return e=Wn(e),i=null==i?0:Gi($n(i),0,e.length),t=Es(t),e.slice(i,i+t.length)==t},Di.template=function(t,i,s){var n=Di.templateSettings;s&&Hs(t,i,s)&&(i=e),t=Wn(t),i=Yn({},i,n,Ps);var a,r,o=Yn({},i.imports,n.imports,Ps),l=Qn(o),d=yt(o,l),u=0,c=i.interpolate||Re,h="__p += '",p=RegExp((i.escape||Re).source+"|"+c.source+"|"+(c===he?ye:Re).source+"|"+(i.evaluate||Re).source+"|$","g"),g="//# sourceURL="+("sourceURL"in i?i.sourceURL:"lodash.templateSources["+ ++Ve+"]")+"\n";t.replace(p,function(e,i,s,n,o,l){return s||(s=n),h+=t.slice(u,l).replace(Pe,Ct),i&&(a=!0,h+="' +\n__e("+i+") +\n'"),o&&(r=!0,h+="';\n"+o+";\n__p += '"),s&&(h+="' +\n((__t = ("+s+")) == null ? '' : __t) +\n'"),u=l+e.length,e}),h+="';\n";var f=i.variable;f||(h="with (obj) {\n"+h+"\n}\n"),h=(r?h.replace(oe,""):h).replace(le,"$1").replace(de,"$1;"),h="function("+(f||"obj")+") {\n"+(f?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(a?", __e = _.escape":"")+(r?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+h+"return __p\n}";var v=na(function(){return Function(l,g+"return "+h).apply(e,d)});if(v.source=h,Mn(v))throw v;return v},Di.toFinite=Hn,Di.toInteger=$n,Di.toNumber=qn,Di.toString=Wn,Di.upperFirst=sa,Di.each=mn,la(Di,(pa={},Yi(Di,function(e,t){jt.call(Di.prototype,t)||(pa[t]=e)}),pa),{chain:!1}),Di.VERSION="4.17.5",rt(["drop","take"],function(t,i){ki.prototype[t]=function(s){s=s===e?1:oi($n(s),0);var n=this.__filtered__&&!i?new ki(this):this.clone();return n.__filtered__?n.__takeCount__=li(s,n.__takeCount__):n.__views__.push({size:li(s,R),type:t+(n.__dir__<0?"Right":"")}),n},ki.prototype[t+"Right"]=function(e){return this.reverse()[t](e).reverse()}}),rt(["filter","map","takeWhile"],function(e,t){var i=t+1,s=i==S||3==i;ki.prototype[e]=function(e){var t=this.clone();return t.__iteratees__.push({iteratee:Ls(e,3),type:i}),t.__filtered__=t.__filtered__||s,t}}),rt(["head","last"],function(e,t){var i="take"+(t?"Right":"");ki.prototype[e]=function(){return this[i](1).value()[0]}}),rt(["initial","tail"],function(e,t){var i="drop"+(t?"":"Right");ki.prototype[e]=function(){return this.__filtered__?new ki(this):this[i](1)}}),ki.prototype.compact=function(){return this.filter(ra)},ki.prototype.find=function(e){return this.filter(e).head()},ki.prototype.findLast=function(e){return this.reverse().find(e)},ki.prototype.invokeMap=ps(function(e,t){return"function"==typeof e?new ki(this):this.map(function(i){return is(i,e,t)})}),ki.prototype.reject=function(e){return this.filter(Sn(Ls(e)))},ki.prototype.slice=function(t,i){t=$n(t);var s=this;return s.__filtered__&&(t>0||i<0)?new ki(s):(t<0?s=s.takeRight(-t):t&&(s=s.drop(t)),i!==e&&(s=(i=$n(i))<0?s.dropRight(-i):s.take(i-t)),s)},ki.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},ki.prototype.toArray=function(){return this.take(R)},Yi(ki.prototype,function(t,i){var s=/^(?:filter|find|map|reject)|While$/.test(i),n=/^(?:head|last)$/.test(i),a=Di[n?"take"+("last"==i?"Right":""):i],r=n||/^find/.test(i);a&&(Di.prototype[i]=function(){var i=this.__wrapped__,o=n?[1]:arguments,l=i instanceof ki,d=o[0],u=l||Cn(i),c=function(e){var t=a.apply(Di,ht([e],o));return n&&h?t[0]:t};u&&s&&"function"==typeof d&&1!=d.length&&(l=u=!1);var h=this.__chain__,p=!!this.__actions__.length,g=r&&!h,f=l&&!p;if(!r&&u){i=f?i:new ki(this);var v=t.apply(i,o);return v.__actions__.push({func:gn,args:[c],thisArg:e}),new Mi(v,h)}return g&&f?t.apply(this,o):(v=this.thru(c),g?n?v.value()[0]:v.value():v)})}),rt(["pop","push","shift","sort","splice","unshift"],function(e){var t=Ot[e],i=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",s=/^(?:pop|shift)$/.test(e);Di.prototype[e]=function(){var e=arguments;if(s&&!this.__chain__){var n=this.value();return t.apply(Cn(n)?n:[],e)}return this[i](function(i){return t.apply(Cn(i)?i:[],e)})}}),Yi(ki.prototype,function(e,t){var i=Di[t];if(i){var s=i.name+"";(_i[s]||(_i[s]=[])).push({name:t,func:i})}}),_i[function t(i,s,n,r,o,l,d,u,A,y){var S=s&_,b=s&c,T=s&h,C=s&(g|f),I=s&E,D=T?e:Rs(i);return function f(){for(var _=arguments.length,E=Array(_),R=_;R--;)E[R]=arguments[R];if(C)var M=function(e){return(jt.call(Di,"placeholder")?Di:e).placeholder}(f),k=function(e,t){for(var i=e.length,s=0;i--;)e[i]===t&&++s;return s}(E,M);if(r&&(E=function(e,t,i,s){for(var n=-1,a=e.length,r=i.length,o=-1,l=t.length,d=oi(a-r,0),u=Array(l+d),c=!s;++o<l;)u[o]=t[o];for(;++n<r;)(c||n<a)&&(u[i[n]]=e[n]);for(;d--;)u[o++]=e[n++];return u}(E,r,o,C)),l&&(E=function(e,t,i,s){for(var n=-1,a=e.length,r=-1,o=i.length,l=-1,d=t.length,u=oi(a-o,0),c=Array(u+d),h=!s;++n<u;)c[n]=e[n];for(var p=n;++l<d;)c[p+l]=t[l];for(;++r<o;)(h||n<a)&&(c[p+i[r]]=e[n++]);return c}(E,l,d,C)),_-=k,C&&_<y){var w=function(e,t){for(var i=-1,s=e.length,n=0,r=[];++i<s;){var o=e[i];o!==t&&o!==a||(e[i]=a,r[n++]=i)}return r}(E,M);return function(t,i,s,n,a,r,o,l,d,u){var f=i&g;i|=f?v:m,(i&=~(f?m:v))&p||(i&=~(c|h));var _=[t,i,a,f?r:e,f?o:e,f?e:r,f?e:o,l,d,u],E=s.apply(e,_);return function(e){var t=function(e){for(var t=e.name+"",i=_i[t],s=jt.call(_i,t)?i.length:0;s--;){var n=i[s],a=n.func;if(null==a||a==e)return n.name}return t}(e),i=Di[t];if("function"!=typeof i||!(t in ki.prototype))return!1;if(e===i)return!0;var s=Os(i);return!!s&&e===s[0]}(t)&&Ys(E,_),E.placeholder=n,function(e,t,i){var s=t+"";return Xs(e,function(e,t){var i=t.length;if(!i)return e;var s=i-1;return t[s]=(i>1?"& ":"")+t[s],t=t.join(i>2?", ":" "),e.replace(me,"{\n/* [wrapped with "+t+"] */\n")}(s,function(e,t){return rt(P,function(i){var s="_."+i[0];t&i[1]&&!dt(e,s)&&e.push(s)}),e.sort()}(function(e){var t=e.match(_e);return t?t[1].split(Ee):[]}(s),i)))}(E,t,i)}(i,s,t,f.placeholder,n,E,w,u,A,y-_)}var O=b?n:this,L=T?O[i]:i;return _=E.length,u?E=function(t,i){for(var s=t.length,n=li(i.length,s),a=Cs(t);n--;){var r=i[n];t[n]=Vs(r,s)?a[r]:e}return t}(E,u):I&&_>1&&E.reverse(),S&&A<_&&(E.length=A),this&&this!==Ye&&this instanceof f&&(L=D||Rs(L)),L.apply(O,E)}}(e,h).name]=[{name:"wrapper",func:e}],ki.prototype.clone=function(){var e=new ki(this.__wrapped__);return e.__actions__=Cs(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=Cs(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=Cs(this.__views__),e},ki.prototype.reverse=function(){if(this.__filtered__){var e=new ki(this);e.__dir__=-1,e.__filtered__=!0}else(e=this.clone()).__dir__*=-1;return e},ki.prototype.value=function(){var e=this.__wrapped__.value(),t=this.__dir__,i=Cn(e),s=t<0,n=i?e.length:0,a=function(e,t,i){for(var s=-1,n=i.length;++s<n;){var a=i[s],r=a.size;switch(a.type){case"drop":e+=r;break;case"dropRight":t-=r;break;case"take":t=li(t,e+r);break;case"takeRight":e=oi(e,t-r)}}return{start:e,end:t}}(0,n,this.__views__),r=a.start,o=a.end,l=o-r,d=s?o:r-1,u=this.__iteratees__,c=u.length,h=0,p=li(l,this.__takeCount__);if(!i||!s&&n==l&&p==l)return As(e,this.__actions__);var g=[];e:for(;l--&&h<p;){for(var f=-1,v=e[d+=t];++f<c;){var m=u[f],_=m.iteratee,E=m.type,A=_(v);if(E==b)v=A;else if(!A){if(E==S)continue e;break e}}g[h++]=v}return g},Di.prototype.chain=function(){return pn(this)},Di.prototype.commit=function(){return new Mi(this.value(),this.__chain__)},Di.prototype.next=function(){this.__values__===e&&(this.__values__=Vn(this.value()));var t=this.__index__>=this.__values__.length;return{done:t,value:t?e:this.__values__[this.__index__++]}},Di.prototype.plant=function(t){for(var i,s=this;s instanceof Pi;){var n=an(s);n.__index__=0,n.__values__=e,i?a.__wrapped__=n:i=n;var a=n;s=s.__wrapped__}return a.__wrapped__=t,i},Di.prototype.reverse=function(){var t=this.__wrapped__;if(t instanceof ki){var i=t;return this.__actions__.length&&(i=new ki(this)),(i=i.reverse()).__actions__.push({func:gn,args:[cn],thisArg:e}),new Mi(i,this.__chain__)}return this.thru(cn)},Di.prototype.toJSON=Di.prototype.valueOf=Di.prototype.value=function(){return As(this.__wrapped__,this.__actions__)},Di.prototype.first=Di.prototype.head,Zt&&(Di.prototype[Zt]=function(){return this}),Je?((Je.exports=Di)._=Di,Xe._=Di):Ye._=Di}).call(this),"undefined"!=typeof window&&(t=this,s=function(){return function(e){var t={};function i(s){if(t[s])return t[s].exports;var n=t[s]={i:s,l:!1,exports:{}};return e[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=e,i.c=t,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(s,n,function(t){return e[t]}.bind(null,n));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/dist/",i(i.s="./src/hls.js")}({"./node_modules/eventemitter3/index.js":function(e,t,i){var s=Object.prototype.hasOwnProperty,n="~";function a(){}function r(e,t,i){this.fn=e,this.context=t,this.once=i||!1}function o(e,t,i,s,a){if("function"!=typeof i)throw new TypeError("The listener must be a function");var o=new r(i,s||e,a),l=n?n+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function l(e,t){0==--e._eventsCount?e._events=new a:delete e._events[t]}function d(){this._events=new a,this._eventsCount=0}Object.create&&(a.prototype=Object.create(null),(new a).__proto__||(n=!1)),d.prototype.eventNames=function(){var e,t,i=[];if(0===this._eventsCount)return i;for(t in e=this._events)s.call(e,t)&&i.push(n?t.slice(1):t);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},d.prototype.listeners=function(e){var t=n?n+e:e,i=this._events[t];if(!i)return[];if(i.fn)return[i.fn];for(var s=0,a=i.length,r=new Array(a);s<a;s++)r[s]=i[s].fn;return r},d.prototype.listenerCount=function(e){var t=n?n+e:e,i=this._events[t];return i?i.fn?1:i.length:0},d.prototype.emit=function(e,t,i,s,a,r){var o=n?n+e:e;if(!this._events[o])return!1;var l,d,u=this._events[o],c=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),c){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,i),!0;case 4:return u.fn.call(u.context,t,i,s),!0;case 5:return u.fn.call(u.context,t,i,s,a),!0;case 6:return u.fn.call(u.context,t,i,s,a,r),!0}for(d=1,l=new Array(c-1);d<c;d++)l[d-1]=arguments[d];u.fn.apply(u.context,l)}else{var h,p=u.length;for(d=0;d<p;d++)switch(u[d].once&&this.removeListener(e,u[d].fn,void 0,!0),c){case 1:u[d].fn.call(u[d].context);break;case 2:u[d].fn.call(u[d].context,t);break;case 3:u[d].fn.call(u[d].context,t,i);break;case 4:u[d].fn.call(u[d].context,t,i,s);break;default:if(!l)for(h=1,l=new Array(c-1);h<c;h++)l[h-1]=arguments[h];u[d].fn.apply(u[d].context,l)}}return!0},d.prototype.on=function(e,t,i){return o(this,e,t,i,!1)},d.prototype.once=function(e,t,i){return o(this,e,t,i,!0)},d.prototype.removeListener=function(e,t,i,s){var a=n?n+e:e;if(!this._events[a])return this;if(!t)return l(this,a),this;var r=this._events[a];if(r.fn)r.fn!==t||s&&!r.once||i&&r.context!==i||l(this,a);else{for(var o=0,d=[],u=r.length;o<u;o++)(r[o].fn!==t||s&&!r[o].once||i&&r[o].context!==i)&&d.push(r[o]);d.length?this._events[a]=1===d.length?d[0]:d:l(this,a)}return this},d.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&l(this,t)):(this._events=new a,this._eventsCount=0),this},d.prototype.off=d.prototype.removeListener,d.prototype.addListener=d.prototype.on,d.prefixed=n,d.EventEmitter=d,e.exports=d},"./node_modules/node-libs-browser/node_modules/events/events.js":function(e,t){function i(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function s(e){return"function"==typeof e}function n(e){return"object"==typeof e&&null!==e}function a(e){return void 0===e}e.exports=i,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._maxListeners=void 0,i.defaultMaxListeners=10,i.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},i.prototype.emit=function(e){var t,i,r,o,l,d;if(this._events||(this._events={}),"error"===e&&(!this._events.error||n(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var u=new Error('Uncaught, unspecified "error" event. ('+t+")");throw u.context=t,u}if(a(i=this._events[e]))return!1;if(s(i))switch(arguments.length){case 1:i.call(this);break;case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:o=Array.prototype.slice.call(arguments,1),i.apply(this,o)}else if(n(i))for(o=Array.prototype.slice.call(arguments,1),r=(d=i.slice()).length,l=0;l<r;l++)d[l].apply(this,o);return!0},i.prototype.addListener=function(e,t){var r;if(!s(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,s(t.listener)?t.listener:t),this._events[e]?n(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,n(this._events[e])&&!this._events[e].warned&&(r=a(this._maxListeners)?i.defaultMaxListeners:this._maxListeners)&&r>0&&this._events[e].length>r&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},i.prototype.on=i.prototype.addListener,i.prototype.once=function(e,t){if(!s(t))throw TypeError("listener must be a function");var i=!1;function n(){this.removeListener(e,n),i||(i=!0,t.apply(this,arguments))}return n.listener=t,this.on(e,n),this},i.prototype.removeListener=function(e,t){var i,a,r,o;if(!s(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(r=(i=this._events[e]).length,a=-1,i===t||s(i.listener)&&i.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(n(i)){for(o=r;o-- >0;)if(i[o]===t||i[o].listener&&i[o].listener===t){a=o;break}if(a<0)return this;1===i.length?(i.length=0,delete this._events[e]):i.splice(a,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},i.prototype.removeAllListeners=function(e){var t,i;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(s(i=this._events[e]))this.removeListener(e,i);else if(i)for(;i.length;)this.removeListener(e,i[i.length-1]);return delete this._events[e],this},i.prototype.listeners=function(e){return this._events&&this._events[e]?s(this._events[e])?[this._events[e]]:this._events[e].slice():[]},i.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(s(t))return 1;if(t)return t.length}return 0},i.listenerCount=function(e,t){return e.listenerCount(t)}},"./node_modules/url-toolkit/src/url-toolkit.js":function(e,t,i){var s,n,a,r,o;s=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/\?#]*\/)*.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,n=/^([^\/?#]*)(.*)$/,a=/(?:\/|^)\.(?=\/)/g,r=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,o={buildAbsoluteURL:function(e,t,i){if(i=i||{},e=e.trim(),!(t=t.trim())){if(!i.alwaysNormalize)return e;var s=o.parseURL(e);if(!s)throw new Error("Error trying to parse base URL.");return s.path=o.normalizePath(s.path),o.buildURLFromParts(s)}var a=o.parseURL(t);if(!a)throw new Error("Error trying to parse relative URL.");if(a.scheme)return i.alwaysNormalize?(a.path=o.normalizePath(a.path),o.buildURLFromParts(a)):t;var r=o.parseURL(e);if(!r)throw new Error("Error trying to parse base URL.");if(!r.netLoc&&r.path&&"/"!==r.path[0]){var l=n.exec(r.path);r.netLoc=l[1],r.path=l[2]}r.netLoc&&!r.path&&(r.path="/");var d={scheme:r.scheme,netLoc:a.netLoc,path:null,params:a.params,query:a.query,fragment:a.fragment};if(!a.netLoc&&(d.netLoc=r.netLoc,"/"!==a.path[0]))if(a.path){var u=r.path,c=u.substring(0,u.lastIndexOf("/")+1)+a.path;d.path=o.normalizePath(c)}else d.path=r.path,a.params||(d.params=r.params,a.query||(d.query=r.query));return null===d.path&&(d.path=i.alwaysNormalize?o.normalizePath(a.path):a.path),o.buildURLFromParts(d)},parseURL:function(e){var t=s.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(a,"");e.length!==(e=e.replace(r,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}},e.exports=o},"./node_modules/webworkify-webpack/index.js":function(e,t,i){function s(e){var t={};function i(s){if(t[s])return t[s].exports;var n=t[s]={i:s,l:!1,exports:{}};return e[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=t,i.i=function(e){return e},i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:s})},i.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/",i.oe=function(e){throw console.error(e),e};var s=i(i.s=ENTRY_MODULE);return s.default||s}var n="[\\.|\\-|\\+|\\w|/|@]+",a="\\((/\\*.*?\\*/)?s?.*?("+n+").*?\\)";function r(e){return(e+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function o(e,t,s){var o={};o[s]=[];var l=t.toString(),d=l.match(/^function\s?\(\w+,\s*\w+,\s*(\w+)\)/);if(!d)return o;for(var u,c=d[1],h=new RegExp("(\\\\n|\\W)"+r(c)+a,"g");u=h.exec(l);)"dll-reference"!==u[3]&&o[s].push(u[3]);for(h=new RegExp("\\("+r(c)+'\\("(dll-reference\\s('+n+'))"\\)\\)'+a,"g");u=h.exec(l);)e[u[2]]||(o[s].push(u[1]),e[u[2]]=i(u[1]).m),o[u[2]]=o[u[2]]||[],o[u[2]].push(u[4]);for(var p,g=Object.keys(o),f=0;f<g.length;f++)for(var v=0;v<o[g[f]].length;v++)p=o[g[f]][v],isNaN(1*p)||(o[g[f]][v]=1*o[g[f]][v]);return o}function l(e){return Object.keys(e).reduce(function(t,i){return t||e[i].length>0},!1)}e.exports=function(e,t){t=t||{};var n={main:i.m},a=t.all?{main:Object.keys(n.main)}:function(e,t){for(var i={main:[t]},s={main:[]},n={main:{}};l(i);)for(var a=Object.keys(i),r=0;r<a.length;r++){var d=a[r],u=i[d].pop();if(n[d]=n[d]||{},!n[d][u]&&e[d][u]){n[d][u]=!0,s[d]=s[d]||[],s[d].push(u);for(var c=o(e,e[d][u],d),h=Object.keys(c),p=0;p<h.length;p++)i[h[p]]=i[h[p]]||[],i[h[p]]=i[h[p]].concat(c[h[p]])}}return s}(n,e),r="";Object.keys(a).filter(function(e){return"main"!==e}).forEach(function(e){for(var t=0;a[e][t];)t++;a[e].push(t),n[e][t]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",r=r+"var "+e+" = ("+s.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+a[e].map(function(t){return JSON.stringify(t)+": "+n[e][t].toString()}).join(",")+"});\n"}),r=r+"new (("+s.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+a.main.map(function(e){return JSON.stringify(e)+": "+n.main[e].toString()}).join(",")+"}))(self);";var d=new window.Blob([r],{type:"text/javascript"});if(t.bare)return d;var u=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(d),c=new window.Worker(u);return c.objectURL=u,c}},"./src/config.js":function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i("./src/controller/abr-controller.js"),n=i("./src/controller/buffer-controller.js"),a=i("./src/controller/cap-level-controller.js"),r=i("./src/controller/fps-controller.js"),o=i("./src/utils/xhr-loader.js"),l=i("./src/controller/audio-track-controller.js"),d=i("./src/controller/audio-stream-controller.js"),u=i("./src/utils/cues.js"),c=i("./src/controller/timeline-controller.js"),h=i("./src/controller/subtitle-track-controller.js"),p=i("./src/controller/subtitle-stream-controller.js"),g=i("./src/controller/eme-controller.js"),f=i("./src/utils/mediakeys-helper.js");t.hlsDefaultConfig={autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,liveDurationInfinity:!1,liveBackBufferLength:1/0,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:o.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,abrController:s.default,bufferController:n.default,capLevelController:a.default,fpsController:r.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,requestMediaKeySystemAccessFunc:f.requestMediaKeySystemAccess},t.hlsDefaultConfig.subtitleStreamController=p.SubtitleStreamController,t.hlsDefaultConfig.subtitleTrackController=h.default,t.hlsDefaultConfig.timelineController=c.default,t.hlsDefaultConfig.cueHandler=u,t.hlsDefaultConfig.enableCEA708Captions=!0,t.hlsDefaultConfig.enableWebVTT=!0,t.hlsDefaultConfig.captionsTextTrack1Label="English",t.hlsDefaultConfig.captionsTextTrack1LanguageCode="en",t.hlsDefaultConfig.captionsTextTrack2Label="Spanish",t.hlsDefaultConfig.captionsTextTrack2LanguageCode="es",t.hlsDefaultConfig.audioStreamController=d.default,t.hlsDefaultConfig.audioTrackController=l.default,t.hlsDefaultConfig.emeController=g.default},"./src/controller/abr-controller.js":function(e,t,i){(function(e){var s,n=this&&this.__extends||(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},function(e,t){function i(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0});var a=i("./src/events.js"),r=i("./src/event-handler.js"),o=i("./src/utils/buffer-helper.js"),l=i("./src/errors.js"),d=i("./src/utils/logger.js"),u=i("./src/utils/ewma-bandwidth-estimator.js"),c=window.performance,h=function(t){function i(e){var i=t.call(this,e,a.default.FRAG_LOADING,a.default.FRAG_LOADED,a.default.FRAG_BUFFERED,a.default.ERROR)||this;return i.lastLoadedFragLevel=0,i._nextAutoLevel=-1,i.hls=e,i.timer=null,i._bwEstimator=null,i.onCheck=i._abandonRulesCheck.bind(i),i}return n(i,t),i.prototype.destroy=function(){this.clearTimer(),r.default.prototype.destroy.call(this)},i.prototype.onFragLoading=function(e){var t=e.frag;if("main"===t.type&&(this.timer||(this.fragCurrent=t,this.timer=setInterval(this.onCheck,100)),!this._bwEstimator)){var i=this.hls,s=i.config,n=t.level,a=void 0,r=void 0;i.levels[n].details.live?(a=s.abrEwmaFastLive,r=s.abrEwmaSlowLive):(a=s.abrEwmaFastVoD,r=s.abrEwmaSlowVoD),this._bwEstimator=new u.default(i,r,a,s.abrEwmaDefaultEstimate)}},i.prototype._abandonRulesCheck=function(){var e=this.hls,t=e.media,i=this.fragCurrent;if(i){var s=i.loader,n=e.minAutoLevel;if(!s||s.stats&&s.stats.aborted)return d.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);var r=s.stats;if(t&&r&&(!t.paused&&0!==t.playbackRate||!t.readyState)&&i.autoLevel&&i.level){var l=c.now()-r.trequest,u=Math.abs(t.playbackRate);if(l>500*i.duration/u){var h=e.levels,p=Math.max(1,r.bw?r.bw/8:1e3*r.loaded/l),g=h[i.level],f=g.realBitrate?Math.max(g.realBitrate,g.bitrate):g.bitrate,v=r.total?r.total:Math.max(r.loaded,Math.round(i.duration*f/8)),m=t.currentTime,_=(v-r.loaded)/p,E=(o.BufferHelper.bufferInfo(t,m,e.config.maxBufferHole).end-m)/u;if(E<2*i.duration/u&&_>E){var A=void 0,y=void 0;for(y=i.level-1;y>n;y--){var S=h[y].realBitrate?Math.max(h[y].realBitrate,h[y].bitrate):h[y].bitrate;if((A=i.duration*S/(6.4*p))<E)break}A<_&&(d.logger.warn("loading too slow, abort fragment loading and switch to level "+y+":fragLoadedDelay["+y+"]<fragLoadedDelay["+(i.level-1)+"];bufferStarvationDelay:"+A.toFixed(1)+"<"+_.toFixed(1)+":"+E.toFixed(1)),e.nextLoadLevel=y,this._bwEstimator.sample(l,r.loaded),s.abort(),this.clearTimer(),e.trigger(a.default.FRAG_LOAD_EMERGENCY_ABORTED,{frag:i,stats:r}))}}}}},i.prototype.onFragLoaded=function(t){var i=t.frag;if("main"===i.type&&e.isFinite(i.sn)){if(this.clearTimer(),this.lastLoadedFragLevel=i.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var s=this.hls.levels[i.level],n=(s.loaded?s.loaded.bytes:0)+t.stats.loaded,a=(s.loaded?s.loaded.duration:0)+t.frag.duration;s.loaded={bytes:n,duration:a},s.realBitrate=Math.round(8*n/a)}if(t.frag.bitrateTest){var r=t.stats;r.tparsed=r.tbuffered=r.tload,this.onFragBuffered(t)}}},i.prototype.onFragBuffered=function(t){var i=t.stats,s=t.frag;if(!0!==i.aborted&&"main"===s.type&&e.isFinite(s.sn)&&(!s.bitrateTest||i.tload===i.tbuffered)){var n=i.tparsed-i.trequest;d.logger.log("latency/loading/parsing/append/kbps:"+Math.round(i.tfirst-i.trequest)+"/"+Math.round(i.tload-i.tfirst)+"/"+Math.round(i.tparsed-i.tload)+"/"+Math.round(i.tbuffered-i.tparsed)+"/"+Math.round(8*i.loaded/(i.tbuffered-i.trequest))),this._bwEstimator.sample(n,i.loaded),i.bwEstimate=this._bwEstimator.getEstimate(),s.bitrateTest?this.bitrateTestDelay=n/1e3:this.bitrateTestDelay=0}},i.prototype.onError=function(e){switch(e.details){case l.ErrorDetails.FRAG_LOAD_ERROR:case l.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}},i.prototype.clearTimer=function(){clearInterval(this.timer),this.timer=null},Object.defineProperty(i.prototype,"nextAutoLevel",{get:function(){var e=this._nextAutoLevel,t=this._bwEstimator;if(!(-1===e||t&&t.canEstimate()))return e;var i=this._nextABRAutoLevel;return-1!==e&&(i=Math.min(e,i)),i},set:function(e){this._nextAutoLevel=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"_nextABRAutoLevel",{get:function(){var e=this.hls,t=e.maxAutoLevel,i=e.levels,s=e.config,n=e.minAutoLevel,a=e.media,r=this.lastLoadedFragLevel,l=this.fragCurrent?this.fragCurrent.duration:0,u=a?a.currentTime:0,c=a&&0!==a.playbackRate?Math.abs(a.playbackRate):1,h=this._bwEstimator?this._bwEstimator.getEstimate():s.abrEwmaDefaultEstimate,p=(o.BufferHelper.bufferInfo(a,u,s.maxBufferHole).end-u)/c,g=this._findBestLevel(r,l,h,n,t,p,s.abrBandWidthFactor,s.abrBandWidthUpFactor,i);if(g>=0)return g;d.logger.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");var f=l?Math.min(l,s.maxStarvationDelay):s.maxStarvationDelay,v=s.abrBandWidthFactor,m=s.abrBandWidthUpFactor;if(0===p){var _=this.bitrateTestDelay;if(_)f=(l?Math.min(l,s.maxLoadingDelay):s.maxLoadingDelay)-_,d.logger.trace("bitrate test took "+Math.round(1e3*_)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*f)+" ms"),v=m=1}return g=this._findBestLevel(r,l,h,n,t,p+f,v,m,i),Math.max(g,0)},enumerable:!0,configurable:!0}),i.prototype._findBestLevel=function(e,t,i,s,n,a,r,o,l){for(var u=n;u>=s;u--){var c=l[u];if(c){var h=c.details,p=h?h.totalduration/h.fragments.length:t,g=!!h&&h.live,f=void 0;f=u<=e?r*i:o*i;var v=l[u].realBitrate?Math.max(l[u].realBitrate,l[u].bitrate):l[u].bitrate,m=v*p/f;if(d.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+u+"/"+Math.round(f)+"/"+v+"/"+p+"/"+a+"/"+m),f>v&&(!m||g&&!this.bitrateTestDelay||m<a))return u}}return-1},i}(r.default);t.default=h}).call(this,i("./src/polyfills/number.js").Number)},"./src/controller/audio-stream-controller.js":function(e,t,i){(function(e){var s,n=this&&this.__extends||(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},function(e,t){function i(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0});var a=i("./src/utils/binary-search.js"),r=i("./src/utils/buffer-helper.js"),o=i("./src/demux/demuxer.js"),l=i("./src/events.js"),d=i("./src/controller/level-helper.js"),u=i("./src/utils/time-ranges.js"),c=i("./src/errors.js"),h=i("./src/utils/logger.js"),p=i("./src/utils/discontinuities.js"),g=i("./src/controller/fragment-tracker.js"),f=i("./src/loader/fragment.js"),v=i("./src/controller/base-stream-controller.js"),m=window.performance,_=function(t){function i(e,i){var s=t.call(this,e,l.default.MEDIA_ATTACHED,l.default.MEDIA_DETACHING,l.default.AUDIO_TRACKS_UPDATED,l.default.AUDIO_TRACK_SWITCHING,l.default.AUDIO_TRACK_LOADED,l.default.KEY_LOADED,l.default.FRAG_LOADED,l.default.FRAG_PARSING_INIT_SEGMENT,l.default.FRAG_PARSING_DATA,l.default.FRAG_PARSED,l.default.ERROR,l.default.BUFFER_RESET,l.default.BUFFER_CREATED,l.default.BUFFER_APPENDED,l.default.BUFFER_FLUSHED,l.default.INIT_PTS_FOUND)||this;return s.fragmentTracker=i,s.config=e.config,s.audioCodecSwap=!1,s._state=v.State.STOPPED,s.initPTS=[],s.waitingFragment=null,s.videoTrackCC=null,s}return n(i,t),i.prototype.onInitPtsFound=function(e){var t=e.id,i=e.frag.cc,s=e.initPTS;"main"===t&&(this.initPTS[i]=s,this.videoTrackCC=i,h.logger.log("InitPTS for cc: "+i+" found from video track: "+s),this.state===v.State.WAITING_INIT_PTS&&this.tick())},i.prototype.startLoad=function(e){if(this.tracks){var t=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),this.fragLoadError=0,t>0&&-1===e?(h.logger.log("audio:override startPosition with lastCurrentTime @"+t.toFixed(3)),this.state=v.State.IDLE):(this.lastCurrentTime=this.startPosition?this.startPosition:e,this.state=v.State.STARTING),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else this.startPosition=e,this.state=v.State.STOPPED},Object.defineProperty(i.prototype,"state",{get:function(){return this._state},set:function(e){if(this.state!==e){var t=this.state;this._state=e,h.logger.log("audio stream:"+t+"->"+e)}},enumerable:!0,configurable:!0}),i.prototype.doTick=function(){var t,i,s,n=this.hls,o=n.config;switch(this.state){case v.State.ERROR:case v.State.PAUSED:case v.State.BUFFER_FLUSHING:break;case v.State.STARTING:this.state=v.State.WAITING_TRACK,this.loadedmetadata=!1;break;case v.State.IDLE:var d=this.tracks;if(!d)break;if(!this.media&&(this.startFragRequested||!o.startFragPrefetch))break;if(this.loadedmetadata)t=this.media.currentTime;else if(void 0===(t=this.nextLoadPosition))break;var u=this.mediaBuffer?this.mediaBuffer:this.media,c=this.videoBuffer?this.videoBuffer:this.media,f=r.BufferHelper.bufferInfo(u,t,o.maxBufferHole),_=r.BufferHelper.bufferInfo(c,t,o.maxBufferHole),E=f.len,A=f.end,y=this.fragPrevious,S=Math.min(o.maxBufferLength,o.maxMaxBufferLength),b=Math.max(S,_.len),T=this.audioSwitch,C=this.trackId;if((E<b||T)&&C<d.length){if(void 0===(s=d[C].details)){this.state=v.State.WAITING_TRACK;break}if(!T&&this._streamEnded(f,s))return this.hls.trigger(l.default.BUFFER_EOS,{type:"audio"}),void(this.state=v.State.ENDED);var I=s.fragments,D=I.length,R=I[0].start,P=I[D-1].start+I[D-1].duration,M=void 0;if(T)if(s.live&&!s.PTSKnown)h.logger.log("switching audiotrack, live stream, unknown PTS,load first fragment"),A=0;else if(A=t,s.PTSKnown&&t<R){if(!(f.end>R||f.nextStart))return;h.logger.log("alt audio track ahead of main track, seek to start of alt audio track"),this.media.currentTime=R+.05}if(s.initSegment&&!s.initSegment.data)M=s.initSegment;else if(A<=R){if(M=I[0],null!==this.videoTrackCC&&M.cc!==this.videoTrackCC&&(M=p.findFragWithCC(I,this.videoTrackCC)),s.live&&M.loadIdx&&M.loadIdx===this.fragLoadIdx){var k=f.nextStart?f.nextStart:R;return h.logger.log("no alt audio available @currentTime:"+this.media.currentTime+", seeking @"+(k+.05)),void(this.media.currentTime=k+.05)}}else{var w=void 0,O=o.maxFragLookUpTolerance,L=y?I[y.sn-I[0].sn+1]:void 0,N=function(e){var t=Math.min(O,e.duration);return e.start+e.duration-t<=A?1:e.start-t>A&&e.start?-1:0};A<P?(A>P-O&&(O=0),w=L&&!N(L)?L:a.default.search(I,N)):w=I[D-1],w&&(M=w,R=w.start,y&&M.level===y.level&&M.sn===y.sn&&(M.sn<s.endSN?(M=I[M.sn+1-s.startSN],h.logger.log("SN just loaded, load next one: "+M.sn)):M=null))}M&&(M.encrypted?(h.logger.log("Loading key for "+M.sn+" of ["+s.startSN+" ,"+s.endSN+"],track "+C),this.state=v.State.KEY_LOADING,n.trigger(l.default.KEY_LOADING,{frag:M})):(h.logger.log("Loading "+M.sn+", cc: "+M.cc+" of ["+s.startSN+" ,"+s.endSN+"],track "+C+", currentTime:"+t+",bufferEnd:"+A.toFixed(3)),this.fragCurrent=M,(T||this.fragmentTracker.getState(M)===g.FragmentState.NOT_LOADED)&&(this.startFragRequested=!0,e.isFinite(M.sn)&&(this.nextLoadPosition=M.start+M.duration),n.trigger(l.default.FRAG_LOADING,{frag:M}),this.state=v.State.FRAG_LOADING)))}break;case v.State.WAITING_TRACK:(i=this.tracks[this.trackId])&&i.details&&(this.state=v.State.IDLE);break;case v.State.FRAG_LOADING_WAITING_RETRY:var U=m.now(),B=this.retryDate,j=(u=this.media)&&u.seeking;(!B||U>=B||j)&&(h.logger.log("audioStreamController: retryDate reached, switch back to IDLE state"),this.state=v.State.IDLE);break;case v.State.WAITING_INIT_PTS:var x=this.videoTrackCC;if(void 0===this.initPTS[x])break;var F=this.waitingFragment;if(F){var G=F.frag.cc;x!==G?(i=this.tracks[this.trackId]).details&&i.details.live&&(h.logger.warn("Waiting fragment CC ("+G+") does not match video track CC ("+x+")"),this.waitingFragment=null,this.state=v.State.IDLE):(this.state=v.State.FRAG_LOADING,this.onFragLoaded(this.waitingFragment),this.waitingFragment=null)}else this.state=v.State.IDLE;break;case v.State.STOPPED:case v.State.FRAG_LOADING:case v.State.PARSING:case v.State.PARSED:case v.State.ENDED:}},i.prototype.onMediaAttached=function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("ended",this.onvended);var i=this.config;this.tracks&&i.autoStartLoad&&this.startLoad(i.startPosition)},i.prototype.onMediaDetaching=function(){var e=this.media;e&&e.ended&&(h.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1,this.stopLoad()},i.prototype.onAudioTracksUpdated=function(e){h.logger.log("audio tracks updated"),this.tracks=e.audioTracks},i.prototype.onAudioTrackSwitching=function(e){var t=!!e.url;this.trackId=e.id,this.fragCurrent=null,this.state=v.State.PAUSED,this.waitingFragment=null,t?this.setInterval(100):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),t&&(this.audioSwitch=!0,this.state=v.State.IDLE),this.tick()},i.prototype.onAudioTrackLoaded=function(t){var i=t.details,s=t.id,n=this.tracks[s],a=i.totalduration,r=0;if(h.logger.log("track "+s+" loaded ["+i.startSN+","+i.endSN+"],duration:"+a),i.live){var o=n.details;o&&i.fragments.length>0?(d.mergeDetails(o,i),r=i.fragments[0].start,i.PTSKnown?h.logger.log("live audio playlist sliding:"+r.toFixed(3)):h.logger.log("live audio playlist - outdated PTS, unknown sliding")):(i.PTSKnown=!1,h.logger.log("live audio playlist - first load, unknown sliding"))}else i.PTSKnown=!1;if(n.details=i,!this.startFragRequested){if(-1===this.startPosition){var l=i.startTimeOffset;e.isFinite(l)?(h.logger.log("start time offset found in playlist, adjust startPosition to "+l),this.startPosition=l):this.startPosition=0}this.nextLoadPosition=this.startPosition}this.state===v.State.WAITING_TRACK&&(this.state=v.State.IDLE),this.tick()},i.prototype.onKeyLoaded=function(){this.state===v.State.KEY_LOADING&&(this.state=v.State.IDLE,this.tick())},i.prototype.onFragLoaded=function(e){var t=this.fragCurrent,i=e.frag;if(this.state===v.State.FRAG_LOADING&&t&&"audio"===i.type&&i.level===t.level&&i.sn===t.sn){var s=this.tracks[this.trackId],n=s.details,a=n.totalduration,r=t.level,d=t.sn,u=t.cc,c=this.config.defaultAudioCodec||s.audioCodec||"mp4a.40.2",p=this.stats=e.stats;if("initSegment"===d)this.state=v.State.IDLE,p.tparsed=p.tbuffered=m.now(),n.initSegment.data=e.payload,this.hls.trigger(l.default.FRAG_BUFFERED,{stats:p,frag:t,id:"audio"}),this.tick();else{this.state=v.State.PARSING,this.appended=!1,this.demuxer||(this.demuxer=new o.default(this.hls,"audio"));var g=this.initPTS[u],f=n.initSegment?n.initSegment.data:[];if(n.initSegment||void 0!==g){this.pendingBuffering=!0,h.logger.log("Demuxing "+d+" of ["+n.startSN+" ,"+n.endSN+"],track "+r);this.demuxer.push(e.payload,f,c,null,t,a,!1,g)}else h.logger.log("unknown video PTS for continuity counter "+u+", waiting for video PTS before demuxing audio frag "+d+" of ["+n.startSN+" ,"+n.endSN+"],track "+r),this.waitingFragment=e,this.state=v.State.WAITING_INIT_PTS}}this.fragLoadError=0},i.prototype.onFragParsingInitSegment=function(e){var t=this.fragCurrent,i=e.frag;if(t&&"audio"===e.id&&i.sn===t.sn&&i.level===t.level&&this.state===v.State.PARSING){var s=e.tracks,n=void 0;if(s.video&&delete s.video,n=s.audio){n.levelCodec=n.codec,n.id=e.id,this.hls.trigger(l.default.BUFFER_CODECS,s),h.logger.log("audio track:audio,container:"+n.container+",codecs[level/parsed]=["+n.levelCodec+"/"+n.codec+"]");var a=n.initSegment;if(a){var r={type:"audio",data:a,parent:"audio",content:"initSegment"};this.audioSwitch?this.pendingData=[r]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(l.default.BUFFER_APPENDING,r))}this.tick()}}},i.prototype.onFragParsingData=function(t){var i=this,s=this.fragCurrent,n=t.frag;if(s&&"audio"===t.id&&"audio"===t.type&&n.sn===s.sn&&n.level===s.level&&this.state===v.State.PARSING){var a=this.trackId,r=this.tracks[a],o=this.hls;e.isFinite(t.endPTS)||(t.endPTS=t.startPTS+s.duration,t.endDTS=t.startDTS+s.duration),s.addElementaryStream(f.default.ElementaryStreamTypes.AUDIO),h.logger.log("parsed "+t.type+",PTS:["+t.startPTS.toFixed(3)+","+t.endPTS.toFixed(3)+"],DTS:["+t.startDTS.toFixed(3)+"/"+t.endDTS.toFixed(3)+"],nb:"+t.nb),d.updateFragPTSDTS(r.details,s,t.startPTS,t.endPTS);var u=this.audioSwitch,p=this.media,g=!1;if(u&&p)if(p.readyState){var m=p.currentTime;h.logger.log("switching audio track : currentTime:"+m),m>=t.startPTS&&(h.logger.log("switching audio track : flushing all audio"),this.state=v.State.BUFFER_FLUSHING,o.trigger(l.default.BUFFER_FLUSHING,{startOffset:0,endOffset:e.POSITIVE_INFINITY,type:"audio"}),g=!0,this.audioSwitch=!1,o.trigger(l.default.AUDIO_TRACK_SWITCHED,{id:a}))}else this.audioSwitch=!1,o.trigger(l.default.AUDIO_TRACK_SWITCHED,{id:a});var _=this.pendingData;if(!_)return h.logger.warn("Apparently attempt to enqueue media payload without codec initialization data upfront"),void o.trigger(l.default.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,details:null,fatal:!0});this.audioSwitch||([t.data1,t.data2].forEach(function(e){e&&e.length&&_.push({type:t.type,data:e,parent:"audio",content:"data"})}),!g&&_.length&&(_.forEach(function(e){i.state===v.State.PARSING&&(i.pendingBuffering=!0,i.hls.trigger(l.default.BUFFER_APPENDING,e))}),this.pendingData=[],this.appended=!0)),this.tick()}},i.prototype.onFragParsed=function(e){var t=this.fragCurrent,i=e.frag;t&&"audio"===e.id&&i.sn===t.sn&&i.level===t.level&&this.state===v.State.PARSING&&(this.stats.tparsed=m.now(),this.state=v.State.PARSED,this._checkAppendedParsed())},i.prototype.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},i.prototype.onBufferCreated=function(e){var t=e.tracks.audio;t&&(this.mediaBuffer=t.buffer,this.loadedmetadata=!0),e.tracks.video&&(this.videoBuffer=e.tracks.video.buffer)},i.prototype.onBufferAppended=function(e){if("audio"===e.parent){var t=this.state;t!==v.State.PARSING&&t!==v.State.PARSED||(this.pendingBuffering=e.pending>0,this._checkAppendedParsed())}},i.prototype._checkAppendedParsed=function(){if(!(this.state!==v.State.PARSED||this.appended&&this.pendingBuffering)){var e=this.fragCurrent,t=this.stats,i=this.hls;if(e){this.fragPrevious=e,t.tbuffered=m.now(),i.trigger(l.default.FRAG_BUFFERED,{stats:t,frag:e,id:"audio"});var s=this.mediaBuffer?this.mediaBuffer:this.media;h.logger.log("audio buffered : "+u.default.toString(s.buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,i.trigger(l.default.AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=v.State.IDLE}this.tick()}},i.prototype.onError=function(t){var i=t.frag;if(!i||"audio"===i.type)switch(t.details){case c.ErrorDetails.FRAG_LOAD_ERROR:case c.ErrorDetails.FRAG_LOAD_TIMEOUT:var s=t.frag;if(s&&"audio"!==s.type)break;if(!t.fatal){var n=this.fragLoadError;if(n?n++:n=1,n<=(o=this.config).fragLoadingMaxRetry){this.fragLoadError=n;var a=Math.min(Math.pow(2,n-1)*o.fragLoadingRetryDelay,o.fragLoadingMaxRetryTimeout);h.logger.warn("AudioStreamController: frag loading failed, retry in "+a+" ms"),this.retryDate=m.now()+a,this.state=v.State.FRAG_LOADING_WAITING_RETRY}else h.logger.error("AudioStreamController: "+t.details+" reaches max retry, redispatch as fatal ..."),t.fatal=!0,this.state=v.State.ERROR}break;case c.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case c.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case c.ErrorDetails.KEY_LOAD_ERROR:case c.ErrorDetails.KEY_LOAD_TIMEOUT:this.state!==v.State.ERROR&&(this.state=t.fatal?v.State.ERROR:v.State.IDLE,h.logger.warn("AudioStreamController: "+t.details+" while loading frag, now switching to "+this.state+" state ..."));break;case c.ErrorDetails.BUFFER_FULL_ERROR:if("audio"===t.parent&&(this.state===v.State.PARSING||this.state===v.State.PARSED)){var o,d=this.mediaBuffer,u=this.media.currentTime;if(d&&r.BufferHelper.isBuffered(d,u)&&r.BufferHelper.isBuffered(d,u+.5))(o=this.config).maxMaxBufferLength>=o.maxBufferLength&&(o.maxMaxBufferLength/=2,h.logger.warn("AudioStreamController: reduce max buffer length to "+o.maxMaxBufferLength+"s")),this.state=v.State.IDLE;else h.logger.warn("AudioStreamController: buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,this.state=v.State.BUFFER_FLUSHING,this.hls.trigger(l.default.BUFFER_FLUSHING,{startOffset:0,endOffset:e.POSITIVE_INFINITY,type:"audio"})}}},i.prototype.onBufferFlushed=function(){var e=this,t=this.pendingData;t&&t.length?(h.logger.log("AudioStreamController: appending pending audio data after buffer flushed"),t.forEach(function(t){e.hls.trigger(l.default.BUFFER_APPENDING,t)}),this.appended=!0,this.pendingData=[],this.state=v.State.PARSED):(this.state=v.State.IDLE,this.fragPrevious=null,this.tick())},i}(v.default);t.default=_}).call(this,i("./src/polyfills/number.js").Number)},"./src/controller/audio-track-controller.js":function(e,t,i){var s,n=this&&this.__extends||(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},function(e,t){function i(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0});var a=i("./src/events.js"),r=i("./src/task-loop.js"),o=i("./src/utils/logger.js"),l=i("./src/errors.js"),d=function(e){function t(t){var i=e.call(this,t,a.default.MANIFEST_LOADING,a.default.MANIFEST_PARSED,a.default.AUDIO_TRACK_LOADED,a.default.AUDIO_TRACK_SWITCHED,a.default.LEVEL_LOADED,a.default.ERROR)||this;return i._trackId=-1,i._selectDefaultTrack=!0,i.tracks=[],i.trackIdBlacklist=Object.create(null),i.audioGroupId=null,i}return n(t,e),t.prototype.onManifestLoading=function(){this.tracks=[],this._trackId=-1,this._selectDefaultTrack=!0},t.prototype.onManifestParsed=function(e){var t=this.tracks=e.audioTracks||[];this.hls.trigger(a.default.AUDIO_TRACKS_UPDATED,{audioTracks:t})},t.prototype.onAudioTrackLoaded=function(e){if(e.id>=this.tracks.length)o.logger.warn("Invalid audio track id:",e.id);else{if(o.logger.log("audioTrack "+e.id+" loaded"),this.tracks[e.id].details=e.details,e.details.live&&!this.hasInterval()){var t=1e3*e.details.targetduration;this.setInterval(t)}!e.details.live&&this.hasInterval()&&this.clearInterval()}},t.prototype.onAudioTrackSwitched=function(e){var t=this.tracks[e.id].groupId;t&&this.audioGroupId!==t&&(this.audioGroupId=t)},t.prototype.onLevelLoaded=function(e){var t=this.hls.levels[e.level];if(t.audioGroupIds){var i=t.audioGroupIds[t.urlId];this.audioGroupId!==i&&(this.audioGroupId=i,this._selectInitialAudioTrack())}},t.prototype.onError=function(e){e.type===l.ErrorTypes.NETWORK_ERROR&&(e.fatal&&this.clearInterval(),e.details===l.ErrorDetails.AUDIO_TRACK_LOAD_ERROR&&(o.logger.warn("Network failure on audio-track id:",e.context.id),this._handleLoadError()))},Object.defineProperty(t.prototype,"audioTracks",{get:function(){return this.tracks},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"audioTrack",{get:function(){return this._trackId},set:function(e){this._setAudioTrack(e),this._selectDefaultTrack=!1},enumerable:!0,configurable:!0}),t.prototype._setAudioTrack=function(e){if(this._trackId===e&&this.tracks[this._trackId].details)o.logger.debug("Same id as current audio-track passed, and track details available -> no-op");else if(e<0||e>=this.tracks.length)o.logger.warn("Invalid id passed to audio-track controller");else{var t=this.tracks[e];o.logger.log("Now switching to audio-track index "+e),this.clearInterval(),this._trackId=e;var i=t.url,s=t.type,n=t.id;this.hls.trigger(a.default.AUDIO_TRACK_SWITCHING,{id:n,type:s,url:i}),this._loadTrackDetailsIfNeeded(t)}},t.prototype.doTick=function(){this._updateTrack(this._trackId)},t.prototype._selectInitialAudioTrack=function(){var e=this,t=this.tracks;if(t.length){var i=this.tracks[this._trackId],s=null;if(i&&(s=i.name),this._selectDefaultTrack){var n=t.filter(function(e){return e.default});n.length?t=n:o.logger.warn("No default audio tracks defined")}var r=!1,d=function(){t.forEach(function(t){r||e.audioGroupId&&t.groupId!==e.audioGroupId||s&&s!==t.name||(e._setAudioTrack(t.id),r=!0)})};d(),r||(s=null,d()),r||(o.logger.error("No track found for running audio group-ID: "+this.audioGroupId),this.hls.trigger(a.default.ERROR,{type:l.ErrorTypes.MEDIA_ERROR,details:l.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))}},t.prototype._needsTrackLoading=function(e){var t=e.details,i=e.url;return!(t&&!t.live)&&!!i},t.prototype._loadTrackDetailsIfNeeded=function(e){if(this._needsTrackLoading(e)){var t=e.url,i=e.id;o.logger.log("loading audio-track playlist for id: "+i),this.hls.trigger(a.default.AUDIO_TRACK_LOADING,{url:t,id:i})}},t.prototype._updateTrack=function(e){if(!(e<0||e>=this.tracks.length)){this.clearInterval(),this._trackId=e,o.logger.log("trying to update audio-track "+e);var t=this.tracks[e];this._loadTrackDetailsIfNeeded(t)}},t.prototype._handleLoadError=function(){this.trackIdBlacklist[this._trackId]=!0;var e=this._trackId,t=this.tracks[e],i=t.name,s=t.language,n=t.groupId;o.logger.warn("Loading failed on audio track id: "+e+", group-id: "+n+', name/language: "'+i+'" / "'+s+'"');for(var a=e,r=0;r<this.tracks.length;r++){if(!this.trackIdBlacklist[r])if(this.tracks[r].name===i){a=r;break}}a!==e?(o.logger.log("Attempting audio-track fallback id:",a,"group-id:",this.tracks[a].groupId),this._setAudioTrack(a)):o.logger.warn('No fallback audio-track found for name/language: "'+i+'" / "'+s+'"')},t}(r.default);t.default=d},"./src/controller/base-stream-controller.js":function(e,t,i){(function(e){var s,n=this&&this.__extends||(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},function(e,t){function i(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0});var a=i("./src/task-loop.js"),r=i("./src/controller/fragment-tracker.js"),o=i("./src/utils/buffer-helper.js"),l=i("./src/utils/logger.js");t.State={STOPPED:"STOPPED",STARTING:"STARTING",IDLE:"IDLE",PAUSED:"PAUSED",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};var d=function(i){function s(){return null!==i&&i.apply(this,arguments)||this}return n(s,i),s.prototype.doTick=function(){},s.prototype.startLoad=function(){},s.prototype.stopLoad=function(){var e=this.fragCurrent;e&&(e.loader&&e.loader.abort(),this.fragmentTracker.removeFragment(e)),this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=t.State.STOPPED},s.prototype._streamEnded=function(e,t){var i=this.fragCurrent,s=this.fragmentTracker;if(!t.live&&i&&!i.backtracked&&i.sn===t.endSN&&!e.nextStart){var n=s.getState(i);return n===r.FragmentState.PARTIAL||n===r.FragmentState.OK}return!1},s.prototype.onMediaSeeking=function(){var i=this.config,s=this.media,n=this.mediaBuffer,a=this.state,r=s?s.currentTime:null,d=o.BufferHelper.bufferInfo(n||s,r,this.config.maxBufferHole);if(e.isFinite(r)&&l.logger.log("media seeking to "+r.toFixed(3)),a===t.State.FRAG_LOADING){var u=this.fragCurrent;if(0===d.len&&u){var c=i.maxFragLookUpTolerance,h=u.start-c,p=u.start+u.duration+c;r<h||r>p?(u.loader&&(l.logger.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),u.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=t.State.IDLE):l.logger.log("seeking outside of buffer but within currently loaded fragment range")}}else a===t.State.ENDED&&(0===d.len&&(this.fragPrevious=null,this.fragCurrent=null),this.state=t.State.IDLE);s&&(this.lastCurrentTime=r),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=r),this.tick()},s.prototype.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},s.prototype.onHandlerDestroying=function(){this.stopLoad(),i.prototype.onHandlerDestroying.call(this)},s.prototype.onHandlerDestroyed=function(){this.state=t.State.STOPPED,this.fragmentTracker=null},s}(a.default);t.default=d}).call(this,i("./src/polyfills/number.js").Number)},"./src/controller/buffer-controller.js":function(e,t,i){(function(e){var s,n=this&&this.__extends||(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},function(e,t){function i(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0});var a=i("./src/events.js"),r=i("./src/event-handler.js"),o=i("./src/utils/logger.js"),l=i("./src/errors.js"),d=i("./src/utils/mediasource-helper.js").getMediaSource(),u=function(t){function i(e){var i=t.call(this,e,a.default.MEDIA_ATTACHING,a.default.MEDIA_DETACHING,a.default.MANIFEST_PARSED,a.default.BUFFER_RESET,a.default.BUFFER_APPENDING,a.default.BUFFER_CODECS,a.default.BUFFER_EOS,a.default.BUFFER_FLUSHING,a.default.LEVEL_PTS_UPDATED,a.default.LEVEL_UPDATED)||this;return i._msDuration=null,i._levelDuration=null,i._levelTargetDuration=10,i._live=null,i._objectUrl=null,i.bufferCodecEventsExpected=0,i.onsbue=i.onSBUpdateEnd.bind(i),i.onsbe=i.onSBUpdateError.bind(i),i.pendingTracks={},i.tracks={},i}return n(i,t),i.prototype.destroy=function(){r.default.prototype.destroy.call(this)},i.prototype.onLevelPtsUpdated=function(e){var t=e.type,i=this.tracks.audio;if("audio"===t&&i&&"audio/mpeg"===i.container){var s=this.sourceBuffer.audio;if(Math.abs(s.timestampOffset-e.start)>.1){var n=s.updating;try{s.abort()}catch(e){o.logger.warn("can not abort audio buffer: "+e)}n?this.audioTimestampOffset=e.start:(o.logger.warn("change mpeg audio timestamp offset from "+s.timestampOffset+" to "+e.start),s.timestampOffset=e.start)}}},i.prototype.onManifestParsed=function(e){this.bufferCodecEventsExpected=e.altAudio?2:1,o.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},i.prototype.onMediaAttaching=function(e){var t=this.media=e.media;if(t){var i=this.mediaSource=new d;this.onmso=this.onMediaSourceOpen.bind(this),this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),i.addEventListener("sourceopen",this.onmso),i.addEventListener("sourceended",this.onmse),i.addEventListener("sourceclose",this.onmsc),t.src=window.URL.createObjectURL(i),this._objectUrl=t.src}},i.prototype.onMediaDetaching=function(){o.logger.log("media source detaching");var e=this.mediaSource;if(e){if("open"===e.readyState)try{e.endOfStream()}catch(e){o.logger.warn("onMediaDetaching:"+e.message+" while calling endOfStream")}e.removeEventListener("sourceopen",this.onmso),e.removeEventListener("sourceended",this.onmse),e.removeEventListener("sourceclose",this.onmsc),this.media&&(window.URL.revokeObjectURL(this._objectUrl),this.media.src===this._objectUrl?(this.media.removeAttribute("src"),this.media.load()):o.logger.warn("media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.onmso=this.onmse=this.onmsc=null,this.hls.trigger(a.default.MEDIA_DETACHED)},i.prototype.onMediaSourceOpen=function(){o.logger.log("media source opened"),this.hls.trigger(a.default.MEDIA_ATTACHED,{media:this.media});var e=this.mediaSource;e&&e.removeEventListener("sourceopen",this.onmso),this.checkPendingTracks()},i.prototype.checkPendingTracks=function(){var e=this.bufferCodecEventsExpected,t=this.pendingTracks,i=Object.keys(t).length;(i&&!e||2===i)&&(this.createSourceBuffers(t),this.pendingTracks={},this.doAppending())},i.prototype.onMediaSourceClose=function(){o.logger.log("media source closed")},i.prototype.onMediaSourceEnded=function(){o.logger.log("media source ended")},i.prototype.onSBUpdateEnd=function(){if(this.audioTimestampOffset){var e=this.sourceBuffer.audio;o.logger.warn("change mpeg audio timestamp offset from "+e.timestampOffset+" to "+this.audioTimestampOffset),e.timestampOffset=this.audioTimestampOffset,delete this.audioTimestampOffset}this._needsFlush&&this.doFlush(),this._needsEos&&this.checkEos(),this.appending=!1;var t=this.parent,i=this.segments.reduce(function(e,i){return i.parent===t?e+1:e},0),s={},n=this.sourceBuffer;for(var r in n)s[r]=n[r].buffered;this.hls.trigger(a.default.BUFFER_APPENDED,{parent:t,pending:i,timeRanges:s}),this._needsFlush||this.doAppending(),this.updateMediaElementDuration(),0===i&&this.flushLiveBackBuffer()},i.prototype.onSBUpdateError=function(e){o.logger.error("sourceBuffer error:",e),this.hls.trigger(a.default.ERROR,{type:l.ErrorTypes.MEDIA_ERROR,details:l.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})},i.prototype.onBufferReset=function(){var e=this.sourceBuffer;for(var t in e){var i=e[t];try{this.mediaSource.removeSourceBuffer(i),i.removeEventListener("updateend",this.onsbue),i.removeEventListener("error",this.onsbe)}catch(e){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0},i.prototype.onBufferCodecs=function(e){var t=this;if(!Object.keys(this.sourceBuffer).length){Object.keys(e).forEach(function(i){t.pendingTracks[i]=e[i]});var i=this.mediaSource;this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),i&&"open"===i.readyState&&this.checkPendingTracks()}},i.prototype.createSourceBuffers=function(e){var t=this.sourceBuffer,i=this.mediaSource;for(var s in e)if(!t[s]){var n=e[s],r=n.levelCodec||n.codec,d=n.container+";codecs="+r;o.logger.log("creating sourceBuffer("+d+")");try{var u=t[s]=i.addSourceBuffer(d);u.addEventListener("updateend",this.onsbue),u.addEventListener("error",this.onsbe),this.tracks[s]={codec:r,container:n.container},n.buffer=u}catch(e){o.logger.error("error while trying to add sourceBuffer:"+e.message),this.hls.trigger(a.default.ERROR,{type:l.ErrorTypes.MEDIA_ERROR,details:l.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:e,mimeType:d})}}this.hls.trigger(a.default.BUFFER_CREATED,{tracks:e})},i.prototype.onBufferAppending=function(e){this._needsFlush||(this.segments?this.segments.push(e):this.segments=[e],this.doAppending())},i.prototype.onBufferAppendFail=function(e){o.logger.error("sourceBuffer error:",e.event),this.hls.trigger(a.default.ERROR,{type:l.ErrorTypes.MEDIA_ERROR,details:l.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})},i.prototype.onBufferEos=function(e){var t=this.sourceBuffer,i=e.type;for(var s in t)i&&s!==i||t[s].ended||(t[s].ended=!0,o.logger.log(s+" sourceBuffer now EOS"));this.checkEos()},i.prototype.checkEos=function(){var e=this.sourceBuffer,t=this.mediaSource;if(t&&"open"===t.readyState){for(var i in e){var s=e[i];if(!s.ended)return;if(s.updating)return void(this._needsEos=!0)}o.logger.log("all media data are available, signal endOfStream() to MediaSource and stop loading fragment");try{t.endOfStream()}catch(e){o.logger.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1}else this._needsEos=!1},i.prototype.onBufferFlushing=function(e){this.flushRange.push({start:e.startOffset,end:e.endOffset,type:e.type}),this.flushBufferCounter=0,this.doFlush()},i.prototype.flushLiveBackBuffer=function(){if(this._live){var e=this.hls.config.liveBackBufferLength;if(isFinite(e)&&!(e<0))for(var t=this.media.currentTime,i=this.sourceBuffer,s=Object.keys(i),n=t-Math.max(e,this._levelTargetDuration),a=s.length-1;a>=0;a--){var r=s[a],o=i[r].buffered;o.length>0&&n>o.start(0)&&this.removeBufferRange(r,i[r],0,n)}}},i.prototype.onLevelUpdated=function(e){var t=e.details;t.fragments.length>0&&(this._levelDuration=t.totalduration+t.fragments[0].start,this._levelTargetDuration=t.averagetargetduration||t.targetduration||10,this._live=t.live,this.updateMediaElementDuration())},i.prototype.updateMediaElementDuration=function(){var t,i=this.hls.config;if(null!==this._levelDuration&&this.media&&this.mediaSource&&this.sourceBuffer&&0!==this.media.readyState&&"open"===this.mediaSource.readyState){for(var s in this.sourceBuffer)if(!0===this.sourceBuffer[s].updating)return;t=this.media.duration,null===this._msDuration&&(this._msDuration=this.mediaSource.duration),!0===this._live&&!0===i.liveDurationInfinity?(o.logger.log("Media Source duration is set to Infinity"),this._msDuration=this.mediaSource.duration=1/0):(this._levelDuration>this._msDuration&&this._levelDuration>t||!e.isFinite(t))&&(o.logger.log("Updating Media Source duration to "+this._levelDuration.toFixed(3)),this._msDuration=this.mediaSource.duration=this._levelDuration)}},i.prototype.doFlush=function(){for(;this.flushRange.length;){var e=this.flushRange[0];if(!this.flushBuffer(e.start,e.end,e.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var t=0,i=this.sourceBuffer;try{for(var s in i)t+=i[s].buffered.length}catch(e){o.logger.error("error while accessing sourceBuffer.buffered")}this.appended=t,this.hls.trigger(a.default.BUFFER_FLUSHED)}},i.prototype.doAppending=function(){var e=this.hls,t=this.segments,i=this.sourceBuffer;if(Object.keys(i).length){if(this.media.error)return this.segments=[],void o.logger.error("trying to append although a media error occured, flush segment and abort");if(this.appending)return;if(t&&t.length){var s=t.shift();try{var n=i[s.type];n?n.updating?t.unshift(s):(n.ended=!1,this.parent=s.parent,n.appendBuffer(s.data),this.appendError=0,this.appended++,this.appending=!0):this.onSBUpdateEnd()}catch(i){o.logger.error("error while trying to append buffer:"+i.message),t.unshift(s);var r={type:l.ErrorTypes.MEDIA_ERROR,parent:s.parent};22!==i.code?(this.appendError?this.appendError++:this.appendError=1,r.details=l.ErrorDetails.BUFFER_APPEND_ERROR,this.appendError>e.config.appendErrorMaxRetry?(o.logger.log("fail "+e.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),this.segments=[],r.fatal=!0,e.trigger(a.default.ERROR,r)):(r.fatal=!1,e.trigger(a.default.ERROR,r))):(this.segments=[],r.details=l.ErrorDetails.BUFFER_FULL_ERROR,r.fatal=!1,e.trigger(a.default.ERROR,r))}}}},i.prototype.flushBuffer=function(e,t,i){var s,n=this.sourceBuffer;if(Object.keys(n).length){if(o.logger.log("flushBuffer,pos/start/end: "+this.media.currentTime.toFixed(3)+"/"+e+"/"+t),this.flushBufferCounter<this.appended){for(var a in n)if(!i||a===i){if((s=n[a]).ended=!1,s.updating)return o.logger.warn("cannot flush, sb updating in progress"),!1;if(this.removeBufferRange(a,s,e,t))return this.flushBufferCounter++,!1}}else o.logger.warn("abort flushing too many retries");o.logger.log("buffer flushed")}return!0},i.prototype.removeBufferRange=function(e,t,i,s){try{for(var n=0;n<t.buffered.length;n++){var a=t.buffered.start(n),r=t.buffered.end(n),l=Math.max(a,i),d=Math.min(r,s);if(Math.min(d,r)-l>.5)return o.logger.log("sb remove "+e+" ["+l+","+d+"], of ["+a+","+r+"], pos:"+this.media.currentTime),t.remove(l,d),!0}}catch(e){o.logger.warn("removeBufferRange failed",e)}return!1},i}(r.default);t.default=u}).call(this,i("./src/polyfills/number.js").Number)},"./src/controller/cap-level-controller.js":function(e,t,i){(function(e){var s,n=this&&this.__extends||(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},function(e,t){function i(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0});var a=i("./src/events.js"),r=function(t){function i(i){var s=t.call(this,i,a.default.FPS_DROP_LEVEL_CAPPING,a.default.MEDIA_ATTACHING,a.default.MANIFEST_PARSED,a.default.BUFFER_CODECS,a.default.MEDIA_DETACHING)||this;return s.autoLevelCapping=e.POSITIVE_INFINITY,s.firstLevel=null,s.levels=[],s.media=null,s.restrictedLevels=[],s.timer=null,s}return n(i,t),i.prototype.destroy=function(){this.hls.config.capLevelToPlayerSize&&(this.media=null,this._stopCapping())},i.prototype.onFpsDropLevelCapping=function(e){i.isLevelAllowed(e.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(e.droppedLevel)},i.prototype.onMediaAttaching=function(e){this.media=e.media instanceof window.HTMLVideoElement?e.media:null},i.prototype.onManifestParsed=function(e){var t=this.hls;this.restrictedLevels=[],this.levels=e.levels,this.firstLevel=e.firstLevel,t.config.capLevelToPlayerSize&&e.video&&this._startCapping()},i.prototype.onBufferCodecs=function(e){this.hls.config.capLevelToPlayerSize&&e.video&&this._startCapping()},i.prototype.onLevelsUpdated=function(e){this.levels=e.levels},i.prototype.onMediaDetaching=function(){this._stopCapping()},i.prototype.detectPlayerSize=function(){if(this.media){var e=this.levels?this.levels.length:0;if(e){var t=this.hls;t.autoLevelCapping=this.getMaxLevel(e-1),t.autoLevelCapping>this.autoLevelCapping&&t.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}},i.prototype.getMaxLevel=function(e){var t=this;if(!this.levels)return-1;var s=this.levels.filter(function(s,n){return i.isLevelAllowed(n,t.restrictedLevels)&&n<=e});return i.getMaxLevelByMediaSize(s,this.mediaWidth,this.mediaHeight)},i.prototype._startCapping=function(){this.timer||(this.autoLevelCapping=e.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},i.prototype._stopCapping=function(){this.restrictedLevels=[],this.firstLevel=null,this.autoLevelCapping=e.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer),this.timer=null)},Object.defineProperty(i.prototype,"mediaWidth",{get:function(){var e,t=this.media;return t&&(e=t.width||t.clientWidth||t.offsetWidth,e*=i.contentScaleFactor),e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"mediaHeight",{get:function(){var e,t=this.media;return t&&(e=t.height||t.clientHeight||t.offsetHeight,e*=i.contentScaleFactor),e},enumerable:!0,configurable:!0}),Object.defineProperty(i,"contentScaleFactor",{get:function(){var e=1;try{e=window.devicePixelRatio}catch(e){}return e},enumerable:!0,configurable:!0}),i.isLevelAllowed=function(e,t){return void 0===t&&(t=[]),-1===t.indexOf(e)},i.getMaxLevelByMediaSize=function(e,t,i){if(!e||e&&!e.length)return-1;for(var s,n,a=e.length-1,r=0;r<e.length;r+=1){var o=e[r];if((o.width>=t||o.height>=i)&&(s=o,!(n=e[r+1])||s.width!==n.width||s.height!==n.height)){a=r;break}}return a},i}(i("./src/event-handler.js").default);t.default=r}).call(this,i("./src/polyfills/number.js").Number)},"./src/controller/eme-controller.js":function(e,t,i){var s,n=this&&this.__extends||(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},function(e,t){function i(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0});var a=i("./src/event-handler.js"),r=i("./src/events.js"),o=i("./src/errors.js"),l=i("./src/utils/logger.js"),d=window.XMLHttpRequest,u="com.widevine.alpha",c="com.microsoft.playready",h=function(e){function t(t){var i=e.call(this,t,r.default.MEDIA_ATTACHED,r.default.MANIFEST_PARSED)||this;return i._widevineLicenseUrl=t.config.widevineLicenseUrl,i._licenseXhrSetup=t.config.licenseXhrSetup,i._emeEnabled=t.config.emeEnabled,i._requestMediaKeySystemAccess=t.config.requestMediaKeySystemAccessFunc,i._mediaKeysList=[],i._media=null,i._hasSetMediaKeys=!1,i._isMediaEncrypted=!1,i._requestLicenseFailureCount=0,i}return n(t,e),t.prototype.getLicenseServerUrl=function(e){var t;switch(e){case u:t=this._widevineLicenseUrl;break;default:t=null}return t||(l.logger.error('No license server URL configured for key-system "'+e+'"'),this.hls.trigger(r.default.ERROR,{type:o.ErrorTypes.KEY_SYSTEM_ERROR,details:o.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})),t},t.prototype._attemptKeySystemAccess=function(e,t,i){var s=this,n=function(e,t,i){switch(e){case u:return function(e,t,i){var s={videoCapabilities:[]};return t.forEach(function(e){s.videoCapabilities.push({contentType:'video/mp4; codecs="'+e+'"'})}),[s]}(0,i);default:throw Error("Unknown key-system: "+e)}}(e,0,i);n?(l.logger.log("Requesting encrypted media key-system access"),this.requestMediaKeySystemAccess(e,n).then(function(t){s._onMediaKeySystemAccessObtained(e,t)}).catch(function(t){l.logger.error('Failed to obtain key-system "'+e+'" access:',t)})):l.logger.warn("Can not create config for key-system (maybe because platform is not supported):",e)},Object.defineProperty(t.prototype,"requestMediaKeySystemAccess",{get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess},enumerable:!0,configurable:!0}),t.prototype._onMediaKeySystemAccessObtained=function(e,t){var i=this;l.logger.log('Access for key-system "'+e+'" obtained');var s={mediaKeys:null,mediaKeysSession:null,mediaKeysSessionInitialized:!1,mediaKeySystemAccess:t,mediaKeySystemDomain:e};this._mediaKeysList.push(s),t.createMediaKeys().then(function(t){s.mediaKeys=t,l.logger.log('Media-keys created for key-system "'+e+'"'),i._onMediaKeysCreated()}).catch(function(e){l.logger.error("Failed to create media-keys:",e)})},t.prototype._onMediaKeysCreated=function(){var e=this;this._mediaKeysList.forEach(function(t){t.mediaKeysSession||(t.mediaKeysSession=t.mediaKeys.createSession(),e._onNewMediaKeySession(t.mediaKeysSession))})},t.prototype._onNewMediaKeySession=function(e){var t=this;l.logger.log("New key-system session "+e.sessionId),e.addEventListener("message",function(i){t._onKeySessionMessage(e,i.message)},!1)},t.prototype._onKeySessionMessage=function(e,t){l.logger.log("Got EME message event, creating license request"),this._requestLicense(t,function(t){l.logger.log("Received license data, updating key-session"),e.update(t)})},t.prototype._onMediaEncrypted=function(e,t){l.logger.log('Media is encrypted using "'+e+'" init data type'),this._isMediaEncrypted=!0,this._mediaEncryptionInitDataType=e,this._mediaEncryptionInitData=t,this._attemptSetMediaKeys(),this._generateRequestWithPreferredKeySession()},t.prototype._attemptSetMediaKeys=function(){if(!this._hasSetMediaKeys){var e=this._mediaKeysList[0];if(!e||!e.mediaKeys)return l.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(r.default.ERROR,{type:o.ErrorTypes.KEY_SYSTEM_ERROR,details:o.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});l.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(e.mediaKeys),this._hasSetMediaKeys=!0}},t.prototype._generateRequestWithPreferredKeySession=function(){var e=this,t=this._mediaKeysList[0];if(!t)return l.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(r.default.ERROR,{type:o.ErrorTypes.KEY_SYSTEM_ERROR,details:o.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});if(t.mediaKeysSessionInitialized)l.logger.warn("Key-Session already initialized but requested again");else{var i=t.mediaKeysSession;i||(l.logger.error("Fatal: Media is encrypted but no key-session existing"),this.hls.trigger(r.default.ERROR,{type:o.ErrorTypes.KEY_SYSTEM_ERROR,details:o.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0}));var s=this._mediaEncryptionInitDataType,n=this._mediaEncryptionInitData;l.logger.log('Generating key-session request for "'+s+'" init data type'),t.mediaKeysSessionInitialized=!0,i.generateRequest(s,n).then(function(){l.logger.debug("Key-session generation succeeded")}).catch(function(t){l.logger.error("Error generating key-session request:",t),e.hls.trigger(r.default.ERROR,{type:o.ErrorTypes.KEY_SYSTEM_ERROR,details:o.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})}},t.prototype._createLicenseXhr=function(e,t,i){var s=new d,n=this._licenseXhrSetup;try{if(n)try{n(s,e)}catch(t){s.open("POST",e,!0),n(s,e)}s.readyState||s.open("POST",e,!0)}catch(e){return l.logger.error("Error setting up key-system license XHR",e),void this.hls.trigger(r.default.ERROR,{type:o.ErrorTypes.KEY_SYSTEM_ERROR,details:o.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}return s.responseType="arraybuffer",s.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,s,e,t,i),s},t.prototype._onLicenseRequestReadyStageChange=function(e,t,i,s){switch(e.readyState){case 4:if(200===e.status)this._requestLicenseFailureCount=0,l.logger.log("License request succeeded"),s(e.response);else{if(l.logger.error("License Request XHR failed ("+t+"). Status: "+e.status+" ("+e.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount<=3){var n=3-this._requestLicenseFailureCount+1;return l.logger.warn("Retrying license request, "+n+" attempts left"),void this._requestLicense(i,s)}this.hls.trigger(r.default.ERROR,{type:o.ErrorTypes.KEY_SYSTEM_ERROR,details:o.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}}},t.prototype._generateLicenseRequestChallenge=function(e,t){var i;return e.mediaKeySystemDomain===c?l.logger.error("PlayReady is not supported (yet)"):e.mediaKeySystemDomain===u?i=t:l.logger.error("Unsupported key-system:",e.mediaKeySystemDomain),i},t.prototype._requestLicense=function(e,t){l.logger.log("Requesting content license for key-system");var i=this._mediaKeysList[0];if(!i)return l.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(r.default.ERROR,{type:o.ErrorTypes.KEY_SYSTEM_ERROR,details:o.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});var s=this.getLicenseServerUrl(i.mediaKeySystemDomain),n=this._createLicenseXhr(s,e,t);l.logger.log("Sending license request to URL: "+s),n.send(this._generateLicenseRequestChallenge(i,e))},t.prototype.onMediaAttached=function(e){var t=this;if(this._emeEnabled){var i=e.media;this._media=i,i.addEventListener("encrypted",function(e){t._onMediaEncrypted(e.initDataType,e.initData)})}},t.prototype.onManifestParsed=function(e){if(this._emeEnabled){var t=e.levels.map(function(e){return e.audioCodec}),i=e.levels.map(function(e){return e.videoCodec});this._attemptKeySystemAccess(u,t,i)}},t}(a.default);t.default=h},"./src/controller/fps-controller.js":function(e,t,i){var s,n=this&&this.__extends||(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},function(e,t){function i(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0});var a=i("./src/events.js"),r=i("./src/event-handler.js"),o=i("./src/utils/logger.js"),l=window.performance,d=function(e){function t(t){return e.call(this,t,a.default.MEDIA_ATTACHING)||this}return n(t,e),t.prototype.destroy=function(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1},t.prototype.onMediaAttaching=function(e){var t=this.hls.config;t.capLevelOnFPSDrop&&("function"==typeof(this.video=e.media instanceof window.HTMLVideoElement?e.media:null).getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),t.fpsDroppedMonitoringPeriod))},t.prototype.checkFPS=function(e,t,i){var s=l.now();if(t){if(this.lastTime){var n=s-this.lastTime,r=i-this.lastDroppedFrames,d=t-this.lastDecodedFrames,u=1e3*r/n,c=this.hls;if(c.trigger(a.default.FPS_DROP,{currentDropped:r,currentDecoded:d,totalDroppedFrames:i}),u>0&&r>c.config.fpsDroppedMonitoringThreshold*d){var h=c.currentLevel;o.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+h),h>0&&(-1===c.autoLevelCapping||c.autoLevelCapping>=h)&&(h-=1,c.trigger(a.default.FPS_DROP_LEVEL_CAPPING,{level:h,droppedLevel:c.currentLevel}),c.autoLevelCapping=h,c.streamController.nextLevelSwitch())}}this.lastTime=s,this.lastDroppedFrames=i,this.lastDecodedFrames=t}},t.prototype.checkFPSInterval=function(){var e=this.video;if(e)if(this.isVideoPlaybackQualityAvailable){var t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)},t}(r.default);t.default=d},"./src/controller/fragment-finders.js":function(e,t,i){(function(e){Object.defineProperty(t,"__esModule",{value:!0});var s=i("./src/utils/binary-search.js");function n(e,t,i){void 0===e&&(e=0),void 0===t&&(t=0);var s=Math.min(t,i.duration+(i.deltaPTS?i.deltaPTS:0));return i.start+i.duration-s<=e?1:i.start-s>e&&i.start?-1:0}function a(e,t,i){var s=1e3*Math.min(t,i.duration+(i.deltaPTS?i.deltaPTS:0));return i.endProgramDateTime-s>e}t.findFragmentByPDT=function(t,i,s){if(!Array.isArray(t)||!t.length||!e.isFinite(i))return null;if(i<t[0].programDateTime)return null;if(i>=t[t.length-1].endProgramDateTime)return null;s=s||0;for(var n=0;n<t.length;++n){var r=t[n];if(a(i,s,r))return r}return null},t.findFragmentByPTS=function(e,t,i,a){void 0===i&&(i=0),void 0===a&&(a=0);var r=e?t[e.sn-t[0].sn+1]:null;return r&&!n(i,a,r)?r:s.default.search(t,n.bind(null,i,a))},t.fragmentWithinToleranceTest=n,t.pdtWithinToleranceTest=a}).call(this,i("./src/polyfills/number.js").Number)},"./src/controller/fragment-tracker.js":function(e,t,i){(function(e){var s,n=this&&this.__extends||(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},function(e,t){function i(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0});var a=i("./src/event-handler.js"),r=i("./src/events.js");t.FragmentState={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};var o=function(i){function s(e){var t=i.call(this,e,r.default.BUFFER_APPENDED,r.default.FRAG_BUFFERED,r.default.FRAG_LOADED)||this;return t.bufferPadding=.2,t.fragments=Object.create(null),t.timeRanges=Object.create(null),t.config=e.config,t}return n(s,i),s.prototype.destroy=function(){this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.config=null,a.default.prototype.destroy.call(this),i.prototype.destroy.call(this)},s.prototype.getBufferedFrag=function(e,t){var i=this.fragments,s=Object.keys(i).filter(function(s){var n=i[s];if(n.body.type!==t)return!1;if(!n.buffered)return!1;var a=n.body;return a.startPTS<=e&&e<=a.endPTS});if(0===s.length)return null;var n=s.pop();return i[n].body},s.prototype.detectEvictedFragments=function(e,t){var i,s,n=this;Object.keys(this.fragments).forEach(function(a){var r=n.fragments[a];if(!0===r.buffered){var o=r.range[e];if(o){i=o.time;for(var l=0;l<i.length;l++)if(s=i[l],!1===n.isTimeBuffered(s.startPTS,s.endPTS,t)){n.removeFragment(r.body);break}}}})},s.prototype.detectPartialFragments=function(e){var t=this,i=this.getFragmentKey(e),s=this.fragments[i];s&&(s.buffered=!0,Object.keys(this.timeRanges).forEach(function(i){if(e.hasElementaryStream(i)){var n=t.timeRanges[i];s.range[i]=t.getBufferedTimes(e.startPTS,e.endPTS,n)}}))},s.prototype.getBufferedTimes=function(e,t,i){for(var s,n,a=[],r=!1,o=0;o<i.length;o++){if(s=i.start(o)-this.bufferPadding,n=i.end(o)+this.bufferPadding,e>=s&&t<=n){a.push({startPTS:Math.max(e,i.start(o)),endPTS:Math.min(t,i.end(o))});break}if(e<n&&t>s)a.push({startPTS:Math.max(e,i.start(o)),endPTS:Math.min(t,i.end(o))}),r=!0;else if(t<=s)break}return{time:a,partial:r}},s.prototype.getFragmentKey=function(e){return e.type+"_"+e.level+"_"+e.urlId+"_"+e.sn},s.prototype.getPartialFragment=function(e){var t,i,s,n=this,a=null,r=0;return Object.keys(this.fragments).forEach(function(o){var l=n.fragments[o];n.isPartial(l)&&(i=l.body.startPTS-n.bufferPadding,s=l.body.endPTS+n.bufferPadding,e>=i&&e<=s&&(t=Math.min(e-i,s-e),r<=t&&(a=l.body,r=t)))}),a},s.prototype.getState=function(e){var i=this.getFragmentKey(e),s=this.fragments[i],n=t.FragmentState.NOT_LOADED;return void 0!==s&&(n=s.buffered?!0===this.isPartial(s)?t.FragmentState.PARTIAL:t.FragmentState.OK:t.FragmentState.APPENDING),n},s.prototype.isPartial=function(e){return!0===e.buffered&&(void 0!==e.range.video&&!0===e.range.video.partial||void 0!==e.range.audio&&!0===e.range.audio.partial)},s.prototype.isTimeBuffered=function(e,t,i){for(var s,n,a=0;a<i.length;a++){if(s=i.start(a)-this.bufferPadding,n=i.end(a)+this.bufferPadding,e>=s&&t<=n)return!0;if(t<=s)return!1}return!1},s.prototype.onFragLoaded=function(t){var i=t.frag;e.isFinite(i.sn)&&!i.bitrateTest&&(this.fragments[this.getFragmentKey(i)]={body:i,range:Object.create(null),buffered:!1})},s.prototype.onBufferAppended=function(e){var t=this;this.timeRanges=e.timeRanges,Object.keys(this.timeRanges).forEach(function(e){var i=t.timeRanges[e];t.detectEvictedFragments(e,i)})},s.prototype.onFragBuffered=function(e){this.detectPartialFragments(e.frag)},s.prototype.hasFragment=function(e){var t=this.getFragmentKey(e);return void 0!==this.fragments[t]},s.prototype.removeFragment=function(e){var t=this.getFragmentKey(e);delete this.fragments[t]},s.prototype.removeAllFragments=function(){this.fragments=Object.create(null)},s}(a.default);t.FragmentTracker=o}).call(this,i("./src/polyfills/number.js").Number)},"./src/controller/gap-controller.js":function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i("./src/utils/buffer-helper.js"),n=i("./src/errors.js"),a=i("./src/events.js"),r=i("./src/utils/logger.js"),o=function(){function e(e,t,i,s){this.config=e,this.media=t,this.fragmentTracker=i,this.hls=s,this.stallReported=!1}return e.prototype.poll=function(e,t){var i=this.config,n=this.media,a=n.currentTime,o=window.performance.now();if(a!==e)return this.stallReported&&(r.logger.warn("playback not stuck anymore @"+a+", after "+Math.round(o-this.stalled)+"ms"),this.stallReported=!1),this.stalled=null,void(this.nudgeRetry=0);if(!(n.ended||!n.buffered.length||n.readyState>2||n.seeking&&s.BufferHelper.isBuffered(n,a))){var l=o-this.stalled,d=s.BufferHelper.bufferInfo(n,a,i.maxBufferHole);this.stalled?(l>=1e3&&this._reportStall(d.len),this._tryFixBufferStall(d,l)):this.stalled=o}},e.prototype._tryFixBufferStall=function(e,t){var i=this.config,s=this.fragmentTracker,n=this.media.currentTime,a=s.getPartialFragment(n);a&&this._trySkipBufferHole(a),e.len>.5&&t>1e3*i.highBufferWatchdogPeriod&&(this.stalled=null,this._tryNudgeBuffer())},e.prototype._reportStall=function(e){var t=this.hls,i=this.media;this.stallReported||(this.stallReported=!0,r.logger.warn("Playback stalling at @"+i.currentTime+" due to low buffer"),t.trigger(a.default.ERROR,{type:n.ErrorTypes.MEDIA_ERROR,details:n.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:e}))},e.prototype._trySkipBufferHole=function(e){for(var t=this.hls,i=this.media,s=i.currentTime,o=0,l=0;l<i.buffered.length;l++){var d=i.buffered.start(l);if(s>=o&&s<d)return i.currentTime=Math.max(d,i.currentTime+.1),r.logger.warn("skipping hole, adjusting currentTime from "+s+" to "+i.currentTime),this.stalled=null,void t.trigger(a.default.ERROR,{type:n.ErrorTypes.MEDIA_ERROR,details:n.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+s+" to "+i.currentTime,frag:e});o=i.buffered.end(l)}},e.prototype._tryNudgeBuffer=function(){var e=this.config,t=this.hls,i=this.media,s=i.currentTime,o=(this.nudgeRetry||0)+1;if(this.nudgeRetry=o,o<e.nudgeMaxRetry){var l=s+o*e.nudgeOffset;r.logger.log("adjust currentTime from "+s+" to "+l),i.currentTime=l,t.trigger(a.default.ERROR,{type:n.ErrorTypes.MEDIA_ERROR,details:n.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else r.logger.error("still stuck in high buffer @"+s+" after "+e.nudgeMaxRetry+", raise fatal error"),t.trigger(a.default.ERROR,{type:n.ErrorTypes.MEDIA_ERROR,details:n.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})},e}();t.default=o},"./src/controller/id3-track-controller.js":function(e,t,i){var s,n=this&&this.__extends||(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},function(e,t){function i(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0});var a=i("./src/events.js"),r=i("./src/event-handler.js"),o=i("./src/demux/id3.js"),l=i("./src/utils/texttrack-utils.js"),d=function(e){function t(t){var i=e.call(this,t,a.default.MEDIA_ATTACHED,a.default.MEDIA_DETACHING,a.default.FRAG_PARSING_METADATA)||this;return i.id3Track=void 0,i.media=void 0,i}return n(t,e),t.prototype.destroy=function(){r.default.prototype.destroy.call(this)},t.prototype.onMediaAttached=function(e){this.media=e.media,this.media},t.prototype.onMediaDetaching=function(){l.clearCurrentCues(this.id3Track),this.id3Track=void 0,this.media=void 0},t.prototype.getID3Track=function(e){for(var t=0;t<e.length;t++){var i=e[t];if("metadata"===i.kind&&"id3"===i.label)return l.sendAddTrackEvent(i,this.media),i}return this.media.addTextTrack("metadata","id3")},t.prototype.onFragParsingMetadata=function(e){var t=e.frag,i=e.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var s=window.WebKitDataCue||window.VTTCue||window.TextTrackCue,n=0;n<i.length;n++){var a=o.default.getID3Frames(i[n].data);if(a){var r=i[n].pts,l=n<i.length-1?i[n+1].pts:t.endPTS;r===l&&(l+=1e-4);for(var d=0;d<a.length;d++){var u=a[d];if(!o.default.isTimeStampFrame(u)){var c=new s(r,l,"");c.value=u,this.id3Track.addCue(c)}}}}},t}(r.default);t.default=d},"./src/controller/level-controller.js":function(e,t,i){var s,n=this&&this.__extends||(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},function(e,t){function i(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0});var a,r=i("./src/events.js"),o=i("./src/event-handler.js"),l=i("./src/utils/logger.js"),d=i("./src/errors.js"),u=i("./src/utils/codecs.js"),c=i("./src/controller/level-helper.js"),h=(window.performance,function(e){function t(t){var i=e.call(this,t,r.default.MANIFEST_LOADED,r.default.LEVEL_LOADED,r.default.AUDIO_TRACK_SWITCHED,r.default.FRAG_LOADED,r.default.ERROR)||this;return i.canload=!1,i.currentLevelIndex=null,i.manualLevelIndex=-1,i.timer=null,a=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),i}return n(t,e),t.prototype.onHandlerDestroying=function(){this.clearTimer(),this.manualLevelIndex=-1},t.prototype.clearTimer=function(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)},t.prototype.startLoad=function(){var e=this._levels;this.canload=!0,this.levelRetryCount=0,e&&e.forEach(function(e){e.loadError=0;var t=e.details;t&&t.live&&(e.details=void 0)}),null!==this.timer&&this.loadLevel()},t.prototype.stopLoad=function(){this.canload=!1},t.prototype.onManifestLoaded=function(e){var t,i=[],s=[],n={},o=null,h=!1,p=!1;if(e.levels.forEach(function(e){var t=e.attrs;e.loadError=0,e.fragmentError=!1,h=h||!!e.videoCodec,p=p||!!e.audioCodec,a&&e.audioCodec&&-1!==e.audioCodec.indexOf("mp4a.40.34")&&(e.audioCodec=void 0),(o=n[e.bitrate])?o.url.push(e.url):(e.url=[e.url],e.urlId=0,n[e.bitrate]=e,i.push(e)),t&&(t.AUDIO&&(p=!0,c.addGroupId(o||e,"audio",t.AUDIO)),t.SUBTITLES&&c.addGroupId(o||e,"text",t.SUBTITLES))}),h&&p&&(i=i.filter(function(e){return!!e.videoCodec})),i=i.filter(function(e){var t=e.audioCodec,i=e.videoCodec;return(!t||u.isCodecSupportedInMp4(t,"audio"))&&(!i||u.isCodecSupportedInMp4(i,"video"))}),e.audioTracks&&(s=e.audioTracks.filter(function(e){return!e.audioCodec||u.isCodecSupportedInMp4(e.audioCodec,"audio")})).forEach(function(e,t){e.id=t}),i.length>0){t=i[0].bitrate,i.sort(function(e,t){return e.bitrate-t.bitrate}),this._levels=i;for(var g=0;g<i.length;g++)if(i[g].bitrate===t){this._firstLevel=g,l.logger.log("manifest loaded,"+i.length+" level(s) found, first bitrate:"+t);break}this.hls.trigger(r.default.MANIFEST_PARSED,{levels:i,audioTracks:s,firstLevel:this._firstLevel,stats:e.stats,audio:p,video:h,altAudio:s.some(function(e){return!!e.url})})}else this.hls.trigger(r.default.ERROR,{type:d.ErrorTypes.MEDIA_ERROR,details:d.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:this.hls.url,reason:"no level with compatible codecs found in manifest"})},Object.defineProperty(t.prototype,"levels",{get:function(){return this._levels},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"level",{get:function(){return this.currentLevelIndex},set:function(e){var t=this._levels;t&&(e=Math.min(e,t.length-1),this.currentLevelIndex===e&&t[e].details||this.setLevelInternal(e))},enumerable:!0,configurable:!0}),t.prototype.setLevelInternal=function(e){var t=this._levels,i=this.hls;if(e>=0&&e<t.length){if(this.clearTimer(),this.currentLevelIndex!==e){l.logger.log("switching to level "+e),this.currentLevelIndex=e;var s=t[e];s.level=e,i.trigger(r.default.LEVEL_SWITCHING,s)}var n=t[e],a=n.details;if(!a||a.live){var o=n.urlId;i.trigger(r.default.LEVEL_LOADING,{url:n.url[o],level:e,id:o})}}else i.trigger(r.default.ERROR,{type:d.ErrorTypes.OTHER_ERROR,details:d.ErrorDetails.LEVEL_SWITCH_ERROR,level:e,fatal:!1,reason:"invalid level idx"})},Object.defineProperty(t.prototype,"manualLevel",{get:function(){return this.manualLevelIndex},set:function(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"firstLevel",{get:function(){return this._firstLevel},set:function(e){this._firstLevel=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"startLevel",{get:function(){if(void 0===this._startLevel){var e=this.hls.config.startLevel;return void 0!==e?e:this._firstLevel}return this._startLevel},set:function(e){this._startLevel=e},enumerable:!0,configurable:!0}),t.prototype.onError=function(e){if(e.fatal)e.type===d.ErrorTypes.NETWORK_ERROR&&this.clearTimer();else{var t,i=!1,s=!1;switch(e.details){case d.ErrorDetails.FRAG_LOAD_ERROR:case d.ErrorDetails.FRAG_LOAD_TIMEOUT:case d.ErrorDetails.KEY_LOAD_ERROR:case d.ErrorDetails.KEY_LOAD_TIMEOUT:t=e.frag.level,s=!0;break;case d.ErrorDetails.LEVEL_LOAD_ERROR:case d.ErrorDetails.LEVEL_LOAD_TIMEOUT:t=e.context.level,i=!0;break;case d.ErrorDetails.REMUX_ALLOC_ERROR:t=e.level,i=!0}void 0!==t&&this.recoverLevel(e,t,i,s)}},t.prototype.recoverLevel=function(e,t,i,s){var n,a,r,o=this,d=this.hls.config,u=e.details,c=this._levels[t];if(c.loadError++,c.fragmentError=s,i){if(!(this.levelRetryCount+1<=d.levelLoadingMaxRetry))return l.logger.error("level controller, cannot recover from "+u+" error"),this.currentLevelIndex=null,this.clearTimer(),void(e.fatal=!0);a=Math.min(Math.pow(2,this.levelRetryCount)*d.levelLoadingRetryDelay,d.levelLoadingMaxRetryTimeout),this.timer=setTimeout(function(){return o.loadLevel()},a),e.levelRetry=!0,this.levelRetryCount++,l.logger.warn("level controller, "+u+", retry in "+a+" ms, current retry count is "+this.levelRetryCount)}(i||s)&&((n=c.url.length)>1&&c.loadError<n?(c.urlId=(c.urlId+1)%n,c.details=void 0,l.logger.warn("level controller, "+u+" for level "+t+": switching to redundant URL-id "+c.urlId)):-1===this.manualLevelIndex?(r=0===t?this._levels.length-1:t-1,l.logger.warn("level controller, "+u+": switch to "+r),this.hls.nextAutoLevel=this.currentLevelIndex=r):s&&(l.logger.warn("level controller, "+u+": reload a fragment"),this.currentLevelIndex=null))},t.prototype.onFragLoaded=function(e){var t=e.frag;if(void 0!==t&&"main"===t.type){var i=this._levels[t.level];void 0!==i&&(i.fragmentError=!1,i.loadError=0,this.levelRetryCount=0)}},t.prototype.onLevelLoaded=function(e){var t=this,i=e.level,s=e.details;if(i===this.currentLevelIndex){var n=this._levels[i];if(n.fragmentError||(n.loadError=0,this.levelRetryCount=0),s.live){var a=c.computeReloadInterval(n.details,s,e.stats.trequest);l.logger.log("live playlist, reload in "+Math.round(a)+" ms"),this.timer=setTimeout(function(){return t.loadLevel()},a)}else this.clearTimer()}},t.prototype.onAudioTrackSwitched=function(e){var t=this.hls.audioTracks[e.id].groupId,i=this.hls.levels[this.currentLevelIndex];if(i&&i.audioGroupIds){for(var s=-1,n=0;n<i.audioGroupIds.length;n++)if(i.audioGroupIds[n]===t){s=n;break}s!==i.urlId&&(i.urlId=s,this.startLoad())}},t.prototype.loadLevel=function(){if(l.logger.debug("call to loadLevel"),null!==this.currentLevelIndex&&this.canload){var e=this._levels[this.currentLevelIndex];if("object"==typeof e&&e.url.length>0){var t=this.currentLevelIndex,i=e.urlId,s=e.url[i];l.logger.log("Attempt loading level index "+t+" with URL-id "+i),this.hls.trigger(r.default.LEVEL_LOADING,{url:s,level:t,id:i})}}},Object.defineProperty(t.prototype,"nextLoadLevel",{get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)},enumerable:!0,configurable:!0}),t}(o.default));t.default=h},"./src/controller/level-helper.js":function(e,t,i){(function(e){Object.defineProperty(t,"__esModule",{value:!0});var s=i("./src/utils/logger.js");function n(t,i,n){var a=t[i],r=t[n],o=r.startPTS;e.isFinite(o)?n>i?(a.duration=o-a.start,a.duration<0&&s.logger.warn("negative duration computed for frag "+a.sn+",level "+a.level+", there should be some duration drift between playlist and fragment!")):(r.duration=a.start-o,r.duration<0&&s.logger.warn("negative duration computed for frag "+r.sn+",level "+r.level+", there should be some duration drift between playlist and fragment!")):r.start=n>i?a.start+a.duration:Math.max(a.start-r.duration,0)}function a(t,i,s,a,r,o){var l=s;if(e.isFinite(i.startPTS)){var d=Math.abs(i.startPTS-s);e.isFinite(i.deltaPTS)?i.deltaPTS=Math.max(d,i.deltaPTS):i.deltaPTS=d,l=Math.max(s,i.startPTS),s=Math.min(s,i.startPTS),a=Math.max(a,i.endPTS),r=Math.min(r,i.startDTS),o=Math.max(o,i.endDTS)}var u=s-i.start;i.start=i.startPTS=s,i.maxStartPTS=l,i.endPTS=a,i.startDTS=r,i.endDTS=o,i.duration=a-s;var c,h,p,g=i.sn;if(!t||g<t.startSN||g>t.endSN)return 0;for(c=g-t.startSN,(h=t.fragments)[c]=i,p=c;p>0;p--)n(h,p,p-1);for(p=c;p<h.length-1;p++)n(h,p,p+1);return t.PTSKnown=!0,u}function r(e,t,i){if(e&&t)for(var s=Math.max(e.startSN,t.startSN)-t.startSN,n=Math.min(e.endSN,t.endSN)-t.startSN,a=t.startSN-e.startSN,r=s;r<=n;r++){var o=e.fragments[a+r],l=t.fragments[r];if(!o||!l)break;i(o,l,r)}}function o(e,t){var i=t.startSN-e.startSN,s=e.fragments,n=t.fragments;if(!(i<0||i>s.length))for(var a=0;a<n.length;a++)n[a].start+=s[i].start}t.addGroupId=function(e,t,i){switch(t){case"audio":e.audioGroupIds||(e.audioGroupIds=[]),e.audioGroupIds.push(i);break;case"text":e.textGroupIds||(e.textGroupIds=[]),e.textGroupIds.push(i)}},t.updatePTS=n,t.updateFragPTSDTS=a,t.mergeDetails=function(t,i){i.initSegment&&t.initSegment&&(i.initSegment=t.initSegment);var n,l=0;if(r(t,i,function(t,s){l=t.cc-s.cc,e.isFinite(t.startPTS)&&(s.start=s.startPTS=t.startPTS,s.endPTS=t.endPTS,s.duration=t.duration,s.backtracked=t.backtracked,s.dropped=t.dropped,n=s),i.PTSKnown=!0}),i.PTSKnown){if(l){s.logger.log("discontinuity sliding from playlist, take drift into account");for(var d=i.fragments,u=0;u<d.length;u++)d[u].cc+=l}n?a(i,n,n.startPTS,n.endPTS,n.startDTS,n.endDTS):o(t,i),i.PTSKnown=t.PTSKnown}},t.mergeSubtitlePlaylists=function(e,t,i){void 0===i&&(i=0);var s=-1;r(e,t,function(e,t,i){t.start=e.start,s=i});var n=t.fragments;if(s<0)n.forEach(function(e){e.start+=i});else for(var a=s+1;a<n.length;a++)n[a].start=n[a-1].start+n[a-1].duration},t.mapFragmentIntersection=r,t.adjustSliding=o,t.computeReloadInterval=function(e,t,i){var s=1e3*(t.averagetargetduration?t.averagetargetduration:t.targetduration),n=s/2;return e&&t.endSN===e.endSN&&(s=n),i&&(s=Math.max(n,s-(window.performance.now()-i))),Math.round(s)}}).call(this,i("./src/polyfills/number.js").Number)},"./src/controller/stream-controller.js":function(e,t,i){(function(e){var s,n=this&&this.__extends||(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},function(e,t){function i(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0});var a=i("./src/utils/binary-search.js"),r=i("./src/utils/buffer-helper.js"),o=i("./src/demux/demuxer.js"),l=i("./src/events.js"),d=i("./src/controller/fragment-tracker.js"),u=i("./src/loader/fragment.js"),c=i("./src/loader/playlist-loader.js"),h=i("./src/controller/level-helper.js"),p=i("./src/utils/time-ranges.js"),g=i("./src/errors.js"),f=i("./src/utils/logger.js"),v=i("./src/utils/discontinuities.js"),m=i("./src/controller/fragment-finders.js"),_=i("./src/controller/gap-controller.js"),E=i("./src/controller/base-stream-controller.js"),A=function(t){function i(e,i){var s=t.call(this,e,l.default.MEDIA_ATTACHED,l.default.MEDIA_DETACHING,l.default.MANIFEST_LOADING,l.default.MANIFEST_PARSED,l.default.LEVEL_LOADED,l.default.KEY_LOADED,l.default.FRAG_LOADED,l.default.FRAG_LOAD_EMERGENCY_ABORTED,l.default.FRAG_PARSING_INIT_SEGMENT,l.default.FRAG_PARSING_DATA,l.default.FRAG_PARSED,l.default.ERROR,l.default.AUDIO_TRACK_SWITCHING,l.default.AUDIO_TRACK_SWITCHED,l.default.BUFFER_CREATED,l.default.BUFFER_APPENDED,l.default.BUFFER_FLUSHED)||this;return s.fragmentTracker=i,s.config=e.config,s.audioCodecSwap=!1,s._state=E.State.STOPPED,s.stallReported=!1,s.gapController=null,s}return n(i,t),i.prototype.startLoad=function(e){if(this.levels){var t=this.lastCurrentTime,i=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var s=i.startLevel;-1===s&&(s=0,this.bitrateTest=!0),this.level=i.nextLoadLevel=s,this.loadedmetadata=!1}t>0&&-1===e&&(f.logger.log("override startPosition with lastCurrentTime @"+t.toFixed(3)),e=t),this.state=E.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this.forceStartLoad=!0,this.state=E.State.STOPPED},i.prototype.stopLoad=function(){this.forceStartLoad=!1,t.prototype.stopLoad.call(this)},i.prototype.doTick=function(){switch(this.state){case E.State.BUFFER_FLUSHING:this.fragLoadError=0;break;case E.State.IDLE:this._doTickIdle();break;case E.State.WAITING_LEVEL:var e=this.levels[this.level];e&&e.details&&(this.state=E.State.IDLE);break;case E.State.FRAG_LOADING_WAITING_RETRY:var t=window.performance.now(),i=this.retryDate;(!i||t>=i||this.media&&this.media.seeking)&&(f.logger.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=E.State.IDLE);break;case E.State.ERROR:case E.State.STOPPED:case E.State.FRAG_LOADING:case E.State.PARSING:case E.State.PARSED:case E.State.ENDED:}this._checkBuffer(),this._checkFragmentChanged()},i.prototype._doTickIdle=function(){var e=this.hls,t=e.config,i=this.media;if(void 0!==this.levelLastLoaded&&(i||!this.startFragRequested&&t.startFragPrefetch)){var s;s=this.loadedmetadata?i.currentTime:this.nextLoadPosition;var n=e.nextLoadLevel,a=this.levels[n];if(a){var o,d=a.bitrate;o=d?Math.max(8*t.maxBufferSize/d,t.maxBufferLength):t.maxBufferLength,o=Math.min(o,t.maxMaxBufferLength);var u=r.BufferHelper.bufferInfo(this.mediaBuffer?this.mediaBuffer:i,s,t.maxBufferHole),c=u.len;if(!(c>=o)){f.logger.trace("buffer length of "+c.toFixed(3)+" is below max of "+o.toFixed(3)+". checking for more payload ..."),this.level=e.nextLoadLevel=n;var h=a.details;if(!h||h.live&&this.levelLastLoaded!==n)this.state=E.State.WAITING_LEVEL;else{if(this._streamEnded(u,h)){var p={};return this.altAudio&&(p.type="video"),this.hls.trigger(l.default.BUFFER_EOS,p),void(this.state=E.State.ENDED)}this._fetchPayloadOrEos(s,u,h)}}}}},i.prototype._fetchPayloadOrEos=function(e,t,i){var s=this.fragPrevious,n=this.level,a=i.fragments,r=a.length;if(0!==r){var o,l=a[0].start,d=a[r-1].start+a[r-1].duration,u=t.end;if(i.initSegment&&!i.initSegment.data)o=i.initSegment;else if(i.live){var c=this.config.initialLiveManifestSize;if(r<c)return void f.logger.warn("Can not start playback of a level, reason: not enough fragments "+r+" < "+c);if(null===(o=this._ensureFragmentAtLivePoint(i,u,l,d,s,a,r)))return}else u<l&&(o=a[0]);o||(o=this._findFragment(l,s,r,a,u,d,i)),o&&(o.encrypted?(f.logger.log("Loading key for "+o.sn+" of ["+i.startSN+" ,"+i.endSN+"],level "+n),this._loadKey(o)):(f.logger.log("Loading "+o.sn+" of ["+i.startSN+" ,"+i.endSN+"],level "+n+", currentTime:"+e.toFixed(3)+",bufferEnd:"+u.toFixed(3)),this._loadFragment(o)))}},i.prototype._ensureFragmentAtLivePoint=function(e,t,i,s,n,r,o){var l,d=this.hls.config,u=this.media,c=void 0!==d.liveMaxLatencyDuration?d.liveMaxLatencyDuration:d.liveMaxLatencyDurationCount*e.targetduration;if(t<Math.max(i-d.maxFragLookUpTolerance,s-c)){var h=this.liveSyncPosition=this.computeLivePosition(i,e);f.logger.log("buffer end: "+t.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+h.toFixed(3)),t=h,u&&u.readyState&&u.duration>h&&(u.currentTime=h),this.nextLoadPosition=h}if(e.PTSKnown&&t>s&&u&&u.readyState)return null;if(this.startFragRequested&&!e.PTSKnown){if(n)if(e.hasProgramDateTime)f.logger.log("live playlist, switching playlist, load frag with same PDT: "+n.programDateTime),l=m.findFragmentByPDT(r,n.endProgramDateTime,d.maxFragLookUpTolerance);else{var p=n.sn+1;if(p>=e.startSN&&p<=e.endSN){var g=r[p-e.startSN];n.cc===g.cc&&(l=g,f.logger.log("live playlist, switching playlist, load frag with next SN: "+l.sn))}l||(l=a.default.search(r,function(e){return n.cc-e.cc}))&&f.logger.log("live playlist, switching playlist, load frag with same CC: "+l.sn)}l||(l=r[Math.min(o-1,Math.round(o/2))],f.logger.log("live playlist, switching playlist, unknown, load middle frag : "+l.sn))}return l},i.prototype._findFragment=function(e,t,i,s,n,a,r){var o,l=this.hls.config;if(n<a){var d=n>a-l.maxFragLookUpTolerance?0:l.maxFragLookUpTolerance;o=m.findFragmentByPTS(t,s,n,d)}else o=s[i-1];if(o){var u=o.sn-r.startSN,c=t&&o.level===t.level,h=s[u-1],p=s[u+1];if(t&&o.sn===t.sn)if(c&&!o.backtracked)if(o.sn<r.endSN){var g=t.deltaPTS;g&&g>l.maxBufferHole&&t.dropped&&u?(o=h,f.logger.warn("SN just loaded, with large PTS gap between audio and video, maybe frag is not starting with a keyframe ? load previous one to try to overcome this")):(o=p,f.logger.log("SN just loaded, load next one: "+o.sn,o))}else o=null;else o.backtracked&&(p&&p.backtracked?(f.logger.warn("Already backtracked from fragment "+p.sn+", will not backtrack to fragment "+o.sn+". Loading fragment "+p.sn),o=p):(f.logger.warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe"),o.dropped=0,h?(o=h).backtracked=!0:u&&(o=null)))}return o},i.prototype._loadKey=function(e){this.state=E.State.KEY_LOADING,this.hls.trigger(l.default.KEY_LOADING,{frag:e})},i.prototype._loadFragment=function(t){var i=this.fragmentTracker.getState(t);this.fragCurrent=t,this.startFragRequested=!0,e.isFinite(t.sn)&&!t.bitrateTest&&(this.nextLoadPosition=t.start+t.duration),t.backtracked||i===d.FragmentState.NOT_LOADED||i===d.FragmentState.PARTIAL?(t.autoLevel=this.hls.autoLevelEnabled,t.bitrateTest=this.bitrateTest,this.hls.trigger(l.default.FRAG_LOADING,{frag:t}),this.demuxer||(this.demuxer=new o.default(this.hls,"main")),this.state=E.State.FRAG_LOADING):i===d.FragmentState.APPENDING&&this._reduceMaxBufferLength(t.duration)&&this.fragmentTracker.removeFragment(t)},Object.defineProperty(i.prototype,"state",{get:function(){return this._state},set:function(e){if(this.state!==e){var t=this.state;this._state=e,f.logger.log("main stream:"+t+"->"+e),this.hls.trigger(l.default.STREAM_STATE_TRANSITION,{previousState:t,nextState:e})}},enumerable:!0,configurable:!0}),i.prototype.getBufferedFrag=function(e){return this.fragmentTracker.getBufferedFrag(e,c.default.LevelType.MAIN)},Object.defineProperty(i.prototype,"currentLevel",{get:function(){var e=this.media;if(e){var t=this.getBufferedFrag(e.currentTime);if(t)return t.level}return-1},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"nextBufferedFrag",{get:function(){var e=this.media;return e?this.followingBufferedFrag(this.getBufferedFrag(e.currentTime)):null},enumerable:!0,configurable:!0}),i.prototype.followingBufferedFrag=function(e){return e?this.getBufferedFrag(e.endPTS+.5):null},Object.defineProperty(i.prototype,"nextLevel",{get:function(){var e=this.nextBufferedFrag;return e?e.level:-1},enumerable:!0,configurable:!0}),i.prototype._checkFragmentChanged=function(){var e,t,i=this.media;if(i&&i.readyState&&!1===i.seeking&&((t=i.currentTime)>this.lastCurrentTime&&(this.lastCurrentTime=t),r.BufferHelper.isBuffered(i,t)?e=this.getBufferedFrag(t):r.BufferHelper.isBuffered(i,t+.1)&&(e=this.getBufferedFrag(t+.1)),e)){var s=e;if(s!==this.fragPlaying){this.hls.trigger(l.default.FRAG_CHANGED,{frag:s});var n=s.level;this.fragPlaying&&this.fragPlaying.level===n||this.hls.trigger(l.default.LEVEL_SWITCHED,{level:n}),this.fragPlaying=s}}},i.prototype.immediateLevelSwitch=function(){if(f.logger.log("immediateLevelSwitch"),!this.immediateSwitch){this.immediateSwitch=!0;var t=this.media,i=void 0;t?(i=t.paused,t.pause()):i=!0,this.previouslyPaused=i}var s=this.fragCurrent;s&&s.loader&&s.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(0,e.POSITIVE_INFINITY)},i.prototype.immediateLevelSwitchEnd=function(){var e=this.media;e&&e.buffered.length&&(this.immediateSwitch=!1,r.BufferHelper.isBuffered(e,e.currentTime)&&(e.currentTime-=1e-4),this.previouslyPaused||e.play())},i.prototype.nextLevelSwitch=function(){var t=this.media;if(t&&t.readyState){var i,s=void 0,n=void 0;if((i=this.getBufferedFrag(t.currentTime))&&i.startPTS>1&&this.flushMainBuffer(0,i.startPTS-1),t.paused)s=0;else{var a=this.hls.nextLoadLevel,r=this.levels[a],o=this.fragLastKbps;s=o&&this.fragCurrent?this.fragCurrent.duration*r.bitrate/(1e3*o)+1:0}if((n=this.getBufferedFrag(t.currentTime+s))&&(n=this.followingBufferedFrag(n))){var l=this.fragCurrent;l&&l.loader&&l.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(n.maxStartPTS,e.POSITIVE_INFINITY)}}},i.prototype.flushMainBuffer=function(e,t){this.state=E.State.BUFFER_FLUSHING;var i={startOffset:e,endOffset:t};this.altAudio&&(i.type="video"),this.hls.trigger(l.default.BUFFER_FLUSHING,i)},i.prototype.onMediaAttached=function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("seeked",this.onvseeked),t.addEventListener("ended",this.onvended);var i=this.config;this.levels&&i.autoStartLoad&&this.hls.startLoad(i.startPosition),this.gapController=new _.default(i,t,this.fragmentTracker,this.hls)},i.prototype.onMediaDetaching=function(){var e=this.media;e&&e.ended&&(f.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var t=this.levels;t&&t.forEach(function(e){e.details&&e.details.fragments.forEach(function(e){e.backtracked=void 0})}),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("seeked",this.onvseeked),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()},i.prototype.onMediaSeeked=function(){var t=this.media,i=t?t.currentTime:void 0;e.isFinite(i)&&f.logger.log("media seeked to "+i.toFixed(3)),this.tick()},i.prototype.onManifestLoading=function(){f.logger.log("trigger BUFFER_RESET"),this.hls.trigger(l.default.BUFFER_RESET),this.fragmentTracker.removeAllFragments(),this.stalled=!1,this.startPosition=this.lastCurrentTime=0},i.prototype.onManifestParsed=function(e){var t,i=!1,s=!1;e.levels.forEach(function(e){(t=e.audioCodec)&&(-1!==t.indexOf("mp4a.40.2")&&(i=!0),-1!==t.indexOf("mp4a.40.5")&&(s=!0))}),this.audioCodecSwitch=i&&s,this.audioCodecSwitch&&f.logger.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=e.levels,this.startFragRequested=!1;var n=this.config;(n.autoStartLoad||this.forceStartLoad)&&this.hls.startLoad(n.startPosition)},i.prototype.onLevelLoaded=function(t){var i=t.details,s=t.level,n=this.levels[this.levelLastLoaded],a=this.levels[s],r=i.totalduration,o=0;if(f.logger.log("level "+s+" loaded ["+i.startSN+","+i.endSN+"],duration:"+r),i.live){var d=a.details;d&&i.fragments.length>0?(h.mergeDetails(d,i),o=i.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(o,d),i.PTSKnown&&e.isFinite(o)?f.logger.log("live playlist sliding:"+o.toFixed(3)):(f.logger.log("live playlist - outdated PTS, unknown sliding"),v.alignStream(this.fragPrevious,n,i))):(f.logger.log("live playlist - first load, unknown sliding"),i.PTSKnown=!1,v.alignStream(this.fragPrevious,n,i))}else i.PTSKnown=!1;if(a.details=i,this.levelLastLoaded=s,this.hls.trigger(l.default.LEVEL_UPDATED,{details:i,level:s}),!1===this.startFragRequested){if(-1===this.startPosition||-1===this.lastCurrentTime){var u=i.startTimeOffset;e.isFinite(u)?(u<0&&(f.logger.log("negative start time offset "+u+", count from end of last fragment"),u=o+r+u),f.logger.log("start time offset found in playlist, adjust startPosition to "+u),this.startPosition=u):i.live?(this.startPosition=this.computeLivePosition(o,i),f.logger.log("configure startPosition to "+this.startPosition)):this.startPosition=0,this.lastCurrentTime=this.startPosition}this.nextLoadPosition=this.startPosition}this.state===E.State.WAITING_LEVEL&&(this.state=E.State.IDLE),this.tick()},i.prototype.onKeyLoaded=function(){this.state===E.State.KEY_LOADING&&(this.state=E.State.IDLE,this.tick())},i.prototype.onFragLoaded=function(e){var t=this.fragCurrent,i=this.hls,s=this.levels,n=this.media,a=e.frag;if(this.state===E.State.FRAG_LOADING&&t&&"main"===a.type&&a.level===t.level&&a.sn===t.sn){var r=e.stats,d=s[t.level],u=d.details;if(this.bitrateTest=!1,this.stats=r,f.logger.log("Loaded "+t.sn+" of ["+u.startSN+" ,"+u.endSN+"],level "+t.level),a.bitrateTest&&i.nextLoadLevel)this.state=E.State.IDLE,this.startFragRequested=!1,r.tparsed=r.tbuffered=window.performance.now(),i.trigger(l.default.FRAG_BUFFERED,{stats:r,frag:t,id:"main"}),this.tick();else if("initSegment"===a.sn)this.state=E.State.IDLE,r.tparsed=r.tbuffered=window.performance.now(),u.initSegment.data=e.payload,i.trigger(l.default.FRAG_BUFFERED,{stats:r,frag:t,id:"main"}),this.tick();else{f.logger.log("Parsing "+t.sn+" of ["+u.startSN+" ,"+u.endSN+"],level "+t.level+", cc "+t.cc),this.state=E.State.PARSING,this.pendingBuffering=!0,this.appended=!1,a.bitrateTest&&(a.bitrateTest=!1,this.fragmentTracker.onFragLoaded({frag:a}));var c=!(n&&n.seeking)&&(u.PTSKnown||!u.live),h=u.initSegment?u.initSegment.data:[],p=this._getAudioCodec(d);(this.demuxer=this.demuxer||new o.default(this.hls,"main")).push(e.payload,h,p,d.videoCodec,t,u.totalduration,c)}}this.fragLoadError=0},i.prototype.onFragParsingInitSegment=function(e){var t=this.fragCurrent,i=e.frag;if(t&&"main"===e.id&&i.sn===t.sn&&i.level===t.level&&this.state===E.State.PARSING){var s=e.tracks,n=void 0,a=void 0;if(s.audio&&this.altAudio&&delete s.audio,a=s.audio){var r=this.levels[this.level].audioCodec,o=navigator.userAgent.toLowerCase();r&&this.audioCodecSwap&&(f.logger.log("swapping playlist audio codec"),r=-1!==r.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==a.metadata.channelCount&&-1===o.indexOf("firefox")&&(r="mp4a.40.5"),-1!==o.indexOf("android")&&"audio/mpeg"!==a.container&&(r="mp4a.40.2",f.logger.log("Android: force audio codec to "+r)),a.levelCodec=r,a.id=e.id}for(n in(a=s.video)&&(a.levelCodec=this.levels[this.level].videoCodec,a.id=e.id),this.hls.trigger(l.default.BUFFER_CODECS,s),s){a=s[n],f.logger.log("main track:"+n+",container:"+a.container+",codecs[level/parsed]=["+a.levelCodec+"/"+a.codec+"]");var d=a.initSegment;d&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(l.default.BUFFER_APPENDING,{type:n,data:d,parent:"main",content:"initSegment"}))}this.tick()}},i.prototype.onFragParsingData=function(t){var i=this,s=this.fragCurrent,n=t.frag;if(s&&"main"===t.id&&n.sn===s.sn&&n.level===s.level&&("audio"!==t.type||!this.altAudio)&&this.state===E.State.PARSING){var a=this.levels[this.level],r=s;if(e.isFinite(t.endPTS)||(t.endPTS=t.startPTS+s.duration,t.endDTS=t.startDTS+s.duration),!0===t.hasAudio&&r.addElementaryStream(u.default.ElementaryStreamTypes.AUDIO),!0===t.hasVideo&&r.addElementaryStream(u.default.ElementaryStreamTypes.VIDEO),f.logger.log("Parsed "+t.type+",PTS:["+t.startPTS.toFixed(3)+","+t.endPTS.toFixed(3)+"],DTS:["+t.startDTS.toFixed(3)+"/"+t.endDTS.toFixed(3)+"],nb:"+t.nb+",dropped:"+(t.dropped||0)),"video"===t.type)if(r.dropped=t.dropped,r.dropped)if(r.backtracked)f.logger.warn("Already backtracked on this fragment, appending with the gap",r.sn);else{var o=a.details;if(!o||r.sn!==o.startSN)return f.logger.warn("missing video frame(s), backtracking fragment",r.sn),this.fragmentTracker.removeFragment(r),r.backtracked=!0,this.nextLoadPosition=t.startPTS,this.state=E.State.IDLE,this.fragPrevious=r,void this.tick();f.logger.warn("missing video frame(s) on first frag, appending with gap",r.sn)}else r.backtracked=!1;var d=h.updateFragPTSDTS(a.details,r,t.startPTS,t.endPTS,t.startDTS,t.endDTS),c=this.hls;c.trigger(l.default.LEVEL_PTS_UPDATED,{details:a.details,level:this.level,drift:d,type:t.type,start:t.startPTS,end:t.endPTS}),[t.data1,t.data2].forEach(function(e){e&&e.length&&i.state===E.State.PARSING&&(i.appended=!0,i.pendingBuffering=!0,c.trigger(l.default.BUFFER_APPENDING,{type:t.type,data:e,parent:"main",content:"data"}))}),this.tick()}},i.prototype.onFragParsed=function(e){var t=this.fragCurrent,i=e.frag;t&&"main"===e.id&&i.sn===t.sn&&i.level===t.level&&this.state===E.State.PARSING&&(this.stats.tparsed=window.performance.now(),this.state=E.State.PARSED,this._checkAppendedParsed())},i.prototype.onAudioTrackSwitching=function(t){var i=!!t.url,s=t.id;if(!i){if(this.mediaBuffer!==this.media){f.logger.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var n=this.fragCurrent;n.loader&&(f.logger.log("switching to main audio track, cancel main fragment load"),n.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=E.State.IDLE}var a=this.hls;a.trigger(l.default.BUFFER_FLUSHING,{startOffset:0,endOffset:e.POSITIVE_INFINITY,type:"audio"}),a.trigger(l.default.AUDIO_TRACK_SWITCHED,{id:s}),this.altAudio=!1}},i.prototype.onAudioTrackSwitched=function(e){var t=e.id,i=!!this.hls.audioTracks[t].url;if(i){var s=this.videoBuffer;s&&this.mediaBuffer!==s&&(f.logger.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=s)}this.altAudio=i,this.tick()},i.prototype.onBufferCreated=function(e){var t,i,s=e.tracks,n=!1;for(var a in s){var r=s[a];"main"===r.id?(i=a,t=r,"video"===a&&(this.videoBuffer=s[a].buffer)):n=!0}n&&t?(f.logger.log("alternate track found, use "+i+".buffered to schedule main fragment loading"),this.mediaBuffer=t.buffer):this.mediaBuffer=this.media},i.prototype.onBufferAppended=function(e){if("main"===e.parent){var t=this.state;t!==E.State.PARSING&&t!==E.State.PARSED||(this.pendingBuffering=e.pending>0,this._checkAppendedParsed())}},i.prototype._checkAppendedParsed=function(){if(!(this.state!==E.State.PARSED||this.appended&&this.pendingBuffering)){var e=this.fragCurrent;if(e){var t=this.mediaBuffer?this.mediaBuffer:this.media;f.logger.log("main buffered : "+p.default.toString(t.buffered)),this.fragPrevious=e;var i=this.stats;i.tbuffered=window.performance.now(),this.fragLastKbps=Math.round(8*i.total/(i.tbuffered-i.tfirst)),this.hls.trigger(l.default.FRAG_BUFFERED,{stats:i,frag:e,id:"main"}),this.state=E.State.IDLE}this.tick()}},i.prototype.onError=function(t){var i=t.frag||this.fragCurrent;if(!i||"main"===i.type){var s=!!this.media&&r.BufferHelper.isBuffered(this.media,this.media.currentTime)&&r.BufferHelper.isBuffered(this.media,this.media.currentTime+.5);switch(t.details){case g.ErrorDetails.FRAG_LOAD_ERROR:case g.ErrorDetails.FRAG_LOAD_TIMEOUT:case g.ErrorDetails.KEY_LOAD_ERROR:case g.ErrorDetails.KEY_LOAD_TIMEOUT:if(!t.fatal)if(this.fragLoadError+1<=this.config.fragLoadingMaxRetry){var n=Math.min(Math.pow(2,this.fragLoadError)*this.config.fragLoadingRetryDelay,this.config.fragLoadingMaxRetryTimeout);f.logger.warn("mediaController: frag loading failed, retry in "+n+" ms"),this.retryDate=window.performance.now()+n,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.fragLoadError++,this.state=E.State.FRAG_LOADING_WAITING_RETRY}else f.logger.error("mediaController: "+t.details+" reaches max retry, redispatch as fatal ..."),t.fatal=!0,this.state=E.State.ERROR;break;case g.ErrorDetails.LEVEL_LOAD_ERROR:case g.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==E.State.ERROR&&(t.fatal?(this.state=E.State.ERROR,f.logger.warn("streamController: "+t.details+",switch to "+this.state+" state ...")):t.levelRetry||this.state!==E.State.WAITING_LEVEL||(this.state=E.State.IDLE));break;case g.ErrorDetails.BUFFER_FULL_ERROR:"main"!==t.parent||this.state!==E.State.PARSING&&this.state!==E.State.PARSED||(s?(this._reduceMaxBufferLength(this.config.maxBufferLength),this.state=E.State.IDLE):(f.logger.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,e.POSITIVE_INFINITY)))}}},i.prototype._reduceMaxBufferLength=function(e){var t=this.config;return t.maxMaxBufferLength>=e&&(t.maxMaxBufferLength/=2,f.logger.warn("main:reduce max buffer length to "+t.maxMaxBufferLength+"s"),!0)},i.prototype._checkBuffer=function(){var e=this.media;if(e&&0!==e.readyState){var t=(this.mediaBuffer?this.mediaBuffer:e).buffered;!this.loadedmetadata&&t.length?(this.loadedmetadata=!0,this._seekToStartPos()):this.immediateSwitch?this.immediateLevelSwitchEnd():this.gapController.poll(this.lastCurrentTime,t)}},i.prototype.onFragLoadEmergencyAborted=function(){this.state=E.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()},i.prototype.onBufferFlushed=function(){var e=this.mediaBuffer?this.mediaBuffer:this.media;e&&this.fragmentTracker.detectEvictedFragments(u.default.ElementaryStreamTypes.VIDEO,e.buffered),this.state=E.State.IDLE,this.fragPrevious=null},i.prototype.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},i.prototype.computeLivePosition=function(e,t){var i=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*t.targetduration;return e+Math.max(0,t.totalduration-i)},i.prototype._seekToStartPos=function(){var e=this.media,t=e.currentTime,i=e.seeking?t:this.startPosition;t!==i&&(f.logger.log("target start position not buffered, seek to buffered.start(0) "+i+" from current time "+t+" "),e.currentTime=i)},i.prototype._getAudioCodec=function(e){var t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&(f.logger.log("swapping playlist audio codec"),t&&(t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5")),t},Object.defineProperty(i.prototype,"liveSyncPosition",{get:function(){return this._liveSyncPosition},set:function(e){this._liveSyncPosition=e},enumerable:!0,configurable:!0}),i}(E.default);t.default=A}).call(this,i("./src/polyfills/number.js").Number)},"./src/controller/subtitle-stream-controller.js":function(e,t,i){var s,n=this&&this.__extends||(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},function(e,t){function i(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0});var a=i("./src/events.js"),r=i("./src/utils/logger.js"),o=i("./src/crypt/decrypter.js"),l=i("./src/utils/buffer-helper.js"),d=i("./src/controller/fragment-finders.js"),u=i("./src/controller/fragment-tracker.js"),c=i("./src/controller/base-stream-controller.js"),h=i("./src/controller/level-helper.js"),p=window.performance,g=function(e){function t(t,i){var s=e.call(this,t,a.default.MEDIA_ATTACHED,a.default.MEDIA_DETACHING,a.default.ERROR,a.default.KEY_LOADED,a.default.FRAG_LOADED,a.default.SUBTITLE_TRACKS_UPDATED,a.default.SUBTITLE_TRACK_SWITCH,a.default.SUBTITLE_TRACK_LOADED,a.default.SUBTITLE_FRAG_PROCESSED,a.default.LEVEL_UPDATED)||this;return s.fragmentTracker=i,s.config=t.config,s.state=c.State.STOPPED,s.tracks=[],s.tracksBuffered=[],s.currentTrackId=-1,s.decrypter=new o.default(t,t.config),s.lastAVStart=0,s._onMediaSeeking=s.onMediaSeeking.bind(s),s}return n(t,e),t.prototype.onSubtitleFragProcessed=function(e){var t=e.frag,i=e.success;if(this.fragPrevious=t,this.state=c.State.IDLE,i){var s=this.tracksBuffered[this.currentTrackId];if(s){for(var n,a=t.start,r=0;r<s.length;r++)if(a>=s[r].start&&a<=s[r].end){n=s[r];break}var o=t.start+t.duration;n?n.end=o:(n={start:a,end:o},s.push(n))}}},t.prototype.onMediaAttached=function(e){var t=e.media;this.media=t,t.addEventListener("seeking",this._onMediaSeeking),this.state=c.State.IDLE},t.prototype.onMediaDetaching=function(){this.media.removeEventListener("seeking",this._onMediaSeeking),this.media=null,this.state=c.State.STOPPED},t.prototype.onError=function(e){var t=e.frag;t&&"subtitle"===t.type&&(this.state=c.State.IDLE)},t.prototype.onSubtitleTracksUpdated=function(e){var t=this;r.logger.log("subtitle tracks updated"),this.tracksBuffered=[],this.tracks=e.subtitleTracks,this.tracks.forEach(function(e){t.tracksBuffered[e.id]=[]})},t.prototype.onSubtitleTrackSwitch=function(e){if(this.currentTrackId=e.id,this.tracks&&-1!==this.currentTrackId){var t=this.tracks[this.currentTrackId];t&&t.details&&this.setInterval(500)}else this.clearInterval()},t.prototype.onSubtitleTrackLoaded=function(e){var t=e.id,i=e.details,s=this.currentTrackId,n=this.tracks,a=n[s];t>=n.length||t!==s||!a||(i.live&&h.mergeSubtitlePlaylists(a.details,i,this.lastAVStart),a.details=i,this.setInterval(500))},t.prototype.onKeyLoaded=function(){this.state===c.State.KEY_LOADING&&(this.state=c.State.IDLE)},t.prototype.onFragLoaded=function(e){var t=this.fragCurrent,i=e.frag.decryptdata,s=e.frag,n=this.hls;if(this.state===c.State.FRAG_LOADING&&t&&"subtitle"===e.frag.type&&t.sn===e.frag.sn&&e.payload.byteLength>0&&i&&i.key&&"AES-128"===i.method){var r=p.now();this.decrypter.decrypt(e.payload,i.key.buffer,i.iv.buffer,function(e){var t=p.now();n.trigger(a.default.FRAG_DECRYPTED,{frag:s,payload:e,stats:{tstart:r,tdecrypt:t}})})}},t.prototype.onLevelUpdated=function(e){var t=e.details.fragments;this.lastAVStart=t.length?t[0].start:0},t.prototype.doTick=function(){if(this.media)switch(this.state){case c.State.IDLE:var e=this,t=e.config,i=e.currentTrackId,s=e.fragmentTracker,n=e.media,o=e.tracks;if(!o||!o[i]||!o[i].details)break;var h=t.maxBufferHole,p=t.maxFragLookUpTolerance,g=Math.min(t.maxBufferLength,t.maxMaxBufferLength),f=l.BufferHelper.bufferedInfo(this._getBuffered(),n.currentTime,h),v=f.end,m=f.len,_=o[i].details,E=_.fragments,A=E.length,y=E[A-1].start+E[A-1].duration;if(m>g)return;var S=void 0,b=this.fragPrevious;v<y?(b&&_.hasProgramDateTime&&(S=d.findFragmentByPDT(E,b.endProgramDateTime,p)),S||(S=d.findFragmentByPTS(b,E,v,p))):S=E[A-1],S&&S.encrypted?(r.logger.log("Loading key for "+S.sn),this.state=c.State.KEY_LOADING,this.hls.trigger(a.default.KEY_LOADING,{frag:S})):S&&s.getState(S)===u.FragmentState.NOT_LOADED&&(this.fragCurrent=S,this.state=c.State.FRAG_LOADING,this.hls.trigger(a.default.FRAG_LOADING,{frag:S}))}else this.state=c.State.IDLE},t.prototype.stopLoad=function(){this.lastAVStart=0,e.prototype.stopLoad.call(this)},t.prototype._getBuffered=function(){return this.tracksBuffered[this.currentTrackId]||[]},t.prototype.onMediaSeeking=function(){this.fragPrevious=null},t}(c.default);t.SubtitleStreamController=g},"./src/controller/subtitle-track-controller.js":function(e,t,i){(function(e){var s,n=this&&this.__extends||(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},function(e,t){function i(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0});var a=i("./src/events.js"),r=i("./src/event-handler.js"),o=i("./src/utils/logger.js"),l=i("./src/controller/level-helper.js"),d=function(t){function i(e){var i=t.call(this,e,a.default.MEDIA_ATTACHED,a.default.MEDIA_DETACHING,a.default.MANIFEST_LOADED,a.default.SUBTITLE_TRACK_LOADED)||this;return i.tracks=[],i.trackId=-1,i.media=null,i.stopped=!0,i.subtitleDisplay=!0,i}return n(i,t),i.prototype.destroy=function(){r.default.prototype.destroy.call(this)},i.prototype.onMediaAttached=function(e){var t=this;this.media=e.media,this.media&&(this.queuedDefaultTrack&&(this.subtitleTrack=this.queuedDefaultTrack,delete this.queuedDefaultTrack),this.trackChangeListener=this._onTextTracksChanged.bind(this),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.subtitlePollingInterval=setInterval(function(){t.trackChangeListener()},500):this.media.textTracks.addEventListener("change",this.trackChangeListener))},i.prototype.onMediaDetaching=function(){this.media&&(this.useTextTrackPolling?clearInterval(this.subtitlePollingInterval):this.media.textTracks.removeEventListener("change",this.trackChangeListener),this.media=null)},i.prototype.onManifestLoaded=function(e){var t=this,i=e.subtitles||[];this.tracks=i,this.hls.trigger(a.default.SUBTITLE_TRACKS_UPDATED,{subtitleTracks:i}),i.forEach(function(e){e.default&&(t.media?t.subtitleTrack=e.id:t.queuedDefaultTrack=e.id)})},i.prototype.onSubtitleTrackLoaded=function(e){var t=this,i=e.id,s=e.details,n=this.trackId,a=this.tracks,r=a[n];if(i>=a.length||i!==n||!r||this.stopped)this._clearReloadTimer();else if(o.logger.log("subtitle track "+i+" loaded"),s.live){var d=l.computeReloadInterval(r.details,s,e.stats.trequest);o.logger.log("Reloading live subtitle playlist in "+d+"ms"),this.timer=setTimeout(function(){t._loadCurrentTrack()},d)}else this._clearReloadTimer()},i.prototype.startLoad=function(){this.stopped=!1,this._loadCurrentTrack()},i.prototype.stopLoad=function(){this.stopped=!0,this._clearReloadTimer()},Object.defineProperty(i.prototype,"subtitleTracks",{get:function(){return this.tracks},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"subtitleTrack",{get:function(){return this.trackId},set:function(e){this.trackId!==e&&(this._toggleTrackModes(e),this._setSubtitleTrackInternal(e))},enumerable:!0,configurable:!0}),i.prototype._clearReloadTimer=function(){this.timer&&(clearTimeout(this.timer),this.timer=null)},i.prototype._loadCurrentTrack=function(){var e=this.trackId,t=this.tracks,i=this.hls,s=t[e];e<0||!s||s.details&&!s.details.live||(o.logger.log("Loading subtitle track "+e),i.trigger(a.default.SUBTITLE_TRACK_LOADING,{url:s.url,id:e}))},i.prototype._toggleTrackModes=function(e){var t=this.media,i=this.subtitleDisplay,s=this.trackId;if(t){var n=u(t.textTracks);if(-1===e)[].slice.call(n).forEach(function(e){e.mode="disabled"});else{var a=n[s];a&&(a.mode="disabled")}var r=n[e];r&&(r.mode=i?"showing":"hidden")}},i.prototype._setSubtitleTrackInternal=function(t){var i=this.hls,s=this.tracks;!e.isFinite(t)||t<-1||t>=s.length||(this.trackId=t,o.logger.log("Switching to subtitle track "+t),i.trigger(a.default.SUBTITLE_TRACK_SWITCH,{id:t}),this._loadCurrentTrack())},i.prototype._onTextTracksChanged=function(){if(this.media){for(var e=-1,t=u(this.media.textTracks),i=0;i<t.length;i++)if("hidden"===t[i].mode)e=i;else if("showing"===t[i].mode){e=i;break}this.subtitleTrack=e}},i}(r.default);function u(e){for(var t=[],i=0;i<e.length;i++){var s=e[i];"subtitles"===s.kind&&s.label&&t.push(e[i])}return t}t.default=d}).call(this,i("./src/polyfills/number.js").Number)},"./src/controller/timeline-controller.js":function(e,t,i){(function(e){var s,n=this&&this.__extends||(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},function(e,t){function i(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0});var a=i("./src/events.js"),r=i("./src/event-handler.js"),o=i("./src/utils/cea-608-parser.js"),l=i("./src/utils/output-filter.js"),d=i("./src/utils/webvtt-parser.js"),u=i("./src/utils/logger.js"),c=i("./src/utils/texttrack-utils.js");function h(e,t){return e&&e.label===t.name&&!(e.textTrack1||e.textTrack2)}var p=function(t){function i(e){var i=t.call(this,e,a.default.MEDIA_ATTACHING,a.default.MEDIA_DETACHING,a.default.FRAG_PARSING_USERDATA,a.default.FRAG_DECRYPTED,a.default.MANIFEST_LOADING,a.default.MANIFEST_LOADED,a.default.FRAG_LOADED,a.default.LEVEL_SWITCHING,a.default.INIT_PTS_FOUND)||this;if(i.hls=e,i.config=e.config,i.enabled=!0,i.Cues=e.config.cueHandler,i.textTracks=[],i.tracks=[],i.unparsedVttFrags=[],i.initPTS=[],i.cueRanges=[],i.captionsTracks={},i.captionsProperties={textTrack1:{label:i.config.captionsTextTrack1Label,languageCode:i.config.captionsTextTrack1LanguageCode},textTrack2:{label:i.config.captionsTextTrack2Label,languageCode:i.config.captionsTextTrack2LanguageCode}},i.config.enableCEA708Captions){var s=new l.default(i,"textTrack1"),n=new l.default(i,"textTrack2");i.cea608Parser=new o.default(0,s,n)}return i}return n(i,t),i.prototype.addCues=function(e,t,i,s){for(var n,a,r,o,l=this.cueRanges,d=!1,u=l.length;u--;){var c=l[u],h=(n=c[0],a=c[1],r=t,o=i,Math.min(a,o)-Math.max(n,r));if(h>=0&&(c[0]=Math.min(c[0],t),c[1]=Math.max(c[1],i),d=!0,h/(i-t)>.5))return}d||l.push([t,i]),this.Cues.newCue(this.captionsTracks[e],t,i,s)},i.prototype.onInitPtsFound=function(e){var t=this;if("main"===e.id&&(this.initPTS[e.frag.cc]=e.initPTS),this.unparsedVttFrags.length){var i=this.unparsedVttFrags;this.unparsedVttFrags=[],i.forEach(function(e){t.onFragLoaded(e)})}},i.prototype.getExistingTrack=function(e){var t=this.media;if(t)for(var i=0;i<t.textTracks.length;i++){var s=t.textTracks[i];if(s[e])return s}return null},i.prototype.createCaptionsTrack=function(e){var t=this.captionsProperties[e],i=t.label,s=t.languageCode,n=this.captionsTracks;if(!n[e]){var a=this.getExistingTrack(e);if(a)n[e]=a,c.clearCurrentCues(n[e]),c.sendAddTrackEvent(n[e],this.media);else{var r=this.createTextTrack("captions",i,s);r&&(r[e]=!0,n[e]=r)}}},i.prototype.createTextTrack=function(e,t,i){var s=this.media;if(s)return s.addTextTrack(e,t,i)},i.prototype.destroy=function(){r.default.prototype.destroy.call(this)},i.prototype.onMediaAttaching=function(e){this.media=e.media,this._cleanTracks()},i.prototype.onMediaDetaching=function(){var e=this.captionsTracks;Object.keys(e).forEach(function(t){c.clearCurrentCues(e[t]),delete e[t]})},i.prototype.onManifestLoading=function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this._cleanTracks()},i.prototype._cleanTracks=function(){var e=this.media;if(e){var t=e.textTracks;if(t)for(var i=0;i<t.length;i++)c.clearCurrentCues(t[i])}},i.prototype.onManifestLoaded=function(e){var t=this;if(this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.cueRanges=[],this.config.enableWebVTT){this.tracks=e.subtitles||[];var i=this.media?this.media.textTracks:[];this.tracks.forEach(function(e,s){var n;if(s<i.length){for(var a=null,r=0;r<i.length;r++)if(h(i[r],e)){a=i[r];break}a&&(n=a)}n||(n=t.createTextTrack("subtitles",e.name,e.lang)),e.default?n.mode=t.hls.subtitleDisplay?"showing":"hidden":n.mode="disabled",t.textTracks.push(n)})}},i.prototype.onLevelSwitching=function(){this.enabled="NONE"!==this.hls.currentLevel.closedCaptions},i.prototype.onFragLoaded=function(t){var i=t.frag,s=t.payload;if("main"===i.type){var n=i.sn;if(n!==this.lastSn+1){var r=this.cea608Parser;r&&r.reset()}this.lastSn=n}else if("subtitle"===i.type)if(s.byteLength){if(!e.isFinite(this.initPTS[i.cc]))return this.unparsedVttFrags.push(t),void(this.initPTS.length&&this.hls.trigger(a.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i}));var o=i.decryptdata;null!=o&&null!=o.key&&"AES-128"===o.method||this._parseVTTs(i,s)}else this.hls.trigger(a.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i})},i.prototype._parseVTTs=function(e,t){var i=this.vttCCs;i[e.cc]||(i[e.cc]={start:e.start,prevCC:this.prevCC,new:!0},this.prevCC=e.cc);var s=this.textTracks,n=this.hls;d.default.parse(t,this.initPTS[e.cc],i,e.cc,function(t){var i=s[e.level];"disabled"!==i.mode?(t.forEach(function(e){if(!i.cues.getCueById(e.id))try{i.addCue(e)}catch(s){var t=new window.TextTrackCue(e.startTime,e.endTime,e.text);t.id=e.id,i.addCue(t)}}),n.trigger(a.default.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})):n.trigger(a.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e})},function(t){u.logger.log("Failed to parse VTT cue: "+t),n.trigger(a.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e})})},i.prototype.onFragDecrypted=function(t){var i=t.payload,s=t.frag;if("subtitle"===s.type){if(!e.isFinite(this.initPTS[s.cc]))return void this.unparsedVttFrags.push(t);this._parseVTTs(s,i)}},i.prototype.onFragParsingUserdata=function(e){if(this.enabled&&this.config.enableCEA708Captions)for(var t=0;t<e.samples.length;t++){var i=this.extractCea608Data(e.samples[t].bytes);this.cea608Parser.addData(e.samples[t].pts,i)}},i.prototype.extractCea608Data=function(e){for(var t,i,s,n=31&e[0],a=2,r=[],o=0;o<n;o++)t=e[a++],i=127&e[a++],s=127&e[a++],0===i&&0===s||0!=(4&t)&&0===(3&t)&&(r.push(i),r.push(s));return r},i}(r.default);t.default=p}).call(this,i("./src/polyfills/number.js").Number)},"./src/crypt/aes-crypto.js":function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){this.subtle=e,this.aesIV=t}return e.prototype.decrypt=function(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)},e}();t.default=s},"./src/crypt/aes-decryptor.js":function(e,t,i){function s(e){var t=e.byteLength,i=t&&new DataView(e).getUint8(t-1);return i?e.slice(0,t-i):e}Object.defineProperty(t,"__esModule",{value:!0}),t.removePadding=s;var n=function(){function e(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}return e.prototype.uint8ArrayToUint32Array_=function(e){for(var t=new DataView(e),i=new Uint32Array(4),s=0;s<4;s++)i[s]=t.getUint32(4*s);return i},e.prototype.initTable=function(){var e=this.sBox,t=this.invSBox,i=this.subMix,s=i[0],n=i[1],a=i[2],r=i[3],o=this.invSubMix,l=o[0],d=o[1],u=o[2],c=o[3],h=new Uint32Array(256),p=0,g=0,f=0;for(f=0;f<256;f++)h[f]=f<128?f<<1:f<<1^283;for(f=0;f<256;f++){var v=g^g<<1^g<<2^g<<3^g<<4;v=v>>>8^255&v^99,e[p]=v,t[v]=p;var m=h[p],_=h[m],E=h[_],A=257*h[v]^16843008*v;s[p]=A<<24|A>>>8,n[p]=A<<16|A>>>16,a[p]=A<<8|A>>>24,r[p]=A,A=16843009*E^65537*_^257*m^16843008*p,l[v]=A<<24|A>>>8,d[v]=A<<16|A>>>16,u[v]=A<<8|A>>>24,c[v]=A,p?(p=m^h[h[h[E^m]]],g^=h[h[g]]):p=g=1}},e.prototype.expandKey=function(e){for(var t=this.uint8ArrayToUint32Array_(e),i=!0,s=0;s<t.length&&i;)i=t[s]===this.key[s],s++;if(!i){this.key=t;var n=this.keySize=t.length;if(4!==n&&6!==n&&8!==n)throw new Error("Invalid aes key size="+n);var a,r,o,l,d=this.ksRows=4*(n+6+1),u=this.keySchedule=new Uint32Array(d),c=this.invKeySchedule=new Uint32Array(d),h=this.sBox,p=this.rcon,g=this.invSubMix,f=g[0],v=g[1],m=g[2],_=g[3];for(a=0;a<d;a++)a<n?o=u[a]=t[a]:(l=o,a%n==0?(l=h[(l=l<<8|l>>>24)>>>24]<<24|h[l>>>16&255]<<16|h[l>>>8&255]<<8|h[255&l],l^=p[a/n|0]<<24):n>6&&a%n==4&&(l=h[l>>>24]<<24|h[l>>>16&255]<<16|h[l>>>8&255]<<8|h[255&l]),u[a]=o=(u[a-n]^l)>>>0);for(r=0;r<d;r++)a=d-r,l=3&r?u[a]:u[a-4],c[r]=r<4||a<=4?l:f[h[l>>>24]]^v[h[l>>>16&255]]^m[h[l>>>8&255]]^_[h[255&l]],c[r]=c[r]>>>0}},e.prototype.networkToHostOrderSwap=function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24},e.prototype.decrypt=function(e,t,i,n){for(var a,r,o,l,d,u,c,h,p,g,f,v,m,_,E=this.keySize+6,A=this.invKeySchedule,y=this.invSBox,S=this.invSubMix,b=S[0],T=S[1],C=S[2],I=S[3],D=this.uint8ArrayToUint32Array_(i),R=D[0],P=D[1],M=D[2],k=D[3],w=new Int32Array(e),O=new Int32Array(w.length),L=this.networkToHostOrderSwap;t<w.length;){for(p=L(w[t]),g=L(w[t+1]),f=L(w[t+2]),v=L(w[t+3]),d=p^A[0],u=v^A[1],c=f^A[2],h=g^A[3],m=4,_=1;_<E;_++)a=b[d>>>24]^T[u>>16&255]^C[c>>8&255]^I[255&h]^A[m],r=b[u>>>24]^T[c>>16&255]^C[h>>8&255]^I[255&d]^A[m+1],o=b[c>>>24]^T[h>>16&255]^C[d>>8&255]^I[255&u]^A[m+2],l=b[h>>>24]^T[d>>16&255]^C[u>>8&255]^I[255&c]^A[m+3],d=a,u=r,c=o,h=l,m+=4;a=y[d>>>24]<<24^y[u>>16&255]<<16^y[c>>8&255]<<8^y[255&h]^A[m],r=y[u>>>24]<<24^y[c>>16&255]<<16^y[h>>8&255]<<8^y[255&d]^A[m+1],o=y[c>>>24]<<24^y[h>>16&255]<<16^y[d>>8&255]<<8^y[255&u]^A[m+2],l=y[h>>>24]<<24^y[d>>16&255]<<16^y[u>>8&255]<<8^y[255&c]^A[m+3],m+=3,O[t]=L(a^R),O[t+1]=L(l^P),O[t+2]=L(o^M),O[t+3]=L(r^k),R=p,P=g,M=f,k=v,t+=4}return n?s(O.buffer):O.buffer},e.prototype.destroy=function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0},e}();t.default=n},"./src/crypt/decrypter.js":function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i("./src/crypt/aes-crypto.js"),n=i("./src/crypt/fast-aes-key.js"),a=i("./src/crypt/aes-decryptor.js"),r=i("./src/errors.js"),o=i("./src/utils/logger.js"),l=i("./src/events.js"),d=i("./src/utils/get-self-scope.js").getSelfScope(),u=function(){function e(e,t,i){var s=(void 0===i?{}:i).removePKCS7Padding,n=void 0===s||s;if(this.logEnabled=!0,this.observer=e,this.config=t,this.removePKCS7Padding=n,n)try{var a=d.crypto;a&&(this.subtle=a.subtle||a.webkitSubtle)}catch(e){}this.disableWebCrypto=!this.subtle}return e.prototype.isSync=function(){return this.disableWebCrypto&&this.config.enableSoftwareAES},e.prototype.decrypt=function(e,t,i,r){var l=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){this.logEnabled&&(o.logger.log("JS AES decrypt"),this.logEnabled=!1);var d=this.decryptor;d||(this.decryptor=d=new a.default),d.expandKey(t),r(d.decrypt(e,0,i,this.removePKCS7Padding))}else{this.logEnabled&&(o.logger.log("WebCrypto AES decrypt"),this.logEnabled=!1);var u=this.subtle;this.key!==t&&(this.key=t,this.fastAesKey=new n.default(u,t)),this.fastAesKey.expandKey().then(function(n){new s.default(u,i).decrypt(e,n).catch(function(s){l.onWebCryptoError(s,e,t,i,r)}).then(function(e){r(e)})}).catch(function(s){l.onWebCryptoError(s,e,t,i,r)})}},e.prototype.onWebCryptoError=function(e,t,i,s,n){this.config.enableSoftwareAES?(o.logger.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(t,i,s,n)):(o.logger.error("decrypting error : "+e.message),this.observer.trigger(l.default.ERROR,{type:r.ErrorTypes.MEDIA_ERROR,details:r.ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!0,reason:e.message}))},e.prototype.destroy=function(){var e=this.decryptor;e&&(e.destroy(),this.decryptor=void 0)},e}();t.default=u},"./src/crypt/fast-aes-key.js":function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){this.subtle=e,this.key=t}return e.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},e}();t.default=s},"./src/demux/aacdemuxer.js":function(e,t,i){(function(e){Object.defineProperty(t,"__esModule",{value:!0});var s=i("./src/demux/adts.js"),n=i("./src/utils/logger.js"),a=i("./src/demux/id3.js"),r=function(){function t(e,t,i){this.observer=e,this.config=i,this.remuxer=t}return t.prototype.resetInitSegment=function(e,t,i,s){this._audioTrack={container:"audio/adts",type:"audio",id:0,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:t,duration:s,inputTimeScale:9e4}},t.prototype.resetTimeStamp=function(){},t.probe=function(e){if(!e)return!1;for(var t=(a.default.getID3Data(e,0)||[]).length,i=e.length;t<i;t++)if(s.probe(e,t))return n.logger.log("ADTS sync word found !"),!0;return!1},t.prototype.append=function(t,i,r,o){for(var l=this._audioTrack,d=a.default.getID3Data(t,0)||[],u=a.default.getTimeStamp(d),c=e.isFinite(u)?90*u:9e4*i,h=0,p=c,g=t.length,f=d.length,v=[{pts:p,dts:p,data:d}];f<g-1;)if(s.isHeader(t,f)&&f+5<g){s.initTrackConfig(l,this.observer,t,f,l.manifestCodec);var m=s.appendFrame(l,t,f,c,h);if(!m){n.logger.log("Unable to parse AAC frame");break}f+=m.length,p=m.sample.pts,h++}else a.default.isHeader(t,f)?(d=a.default.getID3Data(t,f),v.push({pts:p,dts:p,data:d}),f+=d.length):f++;this.remuxer.remux(l,{samples:[]},{samples:v,inputTimeScale:9e4},{samples:[]},i,r,o)},t.prototype.destroy=function(){},t}();t.default=r}).call(this,i("./src/polyfills/number.js").Number)},"./src/demux/adts.js":function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i("./src/utils/logger.js"),n=i("./src/errors.js"),a=i("./src/events.js");function r(e,t,i,r){var o,l,d,u,c,h=navigator.userAgent.toLowerCase(),p=r,g=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];if(o=1+((192&t[i+2])>>>6),!((l=(60&t[i+2])>>>2)>g.length-1))return u=(1&t[i+2])<<2,u|=(192&t[i+3])>>>6,s.logger.log("manifest codec:"+r+",ADTS data:type:"+o+",sampleingIndex:"+l+"["+g[l]+"Hz],channelConfig:"+u),/firefox/i.test(h)?l>=6?(o=5,c=new Array(4),d=l-3):(o=2,c=new Array(2),d=l):-1!==h.indexOf("android")?(o=2,c=new Array(2),d=l):(o=5,c=new Array(4),r&&(-1!==r.indexOf("mp4a.40.29")||-1!==r.indexOf("mp4a.40.5"))||!r&&l>=6?d=l-3:((r&&-1!==r.indexOf("mp4a.40.2")&&(l>=6&&1===u||/vivaldi/i.test(h))||!r&&1===u)&&(o=2,c=new Array(2)),d=l)),c[0]=o<<3,c[0]|=(14&l)>>1,c[1]|=(1&l)<<7,c[1]|=u<<3,5===o&&(c[1]|=(14&d)>>1,c[2]=(1&d)<<7,c[2]|=8,c[3]=0),{config:c,samplerate:g[l],channelCount:u,codec:"mp4a.40."+o,manifestCodec:p};e.trigger(a.default.ERROR,{type:n.ErrorTypes.MEDIA_ERROR,details:n.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+l})}function o(e,t){return 255===e[t]&&240==(246&e[t+1])}function l(e,t){return 1&e[t+1]?7:9}function d(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function u(e){return 9216e4/e}function c(e,t,i,s,n){var a,r,o=e.length;if(a=l(e,t),r=d(e,t),(r-=a)>0&&t+a+r<=o)return{headerLength:a,frameLength:r,stamp:i+s*n}}t.getAudioConfig=r,t.isHeaderPattern=o,t.getHeaderLength=l,t.getFullFrameLength=d,t.isHeader=function(e,t){return!!(t+1<e.length&&o(e,t))},t.probe=function(e,t){if(t+1<e.length&&o(e,t)){var i=l(e,t);t+5<e.length&&(i=d(e,t));var s=t+i;if(s===e.length||s+1<e.length&&o(e,s))return!0}return!1},t.initTrackConfig=function(e,t,i,n,a){if(!e.samplerate){var o=r(t,i,n,a);e.config=o.config,e.samplerate=o.samplerate,e.channelCount=o.channelCount,e.codec=o.codec,e.manifestCodec=o.manifestCodec,s.logger.log("parsed codec:"+e.codec+",rate:"+o.samplerate+",nb channel:"+o.channelCount)}},t.getFrameDuration=u,t.parseFrameHeader=c,t.appendFrame=function(e,t,i,s,n){var a=c(t,i,s,n,u(e.samplerate));if(a){var r=a.stamp,o=a.headerLength,l=a.frameLength,d={unit:t.subarray(i+o,i+o+l),pts:r,dts:r};return e.samples.push(d),e.len+=l,{sample:d,length:l+o}}}},"./src/demux/demuxer-inline.js":function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s,n=i("./src/events.js"),a=i("./src/errors.js"),r=i("./src/crypt/decrypter.js"),o=i("./src/demux/aacdemuxer.js"),l=i("./src/demux/mp4demuxer.js"),d=i("./src/demux/tsdemuxer.js"),u=i("./src/demux/mp3demuxer.js"),c=i("./src/remux/mp4-remuxer.js"),h=i("./src/remux/passthrough-remuxer.js"),p=i("./src/utils/get-self-scope.js"),g=i("./src/utils/logger.js"),f=p.getSelfScope();try{s=f.performance.now.bind(f.performance)}catch(e){g.logger.debug("Unable to use Performance API on this environment"),s=f.Date.now}var v=function(){function e(e,t,i,s){this.observer=e,this.typeSupported=t,this.config=i,this.vendor=s}return e.prototype.destroy=function(){var e=this.demuxer;e&&e.destroy()},e.prototype.push=function(e,t,i,a,o,l,d,u,c,h,p,g){var f=this;if(e.byteLength>0&&null!=t&&null!=t.key&&"AES-128"===t.method){var v=this.decrypter;null==v&&(v=this.decrypter=new r.default(this.observer,this.config));var m=s();v.decrypt(e,t.key.buffer,t.iv.buffer,function(e){var r=s();f.observer.trigger(n.default.FRAG_DECRYPTED,{stats:{tstart:m,tdecrypt:r}}),f.pushDecrypted(new Uint8Array(e),t,new Uint8Array(i),a,o,l,d,u,c,h,p,g)})}else this.pushDecrypted(new Uint8Array(e),t,new Uint8Array(i),a,o,l,d,u,c,h,p,g)},e.prototype.pushDecrypted=function(e,t,i,s,r,p,g,f,v,m,_,E){var A=this.demuxer;if(!A||(g||f)&&!this.probe(e)){for(var y=this.observer,S=this.typeSupported,b=this.config,T=[{demux:d.default,remux:c.default},{demux:l.default,remux:h.default},{demux:o.default,remux:c.default},{demux:u.default,remux:c.default}],C=0,I=T.length;C<I;C++){var D=T[C],R=D.demux.probe;if(R(e)){var P=this.remuxer=new D.remux(y,b,S,this.vendor);A=new D.demux(y,P,b,S),this.probe=R;break}}if(!A)return void y.trigger(n.default.ERROR,{type:a.ErrorTypes.MEDIA_ERROR,details:a.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});this.demuxer=A}var M=this.remuxer;(g||f)&&(A.resetInitSegment(i,s,r,m),M.resetInitSegment()),g&&(A.resetTimeStamp(E),M.resetTimeStamp(E)),"function"==typeof A.setDecryptData&&A.setDecryptData(t),A.append(e,p,v,_)},e}();t.default=v},"./src/demux/demuxer-worker.js":function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i("./src/demux/demuxer-inline.js"),n=i("./src/events.js"),a=i("./src/utils/logger.js"),r=i("./node_modules/node-libs-browser/node_modules/events/events.js");t.default=function(e){var t=new r.EventEmitter;t.trigger=function(e){for(var i=[],s=1;s<arguments.length;s++)i[s-1]=arguments[s];t.emit.apply(t,[e,e].concat(i))},t.off=function(e){for(var i=[],s=1;s<arguments.length;s++)i[s-1]=arguments[s];t.removeListener.apply(t,[e].concat(i))};var i=function(t,i){e.postMessage({event:t,data:i})};e.addEventListener("message",function(n){var r=n.data;switch(r.cmd){case"init":var o=JSON.parse(r.config);e.demuxer=new s.default(t,r.typeSupported,o,r.vendor),a.enableLogs(o.debug),i("init",null);break;case"demux":e.demuxer.push(r.data,r.decryptdata,r.initSegment,r.audioCodec,r.videoCodec,r.timeOffset,r.discontinuity,r.trackSwitch,r.contiguous,r.duration,r.accurateTimeOffset,r.defaultInitPTS)}}),t.on(n.default.FRAG_DECRYPTED,i),t.on(n.default.FRAG_PARSING_INIT_SEGMENT,i),t.on(n.default.FRAG_PARSED,i),t.on(n.default.ERROR,i),t.on(n.default.FRAG_PARSING_METADATA,i),t.on(n.default.FRAG_PARSING_USERDATA,i),t.on(n.default.INIT_PTS_FOUND,i),t.on(n.default.FRAG_PARSING_DATA,function(t,i){var s=[],n={event:t,data:i};i.data1&&(n.data1=i.data1.buffer,s.push(i.data1.buffer),delete i.data1),i.data2&&(n.data2=i.data2.buffer,s.push(i.data2.buffer),delete i.data2),e.postMessage(n,s)})}},"./src/demux/demuxer.js":function(e,t,i){(function(e){Object.defineProperty(t,"__esModule",{value:!0});var s=i("./node_modules/webworkify-webpack/index.js"),n=i("./src/events.js"),a=i("./src/demux/demuxer-inline.js"),r=i("./src/utils/logger.js"),o=i("./src/errors.js"),l=i("./src/utils/mediasource-helper.js"),d=i("./src/utils/get-self-scope.js"),u=i("./src/observer.js"),c=d.getSelfScope(),h=l.getMediaSource(),p=function(){function t(e,t){var i=this;this.hls=e,this.id=t;var l=this.observer=new u.Observer,d=e.config,p=function(t,s){(s=s||{}).frag=i.frag,s.id=i.id,e.trigger(t,s)};l.on(n.default.FRAG_DECRYPTED,p),l.on(n.default.FRAG_PARSING_INIT_SEGMENT,p),l.on(n.default.FRAG_PARSING_DATA,p),l.on(n.default.FRAG_PARSED,p),l.on(n.default.ERROR,p),l.on(n.default.FRAG_PARSING_METADATA,p),l.on(n.default.FRAG_PARSING_USERDATA,p),l.on(n.default.INIT_PTS_FOUND,p);var g={mp4:h.isTypeSupported("video/mp4"),mpeg:h.isTypeSupported("audio/mpeg"),mp3:h.isTypeSupported('audio/mp4; codecs="mp3"')},f=navigator.vendor;if(d.enableWorker&&"undefined"!=typeof Worker){r.logger.log("demuxing in webworker");var v=void 0;try{v=this.w=s("./src/demux/demuxer-worker.js"),this.onwmsg=this.onWorkerMessage.bind(this),v.addEventListener("message",this.onwmsg),v.onerror=function(t){e.trigger(n.default.ERROR,{type:o.ErrorTypes.OTHER_ERROR,details:o.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:t.message+" ("+t.filename+":"+t.lineno+")"}})},v.postMessage({cmd:"init",typeSupported:g,vendor:f,id:t,config:JSON.stringify(d)})}catch(e){r.logger.warn("Error in worker:",e),r.logger.error("Error while initializing DemuxerWorker, fallback on DemuxerInline"),v&&c.URL.revokeObjectURL(v.objectURL),this.demuxer=new a.default(l,g,d,f),this.w=void 0}}else this.demuxer=new a.default(l,g,d,f)}return t.prototype.destroy=function(){var e=this.w;if(e)e.removeEventListener("message",this.onwmsg),e.terminate(),this.w=null;else{var t=this.demuxer;t&&(t.destroy(),this.demuxer=null)}var i=this.observer;i&&(i.removeAllListeners(),this.observer=null)},t.prototype.push=function(t,i,s,n,a,o,l,d){var u=this.w,c=e.isFinite(a.startPTS)?a.startPTS:a.start,h=a.decryptdata,p=this.frag,g=!(p&&a.cc===p.cc),f=!(p&&a.level===p.level),v=p&&a.sn===p.sn+1,m=!f&&v;if(g&&r.logger.log(this.id+":discontinuity detected"),f&&r.logger.log(this.id+":switch detected"),this.frag=a,u)u.postMessage({cmd:"demux",data:t,decryptdata:h,initSegment:i,audioCodec:s,videoCodec:n,timeOffset:c,discontinuity:g,trackSwitch:f,contiguous:m,duration:o,accurateTimeOffset:l,defaultInitPTS:d},t instanceof ArrayBuffer?[t]:[]);else{var _=this.demuxer;_&&_.push(t,h,i,s,n,c,g,f,m,o,l,d)}},t.prototype.onWorkerMessage=function(e){var t=e.data,i=this.hls;switch(t.event){case"init":c.URL.revokeObjectURL(this.w.objectURL);break;case n.default.FRAG_PARSING_DATA:t.data.data1=new Uint8Array(t.data1),t.data2&&(t.data.data2=new Uint8Array(t.data2));default:t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,i.trigger(t.event,t.data)}},t}();t.default=p}).call(this,i("./src/polyfills/number.js").Number)},"./src/demux/exp-golomb.js":function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i("./src/utils/logger.js"),n=function(){function e(e){this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}return e.prototype.loadWord=function(){var e=this.data,t=this.bytesAvailable,i=e.byteLength-t,s=new Uint8Array(4),n=Math.min(4,t);if(0===n)throw new Error("no bytes available");s.set(e.subarray(i,i+n)),this.word=new DataView(s.buffer).getUint32(0),this.bitsAvailable=8*n,this.bytesAvailable-=n},e.prototype.skipBits=function(e){var t;this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,e-=(t=e>>3)>>3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)},e.prototype.readBits=function(e){var t=Math.min(this.bitsAvailable,e),i=this.word>>>32-t;return e>32&&s.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0?this.word<<=t:this.bytesAvailable>0&&this.loadWord(),(t=e-t)>0&&this.bitsAvailable?i<<t|this.readBits(t):i},e.prototype.skipLZ=function(){var e;for(e=0;e<this.bitsAvailable;++e)if(0!=(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()},e.prototype.skipUEG=function(){this.skipBits(1+this.skipLZ())},e.prototype.skipEG=function(){this.skipBits(1+this.skipLZ())},e.prototype.readUEG=function(){var e=this.skipLZ();return this.readBits(e+1)-1},e.prototype.readEG=function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)},e.prototype.readBoolean=function(){return 1===this.readBits(1)},e.prototype.readUByte=function(){return this.readBits(8)},e.prototype.readUShort=function(){return this.readBits(16)},e.prototype.readUInt=function(){return this.readBits(32)},e.prototype.skipScalingList=function(e){var t,i=8,s=8;for(t=0;t<e;t++)0!==s&&(s=(i+this.readEG()+256)%256),i=0===s?i:s},e.prototype.readSPS=function(){var e,t,i,s,n,a,r,o=0,l=0,d=0,u=0,c=this.readUByte.bind(this),h=this.readBits.bind(this),p=this.readUEG.bind(this),g=this.readBoolean.bind(this),f=this.skipBits.bind(this),v=this.skipEG.bind(this),m=this.skipUEG.bind(this),_=this.skipScalingList.bind(this);if(c(),e=c(),h(5),f(3),c(),m(),100===e||110===e||122===e||244===e||44===e||83===e||86===e||118===e||128===e){var E=p();if(3===E&&f(1),m(),m(),f(1),g())for(a=3!==E?8:12,r=0;r<a;r++)g()&&_(r<6?16:64)}m();var A=p();if(0===A)p();else if(1===A)for(f(1),v(),v(),t=p(),r=0;r<t;r++)v();m(),f(1),i=p(),s=p(),0===(n=h(1))&&f(1),f(1),g()&&(o=p(),l=p(),d=p(),u=p());var y=[1,1];if(g()&&g())switch(c()){case 1:y=[1,1];break;case 2:y=[12,11];break;case 3:y=[10,11];break;case 4:y=[16,11];break;case 5:y=[40,33];break;case 6:y=[24,11];break;case 7:y=[20,11];break;case 8:y=[32,11];break;case 9:y=[80,33];break;case 10:y=[18,11];break;case 11:y=[15,11];break;case 12:y=[64,33];break;case 13:y=[160,99];break;case 14:y=[4,3];break;case 15:y=[3,2];break;case 16:y=[2,1];break;case 255:y=[c()<<8|c(),c()<<8|c()]}return{width:Math.ceil(16*(i+1)-2*o-2*l),height:(2-n)*(s+1)*16-(n?2:4)*(d+u),pixelRatio:y}},e.prototype.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},e}();t.default=n},"./src/demux/id3.js":function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(){}return e.isHeader=function(e,t){return t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},e.isFooter=function(e,t){return t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},e.getID3Data=function(t,i){for(var s=i,n=0;e.isHeader(t,i);){n+=10,n+=e._readSize(t,i+6),e.isFooter(t,i+10)&&(n+=10),i+=n}if(n>0)return t.subarray(s,s+n)},e._readSize=function(e,t){var i=0;return i=(127&e[t])<<21,i|=(127&e[t+1])<<14,i|=(127&e[t+2])<<7,i|=127&e[t+3]},e.getTimeStamp=function(t){for(var i=e.getID3Frames(t),s=0;s<i.length;s++){var n=i[s];if(e.isTimeStampFrame(n))return e._readTimeStamp(n)}},e.isTimeStampFrame=function(e){return e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info},e._getFrameData=function(t){var i=String.fromCharCode(t[0],t[1],t[2],t[3]),s=e._readSize(t,4);return{type:i,size:s,data:t.subarray(10,10+s)}},e.getID3Frames=function(t){for(var i=0,s=[];e.isHeader(t,i);){for(var n=e._readSize(t,i+6),a=(i+=10)+n;i+8<a;){var r=e._getFrameData(t.subarray(i)),o=e._decodeFrame(r);o&&s.push(o),i+=r.size+10}e.isFooter(t,i)&&(i+=10)}return s},e._decodeFrame=function(t){return"PRIV"===t.type?e._decodePrivFrame(t):"T"===t.type[0]?e._decodeTextFrame(t):"W"===t.type[0]?e._decodeURLFrame(t):void 0},e._readTimeStamp=function(e){if(8===e.data.byteLength){var t=new Uint8Array(e.data),i=1&t[3],s=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return s/=45,i&&(s+=47721858.84),Math.round(s)}},e._decodePrivFrame=function(t){if(!(t.size<2)){var i=e._utf8ArrayToStr(t.data,!0),s=new Uint8Array(t.data.subarray(i.length+1));return{key:t.type,info:i,data:s.buffer}}},e._decodeTextFrame=function(t){if(!(t.size<2)){if("TXXX"===t.type){var i=1,s=e._utf8ArrayToStr(t.data.subarray(i));i+=s.length+1;var n=e._utf8ArrayToStr(t.data.subarray(i));return{key:t.type,info:s,data:n}}var a=e._utf8ArrayToStr(t.data.subarray(1));return{key:t.type,data:a}}},e._decodeURLFrame=function(t){if("WXXX"===t.type){if(t.size<2)return;var i=1,s=e._utf8ArrayToStr(t.data.subarray(i));i+=s.length+1;var n=e._utf8ArrayToStr(t.data.subarray(i));return{key:t.type,info:s,data:n}}var a=e._utf8ArrayToStr(t.data);return{key:t.type,data:a}},e._utf8ArrayToStr=function(e,t){void 0===t&&(t=!1);for(var i,s,n,a=e.length,r="",o=0;o<a;){if(0===(i=e[o++])&&t)return r;if(0!==i&&3!==i)switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:r+=String.fromCharCode(i);break;case 12:case 13:s=e[o++],r+=String.fromCharCode((31&i)<<6|63&s);break;case 14:s=e[o++],n=e[o++],r+=String.fromCharCode((15&i)<<12|(63&s)<<6|(63&n)<<0)}}return r},e}(),n=s._utf8ArrayToStr;t.utf8ArrayToStr=n,t.default=s},"./src/demux/mp3demuxer.js":function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i("./src/demux/id3.js"),n=i("./src/utils/logger.js"),a=i("./src/demux/mpegaudio.js"),r=function(){function e(e,t,i){this.observer=e,this.config=i,this.remuxer=t}return e.prototype.resetInitSegment=function(e,t,i,s){this._audioTrack={container:"audio/mpeg",type:"audio",id:-1,sequenceNumber:0,isAAC:!1,samples:[],len:0,manifestCodec:t,duration:s,inputTimeScale:9e4}},e.prototype.resetTimeStamp=function(){},e.probe=function(e){var t,i,r=s.default.getID3Data(e,0);if(r&&void 0!==s.default.getTimeStamp(r))for(t=r.length,i=Math.min(e.length-1,t+100);t<i;t++)if(a.default.probe(e,t))return n.logger.log("MPEG Audio sync word found !"),!0;return!1},e.prototype.append=function(e,t,i,n){for(var r=s.default.getID3Data(e,0),o=s.default.getTimeStamp(r),l=o?90*o:9e4*t,d=r.length,u=e.length,c=0,h=0,p=this._audioTrack,g=[{pts:l,dts:l,data:r}];d<u;)if(a.default.isHeader(e,d)){var f=a.default.appendFrame(p,e,d,l,c);if(!f)break;d+=f.length,h=f.sample.pts,c++}else s.default.isHeader(e,d)?(r=s.default.getID3Data(e,d),g.push({pts:h,dts:h,data:r}),d+=r.length):d++;this.remuxer.remux(p,{samples:[]},{samples:g,inputTimeScale:9e4},{samples:[]},t,i,n)},e.prototype.destroy=function(){},e}();t.default=r},"./src/demux/mp4demuxer.js":function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i("./src/utils/logger.js"),n=i("./src/events.js"),a=Math.pow(2,32)-1,r=function(){function e(e,t){this.observer=e,this.remuxer=t}return e.prototype.resetTimeStamp=function(e){this.initPTS=e},e.prototype.resetInitSegment=function(t,i,s,a){if(t&&t.byteLength){var r=this.initData=e.parseInitSegment(t);null==i&&(i="mp4a.40.5"),null==s&&(s="avc1.42e01e");var o={};r.audio&&r.video?o.audiovideo={container:"video/mp4",codec:i+","+s,initSegment:a?t:null}:(r.audio&&(o.audio={container:"audio/mp4",codec:i,initSegment:a?t:null}),r.video&&(o.video={container:"video/mp4",codec:s,initSegment:a?t:null})),this.observer.trigger(n.default.FRAG_PARSING_INIT_SEGMENT,{tracks:o})}else i&&(this.audioCodec=i),s&&(this.videoCodec=s)},e.probe=function(t){return e.findBox({data:t,start:0,end:Math.min(t.length,16384)},["moof"]).length>0},e.bin2str=function(e){return String.fromCharCode.apply(null,e)},e.readUint16=function(e,t){e.data&&(t+=e.start,e=e.data);var i=e[t]<<8|e[t+1];return i<0?65536+i:i},e.readUint32=function(e,t){e.data&&(t+=e.start,e=e.data);var i=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3];return i<0?4294967296+i:i},e.writeUint32=function(e,t,i){e.data&&(t+=e.start,e=e.data),e[t]=i>>24,e[t+1]=i>>16&255,e[t+2]=i>>8&255,e[t+3]=255&i},e.findBox=function(t,i){var s,n,a,r,o,l,d=[];if(t.data?(o=t.start,a=t.end,t=t.data):(o=0,a=t.byteLength),!i.length)return null;for(s=o;s<a;)l=(n=e.readUint32(t,s))>1?s+n:a,e.bin2str(t.subarray(s+4,s+8))===i[0]&&(1===i.length?d.push({data:t,start:s+8,end:l}):(r=e.findBox({data:t,start:s+8,end:l},i.slice(1))).length&&(d=d.concat(r))),s=l;return d},e.parseSegmentIndex=function(t){var i,s=e.findBox(t,["moov"])[0],n=s?s.end:null,a=0,r=e.findBox(t,["sidx"]);if(!r||!r[0])return null;i=[];var o=(r=r[0]).data[0];a=0===o?8:16;var l=e.readUint32(r,a);a+=4;a+=0===o?8:16,a+=2;var d=r.end+0,u=e.readUint16(r,a);a+=2;for(var c=0;c<u;c++){var h=a,p=e.readUint32(r,h);h+=4;var g=2147483647&p;if(1===(2147483648&p)>>>31)return void console.warn("SIDX has hierarchical references (not supported)");var f=e.readUint32(r,h);h+=4,i.push({referenceSize:g,subsegmentDuration:f,info:{duration:f/l,start:d,end:d+g-1}}),d+=g,a=h+=4}return{earliestPresentationTime:0,timescale:l,version:o,referencesCount:u,references:i,moovEndOffset:n}},e.parseInitSegment=function(t){var i=[];return e.findBox(t,["moov","trak"]).forEach(function(t){var n=e.findBox(t,["tkhd"])[0];if(n){var a=n.data[n.start],r=0===a?12:20,o=e.readUint32(n,r),l=e.findBox(t,["mdia","mdhd"])[0];if(l){r=0===(a=l.data[l.start])?12:20;var d=e.readUint32(l,r),u=e.findBox(t,["mdia","hdlr"])[0];if(u){var c={soun:"audio",vide:"video"}[e.bin2str(u.data.subarray(u.start+8,u.start+12))];if(c){var h=e.findBox(t,["mdia","minf","stbl","stsd"]);if(h.length){h=h[0];var p=e.bin2str(h.data.subarray(h.start+12,h.start+16));s.logger.log("MP4Demuxer:"+c+":"+p+" found")}i[o]={timescale:d,type:c},i[c]={timescale:d,id:o}}}}}}),i},e.getStartDTS=function(t,i){var s,n,a;return s=e.findBox(i,["moof","traf"]),n=[].concat.apply([],s.map(function(i){return e.findBox(i,["tfhd"]).map(function(s){var n,a;return n=e.readUint32(s,4),a=t[n].timescale||9e4,e.findBox(i,["tfdt"]).map(function(t){var i,s;return i=t.data[t.start],s=e.readUint32(t,4),1===i&&(s*=Math.pow(2,32),s+=e.readUint32(t,8)),s})[0]/a})})),a=Math.min.apply(null,n),isFinite(a)?a:0},e.offsetStartDTS=function(t,i,s){e.findBox(i,["moof","traf"]).map(function(i){return e.findBox(i,["tfhd"]).map(function(n){var r=e.readUint32(n,4),o=t[r].timescale||9e4;e.findBox(i,["tfdt"]).map(function(t){var i=t.data[t.start],n=e.readUint32(t,4);if(0===i)e.writeUint32(t,4,n-s*o);else{n*=Math.pow(2,32),n+=e.readUint32(t,8),n-=s*o,n=Math.max(n,0);var r=Math.floor(n/(a+1)),l=Math.floor(n%(a+1));e.writeUint32(t,4,r),e.writeUint32(t,8,l)}})})})},e.prototype.append=function(t,i,s,a){var r=this.initData;r||(this.resetInitSegment(t,this.audioCodec,this.videoCodec,!1),r=this.initData);var o,l=this.initPTS;if(void 0===l){var d=e.getStartDTS(r,t);this.initPTS=l=d-i,this.observer.trigger(n.default.INIT_PTS_FOUND,{initPTS:l})}e.offsetStartDTS(r,t,l),o=e.getStartDTS(r,t),this.remuxer.remux(r.audio,r.video,null,null,o,s,a,t)},e.prototype.destroy=function(){},e}();t.default=r},"./src/demux/mpegaudio.js":function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s={BitratesMap:[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap:[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients:[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot:[0,1,1,4],appendFrame:function(e,t,i,s,n){if(!(i+24>t.length)){var a=this.parseHeader(t,i);if(a&&i+a.frameLength<=t.length){var r=s+n*(9e4*a.samplesPerFrame/a.sampleRate),o={unit:t.subarray(i,i+a.frameLength),pts:r,dts:r};return e.config=[],e.channelCount=a.channelCount,e.samplerate=a.sampleRate,e.samples.push(o),e.len+=a.frameLength,{sample:o,length:a.frameLength}}}},parseHeader:function(e,t){var i=e[t+1]>>3&3,n=e[t+1]>>1&3,a=e[t+2]>>4&15,r=e[t+2]>>2&3,o=e[t+2]>>1&1;if(1!==i&&0!==a&&15!==a&&3!==r){var l=3===i?3-n:3===n?3:4,d=1e3*s.BitratesMap[14*l+a-1],u=3===i?0:2===i?1:2,c=s.SamplingRateMap[3*u+r],h=e[t+3]>>6==3?1:2,p=s.SamplesCoefficients[i][n],g=s.BytesInSlot[n],f=8*p*g;return{sampleRate:c,channelCount:h,frameLength:parseInt(p*d/c+o,10)*g,samplesPerFrame:f}}},isHeaderPattern:function(e,t){return 255===e[t]&&224==(224&e[t+1])&&0!=(6&e[t+1])},isHeader:function(e,t){return!!(t+1<e.length&&this.isHeaderPattern(e,t))},probe:function(e,t){if(t+1<e.length&&this.isHeaderPattern(e,t)){var i=this.parseHeader(e,t),s=4;i&&i.frameLength&&(s=i.frameLength);var n=t+s;if(n===e.length||n+1<e.length&&this.isHeaderPattern(e,n))return!0}return!1}};t.default=s},"./src/demux/sample-aes.js":function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i("./src/crypt/decrypter.js"),n=function(){function e(e,t,i,n){this.decryptdata=i,this.discardEPB=n,this.decrypter=new s.default(e,t,{removePKCS7Padding:!1})}return e.prototype.decryptBuffer=function(e,t){this.decrypter.decrypt(e,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,t)},e.prototype.decryptAacSample=function(e,t,i,s){var n=e[t].unit,a=n.subarray(16,n.length-n.length%16),r=a.buffer.slice(a.byteOffset,a.byteOffset+a.length),o=this;this.decryptBuffer(r,function(a){a=new Uint8Array(a),n.set(a,16),s||o.decryptAacSamples(e,t+1,i)})},e.prototype.decryptAacSamples=function(e,t,i){for(;;t++){if(t>=e.length)return void i();if(!(e[t].unit.length<32)){var s=this.decrypter.isSync();if(this.decryptAacSample(e,t,i,s),!s)return}}},e.prototype.getAvcEncryptedData=function(e){for(var t=16*Math.floor((e.length-48)/160)+16,i=new Int8Array(t),s=0,n=32;n<=e.length-16;n+=160,s+=16)i.set(e.subarray(n,n+16),s);return i},e.prototype.getAvcDecryptedUnit=function(e,t){t=new Uint8Array(t);for(var i=0,s=32;s<=e.length-16;s+=160,i+=16)e.set(t.subarray(i,i+16),s);return e},e.prototype.decryptAvcSample=function(e,t,i,s,n,a){var r=this.discardEPB(n.data),o=this.getAvcEncryptedData(r),l=this;this.decryptBuffer(o.buffer,function(o){n.data=l.getAvcDecryptedUnit(r,o),a||l.decryptAvcSamples(e,t,i+1,s)})},e.prototype.decryptAvcSamples=function(e,t,i,s){for(;;t++,i=0){if(t>=e.length)return void s();for(var n=e[t].units;!(i>=n.length);i++){var a=n[i];if(!(a.length<=48||1!==a.type&&5!==a.type)){var r=this.decrypter.isSync();if(this.decryptAvcSample(e,t,i,s,a,r),!r)return}}}},e}();t.default=n},"./src/demux/tsdemuxer.js":function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i("./src/demux/adts.js"),n=i("./src/demux/mpegaudio.js"),a=i("./src/events.js"),r=i("./src/demux/exp-golomb.js"),o=i("./src/demux/sample-aes.js"),l=i("./src/utils/logger.js"),d=i("./src/errors.js"),u={video:1,audio:2,id3:3,text:4},c=function(){function e(e,t,i,s){this.observer=e,this.config=i,this.typeSupported=s,this.remuxer=t,this.sampleAes=null}return e.prototype.setDecryptData=function(e){null!=e&&null!=e.key&&"SAMPLE-AES"===e.method?this.sampleAes=new o.default(this.observer,this.config,e,this.discardEPB):this.sampleAes=null},e.probe=function(t){var i=e._syncOffset(t);return!(i<0)&&(i&&l.logger.warn("MPEG2-TS detected but first sync word found @ offset "+i+", junk ahead ?"),!0)},e._syncOffset=function(e){for(var t=Math.min(1e3,e.length-564),i=0;i<t;){if(71===e[i]&&71===e[i+188]&&71===e[i+376])return i;i++}return-1},e.createTrack=function(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:u[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0,dropped:"video"===e?0:void 0,isAAC:"audio"===e||void 0,duration:"audio"===e?t:void 0}},e.prototype.resetInitSegment=function(t,i,s,n){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=e.createTrack("video",n),this._audioTrack=e.createTrack("audio",n),this._id3Track=e.createTrack("id3",n),this._txtTrack=e.createTrack("text",n),this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=i,this.videoCodec=s,this._duration=n},e.prototype.resetTimeStamp=function(){},e.prototype.append=function(t,i,s,n){var r,o,u,c,h,p=t.length,g=!1;this.contiguous=s;var f=this.pmtParsed,v=this._avcTrack,m=this._audioTrack,_=this._id3Track,E=v.pid,A=m.pid,y=_.pid,S=this._pmtId,b=v.pesData,T=m.pesData,C=_.pesData,I=this._parsePAT,D=this._parsePMT,R=this._parsePES,P=this._parseAVCPES.bind(this),M=this._parseAACPES.bind(this),k=this._parseMPEGPES.bind(this),w=this._parseID3PES.bind(this),O=e._syncOffset(t);for(p-=(p+O)%188,r=O;r<p;r+=188)if(71===t[r]){if(o=!!(64&t[r+1]),u=((31&t[r+1])<<8)+t[r+2],(48&t[r+3])>>4>1){if((c=r+5+t[r+4])===r+188)continue}else c=r+4;switch(u){case E:o&&(b&&(h=R(b))&&void 0!==h.pts&&P(h,!1),b={data:[],size:0}),b&&(b.data.push(t.subarray(c,r+188)),b.size+=r+188-c);break;case A:o&&(T&&(h=R(T))&&void 0!==h.pts&&(m.isAAC?M(h):k(h)),T={data:[],size:0}),T&&(T.data.push(t.subarray(c,r+188)),T.size+=r+188-c);break;case y:o&&(C&&(h=R(C))&&void 0!==h.pts&&w(h),C={data:[],size:0}),C&&(C.data.push(t.subarray(c,r+188)),C.size+=r+188-c);break;case 0:o&&(c+=t[c]+1),S=this._pmtId=I(t,c);break;case S:o&&(c+=t[c]+1);var L=D(t,c,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,null!=this.sampleAes);(E=L.avc)>0&&(v.pid=E),(A=L.audio)>0&&(m.pid=A,m.isAAC=L.isAAC),(y=L.id3)>0&&(_.pid=y),g&&!f&&(l.logger.log("reparse from beginning"),g=!1,r=O-188),f=this.pmtParsed=!0;break;case 17:case 8191:break;default:g=!0}}else this.observer.trigger(a.default.ERROR,{type:d.ErrorTypes.MEDIA_ERROR,details:d.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});b&&(h=R(b))&&void 0!==h.pts?(P(h,!0),v.pesData=null):v.pesData=b,T&&(h=R(T))&&void 0!==h.pts?(m.isAAC?M(h):k(h),m.pesData=null):(T&&T.size&&l.logger.log("last AAC PES packet truncated,might overlap between fragments"),m.pesData=T),C&&(h=R(C))&&void 0!==h.pts?(w(h),_.pesData=null):_.pesData=C,null==this.sampleAes?this.remuxer.remux(m,v,_,this._txtTrack,i,s,n):this.decryptAndRemux(m,v,_,this._txtTrack,i,s,n)},e.prototype.decryptAndRemux=function(e,t,i,s,n,a,r){if(e.samples&&e.isAAC){var o=this;this.sampleAes.decryptAacSamples(e.samples,0,function(){o.decryptAndRemuxAvc(e,t,i,s,n,a,r)})}else this.decryptAndRemuxAvc(e,t,i,s,n,a,r)},e.prototype.decryptAndRemuxAvc=function(e,t,i,s,n,a,r){if(t.samples){var o=this;this.sampleAes.decryptAvcSamples(t.samples,0,0,function(){o.remuxer.remux(e,t,i,s,n,a,r)})}else this.remuxer.remux(e,t,i,s,n,a,r)},e.prototype.destroy=function(){this._initPTS=this._initDTS=void 0,this._duration=0},e.prototype._parsePAT=function(e,t){return(31&e[t+10])<<8|e[t+11]},e.prototype._parsePMT=function(e,t,i,s){var n,a,r={audio:-1,avc:-1,id3:-1,isAAC:!0};for(n=t+3+((15&e[t+1])<<8|e[t+2])-4,t+=12+((15&e[t+10])<<8|e[t+11]);t<n;){switch(a=(31&e[t+1])<<8|e[t+2],e[t]){case 207:if(!s){l.logger.log("unkown stream type:"+e[t]);break}case 15:-1===r.audio&&(r.audio=a);break;case 21:-1===r.id3&&(r.id3=a);break;case 219:if(!s){l.logger.log("unkown stream type:"+e[t]);break}case 27:-1===r.avc&&(r.avc=a);break;case 3:case 4:i?-1===r.audio&&(r.audio=a,r.isAAC=!1):l.logger.log("MPEG audio found, not supported in this browser for now");break;case 36:l.logger.warn("HEVC stream type found, not supported for now");break;default:l.logger.log("unkown stream type:"+e[t])}t+=5+((15&e[t+3])<<8|e[t+4])}return r},e.prototype._parsePES=function(e){var t,i,s,n,a,r,o,d,u=0,c=e.data;if(!e||0===e.size)return null;for(;c[0].length<19&&c.length>1;){var h=new Uint8Array(c[0].length+c[1].length);h.set(c[0]),h.set(c[1],c[0].length),c[0]=h,c.splice(1,1)}if(1===((t=c[0])[0]<<16)+(t[1]<<8)+t[2]){if((s=(t[4]<<8)+t[5])&&s>e.size-6)return null;192&(i=t[7])&&((r=536870912*(14&t[9])+4194304*(255&t[10])+16384*(254&t[11])+128*(255&t[12])+(254&t[13])/2)>4294967295&&(r-=8589934592),64&i?((o=536870912*(14&t[14])+4194304*(255&t[15])+16384*(254&t[16])+128*(255&t[17])+(254&t[18])/2)>4294967295&&(o-=8589934592),r-o>54e5&&(l.logger.warn(Math.round((r-o)/9e4)+"s delta between PTS and DTS, align them"),r=o)):o=r),d=(n=t[8])+9,e.size-=d,a=new Uint8Array(e.size);for(var p=0,g=c.length;p<g;p++){var f=(t=c[p]).byteLength;if(d){if(d>f){d-=f;continue}t=t.subarray(d),f-=d,d=0}a.set(t,u),u+=f}return s&&(s-=n+3),{data:a,pts:r,dts:o,len:s}}return null},e.prototype.pushAccesUnit=function(e,t){if(e.units.length&&e.frame){var i=t.samples,s=i.length;!this.config.forceKeyFrameOnDiscontinuity||!0===e.key||t.sps&&(s||this.contiguous)?(e.id=s,i.push(e)):t.dropped++}e.debug.length&&l.logger.log(e.pts+"/"+e.dts+":"+e.debug)},e.prototype._parseAVCPES=function(e,t){var i,s,n,a=this,o=this._avcTrack,l=this._parseAVCNALu(e.data),d=this.avcSample,u=!1,c=this.pushAccesUnit.bind(this),h=function(e,t,i,s){return{key:e,pts:t,dts:i,units:[],debug:s}};e.data=null,d&&l.length&&!o.audFound&&(c(d,o),d=this.avcSample=h(!1,e.pts,e.dts,"")),l.forEach(function(t){switch(t.type){case 1:s=!0,d||(d=a.avcSample=h(!0,e.pts,e.dts,"")),d.frame=!0;var l=t.data;if(u&&l.length>4){var p=new r.default(l).readSliceType();2!==p&&4!==p&&7!==p&&9!==p||(d.key=!0)}break;case 5:s=!0,d||(d=a.avcSample=h(!0,e.pts,e.dts,"")),d.key=!0,d.frame=!0;break;case 6:s=!0,(i=new r.default(a.discardEPB(t.data))).readUByte();for(var g=0,f=0,v=!1,m=0;!v&&i.bytesAvailable>1;){g=0;do{g+=m=i.readUByte()}while(255===m);f=0;do{f+=m=i.readUByte()}while(255===m);if(4===g&&0!==i.bytesAvailable){if(v=!0,181===i.readUByte())if(49===i.readUShort())if(1195456820===i.readUInt())if(3===i.readUByte()){var _=i.readUByte(),E=31&_,A=[_,i.readUByte()];for(n=0;n<E;n++)A.push(i.readUByte()),A.push(i.readUByte()),A.push(i.readUByte());a._insertSampleInOrder(a._txtTrack.samples,{type:3,pts:e.pts,bytes:A})}}else if(f<i.bytesAvailable)for(n=0;n<f;n++)i.readUByte()}break;case 7:if(s=!0,u=!0,!o.sps){var y=(i=new r.default(t.data)).readSPS();o.width=y.width,o.height=y.height,o.pixelRatio=y.pixelRatio,o.sps=[t.data],o.duration=a._duration;var S=t.data.subarray(1,4),b="avc1.";for(n=0;n<3;n++){var T=S[n].toString(16);T.length<2&&(T="0"+T),b+=T}o.codec=b}break;case 8:s=!0,o.pps||(o.pps=[t.data]);break;case 9:s=!1,o.audFound=!0,d&&c(d,o),d=a.avcSample=h(!1,e.pts,e.dts,"");break;case 12:s=!1;break;default:s=!1,d&&(d.debug+="unknown NAL "+t.type+" ")}d&&s&&d.units.push(t)}),t&&d&&(c(d,o),this.avcSample=null)},e.prototype._insertSampleInOrder=function(e,t){var i=e.length;if(i>0){if(t.pts>=e[i-1].pts)e.push(t);else for(var s=i-1;s>=0;s--)if(t.pts<e[s].pts){e.splice(s,0,t);break}}else e.push(t)},e.prototype._getLastNalUnit=function(){var e,t=this.avcSample;if(!t||0===t.units.length){var i=this._avcTrack.samples;t=i[i.length-1]}if(t){var s=t.units;e=s[s.length-1]}return e},e.prototype._parseAVCNALu=function(e){var t,i,s,n,a=0,r=e.byteLength,o=this._avcTrack,l=o.naluState||0,d=l,u=[],c=-1;for(-1===l&&(c=0,n=31&e[0],l=0,a=1);a<r;)if(t=e[a++],l)if(1!==l)if(t)if(1===t){var h,p;if(c>=0)s={data:e.subarray(c,a-l-1),type:n},u.push(s);else if(h=this._getLastNalUnit())if(d&&a<=4-d&&h.state&&(h.data=h.data.subarray(0,h.data.byteLength-d)),(i=a-l-1)>0)(p=new Uint8Array(h.data.byteLength+i)).set(h.data,0),p.set(e.subarray(0,i),h.data.byteLength),h.data=p;a<r?(c=a,n=31&e[a],l=0):l=-1}else l=0;else l=3;else l=t?0:2;else l=t?0:1;(c>=0&&l>=0&&(s={data:e.subarray(c,r),type:n,state:l},u.push(s)),0===u.length)&&((h=this._getLastNalUnit())&&((p=new Uint8Array(h.data.byteLength+e.byteLength)).set(h.data,0),p.set(e,h.data.byteLength),h.data=p));return o.naluState=l,u},e.prototype.discardEPB=function(e){for(var t,i,s=e.byteLength,n=[],a=1;a<s-2;)0===e[a]&&0===e[a+1]&&3===e[a+2]?(n.push(a+2),a+=2):a++;if(0===n.length)return e;t=s-n.length,i=new Uint8Array(t);var r=0;for(a=0;a<t;r++,a++)r===n[0]&&(r++,n.shift()),i[a]=e[r];return i},e.prototype._parseAACPES=function(e){var t,i,n,r,o,u=this._audioTrack,c=e.data,h=e.pts,p=this.aacOverFlow,g=this.aacLastPTS;if(p){var f=new Uint8Array(p.byteLength+c.byteLength);f.set(p,0),f.set(c,p.byteLength),c=f}for(n=0,o=c.length;n<o-1&&!s.isHeader(c,n);n++);if(n){var v=void 0,m=void 0;if(n<o-1?(v="AAC PES did not start with ADTS header,offset:"+n,m=!1):(v="no ADTS header found in AAC PES",m=!0),l.logger.warn("parsing error:"+v),this.observer.trigger(a.default.ERROR,{type:d.ErrorTypes.MEDIA_ERROR,details:d.ErrorDetails.FRAG_PARSING_ERROR,fatal:m,reason:v}),m)return}if(s.initTrackConfig(u,this.observer,c,n,this.audioCodec),i=0,t=s.getFrameDuration(u.samplerate),p&&g){var _=g+t;Math.abs(_-h)>1&&(l.logger.log("AAC: align PTS for overlapping frames by "+Math.round((_-h)/90)),h=_)}for(;n<o;)if(s.isHeader(c,n)&&n+5<o){var E=s.appendFrame(u,c,n,h,i);if(!E)break;n+=E.length,r=E.sample.pts,i++}else n++;p=n<o?c.subarray(n,o):null,this.aacOverFlow=p,this.aacLastPTS=r},e.prototype._parseMPEGPES=function(e){for(var t=e.data,i=t.length,s=0,a=0,r=e.pts;a<i;)if(n.default.isHeader(t,a)){var o=n.default.appendFrame(this._audioTrack,t,a,r,s);if(!o)break;a+=o.length,s++}else a++},e.prototype._parseID3PES=function(e){this._id3Track.samples.push(e)},e}();t.default=c},"./src/errors.js":function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.ErrorTypes={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",KEY_SYSTEM_ERROR:"keySystemError",MUX_ERROR:"muxError",OTHER_ERROR:"otherError"},t.ErrorDetails={KEY_SYSTEM_NO_KEYS:"keySystemNoKeys",KEY_SYSTEM_NO_ACCESS:"keySystemNoAccess",KEY_SYSTEM_NO_SESSION:"keySystemNoSession",KEY_SYSTEM_LICENSE_REQUEST_FAILED:"keySystemLicenseRequestFailed",MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",AUDIO_TRACK_LOAD_ERROR:"audioTrackLoadError",AUDIO_TRACK_LOAD_TIMEOUT:"audioTrackLoadTimeOut",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",REMUX_ALLOC_ERROR:"remuxAllocError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_ADD_CODEC_ERROR:"bufferAddCodecError",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",BUFFER_NUDGE_ON_STALL:"bufferNudgeOnStall",INTERNAL_EXCEPTION:"internalException"}},"./src/event-handler.js":function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i("./src/utils/logger.js"),n=i("./src/errors.js"),a=i("./src/events.js"),r={hlsEventGeneric:!0,hlsHandlerDestroying:!0,hlsHandlerDestroyed:!0},o=function(){function e(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];this.hls=e,this.onEvent=this.onEvent.bind(this),this.handledEvents=t,this.useGenericHandler=!0,this.registerListeners()}return e.prototype.destroy=function(){this.onHandlerDestroying(),this.unregisterListeners(),this.onHandlerDestroyed()},e.prototype.onHandlerDestroying=function(){},e.prototype.onHandlerDestroyed=function(){},e.prototype.isEventHandler=function(){return"object"==typeof this.handledEvents&&this.handledEvents.length&&"function"==typeof this.onEvent},e.prototype.registerListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){if(r[e])throw new Error("Forbidden event-name: "+e);this.hls.on(e,this.onEvent)},this)},e.prototype.unregisterListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){this.hls.off(e,this.onEvent)},this)},e.prototype.onEvent=function(e,t){this.onEventGeneric(e,t)},e.prototype.onEventGeneric=function(e,t){try{(function(e,t){var i="on"+e.replace("hls","");if("function"!=typeof this[i])throw new Error("Event "+e+" has no generic handler in this "+this.constructor.name+" class (tried "+i+")");return this[i].bind(this,t)}).call(this,e,t).call()}catch(t){s.logger.error("An internal error happened while handling event "+e+'. Error message: "'+t.message+'". Here is a stacktrace:',t),this.hls.trigger(a.default.ERROR,{type:n.ErrorTypes.OTHER_ERROR,details:n.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:e,err:t})}},e}();t.default=o},"./src/events.js":function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.default={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition"}},"./src/hls.js":function(e,t,i){var s,n=this&&this.__extends||(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},function(e,t){function i(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0});var a=i("./node_modules/url-toolkit/src/url-toolkit.js"),r=i("./src/errors.js"),o=i("./src/loader/playlist-loader.js"),l=i("./src/loader/fragment-loader.js"),d=i("./src/loader/key-loader.js"),u=i("./src/controller/fragment-tracker.js"),c=i("./src/controller/stream-controller.js"),h=i("./src/controller/level-controller.js"),p=i("./src/controller/id3-track-controller.js"),g=i("./src/is-supported.js"),f=i("./src/utils/logger.js"),v=i("./src/config.js"),m=i("./src/events.js"),_=function(e){function t(i){void 0===i&&(i={});var s=e.call(this)||this,n=t.DefaultConfig;if((i.liveSyncDurationCount||i.liveMaxLatencyDurationCount)&&(i.liveSyncDuration||i.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");for(var a in n)a in i||(i[a]=n[a]);if(void 0!==i.liveMaxLatencyDurationCount&&i.liveMaxLatencyDurationCount<=i.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==i.liveMaxLatencyDuration&&(i.liveMaxLatencyDuration<=i.liveSyncDuration||void 0===i.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');f.enableLogs(i.debug),s.config=i,s._autoLevelCapping=-1;var r=s.abrController=new i.abrController(s),g=new i.bufferController(s),v=new i.capLevelController(s),m=new i.fpsController(s),_=new o.default(s),E=new l.default(s),A=new d.default(s),y=new p.default(s),S=s.levelController=new h.default(s),b=new u.FragmentTracker(s),T=[S,s.streamController=new c.default(s,b)],C=i.audioStreamController;C&&T.push(new C(s,b)),s.networkControllers=T;var I=[_,E,A,r,g,v,m,y,b];if(C=i.audioTrackController){var D=new C(s);s.audioTrackController=D,I.push(D)}if(C=i.subtitleTrackController){var R=new C(s);s.subtitleTrackController=R,T.push(R)}if(C=i.emeController){var P=new C(s);s.emeController=P,I.push(P)}return(C=i.subtitleStreamController)&&T.push(new C(s,b)),(C=i.timelineController)&&I.push(new C(s)),s.coreComponents=I,s}return n(t,e),Object.defineProperty(t,"version",{get:function(){return"0.12.4"},enumerable:!0,configurable:!0}),t.isSupported=function(){return g.isSupported()},Object.defineProperty(t,"Events",{get:function(){return m.default},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ErrorTypes",{get:function(){return r.ErrorTypes},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ErrorDetails",{get:function(){return r.ErrorDetails},enumerable:!0,configurable:!0}),Object.defineProperty(t,"DefaultConfig",{get:function(){return t.defaultConfig?t.defaultConfig:v.hlsDefaultConfig},set:function(e){t.defaultConfig=e},enumerable:!0,configurable:!0}),t.prototype.destroy=function(){f.logger.log("destroy"),this.trigger(m.default.DESTROYING),this.detachMedia(),this.coreComponents.concat(this.networkControllers).forEach(function(e){e.destroy()}),this.url=null,this.removeAllListeners(),this._autoLevelCapping=-1},t.prototype.attachMedia=function(e){f.logger.log("attachMedia"),this.media=e,this.trigger(m.default.MEDIA_ATTACHING,{media:e})},t.prototype.detachMedia=function(){f.logger.log("detachMedia"),this.trigger(m.default.MEDIA_DETACHING),this.media=null},t.prototype.loadSource=function(e){e=a.buildAbsoluteURL(window.location.href,e,{alwaysNormalize:!0}),f.logger.log("loadSource:"+e),this.url=e,this.trigger(m.default.MANIFEST_LOADING,{url:e})},t.prototype.startLoad=function(e){void 0===e&&(e=-1),f.logger.log("startLoad("+e+")"),this.networkControllers.forEach(function(t){t.startLoad(e)})},t.prototype.stopLoad=function(){f.logger.log("stopLoad"),this.networkControllers.forEach(function(e){e.stopLoad()})},t.prototype.swapAudioCodec=function(){f.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},t.prototype.recoverMediaError=function(){f.logger.log("recoverMediaError");var e=this.media;this.detachMedia(),this.attachMedia(e)},Object.defineProperty(t.prototype,"levels",{get:function(){return this.levelController.levels},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentLevel",{get:function(){return this.streamController.currentLevel},set:function(e){f.logger.log("set currentLevel:"+e),this.loadLevel=e,this.streamController.immediateLevelSwitch()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nextLevel",{get:function(){return this.streamController.nextLevel},set:function(e){f.logger.log("set nextLevel:"+e),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"loadLevel",{get:function(){return this.levelController.level},set:function(e){f.logger.log("set loadLevel:"+e),this.levelController.manualLevel=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nextLoadLevel",{get:function(){return this.levelController.nextLoadLevel},set:function(e){this.levelController.nextLoadLevel=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"firstLevel",{get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(e){f.logger.log("set firstLevel:"+e),this.levelController.firstLevel=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"startLevel",{get:function(){return this.levelController.startLevel},set:function(e){f.logger.log("set startLevel:"+e);-1!==e&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"autoLevelCapping",{get:function(){return this._autoLevelCapping},set:function(e){f.logger.log("set autoLevelCapping:"+e),this._autoLevelCapping=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"autoLevelEnabled",{get:function(){return-1===this.levelController.manualLevel},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"manualLevel",{get:function(){return this.levelController.manualLevel},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"minAutoLevel",{get:function(){for(var e=this.levels,t=this.config.minAutoBitrate,i=e?e.length:0,s=0;s<i;s++){if((e[s].realBitrate?Math.max(e[s].realBitrate,e[s].bitrate):e[s].bitrate)>t)return s}return 0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxAutoLevel",{get:function(){var e=this.levels,t=this.autoLevelCapping;return-1===t&&e&&e.length?e.length-1:t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nextAutoLevel",{get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(e){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"audioTracks",{get:function(){var e=this.audioTrackController;return e?e.audioTracks:[]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"audioTrack",{get:function(){var e=this.audioTrackController;return e?e.audioTrack:-1},set:function(e){var t=this.audioTrackController;t&&(t.audioTrack=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"liveSyncPosition",{get:function(){return this.streamController.liveSyncPosition},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"subtitleTracks",{get:function(){var e=this.subtitleTrackController;return e?e.subtitleTracks:[]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"subtitleTrack",{get:function(){var e=this.subtitleTrackController;return e?e.subtitleTrack:-1},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleTrack=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"subtitleDisplay",{get:function(){var e=this.subtitleTrackController;return!!e&&e.subtitleDisplay},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)},enumerable:!0,configurable:!0}),t}(i("./src/observer.js").Observer);t.default=_},"./src/is-supported.js":function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i("./src/utils/mediasource-helper.js");t.isSupported=function(){var e=s.getMediaSource(),t=window.SourceBuffer||window.WebKitSourceBuffer,i=e&&"function"==typeof e.isTypeSupported&&e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),n=!t||t.prototype&&"function"==typeof t.prototype.appendBuffer&&"function"==typeof t.prototype.remove;return!!i&&!!n}},"./src/loader/fragment-loader.js":function(e,t,i){(function(e){var s,n=this&&this.__extends||(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},function(e,t){function i(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0});var a=i("./src/events.js"),r=i("./src/event-handler.js"),o=i("./src/errors.js"),l=i("./src/utils/logger.js"),d=function(t){function i(e){var i=t.call(this,e,a.default.FRAG_LOADING)||this;return i.loaders={},i}return n(i,t),i.prototype.destroy=function(){var e=this.loaders;for(var i in e){var s=e[i];s&&s.destroy()}this.loaders={},t.prototype.destroy.call(this)},i.prototype.onFragLoading=function(t){var i=t.frag,s=i.type,n=this.loaders,a=this.hls.config,r=a.fLoader,o=a.loader;i.loaded=0;var d,u,c,h=n[s];h&&(l.logger.warn("abort previous fragment loader for type: "+s),h.abort()),h=n[s]=i.loader=a.fLoader?new r(a):new o(a),d={url:i.url,frag:i,responseType:"arraybuffer",progressData:!1};var p=i.byteRangeStartOffset,g=i.byteRangeEndOffset;e.isFinite(p)&&e.isFinite(g)&&(d.rangeStart=p,d.rangeEnd=g),u={timeout:a.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:a.fragLoadingMaxRetryTimeout},c={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},h.load(d,u,c)},i.prototype.loadsuccess=function(e,t,i,s){void 0===s&&(s=null);var n=e.data,r=i.frag;r.loader=void 0,this.loaders[r.type]=void 0,this.hls.trigger(a.default.FRAG_LOADED,{payload:n,frag:r,stats:t,networkDetails:s})},i.prototype.loaderror=function(e,t,i){void 0===i&&(i=null);var s=t.frag,n=s.loader;n&&n.abort(),this.loaders[s.type]=void 0,this.hls.trigger(a.default.ERROR,{type:o.ErrorTypes.NETWORK_ERROR,details:o.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:t.frag,response:e,networkDetails:i})},i.prototype.loadtimeout=function(e,t,i){void 0===i&&(i=null);var s=t.frag,n=s.loader;n&&n.abort(),this.loaders[s.type]=void 0,this.hls.trigger(a.default.ERROR,{type:o.ErrorTypes.NETWORK_ERROR,details:o.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t.frag,networkDetails:i})},i.prototype.loadprogress=function(e,t,i,s){void 0===s&&(s=null);var n=t.frag;n.loaded=e.loaded,this.hls.trigger(a.default.FRAG_LOAD_PROGRESS,{frag:n,stats:e,networkDetails:s})},i}(r.default);t.default=d}).call(this,i("./src/polyfills/number.js").Number)},"./src/loader/fragment.js":function(e,t,i){(function(e){Object.defineProperty(t,"__esModule",{value:!0});var s=i("./node_modules/url-toolkit/src/url-toolkit.js"),n=i("./src/loader/level-key.js"),a=function(){function t(){var e;this._url=null,this._byteRange=null,this._decryptdata=null,this.tagList=[],this.programDateTime=null,this.rawProgramDateTime=null,this._elementaryStreams=((e={})[t.ElementaryStreamTypes.AUDIO]=!1,e[t.ElementaryStreamTypes.VIDEO]=!1,e)}return Object.defineProperty(t,"ElementaryStreamTypes",{get:function(){return{AUDIO:"audio",VIDEO:"video"}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"url",{get:function(){return!this._url&&this.relurl&&(this._url=s.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function(e){this._url=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"byteRange",{get:function(){if(!this._byteRange&&!this.rawByteRange)return[];if(this._byteRange)return this._byteRange;var e=[];if(this.rawByteRange){var t=this.rawByteRange.split("@",2);if(1===t.length){var i=this.lastByteRangeEndOffset;e[0]=i||0}else e[0]=parseInt(t[1]);e[1]=parseInt(t[0])+e[0],this._byteRange=e}return e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"byteRangeStartOffset",{get:function(){return this.byteRange[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"byteRangeEndOffset",{get:function(){return this.byteRange[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"decryptdata",{get:function(){return this._decryptdata||(this._decryptdata=this.fragmentDecryptdataFromLevelkey(this.levelkey,this.sn)),this._decryptdata},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"endProgramDateTime",{get:function(){if(!e.isFinite(this.programDateTime))return null;var t=e.isFinite(this.duration)?this.duration:0;return this.programDateTime+1e3*t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"encrypted",{get:function(){return!(!this.decryptdata||null===this.decryptdata.uri||null!==this.decryptdata.key)},enumerable:!0,configurable:!0}),t.prototype.addElementaryStream=function(e){this._elementaryStreams[e]=!0},t.prototype.hasElementaryStream=function(e){return!0===this._elementaryStreams[e]},t.prototype.createInitializationVector=function(e){for(var t=new Uint8Array(16),i=12;i<16;i++)t[i]=e>>8*(15-i)&255;return t},t.prototype.fragmentDecryptdataFromLevelkey=function(e,t){var i=e;return e&&e.method&&e.uri&&!e.iv&&((i=new n.default).method=e.method,i.baseuri=e.baseuri,i.reluri=e.reluri,i.iv=this.createInitializationVector(t)),i},t}();t.default=a}).call(this,i("./src/polyfills/number.js").Number)},"./src/loader/key-loader.js":function(e,t,i){var s,n=this&&this.__extends||(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},function(e,t){function i(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0});var a=i("./src/events.js"),r=i("./src/event-handler.js"),o=i("./src/errors.js"),l=i("./src/utils/logger.js"),d=function(e){function t(t){var i=e.call(this,t,a.default.KEY_LOADING)||this;return i.loaders={},i.decryptkey=null,i.decrypturl=null,i}return n(t,e),t.prototype.destroy=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy()}this.loaders={},r.default.prototype.destroy.call(this)},t.prototype.onKeyLoading=function(e){var t=e.frag,i=t.type,s=this.loaders[i],n=t.decryptdata,r=n.uri;if(r!==this.decrypturl||null===this.decryptkey){var o=this.hls.config;s&&(l.logger.warn("abort previous key loader for type:"+i),s.abort()),t.loader=this.loaders[i]=new o.loader(o),this.decrypturl=r,this.decryptkey=null;var d,u,c;d={url:r,frag:t,responseType:"arraybuffer"},u={timeout:o.fragLoadingTimeOut,maxRetry:0,retryDelay:o.fragLoadingRetryDelay,maxRetryDelay:o.fragLoadingMaxRetryTimeout},c={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},t.loader.load(d,u,c)}else this.decryptkey&&(n.key=this.decryptkey,this.hls.trigger(a.default.KEY_LOADED,{frag:t}))},t.prototype.loadsuccess=function(e,t,i){var s=i.frag;this.decryptkey=s.decryptdata.key=new Uint8Array(e.data),s.loader=void 0,this.loaders[s.type]=void 0,this.hls.trigger(a.default.KEY_LOADED,{frag:s})},t.prototype.loaderror=function(e,t){var i=t.frag,s=i.loader;s&&s.abort(),this.loaders[t.type]=void 0,this.hls.trigger(a.default.ERROR,{type:o.ErrorTypes.NETWORK_ERROR,details:o.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:i,response:e})},t.prototype.loadtimeout=function(e,t){var i=t.frag,s=i.loader;s&&s.abort(),this.loaders[t.type]=void 0,this.hls.trigger(a.default.ERROR,{type:o.ErrorTypes.NETWORK_ERROR,details:o.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:i})},t}(r.default);t.default=d},"./src/loader/level-key.js":function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i("./node_modules/url-toolkit/src/url-toolkit.js"),n=function(){function e(){this.method=null,this.key=null,this.iv=null,this._uri=null}return Object.defineProperty(e.prototype,"uri",{get:function(){return!this._uri&&this.reluri&&(this._uri=s.buildAbsoluteURL(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri},enumerable:!0,configurable:!0}),e}();t.default=n},"./src/loader/level.js":function(e,t,i){(function(e){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function t(e){this.endCC=0,this.endSN=0,this.fragments=[],this.initSegment=null,this.live=!0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=e,this.version=null}return Object.defineProperty(t.prototype,"hasProgramDateTime",{get:function(){return!(!this.fragments[0]||!e.isFinite(this.fragments[0].programDateTime))},enumerable:!0,configurable:!0}),t}();t.default=i}).call(this,i("./src/polyfills/number.js").Number)},"./src/loader/m3u8-parser.js":function(e,t,i){(function(e){Object.defineProperty(t,"__esModule",{value:!0});var s=i("./node_modules/url-toolkit/src/url-toolkit.js"),n=i("./src/loader/fragment.js"),a=i("./src/loader/level.js"),r=i("./src/loader/level-key.js"),o=i("./src/utils/attr-list.js"),l=i("./src/utils/logger.js"),d=i("./src/utils/codecs.js"),u=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g,c=/#EXT-X-MEDIA:(.*)/g,h=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)([\S+ ?]+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(""),"g"),p=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)([^:]*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,g=/\.(mp4|m4s|m4v|m4a)$/i,f=function(){function t(){}return t.findGroup=function(e,t){if(!e)return null;for(var i=null,s=0;s<e.length;s++){var n=e[s];n.id===t&&(i=n)}return i},t.convertAVC1ToAVCOTI=function(e){var t,i=e.split(".");return i.length>2?(t=i.shift()+".",t+=parseInt(i.shift()).toString(16),t+=("000"+parseInt(i.shift()).toString(16)).substr(-4)):t=e,t},t.resolve=function(e,t){return s.buildAbsoluteURL(t,e,{alwaysNormalize:!0})},t.parseMasterPlaylist=function(e,i){var s,n=[];function a(e,t){["video","audio"].forEach(function(i){var s=e.filter(function(e){return d.isCodecType(e,i)});if(s.length){var n=s.filter(function(e){return 0===e.lastIndexOf("avc1",0)||0===e.lastIndexOf("mp4a",0)});t[i+"Codec"]=n.length>0?n[0]:s[0],e=e.filter(function(e){return-1===s.indexOf(e)})}}),t.unknownCodecs=e}for(u.lastIndex=0;null!=(s=u.exec(e));){var r={},l=r.attrs=new o.default(s[1]);r.url=t.resolve(s[2],i);var c=l.decimalResolution("RESOLUTION");c&&(r.width=c.width,r.height=c.height),r.bitrate=l.decimalInteger("AVERAGE-BANDWIDTH")||l.decimalInteger("BANDWIDTH"),r.name=l.NAME,a([].concat((l.CODECS||"").split(/[ ,]+/)),r),r.videoCodec&&-1!==r.videoCodec.indexOf("avc1")&&(r.videoCodec=t.convertAVC1ToAVCOTI(r.videoCodec)),n.push(r)}return n},t.parseMasterPlaylistMedia=function(e,i,s,n){var a;void 0===n&&(n=[]);var r=[],l=0;for(c.lastIndex=0;null!==(a=c.exec(e));){var d={},u=new o.default(a[1]);if(u.TYPE===s){if(d.groupId=u["GROUP-ID"],d.name=u.NAME,d.type=s,d.default="YES"===u.DEFAULT,d.autoselect="YES"===u.AUTOSELECT,d.forced="YES"===u.FORCED,u.URI&&(d.url=t.resolve(u.URI,i)),d.lang=u.LANGUAGE,d.name||(d.name=d.lang),n.length){var h=t.findGroup(n,d.groupId);d.audioCodec=h?h.codec:n[0].codec}d.id=l++,r.push(d)}}return r},t.parseLevelPlaylist=function(t,i,s,d,u){var c,f,m=0,_=0,E=new a.default(i),A=new r.default,y=0,S=null,b=new n.default,T=null;for(h.lastIndex=0;null!==(c=h.exec(t));){var C=c[1];if(C){b.duration=parseFloat(C);var I=(" "+c[2]).slice(1);b.title=I||null,b.tagList.push(I?["INF",C,I]:["INF",C])}else if(c[3]){if(e.isFinite(b.duration)){var D=m++;b.type=d,b.start=_,b.levelkey=A,b.sn=D,b.level=s,b.cc=y,b.urlId=u,b.baseurl=i,b.relurl=(" "+c[3]).slice(1),v(b,S),E.fragments.push(b),S=b,_+=b.duration,b=new n.default}}else if(c[4]){if(b.rawByteRange=(" "+c[4]).slice(1),S){var R=S.byteRangeEndOffset;R&&(b.lastByteRangeEndOffset=R)}}else if(c[5])b.rawProgramDateTime=(" "+c[5]).slice(1),b.tagList.push(["PROGRAM-DATE-TIME",b.rawProgramDateTime]),null===T&&(T=E.fragments.length);else{for(c=c[0].match(p),f=1;f<c.length&&void 0===c[f];f++);var P=(" "+c[f+1]).slice(1),M=(" "+c[f+2]).slice(1);switch(c[f]){case"#":b.tagList.push(M?[P,M]:[P]);break;case"PLAYLIST-TYPE":E.type=P.toUpperCase();break;case"MEDIA-SEQUENCE":m=E.startSN=parseInt(P);break;case"TARGETDURATION":E.targetduration=parseFloat(P);break;case"VERSION":E.version=parseInt(P);break;case"EXTM3U":break;case"ENDLIST":E.live=!1;break;case"DIS":y++,b.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":y=parseInt(P);break;case"KEY":var k=P,w=new o.default(k),O=w.enumeratedString("METHOD"),L=w.URI,N=w.hexadecimalInteger("IV");O&&(A=new r.default,L&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(O)>=0&&(A.method=O,A.baseuri=i,A.reluri=L,A.key=null,A.iv=N));break;case"START":var U=P,B=new o.default(U).decimalFloatingPoint("TIME-OFFSET");e.isFinite(B)&&(E.startTimeOffset=B);break;case"MAP":var j=new o.default(P);b.relurl=j.URI,b.rawByteRange=j.BYTERANGE,b.baseurl=i,b.level=s,b.type=d,b.sn="initSegment",E.initSegment=b,(b=new n.default).rawProgramDateTime=E.initSegment.rawProgramDateTime;break;default:l.logger.warn("line parsed but not handled: "+c)}}}return(b=S)&&!b.relurl&&(E.fragments.pop(),_-=b.duration),E.totalduration=_,E.averagetargetduration=_/E.fragments.length,E.endSN=m-1,E.startCC=E.fragments[0]?E.fragments[0].cc:0,E.endCC=y,!E.initSegment&&E.fragments.length&&E.fragments.every(function(e){return g.test(e.relurl)})&&(l.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(b=new n.default).relurl=E.fragments[0].relurl,b.baseurl=i,b.level=s,b.type=d,b.sn="initSegment",E.initSegment=b,E.needSidxRanges=!0),T&&function(e,t){for(var i=e[t],s=t-1;s>=0;s--){var n=e[s];n.programDateTime=i.programDateTime-1e3*n.duration,i=n}}(E.fragments,T),E},t}();function v(t,i){t.rawProgramDateTime?t.programDateTime=Date.parse(t.rawProgramDateTime):i&&i.programDateTime&&(t.programDateTime=i.endProgramDateTime),e.isFinite(t.programDateTime)||(t.programDateTime=null,t.rawProgramDateTime=null)}t.default=f}).call(this,i("./src/polyfills/number.js").Number)},"./src/loader/playlist-loader.js":function(e,t,i){(function(e){var s,n=this&&this.__extends||(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},function(e,t){function i(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0});var a=i("./src/events.js"),r=i("./src/event-handler.js"),o=i("./src/errors.js"),l=i("./src/utils/logger.js"),d=i("./src/demux/mp4demuxer.js"),u=i("./src/loader/m3u8-parser.js"),c=window.performance,h={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},p={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"},g=function(t){function i(e){var i=t.call(this,e,a.default.MANIFEST_LOADING,a.default.LEVEL_LOADING,a.default.AUDIO_TRACK_LOADING,a.default.SUBTITLE_TRACK_LOADING)||this;return i.loaders={},i}return n(i,t),Object.defineProperty(i,"ContextType",{get:function(){return h},enumerable:!0,configurable:!0}),Object.defineProperty(i,"LevelType",{get:function(){return p},enumerable:!0,configurable:!0}),i.canHaveQualityLevels=function(e){return e!==h.AUDIO_TRACK&&e!==h.SUBTITLE_TRACK},i.mapContextToLevelType=function(e){switch(e.type){case h.AUDIO_TRACK:return p.AUDIO;case h.SUBTITLE_TRACK:return p.SUBTITLE;default:return p.MAIN}},i.getResponseUrl=function(e,t){var i=e.url;return void 0!==i&&0!==i.indexOf("data:")||(i=t.url),i},i.prototype.createInternalLoader=function(e){var t=this.hls.config,i=t.pLoader,s=t.loader,n=new(i||s)(t);return e.loader=n,this.loaders[e.type]=n,n},i.prototype.getInternalLoader=function(e){return this.loaders[e.type]},i.prototype.resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},i.prototype.destroyInternalLoaders=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}},i.prototype.destroy=function(){this.destroyInternalLoaders(),t.prototype.destroy.call(this)},i.prototype.onManifestLoading=function(e){this.load(e.url,{type:h.MANIFEST,level:0,id:null})},i.prototype.onLevelLoading=function(e){this.load(e.url,{type:h.LEVEL,level:e.level,id:e.id})},i.prototype.onAudioTrackLoading=function(e){this.load(e.url,{type:h.AUDIO_TRACK,level:null,id:e.id})},i.prototype.onSubtitleTrackLoading=function(e){this.load(e.url,{type:h.SUBTITLE_TRACK,level:null,id:e.id})},i.prototype.load=function(e,t){var i=this.hls.config;l.logger.debug("Loading playlist of type "+t.type+", level: "+t.level+", id: "+t.id);var s,n,a,r,o=this.getInternalLoader(t);if(o){var d=o.context;if(d&&d.url===e)return l.logger.trace("playlist request ongoing"),!1;l.logger.warn("aborting previous loader for type: "+t.type),o.abort()}switch(t.type){case h.MANIFEST:s=i.manifestLoadingMaxRetry,n=i.manifestLoadingTimeOut,a=i.manifestLoadingRetryDelay,r=i.manifestLoadingMaxRetryTimeout;break;case h.LEVEL:s=0,n=i.levelLoadingTimeOut;break;default:s=i.levelLoadingMaxRetry,n=i.levelLoadingTimeOut,a=i.levelLoadingRetryDelay,r=i.levelLoadingMaxRetryTimeout}o=this.createInternalLoader(t),t.url=e,t.responseType=t.responseType||"";var u={timeout:n,maxRetry:s,retryDelay:a,maxRetryDelay:r},c={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};return l.logger.debug("Calling internal loader delegate for URL: "+e),o.load(t,u,c),!0},i.prototype.loadsuccess=function(e,t,i,s){if(void 0===s&&(s=null),i.isSidxRequest)return this._handleSidxRequest(e,i),void this._handlePlaylistLoaded(e,t,i,s);this.resetInternalLoader(i.type);var n=e.data;t.tload=c.now(),0===n.indexOf("#EXTM3U")?n.indexOf("#EXTINF:")>0||n.indexOf("#EXT-X-TARGETDURATION:")>0?this._handleTrackOrLevelPlaylist(e,t,i,s):this._handleMasterPlaylist(e,t,i,s):this._handleManifestParsingError(e,i,"no EXTM3U delimiter",s)},i.prototype.loaderror=function(e,t,i){void 0===i&&(i=null),this._handleNetworkError(t,i,!1,e)},i.prototype.loadtimeout=function(e,t,i){void 0===i&&(i=null),this._handleNetworkError(t,i,!0)},i.prototype._handleMasterPlaylist=function(e,t,s,n){var r=this.hls,o=e.data,d=i.getResponseUrl(e,s),c=u.default.parseMasterPlaylist(o,d);if(c.length){var h=c.map(function(e){return{id:e.attrs.AUDIO,codec:e.audioCodec}}),p=u.default.parseMasterPlaylistMedia(o,d,"AUDIO",h),g=u.default.parseMasterPlaylistMedia(o,d,"SUBTITLES");if(p.length){var f=!1;p.forEach(function(e){e.url||(f=!0)}),!1===f&&c[0].audioCodec&&!c[0].attrs.AUDIO&&(l.logger.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),p.unshift({type:"main",name:"main"}))}r.trigger(a.default.MANIFEST_LOADED,{levels:c,audioTracks:p,subtitles:g,url:d,stats:t,networkDetails:n})}else this._handleManifestParsingError(e,s,"no level found in manifest",n)},i.prototype._handleTrackOrLevelPlaylist=function(t,s,n,r){var o=this.hls,l=n.id,d=n.level,p=n.type,g=i.getResponseUrl(t,n),f=e.isFinite(l)?l:0,v=e.isFinite(d)?d:f,m=i.mapContextToLevelType(n),_=u.default.parseLevelPlaylist(t.data,g,v,m,f);if(_.tload=s.tload,p===h.MANIFEST){var E={url:g,details:_};o.trigger(a.default.MANIFEST_LOADED,{levels:[E],audioTracks:[],url:g,stats:s,networkDetails:r})}if(s.tparsed=c.now(),_.needSidxRanges){var A=_.initSegment.url;this.load(A,{isSidxRequest:!0,type:p,level:d,levelDetails:_,id:l,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer"})}else n.levelDetails=_,this._handlePlaylistLoaded(t,s,n,r)},i.prototype._handleSidxRequest=function(e,t){var i=d.default.parseSegmentIndex(new Uint8Array(e.data));if(i){var s=i.references,n=t.levelDetails;s.forEach(function(e,t){var i=e.info,s=n.fragments[t];0===s.byteRange.length&&(s.rawByteRange=String(1+i.end-i.start)+"@"+String(i.start))}),n.initSegment.rawByteRange=String(i.moovEndOffset)+"@0"}},i.prototype._handleManifestParsingError=function(e,t,i,s){this.hls.trigger(a.default.ERROR,{type:o.ErrorTypes.NETWORK_ERROR,details:o.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:e.url,reason:i,networkDetails:s})},i.prototype._handleNetworkError=function(e,t,i,s){var n,r;void 0===i&&(i=!1),void 0===s&&(s=null),l.logger.info("A network error occured while loading a "+e.type+"-type playlist");var d=this.getInternalLoader(e);switch(e.type){case h.MANIFEST:n=i?o.ErrorDetails.MANIFEST_LOAD_TIMEOUT:o.ErrorDetails.MANIFEST_LOAD_ERROR,r=!0;break;case h.LEVEL:n=i?o.ErrorDetails.LEVEL_LOAD_TIMEOUT:o.ErrorDetails.LEVEL_LOAD_ERROR,r=!1;break;case h.AUDIO_TRACK:n=i?o.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:o.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,r=!1;break;default:r=!1}d&&(d.abort(),this.resetInternalLoader(e.type));var u={type:o.ErrorTypes.NETWORK_ERROR,details:n,fatal:r,url:d.url,loader:d,context:e,networkDetails:t};s&&(u.response=s),this.hls.trigger(a.default.ERROR,u)},i.prototype._handlePlaylistLoaded=function(e,t,s,n){var r=s.type,o=s.level,l=s.id,d=s.levelDetails;if(d.targetduration)if(i.canHaveQualityLevels(s.type))this.hls.trigger(a.default.LEVEL_LOADED,{details:d,level:o||0,id:l||0,stats:t,networkDetails:n});else switch(r){case h.AUDIO_TRACK:this.hls.trigger(a.default.AUDIO_TRACK_LOADED,{details:d,id:l,stats:t,networkDetails:n});break;case h.SUBTITLE_TRACK:this.hls.trigger(a.default.SUBTITLE_TRACK_LOADED,{details:d,id:l,stats:t,networkDetails:n})}else this._handleManifestParsingError(e,s,"invalid target duration",n)},i}(r.default);t.default=g}).call(this,i("./src/polyfills/number.js").Number)},"./src/observer.js":function(e,t,i){var s,n=this&&this.__extends||(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},function(e,t){function i(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.trigger=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];this.emit.apply(this,[e,e].concat(t))},t}(i("./node_modules/eventemitter3/index.js").EventEmitter);t.Observer=a},"./src/polyfills/number.js":function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i("./src/utils/get-self-scope.js").getSelfScope().Number;t.Number=s,s.isFinite=s.isFinite||function(e){return"number"==typeof e&&isFinite(e)}},"./src/remux/aac-helper.js":function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(){}return e.getSilentFrame=function(e,t){switch(e){case"mp4a.40.2":if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},e}();t.default=s},"./src/remux/mp4-generator.js":function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=Math.pow(2,32)-1,n=function(){function e(){}return e.init=function(){var t;for(t in e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var i=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),s=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);e.HDLR_TYPES={video:i,audio:s};var n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),a=new Uint8Array([0,0,0,0,0,0,0,0]);e.STTS=e.STSC=e.STCO=a,e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),e.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var r=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);e.FTYP=e.box(e.types.ftyp,r,l,r,o),e.DINF=e.box(e.types.dinf,e.box(e.types.dref,n))},e.box=function(e){for(var t,i=Array.prototype.slice.call(arguments,1),s=8,n=i.length,a=n;n--;)s+=i[n].byteLength;for((t=new Uint8Array(s))[0]=s>>24&255,t[1]=s>>16&255,t[2]=s>>8&255,t[3]=255&s,t.set(e,4),n=0,s=8;n<a;n++)t.set(i[n],s),s+=i[n].byteLength;return t},e.hdlr=function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])},e.mdat=function(t){return e.box(e.types.mdat,t)},e.mdhd=function(t,i){i*=t;var n=Math.floor(i/(s+1)),a=Math.floor(i%(s+1));return e.box(e.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,n>>24,n>>16&255,n>>8&255,255&n,a>>24,a>>16&255,a>>8&255,255&a,85,196,0,0]))},e.mdia=function(t){return e.box(e.types.mdia,e.mdhd(t.timescale,t.duration),e.hdlr(t.type),e.minf(t))},e.mfhd=function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))},e.minf=function(t){return"audio"===t.type?e.box(e.types.minf,e.box(e.types.smhd,e.SMHD),e.DINF,e.stbl(t)):e.box(e.types.minf,e.box(e.types.vmhd,e.VMHD),e.DINF,e.stbl(t))},e.moof=function(t,i,s){return e.box(e.types.moof,e.mfhd(t),e.traf(s,i))},e.moov=function(t){for(var i=t.length,s=[];i--;)s[i]=e.trak(t[i]);return e.box.apply(null,[e.types.moov,e.mvhd(t[0].timescale,t[0].duration)].concat(s).concat(e.mvex(t)))},e.mvex=function(t){for(var i=t.length,s=[];i--;)s[i]=e.trex(t[i]);return e.box.apply(null,[e.types.mvex].concat(s))},e.mvhd=function(t,i){i*=t;var n=Math.floor(i/(s+1)),a=Math.floor(i%(s+1)),r=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,n>>24,n>>16&255,n>>8&255,255&n,a>>24,a>>16&255,a>>8&255,255&a,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e.box(e.types.mvhd,r)},e.sdtp=function(t){var i,s,n=t.samples||[],a=new Uint8Array(4+n.length);for(s=0;s<n.length;s++)i=n[s].flags,a[s+4]=i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy;return e.box(e.types.sdtp,a)},e.stbl=function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.STTS),e.box(e.types.stsc,e.STSC),e.box(e.types.stsz,e.STSZ),e.box(e.types.stco,e.STCO))},e.avc1=function(t){var i,s,n,a=[],r=[];for(i=0;i<t.sps.length;i++)n=(s=t.sps[i]).byteLength,a.push(n>>>8&255),a.push(255&n),a=a.concat(Array.prototype.slice.call(s));for(i=0;i<t.pps.length;i++)n=(s=t.pps[i]).byteLength,r.push(n>>>8&255),r.push(255&n),r=r.concat(Array.prototype.slice.call(s));var o=e.box(e.types.avcC,new Uint8Array([1,a[3],a[4],a[5],255,224|t.sps.length].concat(a).concat([t.pps.length]).concat(r))),l=t.width,d=t.height,u=t.pixelRatio[0],c=t.pixelRatio[1];return e.box(e.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,255&l,d>>8&255,255&d,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),e.box(e.types.pasp,new Uint8Array([u>>24,u>>16&255,u>>8&255,255&u,c>>24,c>>16&255,c>>8&255,255&c])))},e.esds=function(e){var t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))},e.mp4a=function(t){var i=t.samplerate;return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,i>>8&255,255&i,0,0]),e.box(e.types.esds,e.esds(t)))},e.mp3=function(t){var i=t.samplerate;return e.box(e.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,i>>8&255,255&i,0,0]))},e.stsd=function(t){return"audio"===t.type?t.isAAC||"mp3"!==t.codec?e.box(e.types.stsd,e.STSD,e.mp4a(t)):e.box(e.types.stsd,e.STSD,e.mp3(t)):e.box(e.types.stsd,e.STSD,e.avc1(t))},e.tkhd=function(t){var i=t.id,n=t.duration*t.timescale,a=t.width,r=t.height,o=Math.floor(n/(s+1)),l=Math.floor(n%(s+1));return e.box(e.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,i>>24&255,i>>16&255,i>>8&255,255&i,0,0,0,0,o>>24,o>>16&255,o>>8&255,255&o,l>>24,l>>16&255,l>>8&255,255&l,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,a>>8&255,255&a,0,0,r>>8&255,255&r,0,0]))},e.traf=function(t,i){var n=e.sdtp(t),a=t.id,r=Math.floor(i/(s+1)),o=Math.floor(i%(s+1));return e.box(e.types.traf,e.box(e.types.tfhd,new Uint8Array([0,0,0,0,a>>24,a>>16&255,a>>8&255,255&a])),e.box(e.types.tfdt,new Uint8Array([1,0,0,0,r>>24,r>>16&255,r>>8&255,255&r,o>>24,o>>16&255,o>>8&255,255&o])),e.trun(t,n.length+16+20+8+16+8+8),n)},e.trak=function(t){return t.duration=t.duration||4294967295,e.box(e.types.trak,e.tkhd(t),e.mdia(t))},e.trex=function(t){var i=t.id;return e.box(e.types.trex,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},e.trun=function(t,i){var s,n,a,r,o,l,d=t.samples||[],u=d.length,c=12+16*u,h=new Uint8Array(c);for(i+=8+c,h.set([0,0,15,1,u>>>24&255,u>>>16&255,u>>>8&255,255&u,i>>>24&255,i>>>16&255,i>>>8&255,255&i],0),s=0;s<u;s++)a=(n=d[s]).duration,r=n.size,o=n.flags,l=n.cts,h.set([a>>>24&255,a>>>16&255,a>>>8&255,255&a,r>>>24&255,r>>>16&255,r>>>8&255,255&r,o.isLeading<<2|o.dependsOn,o.isDependedOn<<6|o.hasRedundancy<<4|o.paddingValue<<1|o.isNonSync,61440&o.degradPrio,15&o.degradPrio,l>>>24&255,l>>>16&255,l>>>8&255,255&l],12+16*s);return e.box(e.types.trun,h)},e.initSegment=function(t){e.types||e.init();var i,s=e.moov(t);return(i=new Uint8Array(e.FTYP.byteLength+s.byteLength)).set(e.FTYP),i.set(s,e.FTYP.byteLength),i},e}();t.default=n},"./src/remux/mp4-remuxer.js":function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i("./src/remux/aac-helper.js"),n=i("./src/remux/mp4-generator.js"),a=i("./src/events.js"),r=i("./src/errors.js"),o=i("./src/utils/logger.js"),l=function(){function e(e,t,i,s){this.observer=e,this.config=t,this.typeSupported=i;var n=navigator.userAgent;this.isSafari=s&&s.indexOf("Apple")>-1&&n&&!n.match("CriOS"),this.ISGenerated=!1}return e.prototype.destroy=function(){},e.prototype.resetTimeStamp=function(e){this._initPTS=this._initDTS=e},e.prototype.resetInitSegment=function(){this.ISGenerated=!1},e.prototype.remux=function(e,t,i,s,n,r,l){if(this.ISGenerated||this.generateIS(e,t,n),this.ISGenerated){var d=e.samples.length,u=t.samples.length,c=n,h=n;if(d&&u){var p=(e.samples[0].pts-t.samples[0].pts)/t.inputTimeScale;c+=Math.max(0,p),h+=Math.max(0,-p)}if(d){e.timescale||(o.logger.warn("regenerate InitSegment as audio detected"),this.generateIS(e,t,n));var g=this.remuxAudio(e,c,r,l);if(u){var f=void 0;g&&(f=g.endPTS-g.startPTS),t.timescale||(o.logger.warn("regenerate InitSegment as video detected"),this.generateIS(e,t,n)),this.remuxVideo(t,h,r,f,l)}}else if(u){var v=this.remuxVideo(t,h,r,0,l);v&&e.codec&&this.remuxEmptyAudio(e,c,r,v)}}i.samples.length&&this.remuxID3(i,n),s.samples.length&&this.remuxText(s,n),this.observer.trigger(a.default.FRAG_PARSED)},e.prototype.generateIS=function(e,t,i){var s,l,d=this.observer,u=e.samples,c=t.samples,h=this.typeSupported,p="audio/mp4",g={},f={tracks:g},v=void 0===this._initPTS;if(v&&(s=l=1/0),e.config&&u.length&&(e.timescale=e.samplerate,o.logger.log("audio sampling rate : "+e.samplerate),e.isAAC||(h.mpeg?(p="audio/mpeg",e.codec=""):h.mp3&&(e.codec="mp3")),g.audio={container:p,codec:e.codec,initSegment:!e.isAAC&&h.mpeg?new Uint8Array:n.default.initSegment([e]),metadata:{channelCount:e.channelCount}},v&&(s=l=u[0].pts-e.inputTimeScale*i)),t.sps&&t.pps&&c.length){var m=t.inputTimeScale;t.timescale=m,g.video={container:"video/mp4",codec:t.codec,initSegment:n.default.initSegment([t]),metadata:{width:t.width,height:t.height}},v&&(s=Math.min(s,c[0].pts-m*i),l=Math.min(l,c[0].dts-m*i),this.observer.trigger(a.default.INIT_PTS_FOUND,{initPTS:s}))}Object.keys(g).length?(d.trigger(a.default.FRAG_PARSING_INIT_SEGMENT,f),this.ISGenerated=!0,v&&(this._initPTS=s,this._initDTS=l)):d.trigger(a.default.ERROR,{type:r.ErrorTypes.MEDIA_ERROR,details:r.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})},e.prototype.remuxVideo=function(e,t,i,s,l){var d,u,c,h,p,g,f,v=8,m=e.timescale,_=e.samples,E=[],A=_.length,y=this._PTSNormalize,S=this._initPTS,b=this.nextAvcDts,T=this.isSafari;if(0!==A){T&&(i|=_.length&&b&&(l&&Math.abs(t-b/m)<.1||Math.abs(_[0].pts-b-S)<m/5)),i||(b=t*m),_.forEach(function(e){e.pts=y(e.pts-S,b),e.dts=y(e.dts-S,b)}),_.sort(function(e,t){var i=e.dts-t.dts,s=e.pts-t.pts;return i||s||e.id-t.id});var C=_.reduce(function(e,t){return Math.max(Math.min(e,t.pts-t.dts),-18e3)},0);if(C<0){o.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Math.round(C/90)+" ms to overcome this issue");for(var I=0;I<_.length;I++)_[I].dts+=C}var D=_[0];p=Math.max(D.dts,0),h=Math.max(D.pts,0);var R=Math.round((p-b)/90);i&&R&&(R>1?o.logger.log("AVC:"+R+" ms hole between fragments detected,filling it"):R<-1&&o.logger.log("AVC:"+-R+" ms overlapping between fragments detected"),p=b,_[0].dts=p,h=Math.max(h-R,b),_[0].pts=h,o.logger.log("Video/PTS/DTS adjusted: "+Math.round(h/90)+"/"+Math.round(p/90)+",delta:"+R+" ms")),D=_[_.length-1],f=Math.max(D.dts,0),g=Math.max(D.pts,0,f),T&&(d=Math.round((f-p)/(_.length-1)));var P=0,M=0;for(I=0;I<A;I++){for(var k=_[I],w=k.units,O=w.length,L=0,N=0;N<O;N++)L+=w[N].data.length;M+=L,P+=O,k.length=L,k.dts=T?p+I*d:Math.max(k.dts,p),k.pts=Math.max(k.pts,k.dts)}var U=M+4*P+8;try{u=new Uint8Array(U)}catch(e){return void this.observer.trigger(a.default.ERROR,{type:r.ErrorTypes.MUX_ERROR,details:r.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:U,reason:"fail allocating video mdat "+U})}var B=new DataView(u.buffer);B.setUint32(0,U),u.set(n.default.types.mdat,4);for(I=0;I<A;I++){var j=_[I],x=j.units,F=0,G=void 0;for(N=0,O=x.length;N<O;N++){var V=x[N],H=V.data,$=V.data.byteLength;B.setUint32(v,$),v+=4,u.set(H,v),v+=$,F+=4+$}if(T)G=Math.max(0,d*Math.round((j.pts-j.dts)/d));else{if(I<A-1)d=_[I+1].dts-j.dts;else{var q=this.config,W=j.dts-_[I>0?I-1:I].dts;if(q.stretchShortVideoTrack){var K=q.maxBufferHole,z=Math.floor(K*m),Y=(s?h+s*m:this.nextAudioPts)-j.pts;Y>z?((d=Y-W)<0&&(d=W),o.logger.log("It is approximately "+Y/90+" ms to the next segment; using duration "+d/90+" ms for the last video frame.")):d=W}else d=W}G=Math.round(j.pts-j.dts)}E.push({size:F,duration:d,cts:G,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:j.key?2:1,isNonSync:j.key?0:1}})}this.nextAvcDts=f+d;var X=e.dropped;if(e.len=0,e.nbNalu=0,e.dropped=0,E.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var J=E[0].flags;J.dependsOn=2,J.isNonSync=0}e.samples=E,c=n.default.moof(e.sequenceNumber++,p,e),e.samples=[];var Q={data1:c,data2:u,startPTS:h/m,endPTS:(g+d)/m,startDTS:p/m,endDTS:this.nextAvcDts/m,type:"video",hasAudio:!1,hasVideo:!0,nb:E.length,dropped:X};return this.observer.trigger(a.default.FRAG_PARSING_DATA,Q),Q}},e.prototype.remuxAudio=function(e,t,i,l){var d,u,c,h,p,g,f,v=e.inputTimeScale,m=e.timescale,_=v/m,E=(e.isAAC?1024:1152)*_,A=this._PTSNormalize,y=this._initPTS,S=!e.isAAC&&this.typeSupported.mpeg,b=e.samples,T=[],C=this.nextAudioPts;if(i|=b.length&&C&&(l&&Math.abs(t-C/v)<.1||Math.abs(b[0].pts-C-y)<20*E),b.forEach(function(e){e.pts=e.dts=A(e.pts-y,t*v)}),0!==(b=b.filter(function(e){return e.pts>=0})).length){if(i||(C=l?t*v:b[0].pts),e.isAAC)for(var I=this.config.maxAudioFramesDrift,D=0,R=C;D<b.length;){var P,M=b[D];P=(j=M.pts)-R;var k=Math.abs(1e3*P/v);if(P<=-I*E)o.logger.warn("Dropping 1 audio frame @ "+(R/v).toFixed(3)+"s due to "+Math.round(k)+" ms overlap."),b.splice(D,1),e.len-=M.unit.length;else if(P>=I*E&&k<1e4&&R){var w=Math.round(P/E);o.logger.warn("Injecting "+w+" audio frame @ "+(R/v).toFixed(3)+"s due to "+Math.round(1e3*P/v)+" ms gap.");for(var O=0;O<w;O++){var L=Math.max(R,0);(c=s.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(o.logger.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),c=M.unit.subarray()),b.splice(D,0,{unit:c,pts:L,dts:L}),e.len+=c.length,R+=E,D++}M.pts=M.dts=R,R+=E,D++}else Math.abs(P),M.pts=M.dts=R,R+=E,D++}O=0;for(var N=b.length;O<N;O++){var U=b[O],B=U.unit,j=U.pts;if(void 0!==f)u.duration=Math.round((j-f)/_);else{var x=Math.round(1e3*(j-C)/v),F=0;if(i&&e.isAAC&&x){if(x>0&&x<1e4)F=Math.round((j-C)/E),o.logger.log(x+" ms hole between AAC samples detected,filling it"),F>0&&((c=s.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(c=B.subarray()),e.len+=F*c.length);else if(x<-12){o.logger.log("drop overlapping AAC sample, expected/parsed/delta:"+(C/v).toFixed(3)+"s/"+(j/v).toFixed(3)+"s/"+-x+"ms"),e.len-=B.byteLength;continue}j=C}if(g=j,!(e.len>0))return;var G=S?e.len:e.len+8;d=S?0:8;try{h=new Uint8Array(G)}catch(e){return void this.observer.trigger(a.default.ERROR,{type:r.ErrorTypes.MUX_ERROR,details:r.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:G,reason:"fail allocating audio mdat "+G})}S||(new DataView(h.buffer).setUint32(0,G),h.set(n.default.types.mdat,4));for(D=0;D<F;D++)(c=s.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(o.logger.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),c=B.subarray()),h.set(c,d),d+=c.byteLength,u={size:c.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},T.push(u)}h.set(B,d);var V=B.byteLength;d+=V,u={size:V,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},T.push(u),f=j}var H=0,$=T.length;if($>=2&&(H=T[$-2].duration,u.duration=H),$){this.nextAudioPts=C=f+_*H,e.len=0,e.samples=T,p=S?new Uint8Array:n.default.moof(e.sequenceNumber++,g/_,e),e.samples=[];var q=g/v,W=C/v,K={data1:p,data2:h,startPTS:q,endPTS:W,startDTS:q,endDTS:W,type:"audio",hasAudio:!0,hasVideo:!1,nb:$};return this.observer.trigger(a.default.FRAG_PARSING_DATA,K),K}return null}},e.prototype.remuxEmptyAudio=function(e,t,i,n){var a=e.inputTimeScale,r=a/(e.samplerate?e.samplerate:a),l=this.nextAudioPts,d=(void 0!==l?l:n.startDTS*a)+this._initDTS,u=n.endDTS*a+this._initDTS,c=1024*r,h=Math.ceil((u-d)/c),p=s.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(o.logger.warn("remux empty Audio"),p){for(var g=[],f=0;f<h;f++){var v=d+f*c;g.push({unit:p,pts:v,dts:v}),e.len+=p.length}e.samples=g,this.remuxAudio(e,t,i)}else o.logger.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!")},e.prototype.remuxID3=function(e){var t,i=e.samples.length,s=e.inputTimeScale,n=this._initPTS,r=this._initDTS;if(i){for(var o=0;o<i;o++)(t=e.samples[o]).pts=(t.pts-n)/s,t.dts=(t.dts-r)/s;this.observer.trigger(a.default.FRAG_PARSING_METADATA,{samples:e.samples})}e.samples=[]},e.prototype.remuxText=function(e){e.samples.sort(function(e,t){return e.pts-t.pts});var t,i=e.samples.length,s=e.inputTimeScale,n=this._initPTS;if(i){for(var r=0;r<i;r++)(t=e.samples[r]).pts=(t.pts-n)/s;this.observer.trigger(a.default.FRAG_PARSING_USERDATA,{samples:e.samples})}e.samples=[]},e.prototype._PTSNormalize=function(e,t){var i;if(void 0===t)return e;for(i=t<e?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=i;return e},e}();t.default=l},"./src/remux/passthrough-remuxer.js":function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i("./src/events.js"),n=function(){function e(e){this.observer=e}return e.prototype.destroy=function(){},e.prototype.resetTimeStamp=function(){},e.prototype.resetInitSegment=function(){},e.prototype.remux=function(e,t,i,n,a,r,o,l){var d=this.observer,u="";e&&(u+="audio"),t&&(u+="video"),d.trigger(s.default.FRAG_PARSING_DATA,{data1:l,startPTS:a,startDTS:a,type:u,hasAudio:!!e,hasVideo:!!t,nb:1,dropped:0}),d.trigger(s.default.FRAG_PARSED)},e}();t.default=n},"./src/task-loop.js":function(e,t,i){var s,n=this&&this.__extends||(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},function(e,t){function i(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(t){for(var i=[],s=1;s<arguments.length;s++)i[s-1]=arguments[s];var n=e.apply(this,[t].concat(i))||this;return n._tickInterval=null,n._tickTimer=null,n._tickCallCount=0,n._boundTick=n.tick.bind(n),n}return n(t,e),t.prototype.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},t.prototype.hasInterval=function(){return!!this._tickInterval},t.prototype.hasNextTick=function(){return!!this._tickTimer},t.prototype.setInterval=function(e){return!this._tickInterval&&(this._tickInterval=setInterval(this._boundTick,e),!0)},t.prototype.clearInterval=function(){return!!this._tickInterval&&(clearInterval(this._tickInterval),this._tickInterval=null,!0)},t.prototype.clearNextTick=function(){return!!this._tickTimer&&(clearTimeout(this._tickTimer),this._tickTimer=null,!0)},t.prototype.tick=function(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&(this.clearNextTick(),this._tickTimer=setTimeout(this._boundTick,0)),this._tickCallCount=0)},t.prototype.doTick=function(){},t}(i("./src/event-handler.js").default);t.default=a},"./src/utils/attr-list.js":function(e,t,i){(function(e){Object.defineProperty(t,"__esModule",{value:!0});var i=/^(\d+)x(\d+)$/,s=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,n=function(){function t(e){for(var i in"string"==typeof e&&(e=t.parseAttrList(e)),e)e.hasOwnProperty(i)&&(this[i]=e[i])}return t.prototype.decimalInteger=function(t){var i=parseInt(this[t],10);return i>e.MAX_SAFE_INTEGER?1/0:i},t.prototype.hexadecimalInteger=function(e){if(this[e]){var t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;for(var i=new Uint8Array(t.length/2),s=0;s<t.length/2;s++)i[s]=parseInt(t.slice(2*s,2*s+2),16);return i}return null},t.prototype.hexadecimalIntegerAsNumber=function(t){var i=parseInt(this[t],16);return i>e.MAX_SAFE_INTEGER?1/0:i},t.prototype.decimalFloatingPoint=function(e){return parseFloat(this[e])},t.prototype.enumeratedString=function(e){return this[e]},t.prototype.decimalResolution=function(e){var t=i.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}},t.parseAttrList=function(e){var t,i={};for(s.lastIndex=0;null!==(t=s.exec(e));){var n=t[2];0===n.indexOf('"')&&n.lastIndexOf('"')===n.length-1&&(n=n.slice(1,-1)),i[t[1]]=n}return i},t}();t.default=n}).call(this,i("./src/polyfills/number.js").Number)},"./src/utils/binary-search.js":function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.default={search:function(e,t){for(var i=0,s=e.length-1,n=null,a=null;i<=s;){var r=t(a=e[n=(i+s)/2|0]);if(r>0)i=n+1;else{if(!(r<0))return a;s=n-1}}return null}}},"./src/utils/buffer-helper.js":function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(){}return e.isBuffered=function(e,t){try{if(e)for(var i=e.buffered,s=0;s<i.length;s++)if(t>=i.start(s)&&t<=i.end(s))return!0}catch(e){}return!1},e.bufferInfo=function(e,t,i){try{if(e){var s=e.buffered,n=[],a=void 0;for(a=0;a<s.length;a++)n.push({start:s.start(a),end:s.end(a)});return this.bufferedInfo(n,t,i)}}catch(e){}return{len:0,start:t,end:t,nextStart:void 0}},e.bufferedInfo=function(e,t,i){var s,n,a,r,o,l=[];for(e.sort(function(e,t){var i=e.start-t.start;return i||t.end-e.end}),o=0;o<e.length;o++){var d=l.length;if(d){var u=l[d-1].end;e[o].start-u<i?e[o].end>u&&(l[d-1].end=e[o].end):l.push(e[o])}else l.push(e[o])}for(o=0,s=0,n=a=t;o<l.length;o++){var c=l[o].start,h=l[o].end;if(t+i>=c&&t<h)n=c,s=(a=h)-t;else if(t+i<c){r=c;break}}return{len:s,start:n,end:a,nextStart:r}},e}();t.BufferHelper=s},"./src/utils/cea-608-parser.js":function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},n=function(e){var t=e;return s.hasOwnProperty(e)&&(t=s[e]),String.fromCharCode(t)},a=15,r=100,o={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},l={17:2,18:4,21:6,22:8,23:10,19:13,20:15},d={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},u={25:2,26:4,29:6,30:8,31:10,27:13,28:15},c=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],h={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(e){this.time=e},log:function(e,t){this.verboseFilter[e];this.verboseLevel}},p=function(e){for(var t=[],i=0;i<e.length;i++)t.push(e[i].toString(16));return t},g=function(){function e(e,t,i,s,n){this.foreground=e||"white",this.underline=t||!1,this.italics=i||!1,this.background=s||"black",this.flash=n||!1}return e.prototype.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},e.prototype.setStyles=function(e){for(var t=["foreground","underline","italics","background","flash"],i=0;i<t.length;i++){var s=t[i];e.hasOwnProperty(s)&&(this[s]=e[s])}},e.prototype.isDefault=function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},e.prototype.equals=function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash},e.prototype.copy=function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash},e.prototype.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},e}(),f=function(){function e(e,t,i,s,n,a){this.uchar=e||" ",this.penState=new g(t,i,s,n,a)}return e.prototype.reset=function(){this.uchar=" ",this.penState.reset()},e.prototype.setChar=function(e,t){this.uchar=e,this.penState.copy(t)},e.prototype.setPenState=function(e){this.penState.copy(e)},e.prototype.equals=function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)},e.prototype.copy=function(e){this.uchar=e.uchar,this.penState.copy(e.penState)},e.prototype.isEmpty=function(){return" "===this.uchar&&this.penState.isDefault()},e}(),v=function(){function e(){this.chars=[];for(var e=0;e<r;e++)this.chars.push(new f);this.pos=0,this.currPenState=new g}return e.prototype.equals=function(e){for(var t=!0,i=0;i<r;i++)if(!this.chars[i].equals(e.chars[i])){t=!1;break}return t},e.prototype.copy=function(e){for(var t=0;t<r;t++)this.chars[t].copy(e.chars[t])},e.prototype.isEmpty=function(){for(var e=!0,t=0;t<r;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e},e.prototype.setCursor=function(e){this.pos!==e&&(this.pos=e),this.pos<0?(h.log("ERROR","Negative cursor position "+this.pos),this.pos=0):this.pos>r&&(h.log("ERROR","Too large cursor position "+this.pos),this.pos=r)},e.prototype.moveCursor=function(e){var t=this.pos+e;if(e>1)for(var i=this.pos+1;i<t+1;i++)this.chars[i].setPenState(this.currPenState);this.setCursor(t)},e.prototype.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},e.prototype.insertChar=function(e){e>=144&&this.backSpace();var t=n(e);this.pos>=r?h.log("ERROR","Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1))},e.prototype.clearFromPos=function(e){var t;for(t=e;t<r;t++)this.chars[t].reset()},e.prototype.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},e.prototype.clearToEndOfRow=function(){this.clearFromPos(this.pos)},e.prototype.getTextString=function(){for(var e=[],t=!0,i=0;i<r;i++){var s=this.chars[i].uchar;" "!==s&&(t=!1),e.push(s)}return t?"":e.join("")},e.prototype.setPenStyles=function(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)},e}(),m=function(){function e(){this.rows=[];for(var e=0;e<a;e++)this.rows.push(new v);this.currRow=a-1,this.nrRollUpRows=null,this.reset()}return e.prototype.reset=function(){for(var e=0;e<a;e++)this.rows[e].clear();this.currRow=a-1},e.prototype.equals=function(e){for(var t=!0,i=0;i<a;i++)if(!this.rows[i].equals(e.rows[i])){t=!1;break}return t},e.prototype.copy=function(e){for(var t=0;t<a;t++)this.rows[t].copy(e.rows[t])},e.prototype.isEmpty=function(){for(var e=!0,t=0;t<a;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e},e.prototype.backSpace=function(){this.rows[this.currRow].backSpace()},e.prototype.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},e.prototype.insertChar=function(e){this.rows[this.currRow].insertChar(e)},e.prototype.setPen=function(e){this.rows[this.currRow].setPenStyles(e)},e.prototype.moveCursor=function(e){this.rows[this.currRow].moveCursor(e)},e.prototype.setCursor=function(e){h.log("INFO","setCursor: "+e),this.rows[this.currRow].setCursor(e)},e.prototype.setPAC=function(e){h.log("INFO","pacData = "+JSON.stringify(e));var t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(var i=0;i<a;i++)this.rows[i].clear();var s=this.currRow+1-this.nrRollUpRows,n=this.lastOutputScreen;if(n){var r=n.rows[s].cueStartTime;if(r&&r<h.time)for(i=0;i<this.nrRollUpRows;i++)this.rows[t-this.nrRollUpRows+i+1].copy(n.rows[s+i])}}this.currRow=t;var o=this.rows[this.currRow];if(null!==e.indent){var l=e.indent,d=Math.max(l-1,0);o.setCursor(e.indent),e.color=o.chars[d].penState.foreground}var u={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(u)},e.prototype.setBkgData=function(e){h.log("INFO","bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)},e.prototype.setRollUpRows=function(e){this.nrRollUpRows=e},e.prototype.rollUp=function(){if(null!==this.nrRollUpRows){h.log("TEXT",this.getDisplayText());var e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),h.log("INFO","Rolling up")}else h.log("DEBUG","roll_up but nrRollUpRows not set yet")},e.prototype.getDisplayText=function(e){e=e||!1;for(var t=[],i="",s=-1,n=0;n<a;n++){var r=this.rows[n].getTextString();r&&(s=n+1,e?t.push("Row "+s+": '"+r+"'"):t.push(r.trim()))}return t.length>0&&(i=e?"["+t.join(" | ")+"]":t.join("\n")),i},e.prototype.getTextAndFormat=function(){return this.rows},e}(),_=function(){function e(e,t){this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new m,this.nonDisplayedMemory=new m,this.lastOutputScreen=new m,this.currRollUpRow=this.displayedMemory.rows[a-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}return e.prototype.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[a-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null},e.prototype.getHandler=function(){return this.outputFilter},e.prototype.setHandler=function(e){this.outputFilter=e},e.prototype.setPAC=function(e){this.writeScreen.setPAC(e)},e.prototype.setBkgData=function(e){this.writeScreen.setBkgData(e)},e.prototype.setMode=function(e){e!==this.mode&&(this.mode=e,h.log("INFO","MODE="+e),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)},e.prototype.insertChars=function(e){for(var t=0;t<e.length;t++)this.writeScreen.insertChar(e[t]);var i=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";h.log("INFO",i+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(h.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},e.prototype.ccRCL=function(){h.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},e.prototype.ccBS=function(){h.log("INFO","BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},e.prototype.ccAOF=function(){},e.prototype.ccAON=function(){},e.prototype.ccDER=function(){h.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},e.prototype.ccRU=function(e){h.log("INFO","RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)},e.prototype.ccFON=function(){h.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})},e.prototype.ccRDC=function(){h.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},e.prototype.ccTR=function(){h.log("INFO","TR"),this.setMode("MODE_TEXT")},e.prototype.ccRTD=function(){h.log("INFO","RTD"),this.setMode("MODE_TEXT")},e.prototype.ccEDM=function(){h.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},e.prototype.ccCR=function(){h.log("CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},e.prototype.ccENM=function(){h.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},e.prototype.ccEOC=function(){if(h.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,h.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},e.prototype.ccTO=function(e){h.log("INFO","TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)},e.prototype.ccMIDROW=function(e){var t={flash:!1};if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{var i=Math.floor(e/2)-16;t.foreground=["white","green","blue","cyan","red","yellow","magenta"][i]}h.log("INFO","MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)},e.prototype.outputDataUpdate=function(e){void 0===e&&(e=!1);var t=h.time;null!==t&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),!0===e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue()),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))},e.prototype.cueSplitAtTime=function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))},e}(),E=function(){function e(e,t,i){this.field=e||1,this.outputs=[t,i],this.channels=[new _(1,t),new _(2,i)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,char:0,cmd:0,other:0}}return e.prototype.getHandler=function(e){return this.channels[e].getHandler()},e.prototype.setHandler=function(e,t){this.channels[e].setHandler(t)},e.prototype.addData=function(e,t){var i,s,n,a=!1;this.lastTime=e,h.setTime(e);for(var r=0;r<t.length;r+=2)if(s=127&t[r],n=127&t[r+1],0!==s||0!==n){if(h.log("DATA","["+p([t[r],t[r+1]])+"] -> ("+p([s,n])+")"),(i=this.parseCmd(s,n))||(i=this.parseMidrow(s,n)),i||(i=this.parsePAC(s,n)),i||(i=this.parseBackgroundAttributes(s,n)),!i)if(a=this.parseChars(s,n))if(this.currChNr&&this.currChNr>=0)this.channels[this.currChNr-1].insertChars(a);else h.log("WARNING","No channel found yet. TEXT-MODE?");i?this.dataCounters.cmd+=2:a?this.dataCounters.char+=2:(this.dataCounters.other+=2,h.log("WARNING","Couldn't parse cleaned data "+p([s,n])+" orig: "+p([t[r],t[r+1]])))}else this.dataCounters.padding+=2},e.prototype.parseCmd=function(e,t){var i=null;if(!((20===e||28===e)&&t>=32&&t<=47)&&!((23===e||31===e)&&t>=33&&t<=35))return!1;if(e===this.lastCmdA&&t===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,h.log("DEBUG","Repeated command ("+p([e,t])+") is dropped"),!0;i=20===e||23===e?1:2;var s=this.channels[i-1];return 20===e||28===e?32===t?s.ccRCL():33===t?s.ccBS():34===t?s.ccAOF():35===t?s.ccAON():36===t?s.ccDER():37===t?s.ccRU(2):38===t?s.ccRU(3):39===t?s.ccRU(4):40===t?s.ccFON():41===t?s.ccRDC():42===t?s.ccTR():43===t?s.ccRTD():44===t?s.ccEDM():45===t?s.ccCR():46===t?s.ccENM():47===t&&s.ccEOC():s.ccTO(t-32),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=i,!0},e.prototype.parseMidrow=function(e,t){var i=null;return(17===e||25===e)&&t>=32&&t<=47&&((i=17===e?1:2)!==this.currChNr?(h.log("ERROR","Mismatch channel in midrow parsing"),!1):(this.channels[i-1].ccMIDROW(t),h.log("DEBUG","MIDROW ("+p([e,t])+")"),!0))},e.prototype.parsePAC=function(e,t){var i,s=null;if(!((e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127)&&!((16===e||24===e)&&t>=64&&t<=95))return!1;if(e===this.lastCmdA&&t===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,!0;i=e<=23?1:2,s=t>=64&&t<=95?1===i?o[e]:d[e]:1===i?l[e]:u[e];var n=this.interpretPAC(s,t);return this.channels[i-1].setPAC(n),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=i,!0},e.prototype.interpretPAC=function(e,t){var i=t,s={color:null,italics:!1,indent:null,underline:!1,row:e};return i=t>95?t-96:t-64,s.underline=1==(1&i),i<=13?s.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(i/2)]:i<=15?(s.italics=!0,s.color="white"):s.indent=4*Math.floor((i-16)/2),s},e.prototype.parseChars=function(e,t){var i=null,s=null,a=null;if(e>=25?(i=2,a=e-8):(i=1,a=e),a>=17&&a<=19){var r=t;r=17===a?t+80:18===a?t+112:t+144,h.log("INFO","Special char '"+n(r)+"' in channel "+i),s=[r]}else e>=32&&e<=127&&(s=0===t?[e]:[e,t]);if(s){var o=p(s);h.log("DEBUG","Char codes =  "+o.join(",")),this.lastCmdA=null,this.lastCmdB=null}return s},e.prototype.parseBackgroundAttributes=function(e,t){var i,s,n;return((16===e||24===e)&&t>=32&&t<=47||(23===e||31===e)&&t>=45&&t<=47)&&(i={},16===e||24===e?(s=Math.floor((t-32)/2),i.background=c[s],t%2==1&&(i.background=i.background+"_semi")):45===t?i.background="transparent":(i.foreground="black",47===t&&(i.underline=!0)),n=e<24?1:2,this.channels[n-1].setBkgData(i),this.lastCmdA=null,this.lastCmdB=null,!0)},e.prototype.reset=function(){for(var e=0;e<this.channels.length;e++)this.channels[e]&&this.channels[e].reset();this.lastCmdA=null,this.lastCmdB=null},e.prototype.cueSplitAtTime=function(e){for(var t=0;t<this.channels.length;t++)this.channels[t]&&this.channels[t].cueSplitAtTime(e)},e}();t.default=E},"./src/utils/codecs.js":function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0}};t.isCodecType=function(e,t){var i=s[t];return!!i&&!0===i[e.slice(0,4)]},t.isCodecSupportedInMp4=function(e,t){return window.MediaSource.isTypeSupported((t||"video")+'/mp4;codecs="'+e+'"')}},"./src/utils/cues.js":function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i("./src/utils/vttparser.js");t.newCue=function(e,t,i,n){for(var a,r,o,l,d,u=window.VTTCue||window.TextTrackCue,c=0;c<n.rows.length;c++)if(o=!0,l=0,d="",!(a=n.rows[c]).isEmpty()){for(var h=0;h<a.chars.length;h++)a.chars[h].uchar.match(/\s/)&&o?l++:(d+=a.chars[h].uchar,o=!1);a.cueStartTime=t,t===i&&(i+=1e-4),r=new u(t,i,s.fixLineBreaks(d.trim())),l>=16?l--:l++,navigator.userAgent.match(/Firefox\//)?r.line=c+1:r.line=c>7?c-2:c+1,r.align="left",r.position=Math.max(0,Math.min(100,l/32*100+(navigator.userAgent.match(/Firefox\//)?50:0))),e.addCue(r)}}},"./src/utils/discontinuities.js":function(e,t,i){(function(e){Object.defineProperty(t,"__esModule",{value:!0});var s=i("./src/utils/binary-search.js"),n=i("./src/utils/logger.js");function a(e,t){for(var i=null,s=0;s<e.length;s+=1){var n=e[s];if(n&&n.cc===t){i=n;break}}return i}function r(e,t,i){var s=!1;return t&&t.details&&i&&(i.endCC>i.startCC||e&&e.cc<i.startCC)&&(s=!0),s}function o(e,t){var i=e.fragments,s=t.fragments;if(s.length&&i.length){var r=a(i,s[0].cc);if(r&&(!r||r.startPTS))return r;n.logger.log("No frag in previous level to align on")}else n.logger.log("No fragments to align")}function l(e,t){t.fragments.forEach(function(t){if(t){var i=t.start+e;t.start=t.startPTS=i,t.endPTS=i+t.duration}}),t.PTSKnown=!0}function d(e,t,i){if(r(e,i,t)){var s=o(i.details,t);s&&(n.logger.log("Adjusting PTS using last level due to CC increase within current level"),l(s.start,t))}}function u(t,i){if(i&&i.fragments.length){if(!t.hasProgramDateTime||!i.hasProgramDateTime)return;var s=i.fragments[0].programDateTime,a=(t.fragments[0].programDateTime-s)/1e3+i.fragments[0].start;e.isFinite(a)&&(n.logger.log("adjusting PTS using programDateTime delta, sliding:"+a.toFixed(3)),l(a,t))}}t.findFirstFragWithCC=a,t.findFragWithCC=function(e,t){return s.default.search(e,function(e){return e.cc<t?1:e.cc>t?-1:0})},t.shouldAlignOnDiscontinuities=r,t.findDiscontinuousReferenceFrag=o,t.adjustPts=l,t.alignStream=function(e,t,i){d(e,i,t),!i.PTSKnown&&t&&u(i,t.details)},t.alignDiscontinuities=d,t.alignPDT=u}).call(this,i("./src/polyfills/number.js").Number)},"./src/utils/ewma-bandwidth-estimator.js":function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i("./src/utils/ewma.js"),n=function(){function e(e,t,i,n){this.hls=e,this.defaultEstimate_=n,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new s.default(t),this.fast_=new s.default(i)}return e.prototype.sample=function(e,t){var i=8e3*t/(e=Math.max(e,this.minDelayMs_)),s=e/1e3;this.fast_.sample(s,i),this.slow_.sample(s,i)},e.prototype.canEstimate=function(){var e=this.fast_;return e&&e.getTotalWeight()>=this.minWeight_},e.prototype.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},e.prototype.destroy=function(){},e}();t.default=n},"./src/utils/ewma.js":function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e){this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=0,this.totalWeight_=0}return e.prototype.sample=function(e,t){var i=Math.pow(this.alpha_,e);this.estimate_=t*(1-i)+i*this.estimate_,this.totalWeight_+=e},e.prototype.getTotalWeight=function(){return this.totalWeight_},e.prototype.getEstimate=function(){if(this.alpha_){var e=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/e}return this.estimate_},e}();t.default=s},"./src/utils/get-self-scope.js":function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.getSelfScope=function(){return"undefined"==typeof window?self:window}},"./src/utils/logger.js":function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i("./src/utils/get-self-scope.js");function n(){}var a={trace:n,debug:n,log:n,warn:n,info:n,error:n},r=a;var o=s.getSelfScope();function l(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];t.forEach(function(t){r[t]=e[t]?e[t].bind(e):function(e){var t=o.console[e];return t?function(){for(var i=[],s=0;s<arguments.length;s++)i[s]=arguments[s];i[0]&&(i[0]=function(e,t){return t="["+e+"] > "+t}(e,i[0])),t.apply(o.console,i)}:n}(t)})}t.enableLogs=function(e){if(!0===e||"object"==typeof e){l(e,"debug","log","info","warn","error");try{r.log()}catch(e){r=a}}else r=a},t.logger=r},"./src/utils/mediakeys-helper.js":function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s="undefined"!=typeof window&&window.navigator&&window.navigator.requestMediaKeySystemAccess?window.navigator.requestMediaKeySystemAccess.bind(window.navigator):null;t.requestMediaKeySystemAccess=s},"./src/utils/mediasource-helper.js":function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.getMediaSource=function(){if("undefined"!=typeof window)return window.MediaSource||window.WebKitMediaSource}},"./src/utils/output-filter.js":function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){this.timelineController=e,this.trackName=t,this.startTime=null,this.endTime=null,this.screen=null}return e.prototype.dispatchCue=function(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen),this.startTime=null)},e.prototype.newCue=function(e,t,i){(null===this.startTime||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=i,this.timelineController.createCaptionsTrack(this.trackName)},e}();t.default=s},"./src/utils/texttrack-utils.js":function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.sendAddTrackEvent=function(e,t){var i=null;try{i=new window.Event("addtrack")}catch(e){(i=document.createEvent("Event")).initEvent("addtrack",!1,!1)}i.track=e,t.dispatchEvent(i)},t.clearCurrentCues=function(e){if(e&&e.cues)for(;e.cues.length>0;)e.removeCue(e.cues[0])}},"./src/utils/time-ranges.js":function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.default={toString:function(e){for(var t="",i=e.length,s=0;s<i;s++)t+="["+e.start(s).toFixed(3)+","+e.end(s).toFixed(3)+"]";return t}}},"./src/utils/vttcue.js":function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){if("undefined"!=typeof window&&window.VTTCue)return window.VTTCue;var e="auto",t={"":!0,lr:!0,rl:!0},i={start:!0,middle:!0,end:!0,left:!0,right:!0};function s(e){return"string"==typeof e&&(!!i[e.toLowerCase()]&&e.toLowerCase())}function n(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)e[s]=i[s]}return e}function a(i,a,r){var o=this,l=function(){if("undefined"!=typeof navigator)return/MSIE\s8\.0/.test(navigator.userAgent)}(),d={};l?o=document.createElement("custom"):d.enumerable=!0,o.hasBeenReset=!1;var u="",c=!1,h=i,p=a,g=r,f=null,v="",m=!0,_="auto",E="start",A=50,y="middle",S=50,b="middle";if(Object.defineProperty(o,"id",n({},d,{get:function(){return u},set:function(e){u=""+e}})),Object.defineProperty(o,"pauseOnExit",n({},d,{get:function(){return c},set:function(e){c=!!e}})),Object.defineProperty(o,"startTime",n({},d,{get:function(){return h},set:function(e){if("number"!=typeof e)throw new TypeError("Start time must be set to a number.");h=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"endTime",n({},d,{get:function(){return p},set:function(e){if("number"!=typeof e)throw new TypeError("End time must be set to a number.");p=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"text",n({},d,{get:function(){return g},set:function(e){g=""+e,this.hasBeenReset=!0}})),Object.defineProperty(o,"region",n({},d,{get:function(){return f},set:function(e){f=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"vertical",n({},d,{get:function(){return v},set:function(e){var i=function(e){return"string"==typeof e&&!!t[e.toLowerCase()]&&e.toLowerCase()}(e);if(!1===i)throw new SyntaxError("An invalid or illegal string was specified.");v=i,this.hasBeenReset=!0}})),Object.defineProperty(o,"snapToLines",n({},d,{get:function(){return m},set:function(e){m=!!e,this.hasBeenReset=!0}})),Object.defineProperty(o,"line",n({},d,{get:function(){return _},set:function(t){if("number"!=typeof t&&t!==e)throw new SyntaxError("An invalid number or illegal string was specified.");_=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"lineAlign",n({},d,{get:function(){return E},set:function(e){var t=s(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");E=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"position",n({},d,{get:function(){return A},set:function(e){if(e<0||e>100)throw new Error("Position must be between 0 and 100.");A=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"positionAlign",n({},d,{get:function(){return y},set:function(e){var t=s(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");y=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"size",n({},d,{get:function(){return S},set:function(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100.");S=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"align",n({},d,{get:function(){return b},set:function(e){var t=s(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");b=t,this.hasBeenReset=!0}})),o.displayState=void 0,l)return o}return a.prototype.getCueAsHTML=function(){return window.WebVTT.convertCueToDOMTree(window,this.text)},a}()},"./src/utils/vttparser.js":function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i("./src/utils/vttcue.js"),n=function(){return{decode:function(e){if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}};function a(){this.window=window,this.state="INITIAL",this.buffer="",this.decoder=new n,this.regionList=[]}function r(){this.values=Object.create(null)}function o(e,t,i,s){var n=s?e.split(s):[e];for(var a in n)if("string"==typeof n[a]){var r=n[a].split(i);if(2===r.length)t(r[0],r[1])}}r.prototype={set:function(e,t){this.get(e)||""===t||(this.values[e]=t)},get:function(e,t,i){return i?this.has(e)?this.values[e]:t[i]:this.has(e)?this.values[e]:t},has:function(e){return e in this.values},alt:function(e,t,i){for(var s=0;s<i.length;++s)if(t===i[s]){this.set(e,t);break}},integer:function(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))},percent:function(e,t){return!!(t.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&(t=parseFloat(t))>=0&&t<=100)&&(this.set(e,t),!0)}};var l=new s.default(0,0,0),d="middle"===l.align?"middle":"center";function u(e,t,i){var s=e;function n(){var t=function(e){function t(e,t,i,s){return 3600*(0|e)+60*(0|t)+(0|i)+(0|s)/1e3}var i=e.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);return i?i[3]?t(i[1],i[2],i[3].replace(":",""),i[4]):i[1]>59?t(i[1],i[2],0,i[4]):t(0,i[1],i[2],i[4]):null}(e);if(null===t)throw new Error("Malformed timestamp: "+s);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function a(){e=e.replace(/^\s+/,"")}if(a(),t.startTime=n(),a(),"--\x3e"!==e.substr(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+s);e=e.substr(3),a(),t.endTime=n(),a(),function(e,t){var s=new r;o(e,function(e,t){switch(e){case"region":for(var n=i.length-1;n>=0;n--)if(i[n].id===t){s.set(e,i[n].region);break}break;case"vertical":s.alt(e,t,["rl","lr"]);break;case"line":var a=t.split(","),r=a[0];s.integer(e,r),s.percent(e,r)&&s.set("snapToLines",!1),s.alt(e,r,["auto"]),2===a.length&&s.alt("lineAlign",a[1],["start",d,"end"]);break;case"position":a=t.split(","),s.percent(e,a[0]),2===a.length&&s.alt("positionAlign",a[1],["start",d,"end","line-left","line-right","auto"]);break;case"size":s.percent(e,t);break;case"align":s.alt(e,t,["start",d,"end","left","right"])}},/:/,/\s/),t.region=s.get("region",null),t.vertical=s.get("vertical","");var n=s.get("line","auto");"auto"===n&&-1===l.line&&(n=-1),t.line=n,t.lineAlign=s.get("lineAlign","start"),t.snapToLines=s.get("snapToLines",!0),t.size=s.get("size",100),t.align=s.get("align",d);var a=s.get("position","auto");"auto"===a&&50===l.position&&(a="start"===t.align||"left"===t.align?0:"end"===t.align||"right"===t.align?100:50),t.position=a}(e,t)}function c(e){return e.replace(/<br(?: \/)?>/gi,"\n")}t.fixLineBreaks=c,a.prototype={parse:function(e){var t=this;function i(){var e=t.buffer,i=0;for(e=c(e);i<e.length&&"\r"!==e[i]&&"\n"!==e[i];)++i;var s=e.substr(0,i);return"\r"===e[i]&&++i,"\n"===e[i]&&++i,t.buffer=e.substr(i),s}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{var n=void 0;if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;var a=(n=i()).match(/^(Ã¯Â»Â¿)?WEBVTT([ \t].*)?$/);if(!a||!a[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}for(var r=!1;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(r?r=!1:n=i(),t.state){case"HEADER":/:/.test(n)?o(n,function(e,t){},/:/):n||(t.state="ID");continue;case"NOTE":n||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(n)){t.state="NOTE";break}if(!n)continue;if(t.cue=new s.default(0,0,""),t.state="CUE",-1===n.indexOf("--\x3e")){t.cue.id=n;continue}case"CUE":try{u(n,t.cue,t.regionList)}catch(e){t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":var l=-1!==n.indexOf("--\x3e");if(!n||l&&(r=!0)){t.oncue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}t.cue.text&&(t.cue.text+="\n"),t.cue.text+=n;continue;case"BADCUE":n||(t.state="ID");continue}}}catch(e){"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){try{if(this.buffer+=this.decoder.decode(),(this.cue||"HEADER"===this.state)&&(this.buffer+="\n\n",this.parse()),"INITIAL"===this.state)throw new Error("Malformed WebVTT signature.")}catch(e){throw e}return this.onflush&&this.onflush(),this}},t.default=a},"./src/utils/webvtt-parser.js":function(e,t,i){(function(e){Object.defineProperty(t,"__esModule",{value:!0});var s=i("./src/utils/vttparser.js"),n=i("./src/demux/id3.js"),a=function(e,t,i){return e.substr(i||0,t.length)===t},r=function(e){for(var t=5381,i=e.length;i;)t=33*t^e.charCodeAt(--i);return(t>>>0).toString()},o={parse:function(t,i,o,l,d,u){var c,h=n.utf8ArrayToStr(new Uint8Array(t)).trim().replace(/\r\n|\n\r|\n|\r/g,"\n").split("\n"),p="00:00.000",g=0,f=0,v=0,m=[],_=!0,E=new s.default;E.oncue=function(e){var t=o[l],i=o.ccOffset;t&&t.new&&(void 0!==f?i=o.ccOffset=t.start:function(e,t,i){var s=e[t],n=e[s.prevCC];if(!n||!n.new&&s.new)return e.ccOffset=e.presentationOffset=s.start,void(s.new=!1);for(;n&&n.new;)e.ccOffset+=s.start-n.start,s.new=!1,n=e[(s=n).prevCC];e.presentationOffset=i}(o,l,v)),v&&(i=v-o.presentationOffset),e.startTime+=i-f,e.endTime+=i-f,e.id=r(e.startTime.toString())+r(e.endTime.toString())+r(e.text),e.text=decodeURIComponent(encodeURIComponent(e.text)),e.endTime>0&&m.push(e)},E.onparsingerror=function(e){c=e},E.onflush=function(){c&&u?u(c):d(m)},h.forEach(function(t){if(_){if(a(t,"X-TIMESTAMP-MAP=")){_=!1,t.substr(16).split(",").forEach(function(e){a(e,"LOCAL:")?p=e.substr(6):a(e,"MPEGTS:")&&(g=parseInt(e.substr(7)))});try{i+(9e4*o[l].start||0)<0&&(i+=8589934592),g-=i,s=p,n=parseInt(s.substr(-3)),r=parseInt(s.substr(-6,2)),d=parseInt(s.substr(-9,2)),u=s.length>9?parseInt(s.substr(0,s.indexOf(":"))):0,f=(e.isFinite(n)&&e.isFinite(r)&&e.isFinite(d)&&e.isFinite(u)?(n+=1e3*r,n+=6e4*d,n+=36e5*u):-1)/1e3,v=g/9e4,-1===f&&(c=new Error("Malformed X-TIMESTAMP-MAP: "+t))}catch(e){c=new Error("Malformed X-TIMESTAMP-MAP: "+t)}return}""===t&&(_=!1)}var s,n,r,d,u;E.parse(t+"\n")}),E.flush()}};t.default=o}).call(this,i("./src/polyfills/number.js").Number)},"./src/utils/xhr-loader.js":function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i("./src/utils/logger.js"),n=window.performance,a=window.XMLHttpRequest,r=function(){function e(e){e&&e.xhrSetup&&(this.xhrSetup=e.xhrSetup)}return e.prototype.destroy=function(){this.abort(),this.loader=null},e.prototype.abort=function(){var e=this.loader;e&&4!==e.readyState&&(this.stats.aborted=!0,e.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null},e.prototype.load=function(e,t,i){this.context=e,this.config=t,this.callbacks=i,this.stats={trequest:n.now(),retry:0},this.retryDelay=t.retryDelay,this.loadInternal()},e.prototype.loadInternal=function(){var e,t=this.context;e=this.loader=new a;var i=this.stats;i.tfirst=0,i.loaded=0;var s=this.xhrSetup;try{if(s)try{s(e,t.url)}catch(i){e.open("GET",t.url,!0),s(e,t.url)}e.readyState||e.open("GET",t.url,!0)}catch(i){return void this.callbacks.onError({code:e.status,text:i.message},t,e)}t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),e.send()},e.prototype.readystatechange=function(e){var t=e.currentTarget,i=t.readyState,a=this.stats,r=this.context,o=this.config;if(!a.aborted&&i>=2)if(window.clearTimeout(this.requestTimeout),0===a.tfirst&&(a.tfirst=Math.max(n.now(),a.trequest)),4===i){var l=t.status;if(l>=200&&l<300){a.tload=Math.max(a.tfirst,n.now());var d=void 0,u=void 0;u="arraybuffer"===r.responseType?(d=t.response).byteLength:(d=t.responseText).length,a.loaded=a.total=u;var c={url:t.responseURL,data:d};this.callbacks.onSuccess(c,a,r,t)}else a.retry>=o.maxRetry||l>=400&&l<499?(s.logger.error(l+" while loading "+r.url),this.callbacks.onError({code:l,text:t.statusText},r,t)):(s.logger.warn(l+" while loading "+r.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,o.maxRetryDelay),a.retry++)}else this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),o.timeout)},e.prototype.loadtimeout=function(){s.logger.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context,null)},e.prototype.loadprogress=function(e){var t=e.currentTarget,i=this.stats;i.loaded=e.loaded,e.lengthComputable&&(i.total=e.total);var s=this.callbacks.onProgress;s&&s(i,this.context,null,t)},e}();t.default=r}}).default},"object"==typeof exports&&"object"==typeof module?module.exports=s():"object"==typeof exports?exports.Hls=s():t.Hls=s()),function(t){"use strict";var i,s,n,a,r;t?function(){var e=t.crypto||t.msCrypto;if(!i&&e&&e.getRandomValues)try{var n=new Uint8Array(16);a=i=function(){return e.getRandomValues(n),n},i()}catch(e){}if(!i){var r=new Array(16);s=i=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),r[t]=e>>>((3&t)<<3)&255;return r},"undefined"!=typeof console&&console.warn&&console.warn("[SECURITY] node-uuid: crypto not usable, falling back to insecure Math.random()")}}():function(){if("function"==typeof e)try{var t=e("crypto").randomBytes;n=i=t&&function(){return t(16)},i()}catch(e){}}();for(var o="function"==typeof Buffer?Buffer:Array,l=[],d={},u=0;u<256;u++)l[u]=(u+256).toString(16).substr(1),d[l[u]]=u;function c(e,t){var i=t||0,s=l;return s[e[i++]]+s[e[i++]]+s[e[i++]]+s[e[i++]]+"-"+s[e[i++]]+s[e[i++]]+"-"+s[e[i++]]+s[e[i++]]+"-"+s[e[i++]]+s[e[i++]]+"-"+s[e[i++]]+s[e[i++]]+s[e[i++]]+s[e[i++]]+s[e[i++]]+s[e[i++]]}var h=i(),p=[1|h[0],h[1],h[2],h[3],h[4],h[5]],g=16383&(h[6]<<8|h[7]),f=0,v=0;function m(e,t,s){var n=t&&s||0;"string"==typeof e&&(t="binary"===e?new o(16):null,e=null);var a=(e=e||{}).random||(e.rng||i)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t)for(var r=0;r<16;r++)t[n+r]=a[r];return t||c(a)}var _=m;_.v1=function(e,t,i){var s=t&&i||0,n=t||[],a=null!=(e=e||{}).clockseq?e.clockseq:g,r=null!=e.msecs?e.msecs:(new Date).getTime(),o=null!=e.nsecs?e.nsecs:v+1,l=r-f+(o-v)/1e4;if(l<0&&null==e.clockseq&&(a=a+1&16383),(l<0||r>f)&&null==e.nsecs&&(o=0),o>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");f=r,v=o,g=a;var d=(1e4*(268435455&(r+=122192928e5))+o)%4294967296;n[s++]=d>>>24&255,n[s++]=d>>>16&255,n[s++]=d>>>8&255,n[s++]=255&d;var u=r/4294967296*1e4&268435455;n[s++]=u>>>8&255,n[s++]=255&u,n[s++]=u>>>24&15|16,n[s++]=u>>>16&255,n[s++]=a>>>8|128,n[s++]=255&a;for(var h=e.node||p,m=0;m<6;m++)n[s+m]=h[m];return t||c(n)},_.v4=m,_.parse=function(e,t,i){var s=t&&i||0,n=0;for(t=t||[],e.toLowerCase().replace(/[0-9a-f]{2}/g,function(e){n<16&&(t[s+n++]=d[e])});n<16;)t[s+n++]=0;return t},_.unparse=c,_.BufferClass=o,_._rng=i,_._mathRNG=s,_._nodeRNG=n,_._whatwgRNG=a,"undefined"!=typeof module&&module.exports?module.exports=_:(r=t.uuid,_.noConflict=function(){return t.uuid=r,_},t.uuid=_)}("undefined"!=typeof window?window:null),function(){var e,t,i=document.attachEvent,s=!1;if(!i){var n=(t=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(e){return window.setTimeout(e,20)},function(e){return t(e)}),a=(e=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.clearTimeout,function(t){return e(t)});function r(e){var t=e.__resizeTriggers__,i=t.firstElementChild,s=t.lastElementChild,n=i.firstElementChild;s.scrollLeft=s.scrollWidth,s.scrollTop=s.scrollHeight,n.style.width=i.offsetWidth+1+"px",n.style.height=i.offsetHeight+1+"px",i.scrollLeft=i.scrollWidth,i.scrollTop=i.scrollHeight}function o(e){var t=this;r(this),this.__resizeRAF__&&a(this.__resizeRAF__),this.__resizeRAF__=n(function(){(function(e){return e.offsetWidth!=e.__resizeLast__.width||e.offsetHeight!=e.__resizeLast__.height})(t)&&(t.__resizeLast__.width=t.offsetWidth,t.__resizeLast__.height=t.offsetHeight,t.__resizeListeners__.forEach(function(i){i.call(t,e)}))})}var l=!1,d="",u="animationstart",c="Webkit Moz O ms".split(" "),h="webkitAnimationStart animationstart oAnimationStart MSAnimationStart".split(" "),p="",g=document.createElement("fakeelement");if(void 0!==g.style.animationName&&(l=!0),!1===l)for(var f=0;f<c.length;f++)if(void 0!==g.style[c[f]+"AnimationName"]){(p=c[f])+"Animation",d="-"+p.toLowerCase()+"-",u=h[f],l=!0;break}var v="resizeanim",m="@"+d+"keyframes "+v+" { from { opacity: 0; } to { opacity: 0; } } ",_=d+"animation: 1ms "+v+"; "}window.addResizeListener=function(e,t){i?e.attachEvent("onresize",t):(e.__resizeTriggers__||("static"==getComputedStyle(e).position&&(e.style.position="relative"),function(){if(!s){var e=(m||"")+".resize-triggers { "+(_||"")+'visibility: hidden; opacity: 0; } .resize-triggers, .resize-triggers > div, .contract-trigger:before { content: " "; display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; } .resize-triggers > div { background: #eee; overflow: auto; } .contract-trigger:before { width: 200%; height: 200%; }',t=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css",i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e)),t.appendChild(i),s=!0}}(),e.__resizeLast__={},e.__resizeListeners__=[],(e.__resizeTriggers__=document.createElement("div")).className="resize-triggers",e.__resizeTriggers__.innerHTML='<div class="expand-trigger"><div></div></div><div class="contract-trigger"></div>',e.appendChild(e.__resizeTriggers__),r(e),e.addEventListener("scroll",o,!0),u&&e.__resizeTriggers__.addEventListener(u,function(t){t.animationName==v&&r(e)})),e.__resizeListeners__.push(t))},window.removeResizeListener=function(e,t){i?e.detachEvent("onresize",t):(e.__resizeListeners__.splice(e.__resizeListeners__.indexOf(t),1),e.__resizeListeners__.length||(e.removeEventListener("scroll",o),e.__resizeTriggers__=!e.removeChild(e.__resizeTriggers__)))}}(),n=this,a=function(){"use strict";function e(e,t){var i,s=document.createElement(e||"div");for(i in t)s[i]=t[i];return s}function t(e){for(var t=1,i=arguments.length;i>t;t++)e.appendChild(arguments[t]);return e}function i(e,t,i,s){var n=["opacity",t,~~(100*e),i,s].join("-"),a=.01+i/s*100,r=Math.max(1-(1-e)/t*(100-a),e),o=l.substring(0,l.indexOf("Animation")).toLowerCase(),u=o&&"-"+o+"-"||"";return c[n]||(d.insertRule("@"+u+"keyframes "+n+"{0%{opacity:"+r+"}"+a+"%{opacity:"+e+"}"+(a+.01)+"%{opacity:1}"+(a+t)%100+"%{opacity:"+e+"}100%{opacity:"+r+"}}",d.cssRules.length),c[n]=1),n}function s(e,t){var i,s,n=e.style;if(void 0!==n[t=t.charAt(0).toUpperCase()+t.slice(1)])return t;for(s=0;s<u.length;s++)if(void 0!==n[i=u[s]+t])return i}function n(e,t){for(var i in t)e.style[s(e,i)||i]=t[i];return e}function a(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)void 0===e[s]&&(e[s]=i[s])}return e}function r(e,t){return"string"==typeof e?e:e[t%e.length]}function o(e){this.opts=a(e||{},o.defaults,h)}var l,d,u=["webkit","Moz","ms","O"],c={},h={lines:12,length:7,width:5,radius:10,scale:1,corners:1,color:"#000",opacity:.25,rotate:0,direction:1,speed:1,trail:100,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",shadow:!1,hwaccel:!1,position:"absolute"};if(o.defaults={},a(o.prototype,{spin:function(t){this.stop();var i=this,s=i.opts,a=i.el=e(null,{className:s.className});if(n(a,{position:s.position,width:0,zIndex:s.zIndex,left:s.left,top:s.top}),t&&t.insertBefore(a,t.firstChild||null),a.setAttribute("role","progressbar"),i.lines(a,i.opts),!l){var r,o=0,d=(s.lines-1)*(1-s.direction)/2,u=s.fps,c=u/s.speed,h=(1-s.opacity)/(c*s.trail/100),p=c/s.lines;!function e(){o++;for(var t=0;t<s.lines;t++)r=Math.max(1-(o+(s.lines-t)*p)%c*h,s.opacity),i.opacity(a,t*s.direction+d,r,s);i.timeout=i.el&&setTimeout(e,~~(1e3/u))}()}return i},stop:function(){var e=this.el;return e&&(clearTimeout(this.timeout),e.parentNode&&e.parentNode.removeChild(e),this.el=void 0),this},lines:function(s,a){function o(t,i){return n(e(),{position:"absolute",width:a.scale*(a.length+a.width)+"px",height:a.scale*a.width+"px",background:t,boxShadow:i,transformOrigin:"left",transform:"rotate("+~~(360/a.lines*u+a.rotate)+"deg) translate("+a.scale*a.radius+"px,0)",borderRadius:(a.corners*a.scale*a.width>>1)+"px"})}for(var d,u=0,c=(a.lines-1)*(1-a.direction)/2;u<a.lines;u++)d=n(e(),{position:"absolute",top:1+~(a.scale*a.width/2)+"px",transform:a.hwaccel?"translate3d(0,0,0)":"",opacity:a.opacity,animation:l&&i(a.opacity,a.trail,c+u*a.direction,a.lines)+" "+1/a.speed+"s linear infinite"}),a.shadow&&t(d,n(o("#000","0 0 4px #000"),{top:"2px"})),t(s,t(d,o(r(a.color,u),"0 0 1px rgba(0,0,0,.1)")));return s},opacity:function(e,t,i){t<e.childNodes.length&&(e.childNodes[t].style.opacity=i)}}),"undefined"!=typeof document){d=function(){var i=e("style",{type:"text/css"});return t(document.getElementsByTagName("head")[0],i),i.sheet||i.styleSheet}();var p=n(e("group"),{behavior:"url(#default#VML)"});!s(p,"transform")&&p.adj?function(){function i(t,i){return e("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',i)}d.addRule(".spin-vml","behavior:url(#default#VML)"),o.prototype.lines=function(e,s){function a(){return n(i("group",{coordsize:u+" "+u,coordorigin:-d+" "+-d}),{width:u,height:u})}function o(e,o,l){t(h,t(n(a(),{rotation:360/s.lines*e+"deg",left:~~o}),t(n(i("roundrect",{arcsize:s.corners}),{width:d,height:s.scale*s.width,left:s.scale*s.radius,top:-s.scale*s.width>>1,filter:l}),i("fill",{color:r(s.color,e),opacity:s.opacity}),i("stroke",{opacity:0}))))}var l,d=s.scale*(s.length+s.width),u=2*s.scale*d,c=-(s.width+s.length)*s.scale*2+"px",h=n(a(),{position:"absolute",top:c,left:c});if(s.shadow)for(l=1;l<=s.lines;l++)o(l,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(l=1;l<=s.lines;l++)o(l);return t(e,h)},o.prototype.opacity=function(e,t,i,s){var n=e.firstChild;s=s.shadow&&s.lines||0,n&&t+s<n.childNodes.length&&(n=(n=(n=n.childNodes[t+s])&&n.firstChild)&&n.firstChild)&&(n.opacity=i)}}():l=s(p,"animation")}return o},"object"==typeof module&&module.exports?module.exports=a():n.Spinner=a(),window.uvpjs={debug:!1,log:function(){},warn:function(){},error:function(){},EventType:{AD_BLOCKED:"onAdBlocked",AD_BUFFERING:"onAdBuffering",AD_END:"onAdEnd",AD_ERROR:"adError",AD_CLICK:"adClick",AD_PLUGIN_CONTENT_PAUSE_REQUEST:"adPluginContentPauseRequest",AD_PLUGIN_CONTENT_RESUME_REQUEST:"adPluginContentResumeRequest",AD_POD_START:"onAdPodStart",AD_POD_END:"onAdPodEnd",AD_SKIPPED:"onAdSkipped",AD_LOADED:"onAdLoaded",AD_REQUEST:"onAdRequest",AD_RESPONSE:"onAdResponse",AD_START:"onAdStart",CAPTIONS_READY:"onCaptionsReady",CAPTIONS_UNAVAILABLE:"onCaptionsUnavailable",CDN_UPDATED:"onCdnUpdated",CONTAINER_RESIZE:"containerResize",CONTENT_DATA_LOADED:"onContentDataLoaded",CONTENT_END:"onContentEnd",CONTENT_START:"onContentStart",CONTROL_MUTE:"controlMute",CONTROL_UNMUTE:"controlUnmute",CONTROL_VOLUME_CHANGE:"controlVolumeChange",DIAGNOSTIC_WINDOW_CLOSE_BUTTON:"diagnosticWindowCloseButton",FIRST_GESTURE:"firstGesture",FORCE_TRACK_SESSION_END:"forceTrackSessionEnd",NO_AD_CONTENT:"onNoAdContent",PAUSE_AD_REQUEST:"pauseAdRequest",PAUSE_AD_LOADED:"pauseAdLoaded",PLAYER_INIT:"playerInit",PLAYER_LOADED:"onPlayerLoaded",PLAYBACK_LIBRARY_LOADED:"onPlaybackLibraryLoaded",PLAYER_START_ERROR:"playerStartError",RESOURCE_END:"onResourceEnd",RESOURCE_START:"onResourceStart",VIDEO_CUEPOINT:"videoCuepoint",VIDEO_DONE:"onVideoDone",VIDEO_LOADING:"onVideoLoading",VIDEO_PLAYBACK_ERROR:"videoPlaybackError",VIDEO_PROGRESS:"onVideoProgress",VIDEO_START_ERROR:"videoStartError",VIDEO_STATE_CHANGE:"onStateChange",VIDEO_TRANSITION_START:"onVideoTransitionStart",VIDEO_TRANSITION_COMPLETE:"onVideoTransitionComplete",LEVEL_LOADED:"onLevelLoaded"},ErrorCode:{1001:"1200",1002:"",1003:"",2000:"1000",2001:"1101",2002:"1100",2003:"1106",2004:"2004",2005:"2000",3000:"3400",3001:"3100",3002:"3001",3003:"3200",3004:"3101",3005:"",3006:"3002",3007:"3102",3008:"3202",3009:"3401",3011:"3300",3012:"3301",3013:"",4000:"4000",4001:"4300"},mapErrorCode:function(e){return uvpjs.ErrorCode[e]||e},domConstants:{AD_ID_PREFIX:"ad_",AD_LEARNMORE_ID_PREFIX:"learnMore_",CAPTIONS_ID_PREFIX:"cc_",CONTENT_ID_PREFIX:"content_",CONTROLS_ID_PREFIX:"controls_",VIDEO_ID_PREFIX:"video_",ID_SELECTOR_PREFIX:"#"},Type:{Button:{FULLSCREEN:"btn-fullscreen",PLAYSTATE:"btn-playstate",SETTINGS:"btn-settings",CLOSED_CAPTION:"btn-captions",VOLUME:"btn-volume"},Gesture:{GLOBAL_RESUME:"globalResume",LOCAL_RESUME:"localResume",CONT_CANCEL:"cont_cancel",RELATED_OVERLAY:"related",RELATED_CLICK_GESTURE:"related_click",SHARE_OVERLAY:"share",SHARE_NETWORK_GESTURE:"share_network",SEND_GESTURE:"send",EMBED_GESTURE:"embed",LINK_GESTURE:"copylink",REPLAY_GESTURE:"replay",END_CARD_OVERLAY:"endCard",ERROR_OVERLAY:"error",RECOMMEND_NOW:"recommend_now",RECOMMEND_NEXT:"recommend_next",RECOMMEND_CLOSE:"recommend_close"},QOSVendor:{CONVIVA:"conviva",AKAMAI:"akamai",MUX:"mux",NPAW:"npaw"}},tracking:{AKAMAI:"AkamaiQOSPluginJS",CONVIVA:"ConvivaQOSPluginJS",COMSCORE:"ComScore_ss",MUX:"MuxQOSPluginJS",NIELSEN:"NielsenTracking_SDK",HEARTBEAT:"SiteCatalyst",OZTAM:"OzTam"},getVideoManager:function(){return uvpjs.VideoManager.getInstance()},register:function(e){var t,i,s=e.split("."),n=window,a=s.length;for(t=0;t<a;t++)void 0===n[i=s[t]]&&(n[i]={}),n=n[i];return n},getClass:function(e){var t,i,s,n,a,r;if("string"!=typeof e)return e;for(t=e.split("."),i=window,s=t.length,n="",a=0;a<s;a++){if(n+=r=t[a],void 0===i[r])throw new Error("uvpjs.getClass(): "+n+" is undefined.");a<s-1&&(n+="."),i=i[r]}return i},getObject:function(e){return uvpjs.getClass(e)}},function(){var e=!1,t=/xyz/.test(function(){})?/\b_super\b/:/.*/;this.Class=function(){},Class.subClass=function(i){var s,n,a,r,o=this.prototype;for(r in e=!0,n=new this,e=!1,s=function(e,t){return function(){var i,s=this._super;return this._super=o[e],i=t.apply(this,arguments),this._super=s,i}},i)i.hasOwnProperty(r)&&(a=i[r],n[r]="function"==typeof a&&"function"==typeof o[r]&&t.test(a)?s(r,a):a);function l(){!e&&this.init&&this.init.apply(this,arguments)}return l.prototype=n,l.prototype.constructor=l,l.subClass=arguments.callee,l}}(),uvpjs.Class=Class,uvpjs._=_.noConflict(),uvpjs.register("uvpjs").b64TestVideo="data:video/mp4;base64,AAAAIGZ0eXBpc29tAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAAAuhtZGF0AUAigKN4SIUtLS0tLS0tLS0tLS0tLS0tLS0tLS0vAAACsAYF//+s3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0OCByMjc5NSBhYWE5YWE4IC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNyAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTE2IGRlYmxvY2s9MTowOjAgYW5hbHlzZT0weDM6MHgxMzMgbWU9dW1oIHN1Ym1lPTEwIHBzeT0xIHBzeV9yZD0xLjAwOjAuMDAgbWl4ZWRfcmVmPTEgbWVfcmFuZ2U9MjQgY2hyb21hX21lPTEgdHJlbGxpcz0yIDh4OGRjdD0xIGNxbT0wIGRlYWR6b25lPTIxLDExIGZhc3RfcHNraXA9MSBjaHJvbWFfcXBfb2Zmc2V0PS0yIHRocmVhZHM9MSBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTggYl9weXJhbWlkPTIgYl9hZGFwdD0yIGJfYmlhcz0wIGRpcmVjdD0zIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MiBrZXlpbnQ9MjUwIGtleWludF9taW49MjUgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD02MCByYz1jcmYgbWJ0cmVlPTEgY3JmPTUxLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IGlwX3JhdGlvPTEuNDAgYXE9MToxLjAwAIAAAAAKZYiBAAn/Ix39GwAABOltb292AAAAbG12aGQAAAAAAAAAAAAAAAAAAAPoAAAALwABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAACL3RyYWsAAABcdGtoZAAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAIgAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAA445AAIAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAACIAAAAAAAEAAAAAAadtZGlhAAAAIG1kaGQAAAAAAAAAAAAAAAAAAC7UAAABkBXHAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAFSbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAABEnN0YmwAAACuc3RzZAAAAAAAAAABAAAAnmF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAgACAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAA4YXZjQwFkAAr/4QAeZ2QACqxyBF+IiP/ABAACRAAAAwGQAABdqDxIlhGAAQAHaOhDgZSyLAAAABBwYXNwAAAAEAAAAAkAAAAYc3R0cwAAAAAAAAABAAAAAQAAAZAAAAAcc3RzYwAAAAAAAAABAAAAAQAAAAEAAAABAAAAFHN0c3oAAAAAAAACwgAAAAEAAAAUc3RjbwAAAAAAAAABAAAATgAAAeR0cmFrAAAAXHRraGQAAAADAAAAAAAAAAAAAAACAAAAAAAAAC8AAAAAAAAAAAAAAAEBAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAkZWR0cwAAABxlbHN0AAAAAAAAAAEAAAAAAAAEAAABAAAAAAFcbWRpYQAAACBtZGhkAAAAAAAAAAAAAAAAAABWIgAABAAVxwAAAAAALWhkbHIAAAAAAAAAAHNvdW4AAAAAAAAAAAAAAABTb3VuZEhhbmRsZXIAAAABB21pbmYAAAAQc21oZAAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAAy3N0YmwAAABnc3RzZAAAAAAAAAABAAAAV21wNGEAAAAAAAAAAQAAAAAAAAAAAAIAEAAAAABWIgAAAAAAM2VzZHMAAAAAA4CAgCIAAgAEgICAFEAVAAAAAAAULwAAFC8FgICAAhOIBoCAgAECAAAAGHN0dHMAAAAAAAAAAQAAAAEAAAQAAAAAHHN0c2MAAAAAAAAAAQAAAAEAAAABAAAAAQAAABRzdHN6AAAAAAAAAB4AAAABAAAAFHN0Y28AAAAAAAAAAQAAADAAAABidWR0YQAAAFptZXRhAAAAAAAAACFoZGxyAAAAAAAAAABtZGlyYXBwbAAAAAAAAAAAAAAAAC1pbHN0AAAAJal0b28AAAAdZGF0YQAAAAEAAAAATGF2ZjU3LjcxLjEwMA==",function(e){"use strict";uvpjs.register("uvpjs").util={isLocalStorageSupported:null,xhrMessages:{0:"Request blocked or timed out",500:"Server error encountered.",404:"Resource not found.",403:"Access denied."},getErrorMessageForXHRStatus:function(e){return e&&this.xhrMessages[e]||"XHR status: "+e},getLocationQueryObject:function(){return this.objFromQueryStr(window.location.search.substring(1))},parseUrl:function(e){var t=document.createElement("a");return t.href=e,{host:t.hostname,pathname:t.pathname,protocol:t.protocol,search:t.search}},objFromQueryStr:function(e){var t,i,s,n="string"==typeof e?e:"",a=(n.indexOf("?")>-1?n.split("?")[1]:n).split("&"),r={};for(i=0,s=a.length;i<s;i++)r[(t=a[i].split("="))[0]]=t[1];return r},queryStrFromObj:function(e,t){var i,s="",n=!1;for(i in e)s+=(n?"&":"")+i+"="+(t?encodeURIComponent(e[i]):e[i]),n=!0;return s},uid8:function(){var e=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return e()+e()},getUserStatusForQuery:function(e){var t="";switch(e){case"anon":t="sb=0";break;case"reg;sub;pay":t="sb=1";break;case"reg":t="sb=2";break;case"reg;sub;susp":t="sb=3";break;case"reg;sub;exsub":t="sb=4";break;case"reg;sub;trial":t="sb=5";break;default:if(e.indexOf("|")>-1){var i,s,n,a,r="",o=e.split(","),l=o.length;for(o.sort(),a=0;a<l;a++)2==(i=o[a].split("|")).length&&(s=i[0],n=i[1],r!=s?(t.length>0&&(t+="&"),t+=s+"="+n):t+=","+n,r=s)}}return""==t&&(t="sb=0"),t},firstInt:function(){var e,t,i=arguments.length;for(t=0;t<i;t++)if(e=arguments[t],parseInt(e)===e)return e},inRange:function(e,t,i){return"number"==typeof e&&e>=t&&e<=i},isEmpty:function(e){return null==e||Array.isArray(e)&&0===e.length||"object"==typeof e&&0===Object.keys(e).length||"string"==typeof e&&""===e},isPlainObject:function(e){return e&&"object"==typeof e&&e.constructor===Object},isFunction:function(e){return"function"==typeof e},isDefinedString:function(e){return!!(e&&"string"==typeof e&&e.length>0)},isNumber:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},isDefined:function(e){return void 0!==e},isFlagTrue:function(e){return!0===e||"true"===e||1===e||"1"===e},getDefinedString:function(){var e,t,i=arguments.length;for(t=0;t<i;t++)if(e=arguments[t],this.isDefinedString(e))return e;return""},supportsLocalStorage:function(){var e;if(null===this.isLocalStorageSupported)try{localStorage.setItem("test","1"),e=localStorage.getItem("test"),this.isLocalStorageSupported="1"===e,localStorage.removeItem("test")}catch(e){this.isLocalStorageSupported=!1}return this.isLocalStorageSupported},htmlToElement:function(e){var t=document.createElement("div");return t.innerHTML=e,t.firstChild},createStyleSheet:function(e,t){var i,s,n,a,r,o,l,d,u,c,h=document.styleSheets,p=h.length;for(u=function(){c||(e(r),c=!0)},i=0;i<p;i++){r=h[i];try{if((r.href&&r.href.replace(/http(s)?:/,""))===t)return void u()}catch(e){null}}s="string"==typeof t&&""!==t,n=uvpjs.mediaCapabilities.isFirefox(),a=!s||n?"style":"link",(r=document.createElement(a)).setAttribute("type","text/css"),r.appendChild(document.createTextNode("")),s&&(r.setAttribute("rel","stylesheet"),r.setAttribute("href",t),r.textContent='@import "'+t+'"'),"function"==typeof e&&(r.onload=u,r.addEventListener&&r.addEventListener("load",u,!1),r.onreadystatechange=function(){"loaded"!==(o=r.readyState)&&"complete"!==o||(link.onreadystatechange=null,u())},l=setInterval(function(){document.styleSheets.length>p&&(u(),clearInterval(l))},10),n&&(d=setInterval(function(){try{r.sheet.cssRules,clearInterval(d),u()}catch(e){}},10)),document.getElementsByTagName("head")[0].appendChild(r))},addCSSObject:function(e,t,i,s){var n,a=uvpjs.util,r="#"+t.id+" "+(s||"");for(n in i)a.addCSSRule(e,r,n,i[n])},addCSSRule:function(e,t,i,s){var n,a,r,o=uvpjs.mediaCapabilities,l="string"==typeof s&&s.match(/NaN(%|px)/);if(!(!e||!e.sheet))if(!l||o.isAndroid()&&o.isChrome()||(s="0"),a=((n=e.sheet).rules||n.cssRules).length,r=i+":"+s+";",n.insertRule)try{n.insertRule(t+"{"+r+"}",a)}catch(e){console.warn("Unable to add CSS rule: "+e.message)}else n.addRule&&n.addRule(t,r,a)},addCSSRules:function(e,t,i){for(var s,n=i.length;n--;)s=i[n],uvpjs.util.addCSSRule(e,t,s.name,s.value)},copyObjectWithKeyMap:function(e){var t=e,i=null;return this.from=function(e){return i=e,this},this.to=function(e){if(!(t&&i&&e))return e;for(var s in t)t.hasOwnProperty(s)&&i.hasOwnProperty(s)&&null!==i[s]&&(e[t[s]]=i[s]);return e},this}}}(),function(e){var t=uvpjs._,i=/\{mediaReferenceId}/g,s=/PARTNER/g,n=/\{ptype}/g,a=/\{VGUID}/g,r=/%7Bptype%7D/g,o=/%7BVGUID%7D/g,l=/;/g;e.adUtil={MOAT_PARTNER_CODE:"cbsiimajsint708425247896",context:{IMA:"ima",DAI:"dai"},vpaidEvents:["AdImpression","AdLoaded","AdStopped","AdVideoStart","AdVideoFirstQuartile","AdVideoMidpoint","AdVideoThirdQuartile","AdVideoComplete","AdPaused","AdPlaying","AdSkipped","AdVolumeChange"],moatEventMapping:{ima:{start:3,firstquartile:4,midpoint:5,thirdquartile:6,complete:7,pause:8,resume:9,skip:10,volumeChange:11,mute:11},dai:{started:3,firstquartile:4,midpoint:5,thirdquartile:6,complete:7,controlPause:8,controlPlay:9,controlVolumeSet:11,controlMute:11,controlUnmute:11}},populateImaAdCallValues:function(e,l,d,u){var c,h,p,g,f,v,m,_,E=uvpjs.util,A="cust_params",y=e.split("?"),S=y[1],b=e.indexOf("%7Bptype%7D")>-1,T=e.indexOf("{ptype}")>-1,C=this.getAdParams(l,d,u);return S=S.replace(i,C.vid).replace(s,C.partner),b&&(S=S.replace(o,C.vguid).replace(r,C.ptype)),T&&(S=S.replace(a,C.vguid).replace(n,C.ptype)),h=E.objFromQueryStr(S),this.isExcludedFromVpaid(l)&&delete h.pp,(p=h[A])&&(c=E.objFromQueryStr(decodeURIComponent(p)),delete h[A]),g=C[A],delete C[A],delete C.partner,delete C.vguid,delete C.ptype,f=t.assign(C,h),v=t.assign(g,c||{}),decodeURIComponent(f.iu).indexOf("/8264/")>=0&&l.isMuteAtPlayStart&&!l.userHasUnmuted&&(f.sz="640x483"),this.removeEmpty(f),this.removeEmpty(v),m=E.queryStrFromObj(f,!1),_=E.queryStrFromObj(v,!1),m+="&"+A+"="+encodeURIComponent(_),y[0]+"?"+m},getAdParams:function(e,i,s){var n,a,r=e.dwPageParams,o=this.getDwViewGuid(e),l=this.getPpidValue(e),d=e.contentVideoState,u=encodeURIComponent(e.sessionOptions.partner),c=r.pagetype||"",h=this.getUserStatusKey(e.getSessionOption("userStatus")),p=""!==d.contPlayState&&!uvpjs.util.isFlagTrue(s)?"1":"0",g=e.getSessionOption("isEmbedded")?"1":"0",f=this.getHost("1"===g,e),v=d.pid,m={cust_params:{}},_=uvpjs.Configuration.env,E=e.getAdCallParams();for(a in n=i?this.getVideoDfpId(e):"",m.vid=n,m.partner=u,m.ptype=c,m.vguid=o,m.cust_params.vguid=o,m.cust_params.embed=g,f&&(m.cust_params.host=f),this.populateCustParamsWithAdSessionValues(m.cust_params,v),d.podsToSkip.length>0&&(m.cust_params.resume=1,m.cust_params.skippod=d.podsToSkip),h)m.cust_params[a]=h[a];if(l&&(m.ppid=l,m.cust_params.ppid=l),"cbs"===u&&(m.cust_params.cpSession=p,m.cust_params.cpPre=p,m.cust_params.sub=t.isEmpty(e.sessionOptions.userId)?"":e.sessionOptions.userId),E&&!uvpjs.util.isEmpty(E.standardParams))for(a in E.standardParams)m[a]=E.standardParams[a];if(E&&!uvpjs.util.isEmpty(E.customParams))for(a in E.customParams)m.cust_params[a]=E.customParams[a];return this.isExcludedFromVpaid(e)?m.pp="ssai":("local"===_||"dev"===_)&&(m.pp="vpaid_js"),m},getVideoDfpId:function(e){return uvpjs.util.isEmpty(e.contentVideoState.dfpMediaId)?e.contentVideoState.cmsRefGuid:e.contentVideoState.dfpMediaId},isExcludedFromVpaid:function(e){return"AA Original"===e.contentVideoState.contentType},getDwViewGuid:function(e){var t=e.dwPageParams;return t&&t.viewguid||t.pguid||""},extractAdInfo:function(e,i){var s,n,a=i===this.context.DAI?"extractAdInfoDai":"extractAdInfoIma";return uvpjs.util.isEmpty(e)||!i?(!i&&console.error("No 'context' arg supplied"),null):((s={adId:e.getAdId(),adSystem:e.getAdSystem(),creativeAdId:e.getCreativeAdId(),creativeId:e.getCreativeId()}).adPodInfo=this.extractPodInfo(e.getAdPodInfo()),n=this[a](e),t.assign(s,n))},extractAdStateData:function(e,t,i){var s=e.getAdPodInfo(),n=s.getPodIndex(),a=s.getAdPosition(),r=e.getDuration(),o=i?"mid":0===n?"pre":n>=1?"mid":-1===n?"post":"",l=("mid"!==o?o+"_0":"mid_"+n)+"_"+a,d=t===this.context.IMA,u=d?this.extractIdInfo(e):null,c=this.getAdStateBlank();return c.adPosition=a,c.adBitrate=e.getVastMediaBitrate?e.getVastMediaBitrate():NaN,c.adServerName=d?this.context.IMA:this.context.DAI,c.adVideoTitle=e.getTitle(),c.duration=r,c.adType=o,c.adClipID=l,c.wrapperAdId=d&&u.wrapperAdId||"",c.adVideoId=d?u.wrapperAdId||u.adId:e.getAdId(),c.creativeId=d?u.wrapperCreativeId||u.creativeId:e.getCreativeId(),t===this.context.DAI&&(c.sourceWidth=e.getVastMediaWidth(),c.sourceHeight=e.getVastMediaHeight()),c},getAdStateBlank:function(){return{adPosition:null,adServerName:null,adVideoTitle:null,duration:null,adType:null,adClipID:null,wrapperAdId:null,adVideoId:null,creativeId:null}},extractIdInfo:function(e){var t=e.getWrapperAdIds(),i=e.getWrapperCreativeIds(),s=Array.isArray(t)&&t.length||0,n=Array.isArray(i)&&i.length||0,a=null,r=null,o=e.getAdId()||"",l=e.getCreativeId()||"";return s&&(s>1&&(a=t[1]),o=t[0]),n&&(n>1&&(r=i[1]),l=i[0]),{adId:o,wrapperAdId:a,creativeId:l,wrapperCreativeId:r}},getHost:function(e,t){var i,s;return e?(i=t.getSessionOption("referrer"))&&(s=uvpjs.util.parseUrl(i).host):s=window.location.hostname,s&&""!==s?s:null},getUserStatusKey:function(e){for(var t,i=uvpjs.util.getUserStatusForQuery(e).split("&"),s=i.length,n={};s--;)n[(t=i[s].split("="))[0]]=t[1];return n},trackAd:function(e){var t,i,s,n=e.model,a=e.context,r=n.getAdVideoState(),o=a===this.context.IMA,l=a===this.context.DAI;if(o||l)return i=n.dwPageParams.pagetype||"",t={level1:"",level2:"",level3:r.adVideoId,level4:r.creativeId,slicer1:"vaw-can",slicer2:n.sessionOptions.partner,slicer3:i,moatVASTSystem:r.adServerName,moatVASTAdID:r.wrapperAdId},""!==(s=this.getDwViewGuid(n))&&(t.zMoatVGUID=s),""!==i&&(t.zMoatPT=i),this.initMoatTracking(e.adVideoContainer,t,r.duration,this.MOAT_PARTNER_CODE,null);console.error("Invalid DFP context supplied to method.")},trackAdEvent:function(e){var t=this.getVpaidEventForEvent(e.eventName,e.context);t&&e.trackingHandle.dispatchEvent({type:t,adVolume:e.volume})},checkForAdBlocker:function(e){var t=e.getSessionOption("adBlockerCallback");return t&&t()},populateCustParamsWithAdSessionValues:function(e,t){var i,s,n;if("function"==typeof window.getVideoAdSessionValues&&"string"==typeof(i=window.getVideoAdSessionValues(t))&&""!==i)for(n in i=i.replace(l,"&"),s=uvpjs.util.objFromQueryStr(i))e[n]=s[n]},removeEmpty:function(e){for(var t in e)(null===e[t]||""===e[t])&&delete e[t]},extractAdInfoIma:function(e){return{contentType:e.getContentType(),isLinear:e.isLinear()}},extractAdInfoDai:function(e){return{advertiserName:e.getAdvertiserName(),description:e.getDescription(),duration:e.getDuration(),title:e.getTitle()}},extractPodInfo:function(e){return e?{adPosition:e.getAdPosition(),podIndex:e.getPodIndex(),timeOffset:e.getTimeOffset(),totalAds:e.getTotalAds()}:null},getPpidValue:function(e){var t=e.getSessionOption("userPPID");return uvpjs.util.isDefinedString(t)?t:null},initMoatTracking:function(e,t,i,s,n){var a,r,o,l=document.createElement("script"),d=[];t={adData:{ids:t,duration:i,url:n},dispatchEvent:function(e){this.sendEvent?(d&&(d.push(e),e=d,d=!1),this.sendEvent(e)):d.push(e)}},o="_moatApi"+Math.floor(1e8*Math.random());try{r=(a=e.ownerDocument).defaultView||a.parentWindow}catch(e){r=window}return r[o]=t,l.type="text/javascript",e&&e.insertBefore(l,e.childNodes[0]||null),l.src="https://z.moatads.com/"+s+"/moatvideo.js#"+o,t},getVpaidEventForEvent:function(e,t){var i=this.moatEventMapping[t][e];return uvpjs.util.isEmpty(i)?null:this.vpaidEvents[i]}}}(uvpjs.register("uvpjs")),function(e){"use strict";e.Configuration={env:"prod",hostname:"vidtech.cbsinteractive.com",name:"UVPJS",version:"3.0.0",date:"12/06/19 10:32:04 AM (PST)",path:"//vidtech.cbsinteractive.com/uvpjs/3.0.0/",playerName:"CBSI-PLAYER"}}(uvpjs),uvpjs.register("uvpjs").AutoplayDetectionService=uvpjs.Class.subClass({init:function(e){this.mc=e.mediaCapabilities,this.completeCallback=e.completeCallback,this.testDom=this.createTestDom(),this.testVidPath=e.testVidPath,this.isMobile=this.mc.isMobile(),this.vidEl=null,this.detectCapabilities()},destroy:function(){this.killVid(),this.testDom&&this.testDom.parentNode.removeChild(this.testDom),this.testDom=null,this.mc=null,this.completeCallback=Function.prototype},setInfo:function(e,t){this.mc.setAutoplayInfo({supportsUnmutedAutoplay:e,supportsMutedAutoplay:t})},detectCapabilities:function(){this.checkUnmutedAutoplay()},finishCheck:function(e,t){this.killVid(),this.setInfo(e,t),setTimeout(this.completeCallback,2)},checkUnmutedAutoplay:function(){var e,t;this.vidEl=t=this.createVideoElement(!1),t.load(),void 0===(e=t.play())?this.isMobile?this.detectMobileCapabilities():this.finishCheck(!0,!0):e.then(this.finishCheck.bind(this,!0,!0)).catch(this.checkMutedAutoplay.bind(this))},checkMutedAutoplay:function(){var e;this.killVid(),this.checkForEarlySafari()?this.finishCheck(!1,!1):(this.vidEl=e=this.createVideoElement(!0),e.load(),e.play().then(this.finishCheck.bind(this,!1,!0)).catch(this.finishCheck.bind(this,!1,!1)))},killVid:function(){this.vidEl&&(this.vidEl.pause(),this.vidEl.removeAttribute("src"),this.testDom&&this.testDom.removeChild(this.vidEl),this.vidEl=null)},checkForEarlySafari:function(){var e=this.mc.getBrowserName()===this.mc.SAFARI,t=this.mc.isDesktop(),i=e&&t?this.mc.getBrowserVersion():null,s=i&&i.split("."),n=s?11===parseInt(s[0])&&0===parseInt(s[1]):null;return null!==i&&n&&(!s[2]||parseInt(s[2])<3)},detectMobileCapabilities:function(){var e=this.isAutoplayEligibleAndroid()||this.isAutoplayEligibleIos();this.finishCheck(!1,e)},isAutoplayEligibleAndroid:function(){return this.mc.isAndroid()&&this.mc.isChrome()&&this.isChromeAutoplayEligible()},isAutoplayEligibleIos:function(){var e=this.mc.isIOSTen(),t=e&&this.mc.isSafari(),i=e&&!t&&this.mc.isChrome()&&this.isChromeAutoplayEligible();return t||i},isChromeAutoplayEligible:function(){return parseInt(this.mc.getBrowserMajorVersion())>=54},createVideoElement:function(e){var t=document.createElement("video");return e&&(t.muted=!0,t.setAttribute("muted","muted")),this.mc.setVideoForInlinePlay(t,!0),t.volume=.005,t.style.width="100%",t.style.height="100%",t.src=this.testVidPath,this.testDom.appendChild(t),t},createTestDom:function(){var e=document.createElement("div"),t=e.style,i="-1000px";return t.position="absolute",t.top=i,t.left=i,t.width="320px",t.height="180px",document.body.appendChild(e),e}}),uvpjs.MediaCapabilities=function(){var e,t,i,s,n,a,r,o,l,d,u,c,h,p=uvpjs._,g=uuid.noConflict(),f=!1,v={EMPTY:-2,LOADING:-1,STOPPED:0,PLAYING:1,PAUSED:2,BUFFERING:3,DATA_LOADING_ERROR_STATE:130,VIDEO_NOT_AVAILABLE_ERROR_STATE:110,GEO_BLOCK_ERROR_STATE:120,RP_URL:"rp_url",RP_DAI:"rp_dai",RP_IMA:"rp_ima",RP_MDIALOG:"rp_mDialog",RP_PLATFORM:"rp_platform",HTML5:"HTML5",HLSJS:"HLSJS",DASHJS:"DASHJS",SHAKA:"SHAKA",FLASH_HLS:"FLASH-HLS",PLATFORM:"platform",IMA:"ima",PLACEHOLDER_M3U8_URL:"//vidtech.cbsinteractive.com/h5/blanks/uvp_blank.mp4",PLACEHOLDER_MP4_URL:"//vidtech.cbsinteractive.com/h5/blanks/uvp_blank.mp4",MP4_BLANK_FILE:"//vidtech.cbsinteractive.com/h5/blanks/uvp_blank.mp4",PLATFORM_OUTLET_ACCOUNT_ID:"dJ5BDC",CAN_DYNAMIC_VARIANT_SERVICE_BASE_URL:"http://can.cbs.com/thunder/player/videoManifest.php?assetType=HLS&authn=",STRING:"string",OBJECT:"object",BOOLEAN:"boolean",FUNCTION:"function",MAC:"Macintosh",WINDOWS:"Windows",LINUX:"Linux",OSX:"OS X",WINDOWS7:"Windows 7",WINDOWS8:"Windows 8",WINDOWS10:"Windows 10",WINDOWS_VISTA:"Windows Vista",IOS:"iOS",ANDROID:"Android",CHROMEOS:"CrOS",PHONE:"Phone",TABLE:"Tablet",DESKTOP:"Desktop",IPHONE:"iPhone",IPAD:"iPad",IPOD:"iPod",ANDROID_PHONE:"Android Phone",ANDROID_TABLET:"Android Tablet",WINDOWS_PHONE:"Windows Phone",WINDOWS_TABLET:"Windows Tablet",CHROME:"Chrome",FIREFOX:"Firefox",FIREFOX_IOS:"FxiOS",SAFARI:"Safari",IE:"IE",EDGE:"Edge",OPERA:"Opera",OPERA_MOBILE:"Opera Mobile",ANDROID_BROWSER:"Android Browser",CHROMECAST:"Chromecast",AMAZON_KINDLE:"Silk",CHROMECAST_USER_AGENT:"CrKey",PLAYSTATION:"Playstation",FACEBOOK_IOS:"Facebook Browser iOS",PROGRESSIVE:"progressive",STREAMING:"streaming",IOS_INLINE_PLAY_ATTRIBUTE:"playsinline",VIDEO:"video",AUDIO:"audio",PROBABLY:"probably",MAYBE:"maybe",MP4:"mp4",M3U:"m3u",MP3:"mp3",MPD:"mpd",MT_MP4:"video/mp4",hasMse:null,systemInfo:{browser:null,version:null,isMobile:null,isDesktop:null,os:null,supportsMse:null,isHlsjsEligible:null,supportsNativeHls:null,supportsMp4:null,supportsDash:null,supportsUnmutedAutoplay:null,supportsMutedAutoplay:null,trackingAvailability:null},apDetectionService:null,_detectEnvironment:function(t,i){var a=this.systemInfo;return typeof t===this.STRING?(e=t,!0):(e=navigator.userAgent||null,!1),s=document.createElement(this.VIDEO),n=document.createElement(this.AUDIO),typeof i===this.BOOLEAN&&i,m(),y(),L(),f="https:"===location.protocol,a.browser=this.getBrowserName(),a.version=parseInt(this.getBrowserMajorVersion()),a.isMobile=this.isMobile(),a.isDesktop=this.isDesktop(),a.os=this.getOS()+"; ver. "+this.getOSVersion(),a.supportsMse=this.hasMediaSourceSupport(),a.isHlsjsEligible=this.canPlayHLSJS(),a.supportsNativeHls=this.canPlayNativeHLS(),a.supportsMp4=this.canPlayH264(),a.supportsDash=this.canPlayDASH(),this.canUseDataUrl()||(this.PLACEHOLDER_MP4_URL=this.MP4_BLANK_FILE),this},canUseDataUrl:function(){return!1},determineAutoplayCapabilities:function(e){var t;null===this.systemInfo.supportsUnmutedAutoplay?(t=function(){this.apDetectionService&&this.apDetectionService.destroy(),this.apDetectionService=null,e()}.bind(this),this.apDetectionService=new uvpjs.AutoplayDetectionService({mediaCapabilities:this,completeCallback:t,testVidPath:this.PLACEHOLDER_MP4_URL})):e()},setTrackingInfo:function(e){var t,i,s=uvpjs.tracking,n={};for(i in s)t=s[i],n[i]=!!e[t];this.systemInfo.trackingAvailability=n},setAutoplayInfo:function(e){this.systemInfo.supportsUnmutedAutoplay=e.supportsUnmutedAutoplay,this.systemInfo.supportsMutedAutoplay=e.supportsMutedAutoplay},getAutoplayInfo:function(){return{supportsMutedAutoplay:this.systemInfo.supportsMutedAutoplay,supportsUnmutedAutoplay:this.systemInfo.supportsUnmutedAutoplay}},getSessionId:function(){return g.v1().replace(/-/g,"")},checkBrowserName:function(e){return typeof e===this.STRING&&this.getBrowserName()===e},canPlayHTML5Video:function(){var e=document.createElement(this.VIDEO);return typeof e===this.OBJECT&&typeof e.canPlayType===this.FUNCTION},canPlayHTML5Audio:function(){var e=document.createElement(this.AUDIO);return typeof e===this.OBJECT&&typeof e.canPlayType===this.FUNCTION},getBrowserName:function(){return u||"unknown"},getBrowserVersion:function(){return c||-1},getBrowserMajorVersion:function(){return h||-1},getBrowserVendorPrefix:function(){return this.isFirefox()?"moz":this.isWebKit()?"webkit":this.isIE()?"ms":this.isOpera()?"o":void 0},setBrowserVersion:function(e,t){if(typeof t===this.OBJECT){var i=t.exec(this.getUserAgent()),s="",n="";if(i&&typeof i===this.OBJECT&&i.length&&i.length>1){if((s=i[1]||"").indexOf(".")){var a=s.split(".");"object"==typeof a&&a.length&&a.length>0&&(n=a[0])}else n=s;return u=e,c=s,h=n,!0}}return!1},hasTealium:function(){return p.has(window,"utag")||p.has(window,"utag_data")},isPlaystation:function(){return this.checkBrowserName(this.PLAYSTATION)},isChrome:function(){return this.checkBrowserName(this.CHROME)},isWebKit:function(){return"WebkitAppearance"in document.documentElement.style},isFirefox:function(){return this.checkBrowserName(this.FIREFOX)||this.checkBrowserName(this.FIREFOX_IOS)},isSafari:function(){return this.checkBrowserName(this.SAFARI)},isIE:function(){return this.checkBrowserName(this.IE)},isEdge:function(){return this.checkBrowserName(this.EDGE)},isOpera:function(){return this.checkBrowserName(this.OPERA)},isOperaMobile:function(){return this.checkBrowserName(this.OPERA_MOBILE)},isAndroidBrowser:function(){return this.checkBrowserName(this.ANDROID_BROWSER)},setUserAgent:function(e){return typeof e===this.STRING&&(this._detectEnvironment(e),!0)},getUserAgent:function(){return e},getMimeTypesObj:function(){return t||(typeof navigator===this.OBJECT&&navigator.mimeTypes&&navigator.mimeTypes.length>0&&(t=navigator.mimeTypes),t)},getMimeTypes:function(){if(typeof i===this.OBJECT)return i;var e={length:0},t=this.getMimeTypesObj();if(typeof t===this.OBJECT){for(var s=0;s<this.length;s++){var n=t[s].enabledPlugin&&t[s].enabledPlugin.name?t[s].enabledPlugin.name:"";e[t[s].type]={type:t[s].type,description:t[s].description,suffixes:t[s].suffixes,enabledPlugin:t[s].enabledPlugin,enabledPluginName:n},e.length++}return i=e}},getPlatform:function(){return typeof r===this.STRING?r:null},getOS:function(){return typeof o===this.STRING?o:null},getOSVersion:function(){return typeof l===this.STRING?l:null},isWindows:function(){return this.getPlatform()===this.WINDOWS},isMac:function(){return this.getPlatform()===this.MAC},isLinux:function(){return this.getPlatform()===this.LINUX},isChromeOS:function(){return this.getUserAgent().toLowerCase().indexOf(this.CHROMEOS.toLowerCase())>=0},isOSX:function(){return this.getOS()===this.OSX},isIOS:function(){return this.getOS()===this.IOS},isAndroid:function(){return this.getDevice()===this.ANDROID},isChromecast:function(){return this.getDevice()===this.CHROMECAST},isWindowsPhone:function(){return this.getOS()===this.WINDOWS_PHONE},isDesktop:function(){return typeof d===this.BOOLEAN?d:d=this.isWindows()&&!this.isWindowsPhone()||this.isMac()&&!this.isIOS()||this.isLinux()&&!this.isAndroid()||this.isChromeOS()},canPlayNativeHLS:function(){return S()&&this.canPlayVideoType("application/vnd.apple.mpegurl")},canUseP2p:function(){return this.canPlayHLSJS()&&!this.isIE()&&!this.isEdge()},hasMediaSourceSupport:function(){if(null===this.hasMse){var e=window.MediaSource||window.WebKitMediaSource,t=window.SourceBuffer||window.WebKitSourceBuffer,i=e&&"function"==typeof e.isTypeSupported&&e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),s=!t||t.prototype&&"function"==typeof t.prototype.appendBuffer&&"function"==typeof t.prototype.remove;this.hasMse=!(!i||!s)}return this.hasMse},canPlayHLSJS:function(e){var t=this.isMobile(),i=!!S(),s=this.hasMediaSourceSupport(),n=this.isFirefox()||this.isChrome(),a=this.isIE()&&this.getBrowserMajorVersion()>=11||this.isEdge(),r=this.isOpera()&&this.getBrowserMajorVersion()>=30,o=this.isPlaystation();return!(!s||!i||o||t&&!this.canPlayHlsjsAndriod(e))&&(!!e||(n||a||r))},canPlayHlsjsAndriod:function(e){var t=this.getUserAgent();if(t.indexOf("Android")>=0&&(parseFloat(t.slice(t.indexOf("Android")+8))>=5&&e))return!0;return!1},canPlayNativeHLSAudio:function(){return b()&&this.canPlayVideoType("audio/mpegurl")},canPlayDASHMP2TS:function(){return null},canPlayH264:function(){return S()&&this.canPlayVideoType('video/mp4; codecs="avc1.42001E, mp4a.40.2"')},canPlayVP8:function(){return S()&&this.canPlayVideoType('video/webm; codecs="vp8.0, vorbis, opus"')},canPlayVP9:function(){return S()&&this.canPlayVideoType('video/webm; codecs="vp9.0, vorbis, opus"')},canPlayVideoType:function(e,t){return S()&&this.canPlayMediaType(this.VIDEO,e,t||!1)},canPlayAudioType:function(e,t){return S()&&this.canPlayMediaType(this.AUDIO,e,t||!1)},canPlayMediaType:function(e,t,i){var s=e===this.AUDIO?document.createElement(this.AUDIO):document.createElement(this.VIDEO);return i=1==i,!(typeof s!==this.OBJECT||typeof s.canPlayType!==this.FUNCTION||!(i&&s.canPlayType(t)===this.PROBABLY||!i&&""!==s.canPlayType(t)))},canPlayType:function(e,t){t=1==t;var i=/audio\//.test(e)?document.createElement(this.AUDIO):document.createElement(this.VIDEO);return!(typeof i!==this.OBJECT||typeof i.canPlayType!==this.FUNCTION||!(t&&i.canPlayType(e)===this.PROBABLY||!t&&""!==i.canPlayType(e)))},nativeCanPlayType:function(e,t){var i=e===this.AUDIO?document.createElement(this.AUDIO):document.createElement(this.VIDEO);return typeof i===this.OBJECT&&typeof i.canPlayType===this.FUNCTION&&i.canPlayType(t)||null},canPlayDASHType:function(e){if(typeof e!==this.STRING||e.length<1)return null;var t=window.MediaSource||window.WebKitMediaSource||null;return this.canPlayType(e)&&this.hasMSE()&&t.isTypeSupported(e)},canPlayDASH264:function(e){return e=typeof e===this.STRING?e:'video/mp4; codecs="avc1.4D401E,mp4a.40.2"',this.canPlayDASHType(e)},canPlayDASH:function(){return this.canPlayDASH264()},canPlayDASHWebM:function(){return this.canPlayDASHType('video/webm; codecs="vp9"')},requiresSeparateTagsForIMA:function(){var e=this.getUserAgent();return e&&!(this.isChromecast()||this.isIOS()||e.indexOf("Android 2.")>-1||e.indexOf("Android 4.0")>-1||e.indexOf("Android 4.1")>-1)},isSingleVideoIma:function(){return this.isIOS()},requiresPlaceholderContent:function(e){return(!e||!this.supportsAutoplay())&&(!this.isChromecast()&&!this.supportsUnmutedAutoplay())},supportsMutedAutoplay:function(){return this.systemInfo.supportsMutedAutoplay},supportsUnmutedAutoplay:function(){return this.systemInfo.supportsUnmutedAutoplay},supportsAutoplay:function(){return this.supportsMutedAutoplay()},supportsIntelligentMobileAutoplay:function(){return this.isIOSTen()&&this.isIPhone()},requiresInlinePlayAttribute:function(e){return e&&this.supportsAutoplay()&&this.isIOSTen()},playRequiresUserGesture:function(e){return!e&&!this.supportsUnmutedAutoplay()},setVideoForInlinePlay:function(e,t){var i=this.getInlinePlayAttribute(),s=i&&i.name;t&&i?i&&e.setAttribute(s,i.value):!t&&s&&e.removeAttribute(s)},getInlinePlayAttribute:function(){return this.isIPhone()&&this.isIOSTen()?{name:this.IOS_INLINE_PLAY_ATTRIBUTE,value:"true"}:null},getCaptionsLineOffset:function(){return this.isSafari()?-1:0},getCaptionsCenterAlignToken:function(){return this.isSafari()?"middle":"center"},isIOSTen:function(){return this.isIOS()&&parseInt(this.getBrowserVersion())>=10},getPreferredPlaceholderURL:function(){return this.isIOS()?this.PLACEHOLDER_M3U8_URL:this.PLACEHOLDER_MP4_URL},hasMSE:function(){return!!window.MediaSource&&!!window.MediaSource.isTypeSupported},hasEME:function(){var e="MediaKeys"in window||"WebKitMediaKeys"in window||"MSMediaKeys"in window;return e&&!e.setMediaKeys},hasGoogle:function(){return"undefined"!=typeof google},getStandaloneMode:function(){return navigator.standalone||null},hasNativeFullscreen:function(){return!uvpjs.util.isEmpty(this._fullscreenEventName)},getFullscreenEventName:function(){return this._fullscreenEventName},getFullscreenEnterEventName:function(){return this._fullscreenEnterEventName||null},getFullscreenExitEventName:function(){return this._fullscreenExitEventName||null},getFullscreenErrorEventName:function(){return this._fullscreenErrorEventName},getEnterFullscreenMethodName:function(){return this._enterFullscreenMethodName},getExitFullscreenMethodName:function(){return this._exitFullscreenMethodName},getIsFullscreenPropertyName:function(){return this._isFullscreenPropertyName},getFullScreenElementName:function(){return this._fullscreenElementName},supportsFullscreenApi:function(){var e,t;return void 0===this._hasFullscreenApiSupport&&(this.isIOS()?this._hasFullscreenApiSupport=!1:(e=document.createElement("div"),t=uvpjs.util,this._hasFullscreenApiSupport=!!(t.isFunction(e.requestFullscreen)||t.isFunction(e.webkitRequestFullscreen)||t.isFunction(e.mozRequestFullScreen)||t.isFunction(e.msRequestFullscreen)))),this._hasFullscreenApiSupport},isFullscreenAvailable:function(e){var t=document,i=this.supportsFullscreenApi()&&(t.fullscreenEnabled||t.webkitFullscreenEnabled||t.mozFullScreenEnabled||t.msFullscreenEnabled);return!i&&(i=e&&e.webkitSupportsFullscreen),i},getDevice:function(){return a||null},isIPhone:function(){return this.getDevice()===this.IPHONE},isIPad:function(){return this.getDevice()===this.IPAD},isIPod:function(){return this.getDevice()===this.IPHONE},isMobile:function(){return this.getOS()===this.IOS||this.getOS()===this.ANDROID||this.getOS()===this.WINDOWS_PHONE||this.getOS()===this.OPERA_MOBILE},supportsMute:function(){var e=this.isIOS();return!e||e&&parseInt(this.getBrowserVersion())>=10},supportsCaptionsCSS:function(){return!this.isFirefox()&&!this.isIE()&&!this.isEdge()},supportsVolume:function(){return!this.isIOS()},isTouch:function(){return"ontouchstart"in window||navigator.maxTouchPoints},isConsole:function(){},isOTT:function(){return!1},isHlsUrl:function(e){return/\.m3u|assetType=hls/i.test(e)},isDashUrl:function(e){return/\.mpd/i.test(e)},isSecure:function(){return f},setUrlProtocol:function(e){return f?e.replace("http:","https:"):e},getDrmType:function(e){var t="none";return e.enabled?((this.isIOS()||this.isSafari())&&null!==e.fairplay.appCertURL?t="Fairplay":(this.isIE()||this.isEdge())&&null!==e.dash.playreadyURL?t="PlayReady":(this.isChrome()||this.isFirefox()||this.isOpera())&&null!==e.dash.widevineURL&&(t="Widevine"),t):t}},m=function(){var e=new RegExp(/\s(\([^)]+\))/).exec(v.getUserAgent());e&&e.length&&e.length>1&&(e=e[1].replace(/_/gi,"."),E(e)||A(e)||_(e)||I(e))},_=function(e){if(-1!==e.indexOf(v.LINUX)||-1!==e.indexOf(v.ANDROID)){if(r=v.LINUX,-1!==e.indexOf(v.ANDROID)){e=new RegExp(/\ Android\ ([^\s]+);/).exec(e),a=v.ANDROID,o=v.ANDROID,l=e&&e[1]?e[1]:""}return!0}return!1},E=function(e){if(-1!==e.indexOf(v.MAC))return r=v.MAC,a=v.DESKTOP,-1!==e.indexOf(v.OSX)&&(e=new RegExp(/Mac\ OS\ X\ ([\d\.]+)/).exec(e),o=v.OSX,l=e&&e[1]?e[1]:null),!0;if(-1!==e.indexOf("like Mac OS X")){r=v.MAC,o=v.IOS;var t=/\sOS\s([^\s]*)\s/.exec(e);if(t&&t[1]&&(l=t[1]),/\(iPhone;/.test(e))a=v.IPHONE;else if(/\(iPad;/.test(e))a=v.IPAD;else{if(!/\(iPod;/.test(e))return!1;a=v.IPOD}return!0}return!1},A=function(e){var t=new RegExp(/(Windows\ Phone\ |Windows\ Phone\ OS\ )([^\s]+);/);if((e=t.exec(v.getUserAgent()))&&e[2])return r=v.WINDOWS,o=v.WINDOWS_PHONE,l=e[2],a=v.PHONE,!0;if((e=(t=new RegExp(/Windows\ NT\ ([^\s]+)[;\)]/)).exec(v.getUserAgent()))&&e[1]){r=v.WINDOWS,o=v.WINDOWS;var i=e[1];return 6==i?o=v.WINDOWS_VISTA:6.1==i?(o=v.WINDOWS7,l=7):6.2==i?(o=v.WINDOWS8,l=8):10==parseInt(i)&&(o=v.WINDOWS10,l=i),a=v.DESKTOP,!0}return!1},y=function(){return!!T()||(!!D()||(!!R()||(!!P()||(!!M()||(!!k()||(!!w()||(!!C()||!!O())))))))},S=function(){return s},b=function(){return n},T=function(){var e=/Chrome\/(\S+)/,t=/CriOS\/(\S+)/,i=v.getUserAgent(),s=t.test(i);return!(!e.test(i)&&!s||/(Opera|OPR)/.test(i)||/Edge/.test(i)||/CrKey/.test(i))&&(v.setBrowserVersion(v.CHROME,s?t:e),!0)},C=function(){var e=/Playstation (\S+)/i;return!!e.test(v.getUserAgent())&&(v.setBrowserVersion(v.PLAYSTATION,e),!0)},I=function(){return null!=v.getUserAgent()&&v.getUserAgent().indexOf(v.CHROMECAST_USER_AGENT)>-1&&(r=v.LINUX,a=v.CHROMECAST,o=v.ANDROID,!0)},D=function(){var e=/MSIE\ ([^\s]+)[\)\;]\ Windows\ /,t=/\ Edge\/([^\s]+)/,i=/Trident.[^\s]+;.*rv:([^\s]+)[\)\;]/;return e.test(v.getUserAgent())?(v.setBrowserVersion(v.IE,e),!0):t.test(v.getUserAgent())?(v.setBrowserVersion(v.EDGE,t),!0):!!i.test(v.getUserAgent())&&(v.setBrowserVersion(v.IE,i),!0)},R=function(){var e=/Firefox\/(\S+)/,t=/FxiOS\/(\S+)/,i=v.getUserAgent(),s=t.test(i),n=!s&&e.test(i)?v.FIREFOX:s?v.FIREFOX_IOS:null;return!!n&&(v.setBrowserVersion(n,s?t:e),!0)},P=function(){var e,t=/Version\/(\S+).*Safari\//,i=t.test(v.getUserAgent());return e=o===v.ANDROID?v.ANDROID:v.SAFARI,!!i&&(v.setBrowserVersion(e,t),!0)},M=function(){var e=new RegExp(/Opera|OPR\/(\S+)/).exec(v.getUserAgent());if(e){var t=-1!==e.indexOf("Opera Mini/")||-1!==e.indexOf("Opera Mobi")?v.OPERA_MOBILE:v.OPERA;return v.setBrowserVersion(t,/Opera|OPR\/(\S+)/),!0}return!1},k=function(){return!!/Silk/i.test(v.getUserAgent())&&(v.setBrowserVersion(v.AMAZON_KINDLE,/Silk\/(\S+)/),!0)},w=function(){return!!/Android/.test(v.getUserAgent())&&(u=v.ANDROID_BROWSER,!0)},O=function(){var e=v.getUserAgent();if(!/FBAN/.test(e))return!1;var t=function(e){var t=e.match(/\[(.*)\]/),i=null,s={};return t&&t.length>0&&(i=t[1]),i.split(";").forEach(function(e){var t=e.split("/");t.length>0&&(s[t[0]]=t[1])}),s}(e);return t.FBSN&&(o=t.FBSN),t.FBSV&&(l=t.FBSV),!(!t.FBAN||!/iOS/i.test(t.FBAN))&&(u=v.FACEBOOK_IOS,!0)},L=function(){var e=S(),t=["fullscreenchange",null,null,"requestFullscreen","exitFullscreen","fullscreen","fullscreenElement","fullscreenError"],i=[null,"webkitbeginfullscreen","webkitendfullscreen","webkitEnterFullscreen","webkitExitFullscreen","webkitDisplayingFullscreen",null,"webkitfullscreenerror"],s=null;v.isIOS()?s=i:e.requestFullscreen?s=t:e.webkitRequestFullscreen?s=["webkitfullscreenchange",null,null,"webkitRequestFullscreen","webkitExitFullscreen","webkitIsFullScreen","webkitFullscreenElement","webkitfullscreenerror"]:e.mozRequestFullScreen?s=["mozfullscreenchange",null,null,"mozRequestFullScreen","mozCancelFullScreen","mozFullScreen","mozFullScreenElement","mozfullscreenerror"]:e.msRequestFullscreen?v.getBrowserVersion()<12?s=["MSFullscreenChange",null,null,"msRequestFullscreen","msExitFullscreen",null,"msFullscreenElement","MSFullscreenError"]:(s=t.slice())[5]=null:v.isAndroid()&&(s=i),function(e,t){e._fullscreenEventName=t?t[0]:null,e._fullscreenEnterEventName=t?t[1]:null,e._fullscreenExitEventName=t?t[2]:null,e._enterFullscreenMethodName=t?t[3]:null,e._exitFullscreenMethodName=t?t[4]:null,e._isFullscreenPropertyName=t?t[5]:null,e._fullscreenElementName=t?t[6]:null,e._fullscreenErrorEventName=t?t[7]:null}(v,s)};return v},uvpjs.mediaCapabilities=uvpjs.MediaCapabilities()._detectEnvironment(),uvpjs.DebugManager={CONFIG_MODULE_NAME:"UVPJSDebug",configParams:{SHOW_ALL:"showAll",SHOW_TIMESTAMPS:"showTimestamps",SHOW_CLOCK_TIME:"showClockTime",CODE_LOADER:"CodeLoader",CONFIG_MANAGER:"ConfigManager",CORE_VIDEO_INSTANCE:"CoreVideoInstance",CVI_MODEL:"CVI_Model",DEBUG_MANAGER:"DebugManager",DOM_MANAGER:"DOMManager",EVENTS_MANAGER:"EventsManager",RESOURCE_CONFIG_OBJECT:"ResourceConfigObject",RESOURCE_PLAYLIST_MANAGER:"ResourcePlaylistManager",RESOURCE_PROVIDER:"ResourceProvider",SKIN_MANAGER:"SkinManager",CONTENT_DATA_PROXY:"ContentDataProxy",VIDEO_CONTROL_INTERFACE:"VideoControlInterface",VIDEO_MANAGER:"VideoManager",STUCK_AD:"StuckAd",FAIRPLAY_DRM:"FairPlayDRM",P2P_CLIENT:"P2pClient",SDK_LOAD_MANAGER:"SdkLoadManager",CAPTIONS_MANAGER:"CaptionsManager",CAPTIONS_AGENT:"CaptionsDisplayAgent",TRACKING_MANAGER:"TrackingManager",TRACKING_LIB:"TrackingLib",MUX_DEBUG:"MuxDebug",VIDEO_PLAYER_FACADE:"VideoPlayerFacade",VPF_HTML5:"VPF_HTML5",VPF_HLSJS:"VPF_HLSJS",HLSJS_LIB:"HLSJS_LIB",HLSJS_LEVEL:"HLSJS_LEVEL",HLSJS_FRAG:"HLSJS_FRAG",HLSJS_FRAME_DROP:"HLSJS_FRAME_DROP",VPF_DASHJS:"VPF_DASHJS",DASHJS_LIB:"DASHJS_LIB",VPF_SHAKA:"VPF_SHAKA",SHAKA_LIB:"SHAKA_LIB"},isEnabled:!1,showAll:!1,showTimestamps:!1,showClockTime:!1,sessionStartTime:0,timezoneOffset:0,adjustedStartTime:0,adjustedTimezone:0,supportsFormatting:!1,COOKIE_NAME:"UVPJSDebug",cookie:{},initialize:function(e){var t=uvpjs._,i=uvpjs.mediaCapabilities;this.DEBUG_ID=this.configParams.DEBUG_MANAGER,this.debugCount=0,t.isObject(e)?(this.cookie=this._getCookie(),this.CDO=e,this.isEnabled=!0===this.cookie.enabled||this._isEnabled(),this.showAll=!0===this.cookie.showAll||this.CDO.getModuleParam(this.CONFIG_MODULE_NAME,this.configParams.SHOW_ALL),this.showTimestamps=!0===this.cookie.showTimestamps||this.CDO.getModuleParam(this.CONFIG_MODULE_NAME,this.configParams.SHOW_TIMESTAMPS),this.showClockTime=!0===this.cookie.showClockTime||this.CDO.getModuleParam(this.CONFIG_MODULE_NAME,this.configParams.SHOW_CLOCK_TIME),this.supportsFormatting=i.isChrome()||i.isFirefox()||i.isSafari(),this.setSessionStartTime()):this.warn(this.DEBUG_ID,"DebugManager requires an instance of the ConfigDataObject.")},setSessionStartTime:function(){this.sessionStartTime=this.sessionStartTime||new Date,this._setupTime()},log:function(){[].unshift.call(arguments,"log"),this.output.apply(this,arguments)},warn:function(){[].unshift.call(arguments,"warn"),this.output.apply(this,arguments)},error:function(){[].unshift.call(arguments,"error"),this.output.apply(this,arguments)},output:function(e,t,i){this.debugCount++;var s=uvpjs._;if(this.isEnabled||s.isUndefined(this.CDO))if(s.isString(e)&&s.isString(t)&&!s.isUndefined(i)){if(this.showAll||s.isUndefined(this.CDO)||this.isParamEnabled(t)||!0===this.cookie[t]){var n=this.showTimestamps?"["+this._timestamp()+"] ":"",a=s.drop(arguments,3),r=s.isEmpty(a)?"":a,o={bold:";font-weight:bold;",normal:";text-decoration:none;",underline:";text-decoration:underline;"};if(!this.supportsFormatting)return void console[e]("%sUVPJS %s %s",n,t,i,r);console[e]("%s%cUVPJS %c%s%c %s",n,o.bold,o.underline,t,o.normal,i,r)}}else console.warn("UVPJS DebugManager unable to display to console because of missing arguments."+i,t)},isParamEnabled:function(e){return!0===this.CDO.getModuleParam(this.CONFIG_MODULE_NAME,e)},_setupTime:function(){this.timezoneOffset=this.sessionStartTime.getTimezoneOffset()/60,this.adjustedStartTime=this.showClockTime?0:this.sessionStartTime,this.adjustedTimezone=this.showClockTime?this.timezoneOffset:0},_isEnabled:function(){return!!window.console&&!0===this.CDO.isModuleEnabled(this.CONFIG_MODULE_NAME)},_timestamp:function(){var e=uvpjs._,t=new Date-this.adjustedStartTime,i=t%1e3,s=(t=(t-i)/1e3)%60,n=(t=(t-s)/60)%60,a=(t=(t-n)/60)%24-this.adjustedTimezone;return e.padStart(a,2,"0")+":"+e.padStart(n,2,"0")+":"+e.padStart(s,2,"0")+"."+e.padStart(i,3,"0")},_getCookie:function(){var e=this._readCookie(this.COOKIE_NAME),t={};if(!e)return t;uvpjs.log(this.DEBUG_ID,"_getCookie cookie",e);try{t=JSON.parse(e)}catch(e){uvpjs.error(this.DEBUG_ID,"Error reading cookie.",e)}return uvpjs.log(this.DEBUG_ID,"_getCookie obj",t),t},_readCookie:function(e){for(var t=e+"=",i=document.cookie.split(";"),s=0,n=i.length;s<n;s++){for(var a=i[s];" "===a.charAt(0);)a=a.substring(1,a.length);if(0===a.indexOf(t))return a.substring(t.length,a.length)}return null}},function(e){var t,i=e._;e.DOMManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.DOM_MANAGER,PLAY:"play",PAUSE:"pause",CAN_PLAY:"canplay",CAN_PLAY_THROUGH:"canplaythrough",LOADED_METADATA:"loadedmetadata",init:function(e){this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"init",e),this.mc=null,this._createControls=e.createControls,this._createAds=e.createAds,this._useInlinePlayAttribute=e.useInlinePlayAttribute,this._useMutedAttribute=e.useMutedAttribute,this._DOMReadyCB=e.callback,this._useAutoplayAttribute=e.useAutoplayAttribute,this._userAgent=null,this.adClickElement=null,this.dom=t(),this.dom.outer.id=e.containerID},initialize:function(){uvpjs.log(this.DEBUG_ID,"initialize"),this.mc=uvpjs.mediaCapabilities,this._userAgent=this.mc.getUserAgent(),this._setupDOM()},destroy:function(){var e=this.dom.video.el;e&&e instanceof HTMLElement&&(e.removeEventListener(this.LOADED_METADATA,this._handleEvent,!1),e.removeEventListener(this.CAN_PLAY_THROUGH,this._handleEvent,!1),e.removeEventListener(this.CAN_PLAY,this._handleEvent,!1),e.removeEventListener(this.PLAY,this._handleEvent,!1),e.removeEventListener(this.PAUSE,this._handleEvent,!1)),this.mc=null,this.dom=null,this._DOMReadyCB=null},getDOM:function(){return i.clone(this.dom)},createAdClickElement:function(){var e={position:"absolute","z-index":100,padding:"4px 6px",height:"16px","text-align":"center","line-height":"16px","font-size":"12px",color:"#000",background:"#dedede",top:0,right:0,display:"none"};for(var t in this.adClickElement=document.createElement("div"),e)this.adClickElement.style[t]=e[t];this.adClickElement.innerHTML="<span>Learn More</span>",this.dom.outer.el.appendChild(this.adClickElement)},showAdContainer:function(e){this.dom.ad.el&&(this.dom.ad.el.style.display=e?"block":"none")},showAdClickElement:function(e){this.adClickElement&&(this.adClickElement.style.display=e?"inline-block":"none")},getAdClickElement:function(){return this.adClickElement||this.createAdClickElement(),this.adClickElement},_disableVideoContextMenu:function(){var e=this.dom.video.el;e.addEventListener?e.addEventListener("contextmenu",function(e){e.preventDefault()},!1):e.attachEvent("oncontextmenu",function(){window.event.returnValue=!1})},_setupDOM:function(){var e=this.dom;e.outer.el=document.getElementById(e.outer.id),i.isNull(this.dom.outer.el)?this.debug&&uvpjs.error(this.DEBUG_ID,"Fatal error: UVPJS outer container does not exist. UVPJS initialization failed!",e.outer.id):(e.content.id=this._getIdByPrefix("CONTENT_ID_PREFIX"),e.video.id=this._getIdByPrefix("VIDEO_ID_PREFIX"),e.ad.id=this._getIdByPrefix("AD_ID_PREFIX"),e.controls.id=this._getIdByPrefix("CONTROLS_ID_PREFIX"),e.content.el=this._getOrCreateElement("content"),e.outer.el.insertBefore(e.content.el,e.outer.el.firstChild),this._createVideoElement(),this._createAds&&(this._useSeparateTags=this.mc.requiresSeparateTagsForIMA(),e.ad.el=this._getOrCreateElement("ad"),e.outer.el.insertBefore(e.ad.el,e.content.el.nextSibling)),this._createControls?(e.controls.el=this._getOrCreateElement("controls"),e.outer.el.appendChild(e.controls.el)):this._addInlineStyles(),this._disableVideoContextMenu(),this._DOMReadyCB())},_createVideoElement:function(){var e,t=[this.dom.outer.id,this.dom.content.id,this.dom.video.id].join(" "),i=document.querySelectorAll(t);if(i instanceof NodeList&&i[0]instanceof HTMLElement&&i[0].id)this._checkVideoTagAttributes(i);else{if(t=[this.dom.outer.id,this.dom.video.id].join(" "),(i=document.querySelectorAll(t))instanceof NodeList&&i[0]instanceof HTMLElement){if(i[0].id)return;return i[0].id=this.dom.video.id,void this.dom.content.el.appendChild(i[0])}e=this._getOrCreateElement("video"),this._checkVideoTagAttributes(e),this.dom.content.el.appendChild(e),this.dom.video.el=e}},_createPlaceholderContent:function(){var e=this.dom.video.el;uvpjs.log(this.DEBUG_ID,"_createPlaceholderContent"),this.dom.video.url=this.mc.getPreferredPlaceholderURL(),this._useSeparateTags||i.isNull(this._userAgent)&&this.mc.isIPhone()?e.innerHTML='<source src="'+this.dom.video.url+'">':e.src=this.dom.video.url,this._handleEvent=this._handleEvent.bind(this),e.addEventListener(this.LOADED_METADATA,this._handleEvent,!1),e.addEventListener(this.CAN_PLAY_THROUGH,this._handleEvent,!1),e.addEventListener(this.CAN_PLAY,this._handleEvent,!1),e.addEventListener(this.PLAY,this._handleEvent,!1),e.addEventListener(this.PAUSE,this._handleEvent,!1),e.style.width="100%",this._DOMReadyCB()},_handleEvent:function(e){var t=this.dom.video.el;if(this.debug&&uvpjs.log(this.DEBUG_ID,"_handleEvent",e),!i.isNull(t)){var s=this._useSeparateTags?t.getElementsByTagName("source")[0]:t;if(!i.isNull(s)){if(e.type===this.LOADED_METADATA&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_handleEvent this._areAdsRequired, this._useSeparateTags",this._areAdsRequired,this._useSeparateTags),this._createAds&&this._useSeparateTags,this.debug&&uvpjs.log(this.DEBUG_ID,"removeEventListener",this.LOADED_METADATA,e.target),t.removeEventListener(this.LOADED_METADATA,this._handleEvent,!1)),-1===s.src.indexOf(this.dom.video.url))return t.removeEventListener(this.LOADED_METADATA,this._handleEvent,!1),t.removeEventListener(this.CAN_PLAY_THROUGH,this._handleEvent,!1),t.removeEventListener(this.CAN_PLAY,this._handleEvent,!1),t.removeEventListener(this.PLAY,this._handleEvent,!1),void t.removeEventListener(this.PAUSE,this._handleEvent,!1);switch(this.debug&&uvpjs.log(this.DEBUG_ID,"removeEventListener",e.type),e.type){case this.CAN_PLAY:t.removeEventListener(this.CAN_PLAY,this._handleEvent,!1),t.removeAttribute("controls","");break;case this.CAN_PLAY_THROUGH:t.removeEventListener(this.CAN_PLAY_THROUGH,this._handleEvent,!1);break;case this.PLAY:if(t.removeEventListener(this.PLAY,this._handleEvent,!1),t.pause(),!i.isFunction(this.dom.video.callback)){this.debug&&uvpjs.warn(this.DEBUG_ID,"No video placeholder callback specified.");break}this.dom.video.callback();break;case this.PAUSE:t.removeEventListener(this.PAUSE,this._handleEvent,!1)}}}},_checkVideoTagAttributes:function(e){this._useMutedAttribute&&e.setAttribute("muted","muted"),this._useAutoplayAttribute&&e.setAttribute("autoplay","autoplay"),this.mc.setVideoForInlinePlay(e,this._useInlinePlayAttribute)},_addInlineStyles:function(){if(this.dom.outer.el.style.position="relative",this.dom.video.el.style.width="100%",this._createAds){var e=this.dom.ad.el;e.style.position="absolute",e.style.width="100%",e.style.height="100%",e.style.left="0",e.style.top="0"}},_getIdByPrefix:function(e){if(!i.isNull(e))return uvpjs.domConstants[e]+this.dom.outer.id},_getOrCreateElement:function(e){var t=this.dom[e],s=document.getElementById(t.id);return i.isNull(s)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"Creating element <"+t.type+' id="'+t.id+'">.'),(s=document.createElement(t.type)).id=t.id),s}}),t=function(){return{outer:{id:null,el:null},content:{id:null,el:null,type:"div"},video:{id:null,el:null,type:"video",url:null,callback:null},ad:{id:null,el:null,type:"div"},controls:{id:null,el:null,type:"div"}}}}(uvpjs.register("uvpjs")),function(e){var t=e._;e.CVI_Model=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.CVI_MODEL,PREROLL:"pre",MIDROLL:"mid",POSTROLL:"post",ALT_AD_BLOCK_URL:"https://dai.google.com/ssai/content/{cmsid}/vid/{vid-id}/master.m3u8",AD_SETTINGS:"AdSettings",DFP_CMS_ID:"dfpCmsId",VIDEO_PLAYBACK_SETTINGS:"VideoPlaybackSettings",START_BITRATE:"startBitrate",MIN_BITRATE:"minBitrate",MAX_BITRATE:"maxBitrate",LIVE_SYNC_DURATION_COUNT:"liveSyncDurationCount",CAP_LEVEL_TO_PLAYER_SIZE:"capLevelToPlayerSize",DASHJS_FAST_SWITCH_ABR:"enableDashJSFastSwitchABR",TRACKING_CONFIG_OVERRIDES:"trackingConfigOverrides",contentVideoStateDefaults:{abrInfo:[],assetURL:"",audioPreviewImageUrl:"",category:"",cdn:"",chapterStartTimes:[],closedCaptionDivName:"",closedCaptionPath:"",closedCaptionType:"",cms:"",cmsRefGuid:"",contentType:"",contextMetadata:null,contPlayState:"",copyright:"",defaultBitrate:0,deliveryType:uvpjs.mediaCapabilities.PROGRESSIVE,dfpMediaId:null,duration:-1,endTime:-1,episodeAbstract:"",episodeFlag:!1,episodeNumber:"",episodeTitle:"",excludeNielsenTracking:!1,fileType:"",isAffiliateFeed:!1,isEmbedable:!1,isGeoRestricted:!1,isLive:!1,isPaidContent:!1,isResumed:!1,isFlash:!1,keywords:"",mediaId:"",overrideAssetURL:null,ozTamMediaId:null,ozTamOptOut:null,pid:"",restrictionCheckResult:"",liveSyncDurationCount:3,sendResumeEvent:!1,elapsedTime:0,showPreroll:!0,playedChapterTime:0,previousSessionId:"",podsToSkip:"",resumePid:"",resumeContentTime:0,resumeEpochTime:0,resumeSessionId:"",seasonNumber:"",seriesTitle:"",sourceHeight:0,sourceOwner:"",sourceWidth:0,startTime:0,useWatermark:!1,uvpc:null,videoTitle:"",is360:!1,drm:{enabled:!1,sessionId:null,ticket:null,fairplay:{appCertURL:null,licenseURL:null,header:{}},dash:{widevineURL:null,playreadyURL:null,widevine:{url:null,header:{}},playready:{url:null,header:{}}}}},contentPlaybackStateDefaults:{abrInfo:[],absoluteStreamTime:0,averageDroppedFPS:0,audioInfo:{},bufferLength:0,currentMaxBandwidth:0,currentContentSegment:1,currentTime:0,duration:-1,errorInfo:"",facadeState:{},isAd:!1,isHDStreamLive:!1,isPlayingLive:!1,isSeeking:!1,lastPercentageCompleted:0,lastSecondCompleted:0,maxBitrate:this.maxBitrate||-1,minBitrate:this.minBitrate||-1,startBitrate:this.startBitrate||-1,liveSyncDurationCount:this.liveSyncDurationCount||3,playbackBitrate:0,playbackComplete:!1,playbackStarted:!1,playbackState:uvpjs.mediaCapabilities.EMPTY,sourceBitrate:0},adVideoStateDefaults:{adClipID:"",adBitrate:0,adParameters:"",adPosition:-1,adServerName:"",adType:"",adVatId:"",adVideoId:"",adVideoTitle:"",adVideoUrl:"",assetURL:"",clickThru:"",creativeId:"",defaultBitrate:0,deliveryType:uvpjs.mediaCapabilities.PROGRESSIVE,duration:-1,isCustomClickTrackingUsed:!1,isLinear:!0,isRewindable:!1,isVPAID:!1,sourceHeight:0,sourceWidth:0,wrapperAdId:"",adAssetUrl:""},adPlaybackStateDefaults:{currentTime:0,absoluteStreamTime:0,duration:-1,errorInfo:"",isAd:!0,lastPercentageCompleted:0,lastSecondCompleted:0,playbackBitrate:0,playbackComplete:!1,playbackStarted:!1,playbackState:uvpjs.mediaCapabilities.EMPTY,sourceBitrate:0},init:function(){this.initTime=Date.now(),this.debug=uvpjs.debug,this.vidContId="",this.cviMgr={},this.eventsMgr={},this.CDO={},this.sessionOptions={},this.sessionId=uvpjs.mediaCapabilities.getSessionId(),this.isAutoplay=!1,this.isMuteAtPlayStart=!1,this.userHasUnmuted=!1,this.contentVideoState={},this.adVideoState={},this.contentPlaybackState={},this.adPlaybackState={},this.playbackState=uvpjs.mediaCapabilities.EMPTY,this.resetAdPlaybackState(),this.resetAdVideoState(),this.resetContentPlaybackState(),this.resetContentVideoState(),this.nativeControls=!1,this.volume=1,this.isMuted=!1,this.useDynamicSwitching=!0,this.isFullscreen=!1,this.startBitrate=-1,this.maxBitrate=-1,this.minBitrate=-1,this.liveSyncDurationCount=3,this.adNum=0,this.medNum=0,this.capLevelToPlayerSize=!1,this.enableDashJSFastSwitchABR=!1,this.errorRecovery=null,this.isCurrVideoAd=!1,this.daiStreamId=null,this.APM=null,this.dwPageParams=window.DW&&window.DW.pageParams||{},this.trackingConfigOverrides=null},initialize:function(e,i,s,n){t.isString(e)&&t.isObject(i)&&t.isObject(s)?(this.debug&&uvpjs.log(this.DEBUG_ID,"initialize vidContId = "+e),this.vidContId=e,this.cviMgr=i,this.CDO=s,this.sessionOptions=n,this.eventsMgr=i.getEventsMgr(),this.internalNS="."+this.vidContId+".cvi_model",this.addEventListeners(),this.setAbrMinBitrateFromCDO(),this.setAbrMaxBitrateFromCDO(),this.setAbrStartBitrateFromCDO(),this.setLiveSyncDurationCountFromCDO(),this.setCapLevelToPlayerSizeFromCDO(),this.setDashJSFastSwitchABRFromCDO(),null!==this.sessionOptions[this.TRACKING_CONFIG_OVERRIDES]&&(this.trackingConfigOverrides=this.sessionOptions[this.TRACKING_CONFIG_OVERRIDES]),this.mergeCDOData()):this.debug&&uvpjs.error(this.DEBUG_ID,"initialize ------------------------------- ERROR BAD INITIALIZATION PARAMS RETURN")},addEventListeners:function(){this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.VIDEO_STATE_CHANGE+this.internalNS,this.onVideoStateChange.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.VIDEO_PROGRESS+this.internalNS,this.onVideoProgress.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_VOLUME_SET+this.internalNS,this.onVideoVolumeChange.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_MUTE+this.internalNS,this.onVideoMute.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_UNMUTE+this.internalNS,this.onVideoUnMute.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_FULLSCREEN+this.internalNS,this.onFullscreen.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_START+this.internalNS,this.onResourceStart.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTEXT_METADATA+this.internalNS,this.onContextMetadata.bind(this))},onVideoStateChange:function(e){if(t.isPlainObject(e)&&e.target===this.vidContId&&t.isNumber(e.payload.newState)){this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoStateChange  this.vidContId = "+this.vidContId+" current this.playbackState = "+this.playbackState+" CHANGE TO evtObj.payload.newState = "+e.payload.newState);var i=e.payload.newState;i!==uvpjs.mediaCapabilities.EMPTY&&i!==uvpjs.mediaCapabilities.LOADING&&i!==uvpjs.mediaCapabilities.STOPPED&&i!==uvpjs.mediaCapabilities.PLAYING&&i!==uvpjs.mediaCapabilities.PAUSED&&i!==uvpjs.mediaCapabilities.BUFFERING||(this.playbackState=i,this.isCurrVideoAd?this.adPlaybackState.playbackState=this.playbackState:this.contentPlaybackState.playbackState=this.playbackState)}},onVideoProgress:function(e){var t=e.payload;e.target===this.vidContId&&(this.isCurrVideoAd=t.isAd,this.playbackState=t.playbackState,this.isCurrVideoAd?(this.adPlaybackState.currentTime=t.currentTime,this.adPlaybackState.absoluteStreamTime=t.absoluteStreamTime||t.currentTime,this.adPlaybackState.duration=t.duration,this.adPlaybackState.isAd=!0,this.adPlaybackState.playbackStarted=t.playbackStarted,this.adPlaybackState.playbackComplete=t.playbackComplete,this.adPlaybackState.sourceBitrate=t.sourceBitrate,this.adPlaybackState.playbackBitrate=t.playbackBitrate,this.adPlaybackState.errorInfo=t.errorInfo,this.adPlaybackState.lastSecondCompleted=t.lastSecondCompleted,this.adPlaybackState.lastPercentageCompleted=t.lastPercentageCompleted,this.adPlaybackState.playbackState=this.playbackState):(this.contentPlaybackState.currentTime=t.currentTime,this.contentPlaybackState.absoluteStreamTime=t.absoluteStreamTime||t.currentTime,this.contentPlaybackState.duration=this.contentVideoState.duration,this.contentPlaybackState.isAd=!1,this.contentPlaybackState.playbackStarted=t.playbackStarted,this.contentPlaybackState.playbackComplete=t.playbackComplete,this.contentPlaybackState.sourceBitrate=t.sourceBitrate,this.contentPlaybackState.playbackBitrate=t.playbackBitrate,this.contentPlaybackState.videoFramerate=t.videoFramerate,this.contentPlaybackState.isSeeking=t.isSeeking,this.contentPlaybackState.isHDStreamLive=t.isHDStreamLive,this.contentPlaybackState.isPlayingLive=t.isPlayingLive,this.contentPlaybackState.currentContentSegment=t.currentContentSegment,this.contentPlaybackState.currentMaxBandwidth=t.currentMaxBandwidth,this.contentPlaybackState.averageDroppedFPS=t.averageDroppedFPS,this.contentPlaybackState.lastSecondCompleted=t.lastSecondCompleted,this.contentPlaybackState.lastPercentageCompleted=t.lastPercentageCompleted,this.contentPlaybackState.bufferLength=t.bufferLength,this.contentPlaybackState.switchingMode=!0===this.useDynamicSwitching?"auto":"manual",this.contentPlaybackState.playbackState=this.playbackState,this.contentPlaybackState.facadeState=t.facadeState,this.contentPlaybackState.startBitrate=this.startBitrate,this.contentPlaybackState.minBitrate=this.minBitrate,this.contentPlaybackState.maxBitrate=this.maxBitrate,this.contentPlaybackState.liveSyncDurationCount=this.liveSyncDurationCount))},onVideoVolumeChange:function(e){t.isPlainObject(e)&&e.target===this.vidContId&&t.isNumber(e.payload.vol)&&(this.volume=e.payload.vol,this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoUnMute ***********************************      onVideoVolumeChange       this.volume now = ",this.volume))},onVideoMute:function(e){t.isPlainObject(e)&&e.target===this.vidContId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoMute ***********************************       onVideoMute          this.isMuted now true;"),this.isMuted=!0)},onVideoUnMute:function(e){t.isPlainObject(e)&&e.target===this.vidContId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoUnMute ***********************************      onVideoUnMute        this.isMuted now false;"),this.isMuted=!1)},onFullscreen:function(e){t.isPlainObject(e)&&e.target===this.vidContId&&(this.isFullscreen=e.payload.isFs)},onContextMetadata:function(e){t.isPlainObject(e)&&e.target===this.vidContId&&t.isPlainObject(e.target.contextMetadata)},onResourceStart:function(e){this.resetAdPlaybackState(),this.resetContentPlaybackState()},resetAdPlaybackState:function(){t.assign(this.adPlaybackState,this.adPlaybackStateDefaults)},resetAdVideoState:function(){this.setAdVideoState()},resetContentPlaybackState:function(){t.assign(this.contentPlaybackState,this.contentPlaybackStateDefaults)},resetContentVideoState:function(){t.assign(this.contentVideoState,this.contentVideoStateDefaults)},getAdCallParams:function(){return this.CDO.getAdCallParams()},setAdCallParams:function(e){this.CDO.setAdCallParams(e)},isId3HandlingRequired:function(){return this.getConfiguredId3OwnerIds()||this.isNielsenTrackingEnabled()},getConfiguredId3OwnerIds:function(){var e=this.CDO.getSessionOption("id3OwnerIds");return"string"==typeof e&&e.length?e:null},isNielsenTrackingEnabled:function(){return!0===this.getModule("NielsenTracking_SDK").enabled},getValueForKey:function(e){var i=void 0;return e&&t.isString(e)&&this.hasOwnProperty(e)&&!t.isFunction(this[e])&&(i=this[e]),i},getModule:function(e){if(t.isString(e))return this.CDO.getModule(e)},getModuleParam:function(e,i){if(t.isString(e)&&t.isString(i))return this.CDO.getModuleParam(e,i)},getModules:function(){return this.CDO.getModules()},copyModules:function(e){this.CDO.copyModules(e)},isModuleEnabled:function(e){return!(!e||!t.isString(e))&&this.CDO.isModuleEnabled(e)},isModuleSet:function(e){return!uvpjs.util.isEmpty(e)&&this.CDO.isModuleSet(e)},getSessionOption:function(e){return e?this.sessionOptions[e]:null},getClass:function(e){if(t.isString(e))return this.CDO.getClass(e)},getClasses:function(){return this.CDO.getClasses()},getClassProperty:function(e,t){return this.CDO.getClassProperty(e,t)},getClassListItems:function(e){return this.CDO.getClassListItems(e)},getClassListItemProperty:function(e,t,i){return this.CDO.getClassListItemProperty(e,t,i)},getCurrentPlaybackState:function(){return this.isCurrVideoAd?this.getAdPlaybackState():this.getContentPlaybackState()},getCurrentVideoState:function(){return this.isCurrVideoAd?this.getAdVideoState():this.getContentVideoState()},getContentVideoState:function(){var e={};return t.assign(e,this.contentVideoState),e},getAdVideoState:function(){var e={};return t.assign(e,this.adVideoState),e},getContentPlaybackState:function(){var e={};return t.assign(e,this.contentPlaybackState),e},getAdPlaybackState:function(){return t.assign({},this.adPlaybackState)},getNumberOfAdPods:function(){return this.APM?this.APM.getNumberOfPods():this.contentVideoState.chapterStartTimes&&this.contentVideoState.chapterStartTimes.length||0},setAbrInfo:function(e){this.contentVideoState.abrInfo=e,this.contentPlaybackState.abrInfo=e},setAdVideoState:function(e){this.adVideoState=t.assign({},this.adVideoStateDefaults,e||{})},setContentVideoStateItems:function(e){this._addItemsToInstanceObj("contentVideoState",e)},setContentPlaybackStateItems:function(e){this._addItemsToInstanceObj("contentPlaybackState",e)},setAdVideoStateItems:function(e){this._addItemsToInstanceObj("adVideoState",e)},setAdPlaybackStateItems:function(e){this._addItemsToInstanceObj("adPlaybackState",e)},setNonDefaultContentVideoStateItems:function(e){this.setContentVideoStateItems(this._removeDefaults(e,this.contentVideoStateDefaults))},setNonDefaultAdVideoStateItems:function(e){this.setAdVideoStateItems(this._removeDefaults(e,this.adVideoStateDefaults))},incrementAdNum:function(){this.adNum++},incrementMedNum:function(){this.medNum++},getVideoPlaybackCDOProperty:function(e){var t=this.VIDEO_PLAYBACK_SETTINGS,i=this.isModuleEnabled(t),s=this.getModuleParam(t,e);if(i&&s)return s},setAbrStartBitrateFromCDO:function(){var e=this.getVideoPlaybackCDOProperty(this.START_BITRATE);void 0!==e&&this.setStartBitrate(e)},setAbrMinBitrateFromCDO:function(){var e=this.getVideoPlaybackCDOProperty(this.MIN_BITRATE);void 0!==e&&this.setMinBitrate(e)},setAbrMaxBitrateFromCDO:function(){var e=this.getVideoPlaybackCDOProperty(this.MAX_BITRATE);void 0!==e&&this.setMaxBitrate(e)},setLiveSyncDurationCountFromCDO:function(){var e=this.getVideoPlaybackCDOProperty(this.LIVE_SYNC_DURATION_COUNT);void 0!==e&&this.setLiveSyncDurationCount(e)},setCapLevelToPlayerSizeFromCDO:function(){var e=this.getVideoPlaybackCDOProperty(this.CAP_LEVEL_TO_PLAYER_SIZE);void 0!==e&&this.setCapLevelToPlayerSize(e)},setDashJSFastSwitchABRFromCDO:function(){var e=this.getVideoPlaybackCDOProperty(this.DASHJS_FAST_SWITCH_ABR);void 0!==e&&this.setDashJSFastSwitchABR(e)},setStartBitrate:function(e){this.startBitrate=e,this.setContentPlaybackStateItems({startBitrate:e}),this.debug&&uvpjs.log(this.DEBUG_ID,"Set Start Bitrate:",this.startBitrate)},setMinBitrate:function(e){this.minBitrate=e,this.setContentPlaybackStateItems({minBitrate:e}),this.debug&&uvpjs.log(this.DEBUG_ID,"Set Min Bitrate:",this.minBitrate)},setMaxBitrate:function(e){this.maxBitrate=e,this.setContentPlaybackStateItems({maxBitrate:e}),this.debug&&uvpjs.log(this.DEBUG_ID,"Set Max Bitrate:",this.maxBitrate)},setLiveSyncDurationCount:function(e){this.liveSyncDurationCount=e,this.setContentPlaybackStateItems({liveSyncDurationCount:e}),this.debug&&uvpjs.log(this.DEBUG_ID,"Set Live Sync Duration Count:",this.liveSyncDurationCount)},setCapLevelToPlayerSize:function(e){this.capLevelToPlayerSize=e,this.debug&&uvpjs.log(this.DEBUG_ID,"Set Cap Level To Player Size:",this.capLevelToPlayerSize)},setDashJSFastSwitchABR:function(e){this.enableDashJSFastSwitchABR=e,this.debug&&uvpjs.log(this.DEBUG_ID,"Set Dash.js FastSwitchABR to: ",this.enableDashJSFastSwitchABR)},setAudioTrackInfo:function(e){this.contentPlaybackState.audioInfo=e},getAudioTrackInfo:function(){return this.contentPlaybackState.audioInfo},setErrorRecovery:function(e){this.errorRecovery=e,this.debug&&uvpjs.log(this.DEBUG_ID,"Set errorRecovery to : ",this.errorRecovery)},setUseDynamicSwitching:function(e){this.useDynamicSwitching=e,this.debug&&uvpjs.log(this.DEBUG_ID,"Set useDynamicSwitching to: ",this.useDynamicSwitching)},mergeCDOData:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"CVI_Model mergeCDOData this.contentVideoState before merge",this.contentVideoState);var e=this;t.forOwn(this.sessionOptions,function(i,s){t.isString(i)&&(t.has(e.contentVideoState,s)?e.contentVideoState[s]=i:t.has(e.adVideoState,s)&&(e.adVideoState[s]=i))}),this.debug&&(uvpjs.log(this.DEBUG_ID,"CVI_Model mergeCDOData this.contentVideoState after merge",this.contentVideoState),uvpjs.log(this.DEBUG_ID,"CVI_Model mergeCDOData      this.adVideoState after merge",this.adVideoState))},_removeDefaults:function(e,i){return t.omitBy(e,function(t,s){return e[s]===i[s]})},_addItemsToInstanceObj:function(e,i){var s,n,a;if(s=this[e])if(t.isObject(i))for(n in this.debug,s)a=i[n],!i.hasOwnProperty(n)||t.isUndefined(a)||t.isFunction(a)||(s[n]=a);else this.debug&&uvpjs.warn(this.DEBUG_ID,"_addItemsToInstanceObj `items` is not an object. ",i);else this.debug&&uvpjs.warn(this.DEBUG_ID,"_addItemsToInstanceObj instance object named "+e)}})}(uvpjs.register("uvpjs")),function(e){var t=e._;e.CodeLoader=uvpjs.Class.subClass({init:function(){this.debug=uvpjs.debug,this._setUrlProtocol=uvpjs.mediaCapabilities.setUrlProtocol,this.DEBUG_ID=uvpjs.DebugManager.configParams.CODE_LOADER,this.REQUEST_TIMEOUT=4e3,this.timeout=0,this.timeoutHandle=0,this.urls=[],this.scriptsLoadedCB={}},initialize:function(){},destroy:function(){this._setUrlProtocol=null,clearTimeout(this.timeoutHandle),this.timeoutHandle=null},loadScript:function(e,i,s){var n,a;for(this.debug&&uvpjs.log(this.DEBUG_ID,"loadScript urls",e),this.scriptsLoadedCB=i,this.timeout=s||this.REQUEST_TIMEOUT,t.isString(e)&&this.urls.push(e),t.isArray(e)&&(this.urls=e),a=this.urls.length,n=0;n<a;n++)this._getScript(this.urls[n])},_getScript:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"_getScript url",e);var i=this,s=function(e,s){t.isFunction(i._onScriptLoaded)&&!i._onScriptLoaded.done?(i.urls=t.without(i.urls,e),i._onScriptLoaded({url:e,error:s})):i.debug&&uvpjs.warn(i.DEBUG_ID,"_getScript _doCallback callback not a function or already called.")},n=document.createElement("script");n.src=this._setUrlProtocol(e),n.async=!0,n.onreadystatechange=n.onload=function(){n.readyState&&!/loaded|complete/.test(n.readyState)||s(e)},n.onerror=function(t){uvpjs.error(i.DEBUG_ID,"_getScript "+t.target.src+" is not accessible."),s(e,t)},document.querySelector("head").appendChild(n),this.timeoutHandle=setTimeout(function(e){-1===t.indexOf(i.urls,e)||(this.debug&&uvpjs.warn(i.DEBUG_ID,"_getScript request timeout"),s(e,"timeout"))}.bind(this,e),this.timeout)},_onScriptLoaded:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"_onScriptLoaded");var i=t.isEmpty(this.urls);this.debug&&uvpjs.log(this.DEBUG_ID,"_onScriptLoaded scriptsLoaded",this.urls),i&&t.isFunction(this.scriptsLoadedCB)&&(this.scriptsLoadedCB.done=!0,this.scriptsLoadedCB(e))},createCORSRequest:function(e,t){var i=new XMLHttpRequest;return t=this._setUrlProtocol(t),"withCredentials"in i?i.open(e,t,!0):"undefined"!=typeof XDomainRequest?(i=new XDomainRequest).open(e,t):i=!1,i},loadXHR:function(e,i,s,n){var a,r;if(e=this._setUrlProtocol(e),!1===(a=this.createCORSRequest("GET",e)))return r="loadXHR CORS not supported for url = "+e,uvpjs.warn(this.DEBUG_ID,r),void s(a);n&&!uvpjs.util.isEmpty(n)&&(a.responseType=n),a.timeout=this.REQUEST_TIMEOUT,a.onload=function(){t.inRange(a.status,200,400)?i(a):s(a)},a.onerror=function(){s(a)},a.ontimeout=function(){s(a)},a.send()},loadXML:function(e,t,i){this.loadXHR(e,t,i,"document")},loadArrayBuffer:function(e,t,i){this.loadXHR(e,t,i,"arraybuffer")}})}(uvpjs.register("uvpjs")),function(e){var t=e._;e.CoreVideoInstanceManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.CORE_VIDEO_INSTANCE,init:function(e){var t=e.vidContId;if(!e.readyCallback)throw new Error("readyCallback missing from CoreVideoInstanceManager.options");this.debug=uvpjs.debug,this.vidContId=t,this.eventsMgr=e.eventsMgr,this.cviModel=new uvpjs.CVI_Model,this.RPM={},this.trackingMgr={},this.imaAdDisplayContainer={},this.adsLoader={},this.pauseAdRetriever=null,this.contentInitializedForIMA=!1,this.adVideoDiv={},this.containers=null,this.deliveryPluginSvc=null,this.readyCallback=e.readyCallback,this.cachedOptions={suppressFacadePlay:e.suppressFacadePlay,deferLoadingCaptions:e.playerOptions.deferLoadingCaptions},this.cviModel.initialize(t,this,e.CDO,e.playerOptions),this.initialPlaybackInfo={},setTimeout(this.initialize.bind(this),1)},initialize:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"Checking video delivery plugins... ",this.vidContId),this.deliveryPluginSvc=new uvpjs.VideoDeliveryPluginService(this.finishInit.bind(this),this.cviModel),this.deliveryPluginSvc.createPlugins()},setContainers:function(e){if(!this.RPM)throw new Error("Must be called after cviMgr init completes");this.RPM.setContainers(e)},setAdCallParams:function(e){this.cviModel.setAdCallParams(e)},setInitialPlaybackType:function(e,t){this.initialPlaybackInfo.isAutoplay=e,this.initialPlaybackInfo.isMuteAtPlayStart=t},setContextMetadata:function(e){this.cviModel.contentVideoState.contextMetadata=e||null},setPlaybackInfoOnModel:function(){this.cviModel.isAutoplay=this.initialPlaybackInfo.isAutoplay,this.cviModel.isMuteAtPlayStart=this.initialPlaybackInfo.isMuteAtPlayStart},finishInit:function(e,t){this.debug&&uvpjs.log(this.DEBUG_ID,"Initializing... ",this.vidContId);var i=this.cachedOptions;this.RPM=new uvpjs.ResourcePlaylistManager({vidContId:this.vidContId,suppressFacadePlay:i.suppressFacadePlay,p2pClient:e||null,multiCdnClient:t||null,deferLoadingCaptions:i.deferLoadingCaptions,cviMgr:this}),this.trackingMgr=new uvpjs.TrackingManager({vidContId:this.vidContId,cviMgr:this}),this.captionsMgr=new uvpjs.CaptionsManager({containerId:this.vidContId,cviModel:this.cviModel,eventsMgr:this.eventsMgr,deferLoadingCaptions:i.deferLoadingCaptions}),this.cachedOptions=null,this.checkForPauseAd(),this.deliveryPluginSvc.destroy(),this.deliveryPluginSvc=null,this.readyCallback()},constructSharedIMAClasses:function(e){var i=this.cviModel.getSessionOption("adBlockerCallback"),s=!(!i||!i()),n=this.eventsMgr.eventTypes,a=uvpjs.ErrorInfo,r=window.google&&google.ima;if(this.debug&&uvpjs.log(this.DEBUG_ID,"constructSharedIMAClasses; ads blocked =  "+s),s&&this.eventsMgr.dispatchEvent(n.AD_BLOCKED,{errorInfo:new a({eventType:n.AD_BLOCKED,errorCode:a.errorCodes.AD_BLOCKING_DETECTED,message:a.messages.AD_BLOCKING_DETECTED,isFatal:!1})},this.vidContId),s||r){if(r)if(t.isEmpty(this.imaAdDisplayContainer)){this.imaAdDisplayContainer=this._createIMAAdDisplayContainer(e),this.imaAdDisplayContainer.initialize(),this.adsLoader=new google.ima.AdsLoader(this.imaAdDisplayContainer);var o=this.adsLoader.getSettings();o.setAutoPlayAdBreaks(!0),o.setVpaidMode(google.ima.ImaSdkSettings.VpaidMode.INSECURE),this.adsLoader.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,this.onAdsManagerLoaded.bind(this),!1),this.adsLoader.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdError.bind(this),!1)}else this.debug&&uvpjs.log(this.DEBUG_ID,"constructSharedIMAClasses RETURN constructSharedIMAClasses already constructed")}else this.eventsMgr.dispatchEvent(n.PLAYER_START_ERROR,{errorInfo:new a({eventType:n.PLAYER_START_ERROR,errorCode:a.errorCodes.IMA_SDK_MISSING,message:a.messages.IMA_SDK_MISSING,isFatal:!1})},this.vidContId)},_createIMAAdDisplayContainer:function(e){var t,i;return this.debug&&uvpjs.log(this.DEBUG_ID,"_createIMAAdDisplayContainer"),this.adVideoDiv=document.getElementById(uvpjs.domConstants.AD_ID_PREFIX+this.vidContId),t=document.getElementById(uvpjs.domConstants.CONTENT_ID_PREFIX+this.vidContId).getElementsByTagName("video")[0],i=new google.ima.AdDisplayContainer(this.adVideoDiv,t,e),this.debug&&uvpjs.log(this.DEBUG_ID,"_createIMAAdDisplayContainer     adClickElement = ",e),this.debug&&uvpjs.log(this.DEBUG_ID,"_createIMAAdDisplayContainer adDisplayContainer = ",i),i},onAdsManagerLoaded:function(e){var t,i=uvpjs.util,s=i.isEmpty(this.RPM),n=i.isEmpty(this.RPM.currRP),a=this.RPM.currRP.getProviderType()!==uvpjs.mediaCapabilities.RP_IMA;if(this.debug&&uvpjs.log(this.DEBUG_ID,"onAdsManagerLoaded; event = ",e),s||n||a)return t="CVI mgr: onAdsManagerLoaded; ",t+=s?"no RPM found":n?"no current RP found":"RP not of type RP_IMA",this.debug&&uvpjs.log(this.DEBUG_ID,t),void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,message:uvpjs.ErrorInfo.messages.UNEXPECTED_CONDITION+t,isFatal:!1})},this.vidContId);this.RPM.currRP.onAdsManagerLoaded(e)},onAdError:function(e){var i=!t.isEmpty(this.RPM)&&this.RPM,s=i&&!t.isEmpty(i.currRP)&&i.currRP;if(this.debug&&uvpjs.log(this.DEBUG_ID,"onAdError; adErrorEvent = ",e),!i||!s)return this.debug&&uvpjs.log(this.DEBUG_ID,"CVI.onAdError: this.RPM or this.RPM.currRP is empty; early return"),void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,message:uvpjs.ErrorInfo.messages.UNEXPECTED_CONDITION+" Encountered null ResourcePlaylistManager and/or ResourceProvider",isFatal:!1})},this.vidContId);"function"==typeof s.handleAdsLoaderError&&s.handleAdsLoaderError(e)},destroyIMAAdsLoader:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"destroyIMAAdsLoader this.adsLoader = ",this.adsLoader),this.adsLoader&&(this.debug&&uvpjs.log(this.DEBUG_ID," destroyIMAAdsLoader this.adsLoader  exists so destroy it"),this.adsLoader.removeEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,this.onAdsManagerLoaded.bind(this),!1),this.adsLoader.removeEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdError.bind(this),!1),this.adsLoader=null)},loadDynamicAdCall:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"loadDynamicAdCall adCall =",e),this.RPM.loadDynamicAdCall(e)},forceDynamicMidrollPodEnd:function(){this.RPM.forceDynamicMidrollPodEnd()},getEventsMgr:function(){return this.eventsMgr},getModelRef:function(){return this.cviModel},playVideoRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"playVideoRequest this.vidContId = ",this.vidContId),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_PLAY,{},this.vidContId)},pauseVideoRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"pauseVideo",this.vidContId),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_PAUSE,{},this.vidContId)},seekToRequest:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"seekToRequest = "+e),t.isNaN(e)?this.debug&&uvpjs.warn(this.DEBUG_ID,"invalid seekToRequest value = "+e):(-1===e&&this.seekToLiveRequest(),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_SEEK,{seekTime:e},this.vidContId))},seekToLiveRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"seekToLiveRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_SEEK_TO_LIVE_POINT,{},this.vidContId)},stopVideoRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"stopVideoRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_STOP,{},this.vidContId)},clearVideoRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"clearVideoRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_CLEAR,{},this.vidContId)},muteRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"muteRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_MUTE,{},this.vidContId)},unmuteRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"unmuteRequest"),this.cviModel.isMuteAtPlayStart&&(this.cviModel.userHasUnmuted=!0),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_UNMUTE,{},this.vidContId)},getPlayerMuted:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getPlayerMuted"),this.cviModel.isMuted},volumeChangeRequest:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"volumeChangeRequest newVolume = ",e),t.isNaN(e)||this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_VOLUME_SET,{vol:e},this.vidContId)},getVolume:function(){return this.cviModel.volume},loadCaptionsRequest:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"loadCaptionsRequest captionsPath = ",e),t.isString(e)&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_LOAD_CAPTIONS,{url:e},this.vidContId)},showCaptionsRequest:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"showCaptionsRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_SHOW_CAPTIONS,{language:e},this.vidContId)},setCaptionLanguage:function(e){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.SET_CAPTIONS_LANG,{language:e},this.vidContId)},hideCaptionsRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"hideCaptionsRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_HIDE_CAPTIONS,{},this.vidContId)},getCaptionInfo:function(){return this.captionsMgr.getCaptionInfo()},setCaptionsStyleRequest:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"setCaptionsStyleRequest",e),this.cviModel.contentVideoState.isFlash?this.RPM.setCaptionStyle(e):this.captionsMgr.setStyles(e)},setCaptionsCuePropertyRequest:function(e,t){this.debug&&uvpjs.log(this.DEBUG_ID,"setCaptionsCuePropertyRequest",e,t),this.captionsMgr.setCueProperty(e,t)},getCaptionsStyleRequest:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getCaptionsStyleRequest"),this.captionsMgr.getStyles()},getAudioTrackInfo:function(){return this.cviModel.getAudioTrackInfo()},setAudioTrack:function(e){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.SWITCH_AUDIO_TRACK,{id:e})},resizeRequest:function(e,i){this.debug&&uvpjs.log(this.DEBUG_ID,"resizeRequest  width = "+e+"  height = "+i),!t.isNaN(e)&&!t.isNaN(i)&&e>=0&&i>=0&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESIZE,{width:e,height:i},this.vidContId)},fullscreenRequest:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"fullscreenRequest onOrOff = ",e),t.isBoolean(e)&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_FULLSCREEN,{isFs:e},this.vidContId)},setUserGesture:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"setUserGesture info = ",e),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.USER_GESTURE,{gestureInfo:e},this.vidContId)},getCurrentPlaybackState:function(){return this.cviModel.getCurrentPlaybackState()},getContentVideoData:function(){return this.cviModel.getContentVideoState()},getAdVideoData:function(){return this.cviModel.getAdVideoState()},getPlayerSessionId:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getPlayerSessionId"),this.cviModel.sessionId},setPageContextMetadata:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"setPageContextMetadata contextData = ",e),t.isPlainObject(e)},setNativeControls:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"setNativeControls onOff = ",e),t.isBoolean(e)&&(this.cviModel.nativeControls=e)},createPauseAdRetriever:function(){var e=this.cviModel.getModuleParam("PauseAd","adcallurl")||this.cviModel.getModuleParam("PauseAd","adCallURL")||this.cviModel.getModuleParam("PauseAd","adCallUrl"),t={eventsMgr:this.eventsMgr,adCallUrl:e,partner:this.cviModel.getSessionOption("partner"),userStatus:this.cviModel.getSessionOption("userStatus"),model:this.cviModel,vidContId:this.vidContId,debugId:this.DEBUG_ID};e?uvpjs.PauseAdRetriever?this.pauseAdRetriever=new uvpjs.PauseAdRetriever(t):this.debug&&uvpjs.warn(this.DEBUG_ID,"Class 'PauseAdRetriever' not loaded; please confirm path."):this.debug&&uvpjs.warn(this.DEBUG_ID,"PauseAd module enabled with invalid ad call url: "+e)},checkForPauseAd:function(){var e=this.cviModel.isModuleEnabled("PauseAd"),t=uvpjs.Configuration.path+"lib/PauseAdRetriever.js";e&&(uvpjs.PauseAdRetriever?this.createPauseAdRetriever():(new uvpjs.CodeLoader).loadScript(t,this.createPauseAdRetriever.bind(this)))}})}(uvpjs.register("uvpjs")),(r=uvpjs.register("uvpjs")).ErrorInfo=uvpjs.Class.subClass({init:function(e){var t=e||{};this.errorCode=t.errorCode||null,this.eventType=t.eventType||null,this.isFatal=!!t.isFatal,this.imaErrorCode=null,this.imaVastErrorCode=null,this.message=t.message||null,this.adInfo=t.adInfo||null,this.serverCode=t.serverCode||null,this.hlsjsErrorCode=null}}),r.ErrorInfo.errorCodes={IMA_SDK_MISSING:1001,DAI_SDK_MISSING:1003,IMA_SCENARIO_UNKNOWN:1002,FLASH_RELATED_ERROR:1003,INVALID_RESOURCE_FORMAT:2e3,RESOURCE_GEOBLOCKED:2001,RESOURCE_UNAVAILABLE:2002,SELECTOR_CALL_ERROR:2003,DASH_START_ERROR:2004,DYNAMIC_VARIANT_MANIFEST_PARSE_ERROR:2005,USER_GESTURE_REQUIRED:2006,UNSPECIFIED_VIDEO_PLAYBACK_ERROR:3e3,MEDIA_ERR_ABORTED:3001,MEDIA_ERR_NETWORK:3002,MEDIA_ERR_DECODE:3003,MEDIA_ERR_SRC_NOT_SUPPORTED:3004,HLSJS_PLAYBACK_ERROR:3005,HLSJS_NETWORK_ERROR:3006,HLSJS_MEDIA_ERROR:3007,HLSJS_MUX_ERROR:3008,HLSJS_OTHER_ERROR:3009,DAI_STREAM_ERROR:3010,FAIRPLAY_APP_CERT_ERROR:3011,FAIRPLAY_LIC_ERROR:3012,FLASH_PLAYBACK_ERROR:3013,IMA_AD_ERROR:4e3,DAI_AD_ERROR:4002,AD_BLOCKING_DETECTED:4001,STUCK_AD_ERROR:4003,UNEXPECTED_CONDITION:9e3},r.ErrorInfo.messages={AD_BLOCKING_DETECTED:"Ad blocking detected; one or more SDKs may be unusable.",DAI_ASSET_URL_ERROR:"DAI stream 'loaded' event has no asset url.",DASH_ERROR_TEMPLATE:"dash.js Error. Type = {TYPE}, ID = {ID}, Message = {MESSAGE}",DYNAMIC_VARIANT_MANIFEST_PARSE_ERROR:"Error parsing dynamic variant manifest.",FAIRPLAY_APP_CERT_LOAD:"Request to load FairPlay Application Certificate failed",FAIRPLAY_NO_CONTENTID:"FairPlay URI does not contain ContentId",FAIRPLAY_KEYSYSTEM_NOT_SUPPORTED:"FairPlay Key System(com.apple.fps.1_0) is not supported in this browser",FAIRPLAY_CREATE_MEDIAKEYS:"Could not create WebKit MediaKeys",FAIRPLAY_CREATE_SESSION:"Could not create FairPlay Key Session",FAIRPLAY_LIC_RESPONSE_CODE:"FairPlay getckc request returned an error response code",FAIRPLAY_LIC_REQUEST:"FairPlay getckc request failed",FAIRPLAY_KEY_ERROR:"Failed to load FairPlay key",HLSJS_NETWORK_ERROR:"An HLSJS network error occurred: {INFO}",HLSJS_MEDIA_ERROR:"An HLSJS media error occurred: {INFO}",HLSJS_MUX_ERROR:"An HLSJS mux error occurred: {INFO}",HLSJS_OTHER_ERROR:"An HLSJS other error occurred: {INFO}",IMA_AD_ERROR_EVENT_RECEIVED:"An IMA ad error occurred.",IMA_ADPOD_ERROR:"Ad event received but current ad pod is undefined.",DAI_ADPOD_ERROR:"Ad start event received but current ad pod is undefined.",IMA_ADSMGR_ERROR:"google.ima.AdsManager failed to start.",IMA_AD_START_FAILED:"Ad load request made but ad start event not received.",IMA_SCENARIO_UNKNOWN:"Possible resource configuration issue.",IMA_SDK_MISSING:"Ad (IMA) SDK is missing.",INVALID_RESOURCE_FORMAT:"Error parsing requested resource.",MEDIA_ERR_ABORTED:"Fetching of resource aborted by user.",MEDIA_ERR_NETWORK:"A network error caused resource to stop being fetched",MEDIA_ERR_DECODE:"A decoding error caused resource to stop being fetched.",MEDIA_ERR_SRC_NOT_SUPPORTED:"Resource format not supported.",RESOURCE_GEOBLOCKED:"Resource is geo-blocked.",RESOURCE_UNAVAILABLE:"Resource PID is expired or otherwise unavailable.",SELECTOR_CALL_ERROR:"Unable to create selector call; possible resource configuration issue.",UNSPECIFIED_VIDEO_PLAYBACK_ERROR:"An unspecified video playback error occurred.",UNEXPECTED_CONDITION:"An unexpected condition was encountered.",UNEXPECTED_NULL_VALUE_FOR_AD:"Unexpected null value for ad.",UNEXPECTED_ABSENCE_OF_VIDEO:"Unable to locate a video node in SMIL response.",USER_GESTURE_REQUIRED:"A user gesture is required to initiate playback."},function(e){var t=e._,i=Math.random();e.EventsManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.EVENTS_MANAGER,sessionStartTime:0,sessionMilliseconds:0,uvpjsClockInterval:100,TENTH_SECOND:100,QUARTER_SECOND:250,HALF_SECOND:500,ONE_SECOND:1e3,THREE_SECONDS:3e3,internalNS:"EventsManager",init:function(e){this.debug=uvpjs.debug,e&&e===i?(this.timerCBOs=[],this.registeredEventsTable={},this._startUVPJSClock(this.uvpjsClockInterval)):this.debug&&uvpjs.error(this.DEBUG_ID,"ERROR: ","EventsManager is a Singleton; obtain instance via EventsManager.getInstance().")},destroy:function(){this.registeredEventsTable={},this.timerCBOs=[],uvpjs.EventsManager.destroyInstance()},addEventListener:function(e,i){if(e&&t.isString(e)&&i&&t.isFunction(i)){var s=this._returnValidEvtTypeAndNameSpace(e);if(!1!==s){var n=s[0],a=s[1];this.registeredEventsTable[n]||(this.registeredEventsTable[n]={}),this.registeredEventsTable[n][a]?this.debug&&uvpjs.warn(this.DEBUG_ID,"addEventListener  DUPLICATE CALLBACK FOR EVENTTYPE.NS RETURN evtType = ",n," ns = ",a):(this.debug&&uvpjs.log(this.DEBUG_ID,"addEventListener ADD LISTENER evtType = ",n," ns = ",a),this.registeredEventsTable[n][a]=i)}else this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsMgr addEventLr; ivalid namespace "+e},this.internalNS)}else this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsManager addEventListener MISSING OR MISS-TYPED PARAMS RETURN"},this.internalNS)},removeEventListener:function(e){if(!e||!t.isString(e))return this.debug&&uvpjs.log(this.DEBUG_ID,"removeEventListener evt_ns MISSING or not a STRING evt_ns = ",e),void this.dispatchEvent(this.eventTypes.UVPJS_ERROR,{msg:"EventsManager removeEventListener EventsManager removeEventListener evt_ns MISSING or not a STRING"},this.internalNS);var i=this._returnValidEvtTypeAndNameSpace(e);if(!1!==i){var s=i[0],n=i[1];this.registeredEventsTable[s]&&this.registeredEventsTable[s][n]?(this.debug&&uvpjs.log(this.DEBUG_ID,"removeEventListener delete this.registeredEventsTable[evtType][ns]; evt_ns = ",e),delete this.registeredEventsTable[s][n]):this.debug&&uvpjs.log(this.DEBUG_ID,"removeEventListener name space not found in this.registeredEventsTable[evtType][ns] evt_ns = ",e)}else this.debug&&uvpjs.log(this.DEBUG_ID,"removeEventListener INVALID EVENTTYPE OR BROKEN NAME SPACE evt_ns = ",e)},dispatchEvent:function(e,i,s){var n={};if(e&&t.isString(e))if(t.isUndefined(i)||t.isPlainObject(i))if(t.isUndefined(s)||t.isString(s)){var a=this.registeredEventsTable[e];if(a)for(var r in t.isUndefined(i)&&(i={}),t.isUndefined(s)&&(s=""),n.type=e,n.payload=i,n.target=s,a)a.hasOwnProperty(r)&&a[r](n)}else this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsManager dispatchEvent target IS NOT A STRING"},this.internalNS);else this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsManager dispatchEvent payload IS NOT A PLAIN OBJECT"},this.internalNS);else this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:'EventsManager dispatchEvent evtType "'+e+'" MISSING, UNDEFINED, or INCORRECT TYPE *EXIT METHOD*'},this.internalNS)},_returnValidEvtTypeAndNameSpace:function(e){var t=[],i=e.split(".");if(i.length<2)return!1;var s=i[0];i.shift();var n=i.join("_");return!(!this._validateEventType(s)||n.indexOf("undefined")>-1)&&(t[0]=s,t[1]=n,t)},_validateEventType:function(e){var t=!1,i=this.eventTypes;for(var s in i)if(i.hasOwnProperty(s)&&i[s]===e){t=!0;break}return t},getAllEventTypes:function(){return this.eventTypes},_startUVPJSClock:function(e){this.sessionStartTime=Date.now(),this.sessionMilliseconds=0,0!=this.uvpjsClockId&&clearInterval(this.uvpjsClockId),this.uvpjsClockId=0,this.uvpjsClockId=setInterval(this.uvpClockTick.bind(this),e)},destroyUVPJSClock:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"destroyUVPJSClock"),0!=this.uvpjsClockId&&clearInterval(this.uvpjsClockId),this.uvpjsClockId=0},addTimedEventCallback:function(e,i,s,n){this.debug&&uvpjs.log(this.DEBUG_ID,"addTimedEventCallback ns =",i);var a={};if(e&&t.isNumber(e)&&i&&t.isString(i)&&s&&t.isFunction(s)&&(!n||t.isNumber(n)||!(n>=1||-1===n))){e<this.uvpjsClockInterval&&(e=this.uvpjsClockInterval);var r=i.split(".");a={freq:e,ns:i=r.join("_"),cb:s,rptCnt:-1,nextTime:Date.now()+e},n&&(a.rptCnt=n),this.debug&&uvpjs.log(this.DEBUG_ID,"addTimedEventCallback ADD Timed Callback freq =",e),this.timerCBOs.push(a)}else this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsManager addTimedEventCallback MISSING OR MISS-TYPED PARAMS RETURN"},this.internalNS)},removeTimedEventCallback:function(e,i){if(this.debug&&uvpjs.log(this.DEBUG_ID,"removeTimedEventCallback freq = ",e+" ns = "+i),e&&t.isNumber(e)&&i&&t.isString(i)){var s,n,a=i.split(".");for(i=a.join("_"),s=this.timerCBOs.length;s--;)(n=this.timerCBOs[s]).freq===e&&n.ns===i&&(this.debug&&uvpjs.log(this.DEBUG_ID,"removeTimedEventCallback delete this.timerCBOs[freq][ns]; CBO.freq = ",n.freq+" CBO.ns = "+n.ns),this.timerCBOs.splice(s,1))}else this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsManager removeTimedEventCallback MISSING OR MISS-TYPED PARAMS RETURN"},this.internalNS)},uvpClockTick:function(){var e,t;this.sessionMilliseconds=Date.now()-this.sessionStartTime;var i=Date.now();for(e=this.timerCBOs.length-1;e>=0;e--)i>=(t=this.timerCBOs[e]).nextTime&&(t.cb(),t.nextTime=i+t.freq,-1!==t.rptCnt&&(t.rptCnt=t.rptCnt-1,0===t.rptCnt&&this.timerCBOs.splice(e,1)))},eventTypes:{SWITCH_AUDIO_TRACK:"switchAudioTrack",FIRST_GESTURE:"firstGesture",UVPJS_ERROR:"uvpjs_error",UVPJS_WARNING:"uvpjs_warning",NO_AD_CONTENT:uvpjs.EventType.NO_AD_CONTENT,PLAYER_DATA_LOADED:"onPlayerDataLoaded",CONTENT_DATA_LOADED:uvpjs.EventType.CONTENT_DATA_LOADED,RESOURCE_AD_DATA_LOADED:uvpjs.EventType.RESOURCE_AD_DATA_LOADED,PLAYER_LOADED:uvpjs.EventType.PLAYER_LOADED,PLAYBACK_LIBRARY_LOADED:uvpjs.EventType.PLAYBACK_LIBRARY_LOADED,PLAYER_INIT:uvpjs.EventType.PLAYER_INIT,PLATFORM_XML_LOADED:"onPlatformXmlLoaded",RESOURCE_LOAD_REQUEST:"resourceLoadRequest",RESOURCE_ADD_REQUEST:"resourceAddRequest",RESOURCE_REMOVE_REQUEST:"resourceRemoveRequest",RESOURCE_PLAYLIST_PAUSE:"resourcePlaylistPause",RESOURCE_PLAYLIST_RESUME:"resourcePlaylistResume",RESOURCE_PLAYLIST_ADVANCE:"resourcePlaylistAdvance",RESOURCE_PLAYLIST_DESTROY:"resourcePlaylistDestroy",RESOURCE_START:uvpjs.EventType.RESOURCE_START,RESOURCE_END:uvpjs.EventType.RESOURCE_END,CONTENT_START:uvpjs.EventType.CONTENT_START,CONTENT_END:uvpjs.EventType.CONTENT_END,AD_LOADED:uvpjs.EventType.AD_LOADED,AD_REQUEST:uvpjs.EventType.AD_REQUEST,AD_RESPONSE:uvpjs.EventType.AD_RESPONSE,AD_START:uvpjs.EventType.AD_START,AD_END:uvpjs.EventType.AD_END,AD_SKIPPED:uvpjs.EventType.AD_SKIPPED,AD_CLICK:uvpjs.EventType.AD_CLICK,AD_POD_START:uvpjs.EventType.AD_POD_START,AD_POD_END:uvpjs.EventType.AD_POD_END,AD_BLOCKED:uvpjs.EventType.AD_BLOCKED,AD_BUFFERING:uvpjs.EventType.AD_BUFFERING,CAPTIONS_READY:"onCaptionsReady",CAPTIONS_DISPLAYED:"onCaptionsDisplayed",CAPTION_AVAILABLE:"onCaptionAvailable",CAPTIONS_UNAVAILABLE:"onCaptionsUnavailable",CDN_UPDATED:uvpjs.EventType.CDN_UPDATED,CAPTIONS_ERROR:"onCaptionsError",SET_CAPTIONS_LANG:"onSetCaptionLang",CONTROL_LOAD_CAPTIONS:"controlLoadCaptions",CONTROL_SHOW_CAPTIONS:"controlShowCaptions",CONTROL_HIDE_CAPTIONS:"controlHideCaptions",AD_QUARTILE:"adQuartile",PLAYBACK_DURATION_RESUME:"playbackDurationResume",LIVE_SEGMENT_START:"onLiveSegmentStart",LIVE_SEGMENT_END:"onLiveSegmentEnd",VIDEO_STATE_CHANGE:"onStateChange",VIDEO_DURATION_CHANGE:"onVideoDurationChange",VIDEO_LOADING:"onVideoLoading",VIDEO_PROGRESS:uvpjs.EventType.VIDEO_PROGRESS,VIDEO_RESUME:"onVideoResume",VIDEO_DONE:uvpjs.EventType.VIDEO_DONE,VIDEO_CUEPOINT:"videoCuepoint",SEEK_DONE:"seekDone",CONTROL_PLAY:"controlPlay",CONTROL_PAUSE:"controlPause",CONTROL_STOP:"controlStop",CONTROL_CLEAR:"controlClear",CONTROL_MUTE:"controlMute",CONTROL_UNMUTE:"controlUnmute",CONTROL_VOLUME_CHANGE:"controlVolumeChange",CONTROL_VOLUME_SET:"controlVolumeSet",CONTROL_FULLSCREEN:"controlFullscreen",CONTROL_SEEK:"controlSeek",CONTROL_SEEK_TO_LIVE_POINT:"controlSeekToLivePoint",PREVIEW_BUTTON:"previewButton",DIAGNOSTIC_WINDOW_CLOSE_BUTTON:"diagnosticWindowCloseButton",USER_GESTURE:"controlGesture",RESIZE:"resize",CONTEXT_METADATA:"contextMetadata",FORCE_TRACK_SESSION_END:"forceTrackSessionEnd",SWITCH_REQUEST:"switchRequest",USE_DYNAMIC_SWITCHING:"useDynamicSwitching",MAXIMUM_BITRATE_ALLOWED:"maximumBitrateAllowed",MINIMUM_BITRATE_ALLOWED:"minimumBitrateAllowed",VIDEO_TRANSITION_START:"onVideoTransitionStart",LEVEL_LOADED:"onLevelLoaded",VIDEO_TRANSITION_COMPLETE:"onVideoTransitionComplete",VIDEO_NOT_AVAILABLE:"videoNotAvailable",DATA_LOADING_ERROR:"dataLoadingError",VIDEO_GEO_BLOCKED:"videoGeoBlocked",VIDEO_ISP_BLOCKED:"videoIspBlocked",VIDEO_DEVICE_BLOCKED:"videoDeviceBlocked",AD_LOAD_ERROR:"adLoadError",AD_PLUGIN_CONTENT_PAUSE_REQUEST:uvpjs.EventType.AD_PLUGIN_CONTENT_PAUSE_REQUEST,AD_PLUGIN_CONTENT_RESUME_REQUEST:uvpjs.EventType.AD_PLUGIN_CONTENT_RESUME_REQUEST,PAUSE_AD_REQUEST:"pauseAdRequest",PAUSE_AD_LOADED:"pauseAdLoaded",CONTAINER_RESIZE:"containerResize",QOS_METADATA:"QOSMetadata",CONTENT_FACADE_CREATED:"contentFacadeCreated",AD_ERROR:"adError",PLAYER_START_ERROR:"playerStartError",VIDEO_START_ERROR:"videoStartError",VIDEO_PLAYBACK_ERROR:"videoPlaybackError"}}),e.EventsManager._instance=null,e.EventsManager.destroyInstance=function(){this._instance=null},e.EventsManager.getInstance=function(){return this._instance||(this._instance=new uvpjs.EventsManager(i)),this._instance}}(uvpjs.register("uvpjs")),function(e){e.AbstractId3Parser=uvpjs.Class.subClass({init:function(e){this.findNielsen=e.findNielsen,this.dataCallback=e.dataCallback,this.ownerIds=this.assembleOwnerIds(e.ownerIdList,this.findNielsen),this.idLengths=this.setLengths(this.ownerIds),this.totalIds=this.idLengths.length},destroy:function(){this.dataCallback=null},parse:function(e){throw new Error("Abstract method parse() must be implemented in subclass")},setLengths:function(e){for(var t=e.length,i=[];t--;)i[t]=e[t].length;return i},assembleOwnerIds:function(e,t){var i,s,n=[];if("string"==typeof e)for(s=(i=e.split(",")).length;s--;)n.push(i[s].trim());return t&&-1===n.indexOf("www.nielsen.com")&&n.push("www.nielsen.com"),n}})}(uvpjs.register("uvpjs")),function(e){e.FrameId3Parser=uvpjs.AbstractId3Parser.subClass({parse:function(e){var t,i=e.length;for(t=0;t<i;t++)e[t].data&&this.findId3(e[t])},findId3:function(e){var t,i,s,n,a,r,o=0,l=e.data;r=this.readStr(l,o,3),o+=3,"ID3"===r&&(o+=3,t=127&l[o++],i=127&l[o++],s=127&l[o++],n=127&l[o++],a=o+((t<<21)+(i<<14)+(s<<7)+n),this.findId3PrivateFrame(e,o,a))},findId3PrivateFrame:function(e,t,i){for(var s,n=e.data;t+8<=i;)s=this.readStr(n,t,4),t+=4,n[t++]<<24+n[t++]<<16+n[t++]<<8+n[t++],(n[t++]<<8)+n[t++],t,"PRIV"===s&&this.parseFrame(e,t)},parseFrame:function(e,t){for(var i,s,n,a=this.idLengths,r=this.totalIds,o=e.data;r--;)if(n=a[r],(s=this.readStr(o,t,n))===this.ownerIds[r]){t+=n,i="www.nielsen.com"===s?this.parseNielsen(s,o,t):this.readStr(o,++t,o.length),this.dataCallback({name:s,data:i,pts:e.pts});break}},parseNielsen:function(e,t,i){var s=e+this.readStr(t,i,t.length-(i+2));return 249===s.length?s:null},readStr:function(e,t,i){var s="",n=t||0,a=t+i;do{s+=String.fromCharCode(e[n++])}while(n<a);return s}})}(uvpjs.register("uvpjs")),function(e){e.TrackId3Parser=uvpjs.AbstractId3Parser.subClass({parse:function(e){if(1===e.length){var t=e[0];if("PRIV"===t.value.key)for(var i=0;i<this.ownerIds.length;i++){var s=this.ownerIds[i];-1!==t.value.info.indexOf(s)&&this.dataCallback({name:s,data:"www.nielsen.com"===s?t.value.info:String.fromCharCode.apply(null,new Uint8Array(t.value.data)),pts:t.startTime})}}}})}(uvpjs.register("uvpjs")),function(e){e.SdkLoadManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.SDK_LOAD_MANAGER,initCallback:null,cdo:null,historyItems:{},getHistory:function(){var e={};for(var t in this.historyItems)e[t]=this.historyItems[t];return e},sdkModules:{AkamaiQOSPluginJS:{isDefined:function(){return void 0!==window.AkaHTML5MediaAnalytics},getPath:function(e){var t="//79423.analytics.edgesuite.net/js/csma.js";return t=e&&e.getModuleParam("AkamaiQOSPluginJS","libpath")||t,uvpjs.mediaCapabilities.isSecure()?[t.replace("edgesuite","edgekey")]:[t]}},ConvivaQOSPluginJS:{isDefined:function(){return void 0!==window.Conviva},getPath:function(){return[uvpjs.Configuration.path+"lib/tracking/conviva-uvpjs-sdk.min.js"]}},ComScore_ss:{isDefined:function(){return void 0!==window.ns_&&void 0!==window.ns_.ReducedRequirementsStreamingAnalytics},getPath:function(){return[uvpjs.Configuration.path+"lib/tracking/comscore/comscore.streaming.6.1.1.171219.min.js"]}},MuxQOSPluginJS:{isDefined:function(){return void 0!==window.mux},getPath:function(){return[uvpjs.Configuration.path+"lib/tracking/mux.js"]}},NielsenTracking_SDK:{isDefined:function(){return void 0!==window.NOLCMB},getPath:function(){return["//cdn-gl.imrworldwide.com/novms/js/2/ggcmb510.js"]}},SiteCatalyst:{isDefined:function(){return!("undefined"==typeof ADB||"undefined"===e._.get(ADB,"va.Heartbeat"))},getPath:function(e){var t=uvpjs.Configuration.path+"lib/tracking/adobe/AppMeasurement-2.3.0.min.js",i=uvpjs.Configuration.path+"lib/tracking/adobe/VideoHeartbeat-2.0.2.min.js";return e.sessionOptions.usesTealium?[i]:[t,i]}},OzTam:{isDefined:function(){return void 0!==window.OzTAMService},getPath:function(){return[uvpjs.Configuration.path+"lib/tracking/oztam-service.js"]}}},init:function(e,t){var i=[],s=e.getModules(),n=uvpjs.util;if(this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"init",e),this.cdo=e,this.initCallback=t,n.isEmpty(s))this.invokeCallbackWithHistory();else{e.getModule("MuxQOSPluginJS")||s.push({name:"MuxQOSPluginJS",enabled:"true"});for(var a=s.length;a--;){var r,o,l=s[a],d=l.name,u=this.sdkModules[l.name];if(l.enabled&&u)if(u.isDefined())this.addToHistory({name:l.name,loaded:!0});else for(o=(r=u.getPath(e)).length;o--;)i.push({name:d,path:r[o]})}n.isEmpty(i)?this.invokeCallbackWithHistory():this.bulkLoad(i)}},invokeCallbackWithHistory:function(){var e=this.initCallback,t=this.getHistory();setTimeout(function(){e(t)},1)},bulkLoad:function(e){var t=e,i=[],s=(this.handleAllLoadResults,function(){var e=t.shift(),n=new uvpjs.CodeLoader;n.loadScript(e.path,function(e,n,a){i.push({name:e,result:a}),n.destroy(),0===t.length?this.handleAllLoadResults(i):s()}.bind(this,e.name,n))}.bind(this));s()},handleAllLoadResults:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"handleAllLoadResults",e);for(var t=e.length;t--;){var i=e[t];i.result.error&&uvpjs.warn(this.DEBUG_ID,"Tracking  SDK load error: "+i.result.error),this.addToHistory({name:i.name,loaded:!i.result.error})}this.initCallback(this.getHistory())},addToHistory:function(e){e.name?!1!==this.historyItems[e.name]&&(this.historyItems[e.name]=!e.error&&e.loaded):this.debug&&uvpjs.warn(this.DEBUG_ID,"module name not found",e)},destroy:function(){this.initCallback=null,this.cdo=null,this.historyItems=null}})}(uvpjs.register("uvpjs")),function(e){var t=e._;e.ResourcePlaylistManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PLAYLIST_MANAGER,init:function(e){this.debug=uvpjs.debug,this.vidContId="",this.cviMgr={},this.eventsMgr={},this.cviModel={},this.internalNS="",this.rscProviders=[],this.usedRPs=[],this.currRP={},this.p2pClient=e.p2pClient||null,this.multiCdnClient=e.multiCdnClient||null,this.mc=uvpjs.mediaCapabilities,this.suppressFacadePlay=e.suppressFacadePlay,this.deferLoadingCaptions=e.deferLoadingCaptions,this.playlistPaused=!1,!t.isEmpty(e)&&this.initialize(e.vidContId,e.cviMgr)},initialize:function(e,i){this.debug&&uvpjs.log(this.DEBUG_ID,"initialize  vidContId = ",e),t.isString(e)&&t.isObject(i)?(this.vidContId=e,this.cviMgr=i,this.eventsMgr=this.cviMgr.getEventsMgr(),this.cviModel=this.cviMgr.getModelRef(),this.internalNS="."+this.vidContId+".rpm",this.containers=null,this._addEventListeners()):this.debug&&uvpjs.error(this.DEBUG_ID,"initialize BAD PARAMS")},setContainers:function(e){this.containers=e},setCaptionStyle:function(e){!uvpjs.util.isEmpty(this.currRP)&&this.currRP.setCaptionStyle(e)},onResourceLoadRequest:function(e){if(e.target===this.vidContId){this.debug&&uvpjs.log(this.DEBUG_ID,"onResourceLoadRequest evtObj.payload.rcObj = ",e.payload.rcObj),this.playlistPaused=!1;var t=this._createResourceProvider(e.payload.rcObj);this.rscProviders.unshift(t),this.playlistInterruptionCleanup()}},onResourceAddRequest:function(e){if(e.target===this.vidContId){this.debug&&uvpjs.log(this.DEBUG_ID,"onResourceAddRequest evtObj.payload.rcObjs= ",e.payload.rcObjs);var i,s,n=e.payload.rcObjs,a=n.length;for(i=0;i<a;i++)s=this._createResourceProvider(n[i]),this.rscProviders.push(s);t.isEmpty(this.currRP)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onResourceAddRequest finished creating Resource Providers and there is no Current Resource Provider -> call this._loadNextRP()"),this._loadNextRP())}},onResourceRemoveRequest:function(e){if(e.target===this.vidContId){for(var t,i=e.payload.rcObjs,s=i.length,n=this.rscProviders,a=this.usedRPs,r=!1,o=!uvpjs.util.isEmpty(this.currRP);s--;)t=i[s],this.removeFromList(t,n),this.removeFromList(t,a),o&&!r&&(r=this.isMatchingResource(t,this.currRP.rco.rcoSeed));r&&this.advancePlaylist()}},removeFromList:function(e,t){for(var i=t.length;i--;)this.isMatchingResource(e,t[i].rco.rcoSeed)&&t.splice(i,1)},isMatchingResource:function(e,t){var i=uvpjs.util;return e.type===t.type&&(!i.isEmpty(e.pid)&&e.pid===t.pid||!i.isEmpty(e.assetURL)&&e.assetURL===t.assetURL||!i.isEmpty(e.selectorCall)&&e.selectorCall===t.selectorCall)},onResourcePlaylistPause:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"onResourcePlaylistPause this.vidContId = ",this.vidContId),e.target!==this.vidContId||this.playlistPaused||(this.playlistPaused=!0)},onResourcePlaylistResume:function(e){e.target===this.vidContId&&this.playlistPaused&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onResourcePlaylistResume this.vidContId = ",this.vidContId),this.playlistPaused=!1,t.isEmpty(this.currRP)&&this.rscProviders.length>0&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onResourcePlaylistResume  (_.isEmpty(this.currRP) && this.rscProviders.length > 0) LOAD NEXT RP this._loadNextRP();"),this._loadNextRP()))},onResourcePlaylistAdvance:function(e){e.target===this.vidContId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onResourcePlaylistAdvance this.vidContId = ",this.vidContId),this.advancePlaylist())},onResourcePlaylistDestroy:function(e){e.target===this.vidContId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onResourcePlaylistDestroy this.vidContId = ",this.vidContId),this.rscProviders=[],this.playlistInterruptionCleanup(),this.currRP=null)},advancePlaylist:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"advancePlaylist"),this.playlistPaused=!1,this.playlistInterruptionCleanup()},loadDynamicAdCall:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"loadDynamicAdCall adCall =",e),t.isEmpty(this.currRP)||t.isEmpty(this.currRP.rco)||this.currRP.rco.type!==this.mc.RP_IMA?this.debug&&uvpjs.warn(this.DEBUG_ID,"loadDynamicAdCall trying to load a dynamic ad call but currRP is either empty or not rco.type === RP_IMA"):this.currRP.loadDynamicAdCall(e)},forceDynamicMidrollPodEnd:function(){!t.isEmpty(this.currRP)&&this.currRP.forceDynamicMidrollPodEnd&&this.currRP.forceDynamicMidrollPodEnd()},playlistInterruptionCleanup:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"playlistInterruptionCleanup this.vidContId = ",this.vidContId),t.isEmpty(this.currRP)||t.isNull(this.currRP.rco)?(this.debug&&uvpjs.log(this.DEBUG_ID,"playlistInterruptionCleanup NO PREVIOUS RP so this._loadNextRP();"),this._loadNextRP()):this.currRP.rco.type===this.mc.RP_IMA?(this.debug&&uvpjs.log(this.DEBUG_ID,"playlistInterruptionCleanup CLEANUP PREVIOUS RP BEFORE LOADING NEXT ONE. IMA case calling -> this.currRP.cleanUpRP_IMA()"),this.currRP.cleanUpRP_IMA()):(this.debug&&uvpjs.log(this.DEBUG_ID,"playlistInterruptionCleanup CLEANUP PREVIOUS RP BEFORE LOADING NEXT ONE. non-IMA case calling -> this.currRP.cleanUp()"),this.currRP.cleanUp())},_createResourceProvider:function(e){var t,i={rco:e,cviMgr:this.cviMgr,vidContId:this.vidContId,containers:this.containers,p2pClient:this.p2pClient,deferLoadingCaptions:this.deferLoadingCaptions,multiCdnClient:this.multiCdnClient};switch(this.debug&&uvpjs.log(this.DEBUG_ID,"_createResourceProvider rcObj = ",e),e.type){case this.mc.RP_URL:t=new uvpjs.RP_URL(i);break;case this.mc.RP_PLATFORM:t=new uvpjs.RP_Platform(i);break;case this.mc.RP_DAI:t=new(e.useSsb()?uvpjs.DaiSsbResourceProvider:uvpjs.DaiResourceProvider)(i);break;case this.mc.RP_IMA:t=new uvpjs.RP_IMA(i);break;case this.mc.RP_MDIALOG:t=new uvpjs.RP_Mdialog(i)}return t},_loadNextRP:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_loadNextRP this.rscProviders.length = ",this.rscProviders.length),this.debug&&uvpjs.log(this.DEBUG_ID,"_loadNextRP this.playlistPaused = ",this.playlistPaused),t.isEmpty(this.currRP)||t.isNull(this.currRP.rco)||(this.currRP.rco.type===this.mc.RP_IMA?(this.debug&&uvpjs.log(this.DEBUG_ID,"_loadNextRP CLEANUP PREVIOUS RP BEFORE LOADING NEXT ONE.         IMA case calling -> this.currRP.cleanUpRP_IMA()"),this.currRP.cleanUpRP_IMA()):(this.debug&&uvpjs.log(this.DEBUG_ID,"_loadNextRP CLEANUP PREVIOUS RP BEFORE LOADING NEXT ONE.     non-IMA case calling -> this.currRP.cleanUp()"),this.currRP.cleanUp())),this.rscProviders.length>0&&!this.playlistPaused?(this.currRP=this.rscProviders.shift(),this.usedRPs.push(this.currRP),this.debug&&uvpjs.log(this.DEBUG_ID,"_loadNextRP JUST AFTER SETTING NEW currRP  this.currRP.rco.id = ",this.currRP.rco.id),this.currRP.loadData(this.rpDataLoadCB.bind(this),this.rpDataLoadErrorCB.bind(this))):(this.debug&&uvpjs.log(this.DEBUG_ID,"_loadNextRP this.rscProviders.length = 0 OR this.playlistPaused TRUE SETTING NEW this.currRP = {}; "),this.currRP={})},rpDataLoadCB:function(e){if(this.debug&&uvpjs.log(this.DEBUG_ID,"rpDataLoadCB"),this.debug&&uvpjs.log(this.DEBUG_ID,"rpDataLoadCB this.currRP =",this.currRP),!t.isObject(this.currRP))return this.debug&&uvpjs.warn(this.DEBUG_ID,"rpDataLoadCB  WARNING !_.isObject(this.currRP) RETURN WITHOUT PLAYING VIDEO"),void this.advancePlaylist();this.currRP.loadVideoAndBeginPlayback(this.suppressFacadePlay)},rpDataLoadErrorCB:function(e){this.debug&&uvpjs.warn(this.DEBUG_ID,"rpDataLoadErrorCB  WARNING Data Load Error Skip current video rpDataLoadErrorCB errMsg = ",e.message),this.eventsMgr.dispatchEvent(e.eventType,{errorInfo:e},this.vidContId),this.advancePlaylist()},resourceStart:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"resourceStart dispatch RESOURCE_START rcoSeed = ",e),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_START,{rco:e},this.vidContId)},resourceEnd:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"resourceEnd dispatch RESOURCE_END rcoSeed = ",e),this.currRP&&this.debug&&uvpjs.log(this.DEBUG_ID,"resourceEnd this.currRP.rco = ",this.currRP.rco),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_END,{rco:e,playlistLength:this.rscProviders.length},this.vidContId),this.currRP&&this.debug&&uvpjs.log(this.DEBUG_ID,"resourceEnd dispatch AFTER this.currRP.rco = ",this.currRP.rco),this.rscProviders.length>0&&!t.isEmpty(this.currRP)&&t.isNull(this.currRP.rco)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"resourceEnd dispatch _loadNextRP()"),this._loadNextRP())},_addEventListeners:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_addEventListeners this.internalNS = ",this.internalNS),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_LOAD_REQUEST+this.internalNS,this.onResourceLoadRequest.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_ADD_REQUEST+this.internalNS,this.onResourceAddRequest.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_REMOVE_REQUEST+this.internalNS,this.onResourceRemoveRequest.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_PAUSE+this.internalNS,this.onResourcePlaylistPause.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_RESUME+this.internalNS,this.onResourcePlaylistResume.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_ADVANCE+this.internalNS,this.onResourcePlaylistAdvance.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_DESTROY+this.internalNS,this.onResourcePlaylistDestroy.bind(this))},_removeEventListeners:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_removeEventListeners this.internalNS = ",this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_LOAD_REQUEST+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_ADD_REQUEST+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_REMOVE_REQUEST+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_PAUSE+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_RESUME+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_ADVANCE+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_DESTROY+this.internalNS)}})}(uvpjs.register("uvpjs")),function(e){var t=e._;e.VideoControlInterface=uvpjs.Class.subClass({AD_SETTINGS:"AdSettings",init:function(){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.VIDEO_CONTROL_INTERFACE,this.vciReadyCB={},this.skinMgr=null,this.DOMMgr={},this.vidContId="",this.eventsMgr={},this.CDO={},this.CVI_Mgr={},this.mc=uvpjs.mediaCapabilities,this.rcoIdIndex=0,this.namespace=null,this.diagnostic=null,this._loadSkinFlag=!1,this._vciReadySent=!1,this._playBlankVideoDone=!1,this._previewButtonDone=!1,this._playBlankVideoCallback=null,this._replayRco=null,this._isUnmutedAutoplay=!1,this._isMutedAutoplay=!1,this._autoPlay=!1,this.hasDispatchedFirstGesture=!1,this.useBrowserNativeControls=!1,this.isWaitingForFirstTouch=!1,this.isPreparedForAutoplay=!1,this.autoplayRestrictionChecked=!1,this.contentStartReceived=!1},initialize:function(e,i,s,n,a){var r=!0===a.skin;this.debug&&uvpjs.log(this.DEBUG_ID,"initialize vidContId =",e),t.isString(e)&&t.isObject(i)&&t.isObject(s)&&t.isFunction(n)?(this.vidContId=e,this.namespace=".vci_"+e,this.eventsMgr=i,this.CDO=s,this.vciReadyCB=n,this._usesIMA=a.usesIMA,this._loadSkinFlag=r,this._isPreviewBtnInternallyManaged=r,this._isUnmutedAutoplay=a.enableUnmutedAutoplay,this._isMutedAutoplay=a.enableMutedAutoplay,this._autoPlay=this._isUnmutedAutoplay||this._isMutedAutoplay,this.playRequiresUserGesture=this.mc.playRequiresUserGesture(this._autoPlay),this.listenForAdEvents(),this.useBrowserNativeControls=!!a.useBrowserControls,this.CVI_Mgr=new uvpjs.CoreVideoInstanceManager({vidContId:e,eventsMgr:i,CDO:s,playerOptions:a,suppressFacadePlay:this.checkNativeAutoplay(a.enableNativeMobileAutoplay),readyCallback:this.handleCviMgrReady.bind(this,a)})):this.debug&&uvpjs.log(this.DEBUG_ID,"-")},destroy:function(){this._replayRco=null,this.skinMgr&&this.skinMgr.destroy(),this.diagnostic&&this.diagnostic.destroy(),removeResizeListener(this.dom.outer.el,this._dispatchResizeEvent.bind(this))},handleCviMgrReady:function(e){var t={skin:!0===e.skin,isUnmutedAutoplay:this._isUnmutedAutoplay,isMutedAutoplay:this._isMutedAutoplay,customCSS:e.customCSS,enableReplay:e.enableReplay,previewImage:e.previewImage,themeName:e.themeName,controls:e.controls,template:e.template};this.CVI_Mgr.setInitialPlaybackType(this._autoPlay,this._isMutedAutoplay),this.useBrowserNativeControls&&this.CVI_Mgr.setNativeControls(!0),this.DOMMgr=new uvpjs.DOMManager({containerID:this.vidContId,createControls:this._loadSkinFlag,createAds:this._usesIMA,useMutedAttribute:this._isMutedAutoplay,useInlinePlayAttribute:e.playsInline||this.mc.requiresInlinePlayAttribute(this._autoPlay),useAutoplayAttribute:this.checkNativeAutoplay(e.enableNativeMobileAutoplay),callback:this.onDOMReady.bind(this,t)}),this.DOMMgr.initialize()},listenForAdEvents:function(){this.addEventListener(uvpjs.EventType.AD_LOADED+this.namespace,this.onAdLoaded.bind(this)),this.addEventListener(uvpjs.EventType.AD_START+this.namespace,this.onAdStart.bind(this)),this.addEventListener(uvpjs.EventType.AD_END+this.namespace,this.onAdEnd.bind(this)),this.addEventListener(uvpjs.EventType.AD_POD_END+this.namespace,this.onAdPodEnd.bind(this)),this.addEventListener(uvpjs.EventType.CONTENT_START+this.namespace,this.onContentStart.bind(this)),this.addEventListener(this.eventsMgr.eventTypes.AD_CLICK+this.namespace,this.hAdClick.bind(this))},onAdPodEnd:function(){this.isWaitingForFirstTouch=!1,this.removeEventListener(uvpjs.EventType.AD_POD_END+this.namespace)},onAdLoaded:function(e){},onAdStart:function(e){var t=e.payload.adData;this.DOMMgr.showAdContainer(!0),!this.autoplayRestrictionChecked&&this.checkAutoplayRestriction(t),t.isCustomClickTrackingUsed&&this.DOMMgr.showAdClickElement(!0)},onAdEnd:function(e){this.DOMMgr.showAdClickElement(!1),this.DOMMgr.showAdContainer(!1)},onContentStart:function(){this.contentStartReceived=!0,this.isWaitingForFirstTouch=!1,this.DOMMgr.showAdClickElement(!1),this.DOMMgr.showAdContainer(!1)},hAdClick:function(){if(this.handleFirstGesture(),this.skinMgr){var e=this.skinMgr,t=this.mc.PAUSED;setTimeout(function(){e.setPlaystate(t)},200)}},setAdCallParams:function(e){this.CVI_Mgr.setAdCallParams(e)},checkAutoplayRestriction:function(e){this.autoplayRestrictionChecked=!0,!this.contentStartReceived&&"pre"===e.adType&&"ima"===e.adServerName&&this._isMutedAutoplay&&!this.mc.isSingleVideoIma()&&!this.mc.supportsUnmutedAutoplay()&&!this.isPreparedForAutoplay&&(this.isWaitingForFirstTouch=!0)},dispatchFirstGesture:function(e){this.eventsMgr.dispatchEvent(uvpjs.EventType.FIRST_GESTURE,e,this.vidContId)},prepForRestrictedAutoplay:function(e){var t=this.dom.video.el,i=function(){this.isPreparedForAutoplay=!0,t.removeEventListener("play",i,!1),t.muted=!1,e&&(this._playBlankVideoDone=!0,this._playBlankVideoCallback())}.bind(this);this.debug&&uvpjs.log(this.DEBUG_ID,"Prep for restricted autoplay..."),t.src=this.mc.getPreferredPlaceholderURL(),t.addEventListener("play",i,!1),t.muted=!0,t.load();var s=t.play();void 0!==s&&s.then(Function.prototype).catch(function(e){console.warn("UVPJS:VCI.prepForRestrictedAutoplay: priming Promise rejected.")})},handleFirstGesture:function(e){this.isWaitingForFirstTouch&&(this.isWaitingForFirstTouch=!1,this.prepForRestrictedAutoplay()),this.hasDispatchedFirstGesture||(this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.FIRST_GESTURE,{info:e||null},this.vidContId),this.hasDispatchedFirstGesture=!0)},onDOMReady:function(e){this.dom=this.DOMMgr.getDOM(),this.useBrowserNativeControls?(this.CVI_Mgr.setNativeControls(!0),this.dom.video.el.setAttribute("controls","controls")):addResizeListener(this.dom.outer.el,this._dispatchResizeEvent.bind(this)),this.CVI_Mgr.setContainers({playerDom:this.dom.outer.el,contentVideoDom:this.dom.content.el}),this.mc.isDesktop()&&!0===this.CDO.getSessionOption("enableDiagnosticWindow")&&(this.diagnostic=new uvpjs.Diagnostic({eventsMgr:this.eventsMgr,containerEl:this.dom.outer.el,videoEl:this.dom.video.el})),this.useBrowserNativeControls||!this._loadSkinFlag?this.onVCIReady():this.skinMgr=new uvpjs.SkinManager({vci:this,skinReadyCallback:this.onVCIReady.bind(this),skinConfig:e})},checkNativeAutoplay:function(e){return e&&this.mc.supportsIntelligentMobileAutoplay()},onVCIReady:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"onVCIReady"),this._vciReadySent||(this._autoPlay||!this._isPreviewBtnInternallyManaged||this._previewButtonDone?(this._usesIMA&&!this.playRequiresUserGesture&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onVCIReady   call this.CVI_Mgr.constructSharedIMAClasses()"),this.CVI_Mgr.constructSharedIMAClasses(this.DOMMgr.getAdClickElement())),this._isMutedAutoplay&&this.mute(),this._vciReadySent=!0,this.vciReadyCB(this)):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PLAYER_INIT,{player:this},this.vidContId))},loadDynamicAdCall:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"loadDynamicAdCall adCall =",e),t.isString(e)?this.CVI_Mgr.loadDynamicAdCall(e):this.debug&&uvpjs.log(this.DEBUG_ID,"loadDynamicAdCall !_.isString(adCall)")},forceDynamicMidrollPodEnd:function(){this.CVI_Mgr.forceDynamicMidrollPodEnd()},onPreviewButton:function(e){if(uvpjs.log(this.DEBUG_ID,"onPreviewButton"),uvpjs.util.isFunction(e)){if(this._usesIMA&&this.playRequiresUserGesture&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onPreviewButton   call this.CVI_Mgr.constructSharedIMAClasses()"),this.CVI_Mgr.constructSharedIMAClasses()),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PREVIEW_BUTTON,{},this.vidContId),this._previewButtonDone=!0,this.playRequiresUserGesture&&!this._playBlankVideoDone)return uvpjs.log(this.DEBUG_ID,"onPreviewButton playing blank video in mobile."),this._playBlankVideoCallback=e,void this.playBlankVideo();uvpjs.log(this.DEBUG_ID,"onPreviewButton executing callback in desktop."),e()}else this.debug&&uvpjs.error(this.DEBUG_ID,"onPreviewButton method called without a callback function.")},canOverrideUserGesture:function(){return!this.playRequiresUserGesture||this.playRequiresUserGesture&&this._playBlankVideoDone},overrideUserGesture:function(e){var t,i;if(!0!==e&&!this.canOverrideUserGesture())return t=uvpjs.ErrorInfo,void(i=this.eventsMgr).dispatchEvent(i.eventTypes.PLAYER_START_ERROR,{errorInfo:new t({eventType:i.eventTypes.PLAYER_START_ERROR,errorCode:t.errorCodes.USER_GESTURE_REQUIRED,message:t.messages.USER_GESTURE_REQUIRED,isFatal:!1})},this.vidContId);this.onPreviewButton(this.onVCIReady.bind(this))},addEventListener:function(e,i){e&&t.isString(e)&&t.isFunction(i)?this.eventsMgr.addEventListener(e,i):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoControlInterface addEventListener MISSING OR MISS-TYPED PARAMS RETURN"},this.vidContId)},removeEventListener:function(e){e&&t.isString(e)?this.eventsMgr.removeEventListener(e):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoControlInterface removeEventListener !evt || evt !== string INVALID RETURN"},this.vidContId)},getVidContId:function(){return this.vidContId},playBlankVideo:function(){uvpjs.log(this.DEBUG_ID,"playBlankVideo"),this.prepForRestrictedAutoplay(!0)},loadAndPlayResource:function(e){var i;if(this.debug&&uvpjs.log(this.DEBUG_ID,"loadAndPlayResource -> dispatches RESOURCE_LOAD_REQUEST event    rcObj = ",e),this.playRequiresUserGesture&&!this._playBlankVideoDone)return this.debug&&uvpjs.warn(this.DEBUG_ID,"loadAndPlayResource was called before a mobile touch event."),this._playBlankVideoCallback=this.loadAndPlayResource.bind(this,e),void this.playBlankVideo();i=this.createResourceConfig(e),t.isObject(i)?this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_LOAD_REQUEST,{rcObj:i},this.vidContId):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoControlInterface  loadAndPlayResource INVALID RESOURCE CONFIG OBJECT RETURN"},this.vidContId)},addResourcesToPlaylist:function(e){if(this.debug&&uvpjs.log(this.DEBUG_ID,"addResourcesToPlaylist rcObjsArray = ",e),this.playRequiresUserGesture&&!this._playBlankVideoDone)return this.debug&&uvpjs.warn(this.DEBUG_ID,"addResourcesToPlaylist was called before a mobile touch event."),this._playBlankVideoCallback=this.addResourcesToPlaylist.bind(this,e),void this.playBlankVideo();if(t.isArray(e)&&e.length>0){var i,s,n=[];for(i in e)s=this.createResourceConfig(e[i]),t.isObject(s)?n.push(s):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoControlInterface addResourcesToPlaylist INVALID RESOURCE CONFIG OBJECT IN rcObjsArray DO NOT ADD TO PLAYLIST"},this.vidContId);n.length>0&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_ADD_REQUEST,{rcObjs:n},this.vidContId)}else this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoControlInterface addResourcesToPlaylist rcObjsArray argument is EMPTY OR NOT AN ARRAY    RETURN"},this.vidContId)},createResourceConfig:function(e){var t,i,s,n,a,r="",o=!1,l=e.type===this.mc.RP_IMA,d=!1,u=null;if(this.debug&&uvpjs.log(this.DEBUG_ID,"createResourceConfig rcObj = ",e),(a=this.prevalidateRcObj(e)).error)return r="Resource configuration error: "+a.message+" this.vidContId = "+this.vidContId,this.dispatchStartError(r,null),!1;switch(e.type){case this.mc.RP_URL:t=uvpjs.RCO_URL;break;case this.mc.RP_PLATFORM:t=uvpjs.RCO_Platform;break;case this.mc.RP_IMA:this._usesIMA||(r="Resource type is IMA, but sessionOptions.usesIMA is set to FALSE",o=!0),d=!0,t=uvpjs.RCO_IMA;break;case this.mc.RP_MDIALOG:t=uvpjs.RCO_Mdialog;break;case this.mc.RP_DAI:d=!e.useSsb,t=uvpjs.DaiRco;break;default:r="VCI createResourceConfig "+("Unknown resource type "+e.type)+"; this.vidContId = "+this.vidContId,o=!0}return o?(this.dispatchStartError(r,null),!1):(this.rcoIdIndex++,a=(i=new t(e,this.rcoIdIndex+"_"+this.vidContId,this.vidContId)).getValidationInfo(),d&&this.checkForAdBlocker()?(!0===a.missingSDK&&(u=l?"IMA":"DAI"),this.dispatchAdBlocked(u,!0),!1):a.error?(r="VCI error initializing RCO: "+a.message,s=uvpjs.ErrorInfo.errorCodes,!0===a.missingSDK?(n=l?s.IMA_SDK_MISSING:s.DAI_SDK_MISSING,this.dispatchStartError(r,n)):this.dispatchStartError(r,null),!1):(this._replayRco=e,i))},prevalidateRcObj:function(e){var t=uvpjs.util,i="",s=!1;return t.isPlainObject(e)?t.isDefinedString(e.type)||(i="Invalid resource type encountered",s=!0):(i="Invalid resource config object format",s=!0),{error:s,message:i}},dispatchStartError:function(e,t){this.debug&&uvpjs.error(this.DEBUG_ID,e),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_START_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.VIDEO_START_ERROR,errorCode:t||uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,message:uvpjs.ErrorInfo.messages.UNEXPECTED_CONDITION+" "+e,isFatal:!0})},this.vidContId)},dispatchAdBlocked:function(e,t){var i=e?" (Missing "+e+" SDK)":"";this.debug&&uvpjs.error(this.DEBUG_ID,"Ad Blocking detected"+i,this.vidContId),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_BLOCKED,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_BLOCKED,errorCode:uvpjs.ErrorInfo.errorCodes.AD_BLOCKING_DETECTED,message:uvpjs.ErrorInfo.messages.AD_BLOCKING_DETECTED+i,isFatal:!!t})},this.vidContId)},checkForAdBlocker:function(){return uvpjs.adUtil.checkForAdBlocker(this.CVI_Mgr.cviModel)},pausePlaylist:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_PAUSE,{},this.vidContId)},resumePlaylist:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_RESUME,{},this.vidContId)},advancePlayList:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_ADVANCE,{},this.vidContId)},removeResourcesFromPlaylist:function(e){t.isArray(e)&&e.length>0&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_REMOVE_REQUEST,{rcObjs:e},this.vidContId)},destroyPlaylist:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"destroyPlaylist RESOURCE_PLAYLIST_DESTROY this.vidContId = ",this.vidContId),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_DESTROY,{},this.vidContId)},playVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"playVideo this.vidContId = ",this.vidContId),this.CVI_Mgr.playVideoRequest()},pauseVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"pauseVideo this.vidContId = ",this.vidContId),this.CVI_Mgr.pauseVideoRequest()},replayVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"replayVideo",this._replayRco),this._replayRco&&this.loadAndPlayResource(this._replayRco)},seekTo:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"seekToRealTime = ",e),isNaN(e)||this.CVI_Mgr.seekToRequest(e)},seekToLive:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"seekToLive Attempt"),this.CVI_Mgr.seekToLiveRequest()},stopVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"stopVideo"),this.CVI_Mgr.stopVideoRequest()},clearVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"clearVideo"),this.CVI_Mgr.clearVideoRequest()},mute:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"mute"),this.CVI_Mgr.muteRequest()},unMute:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"unMute"),this.CVI_Mgr.unmuteRequest()},disableButton:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"disableButton",e),t.isEmpty(this.skinMgr)||t.isEmpty(e)||this.skinMgr.disableButton(e)},enableButton:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"enableButton",e),t.isEmpty(this.skinMgr)||t.isEmpty(e)||this.skinMgr.enableButton(e)},getPlayerMuted:function(){return this.CVI_Mgr.getPlayerMuted()},setVolume:function(e){t.isNaN(e)||this.CVI_Mgr.volumeChangeRequest(e)},getVolume:function(){return this.CVI_Mgr.getVolume()},loadCaptions:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"loadCaptions captionsPath = ",e),t.isString(e)&&this.CVI_Mgr.loadCaptionsRequest(e)},showCaptions:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"showCaptions"),this.CVI_Mgr.showCaptionsRequest(e)},setCaptionLanguage:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"setCaptionLanguage to "+e),this.CVI_Mgr.setCaptionLanguage(e)},getCaptionInfo:function(){return this.CVI_Mgr.getCaptionInfo()},hideCaptions:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"hideCaptions"),this.CVI_Mgr.hideCaptionsRequest()},showDiagnosticWindow:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"showDiagnosticWindow"),this.diagnostic&&this.diagnostic.show()},hideDiagnosticWindow:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"hideDiagnosticWindow"),this.diagnostic&&this.diagnostic.hide()},getAudioTrackInfo:function(){return this.CVI_Mgr.getAudioTrackInfo()},setAudioTrack:function(e){this.CVI_Mgr.setAudioTrack(e)},usesDiagnosticWindow:function(){return!!this.diagnostic},setCaptionsStyle:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"setCaptionsStyle",e),this.CVI_Mgr.setCaptionsStyleRequest(e)},setCaptionsStyleProperty:function(e,t){this.debug&&uvpjs.log(this.DEBUG_ID,"setCaptionsStyleProperty",e,t),this.CVI_Mgr.setCaptionsStyleRequest([{name:e,value:t}])},getCaptionsStyle:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getCaptionsStyle"),this.CVI_Mgr.getCaptionsStyleRequest()},setCaptionsCueProperty:function(e,t){this.debug&&uvpjs.log(this.DEBUG_ID,"setCaptionsCueProperty",e,t),this.CVI_Mgr.setCaptionsCuePropertyRequest(e,t)},setSize:function(e,i){this.debug&&uvpjs.log(this.DEBUG_ID,"setSize  width = "+e+"  height = "+i),t.isNumber(e)||t.isNumber(i)||this.CVI_Mgr.resizeRequest(e,i)},getAutoplayInfo:function(){return this.mc.getAutoplayInfo()},setUserGesture:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"setUserGesture info = ",e),!t.isEmpty(e)&&(t.isArray(e)&&e.length>0||uvpjs.util.isDefinedString(e))&&this.CVI_Mgr.setUserGesture(e)},setQosMetadata:function(e,i){this.debug&&uvpjs.log(this.DEBUG_ID,"setQosMetadata vendorArray = ",e),this.debug&&uvpjs.log(this.DEBUG_ID,"setQosMetadata   paramsObj = ",i),t.isEmpty(e)||t.isEmpty(i)||!t.isArray(e)||(this.debug&&uvpjs.log(this.DEBUG_ID,"setQosMetadata dispatch QOS_METADATA event"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.QOS_METADATA,{vendorArray:e,paramsObj:i},this.vidContId))},fullscreen:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"fullscreen onOff = ",e),t.isBoolean(e)&&this.CVI_Mgr.fullscreenRequest(e)},getCurrentPlaybackState:function(){return this.CVI_Mgr.getCurrentPlaybackState()},getContentVideoData:function(){return this.CVI_Mgr.getContentVideoData()},getAdVideoData:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getAdVideoData"),this.CVI_Mgr.getAdVideoData()},getPlayerSessionId:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getPlayerSessionId"),this.CVI_Mgr.getPlayerSessionId()},setPageContextMetadata:function(e){e&&t.isPlainObject(e)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"setPageContextMetadata",e),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTEXT_METADATA,{contextMetadata:e},this.vidContId))},forceTrackSessionEnd:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.FORCE_TRACK_SESSION_END,{},this.vidContId)},removeNativeControls:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"removeNativeControls onOff = ",e),t.isBoolean(e)&&this.CVI_Mgr.setNativeControls(e)},useDynamicSwitching:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"useDynamicSwitching",e),t.isBoolean(e)&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.USE_DYNAMIC_SWITCHING,{data:e},this.vidContId)},switchUp:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"switchUp"),this.switchTo("up")},switchDown:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"switchDown"),this.switchTo("down")},switchBitrateTo:function(e){e&&"number"==typeof e?(this.debug&&uvpjs.log(this.DEBUG_ID,"switch to bitrate:",e),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.SWITCH_REQUEST,{bitrate:e},this.vidContId)):this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to switch to a selected bitrate based on the value:",e)},switchTo:function(e){var t=null!=e&&"string"==typeof e&&-1!=="up,down".indexOf(e),i=null!=e&&"number"==typeof e&&!isNaN(e);t||i?(this.debug&&uvpjs.log(this.DEBUG_ID,"Switch To:",e),i?this.switchBitrateTo(e):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.SWITCH_REQUEST,{bitrate:e},this.vidContId)):this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to switch to value",e,t,i,typeof e)},setMinimumBitrateAllowed:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"Set Minimum Bitrate:",e),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.MINIMUM_BITRATE_ALLOWED,{bitrate:e},this.vidContId)},setMaximumBitrateAllowed:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"Set Maximum Bitrate:",e),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.MAXIMUM_BITRATE_ALLOWED,{bitrate:e},this.vidContId)},pauseAdRequest:function(e,t){this.debug&&uvpjs.log(this.DEBUG_ID,"pauseAdRequest called"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PAUSE_AD_REQUEST,{width:e||null,height:t||null},this.vidContId)},_dispatchResizeEvent:function(e){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTAINER_RESIZE,{e:e},this.vidContId)},liveSegmentStart:function(e){var t=this.eventsMgr.eventTypes.LIVE_SEGMENT_START,i={liveSegmentData:e};this.eventsMgr.dispatchEvent(t,i,this.vidContId)},liveSegmentEnd:function(e){var t=this.eventsMgr.eventTypes.LIVE_SEGMENT_END,i={liveSegmentData:e};this.eventsMgr.dispatchEvent(t,i,this.vidContId)}})}(uvpjs.register("uvpjs")),function(e){var t=Math.random(),i=e._;e.VideoManager=uvpjs.Class.subClass({init:function(e){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.VIDEO_MANAGER,uvpjs.VideoManager._instance?console.warn("UVPJS: An instance of VideoManager has already been created."):(uvpjs.VideoManager._instance=this,this.initComplete=!1,this.initializing=!1,this.successCallbacks=[],this.internalNS=".Video_Manager",this.VCIs={},this.CDO={},this.currActiveVCI=null,this._allowConcurrentPlayback=!1,this._disableAutoplay=!1,this.mc=uvpjs.mediaCapabilities,this.eventsMgr=null,this.configMgr=null,this.autoplayChecked=!1)},destroy:function(){for(var e in this.VCIs)this.destroyVideoPlayer(e);this.VCIs=null,this.eventsMgr&&this.eventsMgr.destroy(),this.configMgr&&this.configMgr.destroy(),this.eventsMgr=null,this.configMgr=null,this.currActiveVCI=null,this.CDO=null,this.mc=null,this.sdkLoadMgr=null,uvpjs.VideoManager.destroyInstance()},initialize:function(e,t,i){var s=uvpjs.Configuration,n=uvpjs.VideoManager._instance,a=uvpjs.DebugManager,r=this.validateParams(e,t,i),o=r.message,l=r.isValid;if(!o||(console[l?"warn":"error"](o),!l&&r.errorCb&&r.errorCb(o),l)){if(n){if(n.isInitializing())return void n.addInitCallback(t);if(n.isReady())return void(uvpjs.util.isFunction(t)&&t(this.mc.systemInfo))}console.log([s.name,s.version,s.date].join(" ")),uvpjs.log=a.log.bind(a),uvpjs.warn=a.warn.bind(a),uvpjs.error=a.error.bind(a),a.setSessionStartTime(),this.initializing=!0,this.useNativeAutoplay=!(!e.enableNativeMobileAutoplay||!this.mc.supportsIntelligentMobileAutoplay()),this.addInitCallback(t),this.debug&&uvpjs.log(this.DEBUG_ID,"initialize options = ",e),this.eventsMgr=uvpjs.EventsManager.getInstance(),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.UVPJS_ERROR+this.internalNS,this.uvpjsError.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.UVPJS_WARNING+this.internalNS,this.uvpjsWarning.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_PLAY+this.internalNS,this.onVideoPlaybackInitiated.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.PREVIEW_BUTTON+this.internalNS,this.onVideoPlaybackInitiated.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.VIDEO_PROGRESS+this.internalNS,this.onVideoProgress.bind(this)),this.configMgr=uvpjs.ConfigManager.getInstance(e,this.onCongfigMgrReady.bind(this))}},validateParams:function(e,t,s){var n=uvpjs.util,a=null,r=!1,o="VideoManager.initialize()",l=n.isFunction(s)?s:null;return e&&i.isPlainObject(e)||(a=o+" was invoked with invalid session options.",r=!0),n.isFunction(t)||(a=o+": A success callback function is required.",r=!0),l||(a=o+" did not receive a valid error callback function.",r=!1),{errorCb:l,message:a,isValid:!r}},isReady:function(){return this.initComplete},isInitializing:function(){return this.initializing},addInitCallback:function(e){var t=this.successCallbacks.length;if(uvpjs.util.isFunction(e)){for(;t--;)if(this.successCallbacks[t]===e)return;this.successCallbacks.push(e)}},onCongfigMgrReady:function(e){i.isObject(e)?(this.CDO=e,this.checkForForcedHlsjs(this.CDO),this.setupDebugManager(),this.sdkLoadMgr=new uvpjs.SdkLoadManager(this.CDO,this.onSdkLoadManagerReady.bind(this))):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager onCongfigMgrReady CDO MISSING OR MISS-TYPED - RETURN"},this.internalNS)},onSdkLoadManagerReady:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"onSdkLoadManagerReady",e),uvpjs.mediaCapabilities.setTrackingInfo(e),this.autoplayChecked||(this.autoplayChecked=!0,this.checkAutoplay())},checkForForcedHlsjs:function(e){var t,i=e.isModuleEnabled("VideoPlaybackSettings")&&e.getModuleParam("VideoPlaybackSettings","forceHlsjs"),s="string"==typeof i,n=s&&i.toLowerCase();i&&!uvpjs.util.isEmpty(i)&&(!0===i||1===i||s&&("1"===n||"y"===n||"yes"===n))&&((t=this.mc.canPlayHLSJS(!0))&&(this.mc.canPlayHLSJS=this.mc.canPlayHLSJS.bind(this.mc,!0)),this.mc.systemInfo.isHlsjsEligible=t)},checkAutoplay:function(){uvpjs.mediaCapabilities.determineAutoplayCapabilities(this.onAutoplayCheckComplete.bind(this))},onAutoplayCheckComplete:function(){for(this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PLAYER_LOADED,{},this.internalNS),this._allowConcurrentPlayback=this._determineConcurrentPlaybackStatus(),this.initComplete=!0,this.initializing=!1;this.successCallbacks.length;)this.successCallbacks.shift()(this.mc.systemInfo)},_determineConcurrentPlaybackStatus:function(){return!0===this.useNativeAutoplay||!!this.CDO.sessionOptions.allowConcurrentPlayback},setupDebugManager:function(){uvpjs.DebugManager.initialize(this.CDO),uvpjs.debug=uvpjs.DebugManager.isEnabled},addEventListener:function(e,t){this.eventsMgr&&(e&&i.isString(e)&&i.isFunction(t)?this.eventsMgr.addEventListener(e,t):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager addEventListener MISSING OR MISS-TYPED PARAMS RETURN"},this.internalNS))},removeEventListener:function(e){e&&i.isString(e)?this.eventsMgr.removeEventListener(e):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager removeEventListener !evt || evt !== string INVALID RETURN"},this.internalNS)},getVideoPlayers:function(){var e,t={};for(e in this.VCIs)t[e]=this.VCIs[e];return t},createVideoPlayer:function(e,t,s){if(this.debug&&uvpjs.log(this.DEBUG_ID,"createVideoPlayer"),i.isString(e)&&i.isFunction(t)&&(!s||i.isPlainObject(s))){var n=[e,t];s&&n.push(s),this.createMultipleVideoPlayers([n])}else this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager createVideoPlayer initialization PARAMS MISSING OR MISS-TYPED - RETURN"},this.internalNS)},destroyVideoPlayer:function(e){return this.debug&&uvpjs.log(this.DEBUG_ID,"destroyVideoPlayer"),i.isString(e)?i.isEmpty(this.VCIs)||!this.VCIs[e]?(this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager destroyVideoPlayer container VCI does not exist "+e},this.internalNS),!1):(this.VCIs[e].destroy(),delete this.VCIs[e]):(this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager destroyVideoPlayer missing parameters"},this.internalNS),!1)},getAutoplayInfo:function(){return this.mc?this.mc.getAutoplayInfo():{supportsMutedAutoplay:null,supportsUnmutedAutoplay:null}},createMultipleVideoPlayers:function(e){var t,s,n,a,r,o,l,d;if(this.debug&&uvpjs.log(this.DEBUG_ID,"createMultipleVideoPlayers"),this._disableAutoplay&&(this._disableAutoplay=!i.isEmpty(this.VCIs)),i.isArray(e)){for(a=e.length,n=0;n<a;n++)if(o=(r=e[n])[0],l=r[1],d=r[2],r.length<2||!i.isString(o)||!i.isFunction(l)||!i.isUndefined(d)&&!i.isPlainObject(d))return void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager createMultipleVideoPlayers initialization ARRAY PARAMS MISSING OR MISS-TYPED - RETURN"},this.internalNS);for(this.debug&&uvpjs.log(this.DEBUG_ID,"createMultipleVideoPlayers Arrays OK. Create VCIs."),n=0;n<a;n++)o=(r=e[n])[0],l=r[1],d=r[2]||{},this.debug&&uvpjs.log(this.DEBUG_ID,"createMultipleVideoPlayers LOOP containerID = args[0] = ",o),d=this.CDO.getSessionOptions(d),t=this.validateAutoplay(d),!1===this._allowConcurrentPlayback&&t&&(this._disableAutoplay&&(d.enableMutedAutoplay=!1,d.enableUnmutedAutoplay=!1),this._disableAutoplay=!0),s=new uvpjs.VideoControlInterface,this.VCIs[o]=s,s.initialize(o,this.eventsMgr,this.CDO,l,d);this.debug&&(uvpjs.log(this.DEBUG_ID,"createMultipleVideoPlayers after loop this._disableAutoplay",this._disableAutoplay),uvpjs.log(this.DEBUG_ID,"createMultipleVideoPlayers this.VCIs = ",this.VCIs))}else this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager createMultipleVideoPlayers PARAMS IS NOT AN ARRAY - RETURN"},this.internalNS)},validateAutoplay:function(e){var t=e.enableUnmutedAutoplay&&this.mc.supportsUnmutedAutoplay(),i=!!(e.enableMutedAutoplay&&this.mc.supportsMutedAutoplay()||t);return t&&(e.enableMutedAutoplay=!1),i||(e.enableMutedAutoplay=!1,e.enableUnmutedAutoplay=!1),i},overrideSessionOptions:function(e){e&&i.isPlainObject(e)&&this.CDO.overrideSessionOptions(e)},onVideoProgress:function(e){if(!(this._allowConcurrentPlayback||!i.isPlainObject(e)||i.isUndefined(e.target)||i.isUndefined(e.payload)||i.isUndefined(e.payload.playbackState)||e.payload.playbackState!==this.mc.PLAYING)){var t=e.target;i.isEmpty(this.currActiveVCI)&&!i.isUndefined(this.VCIs[t])&&(this.currActiveVCI=this.VCIs[t]),t===this.currActiveVCI.vidContId||i.isUndefined(this.VCIs[t])||(this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoProgress this.VCIs[vidContId].pauseVideo();",t),this.VCIs[t].pauseVideo())}},onVideoPlaybackInitiated:function(e){if(this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoPlaybackInitiated",e),!this._allowConcurrentPlayback&&i.isPlainObject(e)&&!i.isUndefined(e.target)){var t=e.target;this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoPlaybackInitiated this.VCIs",Object.keys(this.VCIs),this.VCIs),i.isEmpty(this.VCIs)||i.isUndefined(this.VCIs[t])||this.currActiveVCI&&this.currActiveVCI.vidContId===t||(this.currActiveVCI=this.VCIs[t],this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoPlaybackInitiated   RESET this.currActiveVCI NEW = ",this.currActiveVCI))}},uvpjsError:function(e){e?this.debug&&uvpjs.error(this.DEBUG_ID,"ERROR: ",e.payload.msg):this.debug&&uvpjs.error(this.DEBUG_ID,"ERROR: uvpjsError MISSING evtObj !!!!!!!!!!!")},uvpjsWarning:function(e){e?this.debug&&uvpjs.warn(this.DEBUG_ID,"WARNING: ",e.payload.msg):this.debug&&uvpjs.warn(this.DEBUG_ID,"WARNING: uvpjsWarning MISSING evtObj !!!!!!!!!!!")}}),e.VideoManager._instance=null,e.VideoManager.destroyInstance=function(){this._instance=null},e.VideoManager.getInstance=function(){return this._instance||(this._instance=new uvpjs.VideoManager(t)),this._instance}}(uvpjs.register("uvpjs")),function(e){var t,i,s,n,a,r,o,l,d,u,c,h,p,g,f,v=e._;e.CaptionsManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.CAPTIONS_MANAGER,VIDEO_ID_PREFIX:uvpjs.domConstants.VIDEO_ID_PREFIX,CAPTIONS_ID_PREFIX:uvpjs.domConstants.CAPTIONS_ID_PREFIX,CAPTIONS_CONTAINER_CLASSNAME:"uvpjs__cc-container",CAPTIONS_TEXT_CLASSNAME:"uvpjs__cc-text",CONFIG_MODULE_NAME:"ClosedCaptions",BASE_CONTROLS_HEIGHT:"50px",BASE_FONT_SIZE:"22px",BASE_VIDEO_WIDTH:"848px",MIN_FONT_SIZE:"10px",init:function(e){var t=uvpjs.mediaCapabilities;this.debug=uvpjs.debug,e&&(this._cviModel=e.cviModel,this._eventsMgr=e.eventsMgr,this._containerId=e.containerId,this.useNativeBrowserControls=!!this._cviModel.getSessionOption("useBrowserControls"),this._videoId=this.VIDEO_ID_PREFIX+this._containerId,this._captionsId=this.CAPTIONS_ID_PREFIX+this._containerId,this._namespace="."+this._containerId+".captionsMgr",this._supportsVTTCue=void 0!==window.VTTCue,this.debug&&uvpjs.log(this.DEBUG_ID,"init",this._containerId),this.styles=i(),this._props={},this._videoEl=null,this._ccEl=null,this._pageStyles={},this._configStyles=null,this._inlineStyles=null,this._captionsJson=null,this._liveCaptionsInitalized=!1,this.hasDispatchedCaptionsReady=!1,this._lineOffset=t.getCaptionsLineOffset(),this._lineAlign=t.getCaptionsCenterAlignToken(),this._captionsUrl=null,this._deferLoadingCaptions=e.deferLoadingCaptions,this._trackCount=0,this._trackId=null,this._disabled=!1,this.subtitleLanguage="en",this.subtitleMasterList=null,this.ccDisplayRequested=!1,this.isAndroidOnHlsjs=uvpjs.mediaCapabilities.canPlayHlsjsAndriod(this._cviModel.getModuleParam("VideoPlaybackSettings","forceHlsjs")),this._onAddTrack=this._onAddTrack.bind(this),this._onLoadedData=this._onLoadedData.bind(this),this._onTimeUpdate=this._onTimeUpdate.bind(this),this._finalizeInit=this._finalizeInit.bind(this),uvpjs.util.createStyleSheet(this._finalizeInit),this._setCDOParams(),this._addEventListeners())},destroy:function(){this.styles=null,this._cviModel=null,this._eventsMgr=null,this._videoEl=null,this._videoId=null,this._captionsId=null,this._ccEl=null,this._styleSelector=null,this._containerId=null,this._namespace=null,this._pageStyles=null,this._configStyles=null,this._inlineStyles=null,this._defaultStyles=null,this._captionsJson=null,this._captionsUrl=null,this._props=null,this._supportsVTTCue=!1,this._liveCaptionsInitalized=!1,this._lineOffset=null,this._lineAlign=null,this._onLoadedData=null,this._trackCount=0,this._trackId=null,this._removeEventListeners()},_finalizeInit:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"_finalizeInit"),this._styleEl=e,this.isAndroidOnHlsjs||!this._ccEl&&this._createCaptionsElement()},showCaptions:function(e){if(this._deferLoadingCaptions&&!this._hasCaptions())return this._loadCaptionsUrl(this._captionsUrl),void this._eventsMgr.addEventListener(this._eventsMgr.eventTypes.CAPTIONS_READY+this._namespace,this.showCaptions.bind(this));this.setCaptionLanguage(e),this.ccDisplayRequested=!0,!this._getActiveTrack()&&uvpjs.mediaCapabilities.isIOS()&&this.enableCaptionsTracks(),this._eventsMgr.removeEventListener(this._eventsMgr.eventTypes.CAPTIONS_READY+this._namespace),this._toggleVisibility(e,"showing")},setCaptionLanguage:function(e){var t=e.payload.language;if(uvpjs.util.isDefinedString(t)){var i=this._getActiveTrack();i&&i.language===this.subtitleLanguage&&this.subtitleLanguage!==t&&this._clearCaptionTrack(i),this._ccEl&&(this._ccEl.innerHTML=""),this.subtitleLanguage=t}},getCaptionInfo:function(){for(var e=[],t=this.subtitleMasterList||this._getTextTracks(),i=this._getActiveTrack(),s=0;s<t.length;s++){var n=t[s];enabled=i&&i.language===n.language||!1,e.push({language:n.language,label:n.label,kind:n.kind,enabled:enabled})}return this.subtitleMasterList=e,this.subtitleMasterList},hideCaptions:function(e){this.ccDisplayRequested=!1,this._toggleVisibility(e,"hidden")},getStyles:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getCaptionsStyle"),this._disabled?{}:v.clone(this.styles)},setStyles:function(e){var t,i,s,n=this._pageStyles,a=e.length;if(!this._disabled){for(this.debug&&uvpjs.log(this.DEBUG_ID,"setStyles",e);a--;)s=e[a],t=p(s.name),i=s.value,n[t]=i;this._updateStylesObject(n),this._applyStyles(),this._setPosition(n["text-position"]||null)}},setCueProperty:function(e,t){var i;this._disabled||(i=this._getActiveTrack(),e&&t&&i&&this._supportsVTTCue?(this.debug&&uvpjs.log(this.DEBUG_ID,"setCueProperty",i,e,t),this._props[e]=isNaN(t)?t:Number(t)):this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to set captions cue property:",e,t))},_addEventListeners:function(){var e=this._eventsMgr,t=e.eventTypes,i=this._namespace,s=this._cviModel.contentVideoState.isLive;this.debug&&uvpjs.log(this.DEBUG_ID,"_addEventListeners",s),e.addEventListener(t.CONTAINER_RESIZE+i,this._onContainerResize.bind(this)),e.addEventListener(t.CONTROL_LOAD_CAPTIONS+i,this._onControlLoadCaptions.bind(this)),e.addEventListener(t.CONTENT_DATA_LOADED+i,this._onContentDataLoaded.bind(this)),e.addEventListener(t.CONTROL_SHOW_CAPTIONS+i,this.showCaptions.bind(this)),e.addEventListener(t.CONTROL_HIDE_CAPTIONS+i,this.hideCaptions.bind(this)),e.addEventListener(t.SET_CAPTIONS_LANG+i,this.setCaptionLanguage.bind(this)),e.addEventListener(t.CONTENT_FACADE_CREATED+i,this._onContentFacadeCreated.bind(this)),e.addEventListener(t.RESOURCE_END+i,this._onVideoComplete.bind(this)),e.addEventListener(t.VIDEO_PROGRESS+i,this._onVideoProgress.bind(this))},_removeEventListeners:function(){var e=this._eventsMgr,t=e.eventTypes,i=this._namespace;this._cviModel.contentVideoState.isLive;this.debug&&uvpjs.log(this.DEBUG_ID,"_removeEventListeners"),e.removeEventListener(t.CONTAINER_RESIZE+i),e.removeEventListener(t.CONTROL_LOAD_CAPTIONS+i),e.removeEventListener(t.CONTENT_DATA_LOADED+i),e.removeEventListener(t.CONTROL_SHOW_CAPTIONS+i),e.removeEventListener(t.CONTROL_HIDE_CAPTIONS+i),e.removeEventListener(t.SET_CAPTIONS_LANG+i),e.removeEventListener(t.CONTENT_FACADE_CREATED+i),e.removeEventListener(t.RESOURCE_END+i),e.removeEventListener(t.VIDEO_PROGRESS+i)},_createTrackElement:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"_createTrackElement",e);var t=document.createElement("track");t.default=!0,t.kind="captions",t.label="English",t.srclang="en",t.id=this._trackId,t.src=e,this._videoEl.appendChild(t)},_createCaptionsElement:function(){var e=uvpjs.util,t=this._styleEl,i=document.createElement("div"),s=document.getElementById(uvpjs.domConstants.CONTENT_ID_PREFIX+this._containerId);i.id=this._captionsId,this.debug&&uvpjs.log(this.DEBUG_ID,"_createCaptionsElement"),s?(s.appendChild(i),this._ccEl=i,e.addCSSObject(t,i,{width:"100%",height:"100%",position:"absolute",top:0,bottom:0,left:0,right:0,display:"none","font-size":this.BASE_FONT_SIZE}),e.addCSSObject(t,i,{position:"absolute",top:"auto",bottom:this.BASE_CONTROLS_HEIGHT,left:0,right:0,"text-align":"center","font-size":"100%"},"."+this.CAPTIONS_CONTAINER_CLASSNAME),e.addCSSObject(t,i,{display:"inline-block",padding:"3px 5px","font-size":"100%"},"."+this.CAPTIONS_TEXT_CLASSNAME)):this.debug&&uvpjs.warn(this.DEBUG_ID,"Can't create captions container. No video content container.")},_dispatchCaptionsError:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"_dispatchCaptionsError",e),this._eventsMgr.dispatchEvent(this._eventsMgr.eventTypes.CAPTIONS_ERROR,{msg:e},this._containerId)},_dispatchCaptionsReady:function(){this.hasDispatchedCaptionsReady||(this.debug&&uvpjs.log(this.DEBUG_ID,"_dispatchCaptionsReady"),this.hasDispatchedCaptionsReady=!0,this.adjustVttCuesLinePosition(),this._eventsMgr.dispatchEvent(this._eventsMgr.eventTypes.CAPTIONS_READY,{},this._containerId))},_dispatchCaptionsUnavailable:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_dispatchCaptionsUnavailable"),this._eventsMgr.dispatchEvent(this._eventsMgr.eventTypes.CAPTIONS_UNAVAILABLE,{},this._containerId)},_onContainerResize:function(e){e.target===this._containerId&&this._setRect()},_onVideoComplete:function(e){var t,i,s=e.target,n=this._videoEl;s===this._containerId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_onVideoComplete",s),this._clearAllCaptionTracks(),this._captionsUrl=null,this._captionsJson=null,this._liveCaptionsInitalized=!1,this.hasDispatchedCaptionsReady=!1,n&&n.removeEventListener("loadeddata",this._onLoadedData),n&&n.removeEventListener("timeupdate",this._onTimeUpdate),(i=this._getTextTracks())&&(i.onaddtrack=null),(t=this._getActiveTrack())instanceof window.TextTrack&&o(t)&&(t.mode="disabled",t.oncuechange=null),this._trackCount++)},_onContentDataLoaded:function(e){var t,i=uvpjs.util,s=e.target,n=e.payload.vidState,a=n.closedCaptionPath;n.isLive;s===this._containerId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_onContentDataLoaded",s),this._videoEl=document.getElementById(this._videoId),this._videoEl.addEventListener("loadeddata",this._onLoadedData),this._trackId="track_"+this._trackCount,(t=this._getTextTracks())&&(t.onaddtrack=this._onAddTrack),this._styleSelector=this._getStyleSelector(),i.isDefinedString(a)&&(this._captionsUrl=a))},_onLoadedData:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"_onLoadedData",e),this._checkForLiveCaptions()},_onTimeUpdate:function(e){!this.hasDispatchedCaptionsReady&&this._getActiveTrack()&&this._dispatchCaptionsReady(),this._setActiveCueProps(e)},_onControlLoadCaptions:function(e){var t;e.target===this._containerId&&(t=e.payload.url,v.isString(t)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_onControlLoadCaptions",e.target),this._loadCaptionsUrl(t)))},_onContentFacadeCreated:function(e){e.target===this._containerId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_onContentFacadeCreated",e.target),this._cviModel.contentVideoState.isFlash?(this._disabled=!0,this._removeEventListeners(),this._dispatchCaptionsReady()):(this._disabled=!1,this._loadOrDeferCaptions(this._captionsUrl)))},_onLoadComplete:function(e){var t=e.responseText;this.debug&&uvpjs.log(this.DEBUG_ID,"_onLoadComplete xhr",e);try{t=(t=t.replace(/\n/g,"")).substr(t.indexOf("<?xml"));var i=(new DOMParser).parseFromString(t,"text/xml");this._xmlToCues(i)}catch(e){var s="Error parsing closed captions XML.";this._dispatchCaptionsError(s),this.debug&&uvpjs.error(this.DEBUG_ID,s,e)}},_onLoadError:function(e){var t=e.status,i="Unknown error";switch(t){case 404:i="File not found";break;case 500:i="Server error";break;case 0:i="Request aborted"}i+=" "+t,this._dispatchCaptionsError(i),this.debug&&uvpjs.error(this.DEBUG_ID,"onLoadError",i)},_onAddTrack:function(e){var t=e.track;t.id=this._trackId,this.useNativeBrowserControls||this._syncCCTrackMode(t,!1),o(t)&&(this._finalizeTrackElement(),this._finalizeLiveCaptions()),this.debug&&uvpjs.log(this.DEBUG_ID,"_onAddTrack",e)},_syncCCTrackMode:function(e,t){e&&(t?e.mode="disabled":this.useNativeBrowserControls||uvpjs.mediaCapabilities.isIOS()?this._cviModel.isFullscreen&&(e.mode="showing"):"hidden"!==e.mode&&(e.mode="hidden"))},_onVideoProgress:function(e){var t;if(e.target===this._containerId){var i=this._getActiveTrack();if(this.isAndroidOnHlsjs||this._syncCCTrackMode(i,!1),this._hasCaptions())if(this._liveCaptionsInitalized)if(i&&i.activeCues&&(t=i.activeCues.length))for(this.ccDisplayRequested&&this.showCcContainer(!0);t--;)e.payload.currentTime-i.activeCues[t].endTime>1&&this.showCcContainer(!1);else this.showCcContainer(!1);else this._checkForLiveCaptions();else this._liveCaptionsInitalized&&(this._dispatchCaptionsUnavailable(),this._liveCaptionsInitalized=!1)}},_finalizeLiveCaptions:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_finalizeLiveCaptions."),this._finalizeCaptions(!0)},_finalizeCaptions:function(e){if(this.debug&&uvpjs.log(this.DEBUG_ID,"_finalizeCaptions"),this._setRect(),!e||!this._liveCaptionsInitalized){try{!e&&this._applyCueStyles(),this._finalizeStyles(),this._applyStyles(),this._checkBottomPosition()}catch(e){this.debug&&uvpjs.error(this.DEBUG_ID,"Error applying cue styling.",e),this._dispatchCaptionsError(e)}e&&(this._liveCaptionsInitalized=!0),this._getActiveTrack()&&this._dispatchCaptionsReady()}},_finalizeTrackElement:function(){var e=this._getActiveTrack(),t=this._onTimeUpdate;this.debug&&uvpjs.log(this.DEBUG_ID,"_finalizeTrackElement"),e&&(e.oncuechange=t)||this._videoEl.addEventListener("timeupdate",t)},_finalizeStyles:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_finalizeStyles"),this._updateStylesObject(this._configStyles),this._updateStylesObject(this._pageStyles),this._applyStyles()},_applyCueStyles:function(){var e=v.get(this._captionsJson,"tt.head.styling.style");e=v.isArray(e)?e[0]:e,this.debug&&uvpjs.log(this.DEBUG_ID,"_applyCueStyles style",e),e?this._inlineStyles={backgroundColor:e["tts:backgroundColor"],color:e["tts:color"],fontFamily:e["tts:fontFamily"],fontSize:e["tts:fontSize"],fontStyle:e["tts:fontStyle"],fontWeight:e["tts:fontWeight"],textAlign:e["tts:textAlign"],textDecoration:e["tts:textDecoration"]}:this.debug&&uvpjs.log(this.DEBUG_ID,"No styling found in XML file.")},_applyStyles:function(){var e,i,s,n=uvpjs.util,a=this.styles,r=this._styleSelector,o=[];for(i in this.debug&&uvpjs.log(this.DEBUG_ID,"_applyStyles styles",a),a){switch(s=a[i],e=!1,i){case"background-opacity":case"font-opacity":e=!0;break;case"text-position":e=!0,this._setPosition(s);break;case"background-color":s=t(s,a["background-opacity"]);break;case"color":case"font-color":i="color",s=t(s,a["font-opacity"]);break;case"text-edge-style":i="text-shadow",s=g(s)}e||(l(i,s)?o.push({name:i,value:s}):this.debug&&uvpjs.warn(this.DEBUG_ID,"Invalid CSS.",i,s))}this.debug&&uvpjs.log(this.DEBUG_ID,"_applyStyles selector, rules",r,o),n.addCSSRules(this._styleEl,r,o)},_updateStylesObject:function(e){var t,i,n;for(t in e){if(!(i=e[t])||!t)return;if((n=p(t))in this.styles){switch(n){case"font-size":i=s(i)}this.styles[n]=i}else this.debug&&uvpjs.warn(this.DEBUG_ID,"Unsupported captions style property.",n)}},_hasCaptions:function(){return o(this._getActiveTrack())},_loadOrDeferCaptions:function(e){this._deferLoadingCaptions?this._dispatchCaptionsReady():this._loadCaptionsUrl(e)},_loadCaptionsUrl:function(e){var t=uvpjs.util.isDefinedString(e),i=t&&-1!==e.indexOf(".vtt");t&&!this._cviModel.contentVideoState.isFlash&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_loadCaptionsUrl"),this._videoEl=document.getElementById(this._videoId),i?this._createTrackElement(e):(new uvpjs.CodeLoader).loadXHR(e,this._onLoadComplete.bind(this),this._onLoadError.bind(this)))},_checkForLiveCaptions:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_checkForLiveCaptions"),this._hasCaptions()?(this._finalizeTrackElement(),this._finalizeLiveCaptions()):this.debug&&uvpjs.log(this.DEBUG_ID,"No captions track to finalize.")},_clearAllCaptionTracks:function(){var e=this._getTextTracks(),t=e&&e.length||0;for(this.debug&&uvpjs.log(this.DEBUG_ID,"_clearAllCaptionTracks",e);t--;)this._clearCaptionTrack(e[t]);this._ccEl&&(this._ccEl.innerHTML="")},_clearCaptionTrack:function(e){var t,i;if(o(e)){for(this.debug&&uvpjs.log(this.DEBUG_ID,"_clearCaptionTrack",e),i=(t=e&&e.cues)&&t.length||0;i--;)e.removeCue(t[i]);this._syncCCTrackMode(e,!0),e.cues=null}},_toggleVisibility:function(e,t){e.target===this._containerId&&this._hasCaptions()&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_toggleVisibility",t),this.showCcContainer("hidden"!==t))},showCcContainer:function(e){this.isAndroidOnHlsjs?this._getActiveTrack().mode=e?"showing":"hidden":this._ccEl&&(this._ccEl.style.display=!1===e?"none":"block")},_getTextTracks:function(){return this._videoEl&&this._videoEl.textTracks},_getActiveTrack:function(){var e,t,i,s=this._getTextTracks(),n=s&&s.length||0;for(i=0;i<n;i++)if((t=(e=s[i])&&e.cues)&&t.length&&o(e))return e},enableCaptionsTracks:function(){for(var e,t=this._getTextTracks(),i=t&&t.length||0;i--;)e=t[i],o(e)&&(e.mode="hidden")},_getTrackById:function(e){var t=this._getTextTracks();return t&&t.getTrackById(e||this._trackId)},_getActiveCues:function(){var e=this._getActiveTrack();return e&&e.activeCues},_getAllCues:function(){var e=this._getActiveTrack();return e&&e.cues},_getStyleSelector:function(){return"#"+this._captionsId+" ."+this.CAPTIONS_TEXT_CLASSNAME},_setCDOParams:function(){var e,t,i=this._cviModel.getModule(this.CONFIG_MODULE_NAME),s={};this.debug&&uvpjs.log(this.DEBUG_ID,"_setCDOParams module",i),i?!0===i.enabled?v.isEmpty(i.params)?this.debug&&uvpjs.log(this.DEBUG_ID,"_setCDOParams Config module params array empty."):(v.each(i.params,function(i){e=i.name,t=i.value,e&&t&&(p(e),s[e]=t)}),this.debug&&uvpjs.log(this.DEBUG_ID,"Config module styles. "+JSON.stringify(s,null,2)),this._configStyles=s):this.debug&&uvpjs.log(this.DEBUG_ID,"_setCDOParams Config module not enabled."):this.debug&&uvpjs.log(this.DEBUG_ID,"_setCDOParams No config module found.")},_setPosition:function(e){var t=["top-left","top-center","top-right","middle-left","middle-center","middle-right","bottom-left","bottom-center","bottom-right","bottom-left-floated","bottom-center-floated","bottom-right-floated"].indexOf(e)>-1?e:"bottom-center-floated";this._setPositionCSS(t)},_setPositionCSS:function(e){var t,i,s,n,a,r,o=uvpjs.util,l=this._styleEl,d=this._ccEl,u=d&&d.style.marginBottom,c=parseInt(this.BASE_CONTROLS_HEIGHT);l&&d&&(n=(i=e.split("-"))[0],s=i[1],a="inherit"===u?0:parseInt(u),r=isNaN(a)?c+"px":(a>c?10:c-a)+"px",t={top:{top:"10px",middle:"50%",bottom:"auto"}[n],bottom:{top:"auto",middle:"auto",bottom:r}[n],"text-align":s,transform:"initial"},"middle"===n&&(t.transform="translateY(-50%)"),o.addCSSObject(l,d,t,"."+this.CAPTIONS_CONTAINER_CLASSNAME))},_checkBottomPosition:function(){var e=this.styles;e&&this._setPosition(e["text-position"])},_setRect:function(){var e,t,i,s,n,a,r,o,l,d,u,c=this._videoEl,h=this._ccEl,p=c&&c.parentNode;function g(){v.assign(c.style,a),h&&(v.assign(h.style,a),this._checkBottomPosition())}c&&p&&(s=c.videoHeight,(n=c.videoWidth)&&s&&(t=c.getBoundingClientRect(),e=p.getBoundingClientRect(),i=t.height/t.width/(s/n),l=e.height-t.height,o=e.width-t.width,u=i<1||0!==o&&0===l,(a=(d=i>1||0===o&&0!==l)?{height:"auto","max-height":"100%",width:"100%",margin:0}:u?{height:"100%","max-width":"100%",width:"auto",margin:0}:{height:"100%",width:"100%",margin:0})&&g.call(this),t=c.getBoundingClientRect(),l=(e=p.getBoundingClientRect()).height-t.height,o=e.width-t.width,d?a={margin:"inherit","margin-top":r=l/2+"px","margin-bottom":r}:u&&(a={margin:"inherit","margin-left":r=o/2+"px","margin-right":r}),h&&(a["font-size"]=this._calculateFontSize(t.width)),a&&g.call(this)))},_calculateFontSize:function(e){var t;try{t=e/parseInt(this.BASE_VIDEO_WIDTH)*parseInt(this.BASE_FONT_SIZE),t=Math.max(t,parseInt(this.MIN_FONT_SIZE))}catch(e){console.error(e)}return t&&t+"px"||this.BASE_FONT_SIZE},_setActiveCueProps:function(e){var t=e&&e.target,i=t&&t.activeCues||this._getActiveCues();this._setCueProps(i)},adjustVttCuesLinePosition:function(){if(this.isAndroidOnHlsjs){var e=this._getAllCues();if(e&&e.length>0){this._syncCCTrackMode(this._getActiveTrack(),!1);for(var t=0;t<e.length;t++){var i=e[t];!i||"auto"!==i.line&&-1!==i.line&&-2!==i.line||(i.line=-3)}}}},_setCueProps:function(e){this._addCuesToCaptionsElement(e)},_xmlToCues:function(e){var t,i,s,r,o,l,d,c,h,p,g,m=f(e);if(this._captionsJson=m,this.debug&&uvpjs.log(this.DEBUG_ID,"_xmlToCues json =",m),!v.isEmpty(m)&&v.isPlainObject(m))if(i=v.get(m,"tt.body.div.p"),this.debug&&uvpjs.log(this.DEBUG_ID,"_xmlToCues cues",i),v.isUndefined(i)||v.isEmpty(i))this.debug&&uvpjs.warn(this.DEBUG_ID,"No cues found in XML file.");else if(t=this._supportsVTTCue?window.VTTCue:window.TextTrackCue){for((o=this._videoEl.addTextTrack("captions","English","en")).id=this._trackId,p=i.length,c=0;c<p;c++)if(h=c+1,d=i[c],r=i[h],l=d.text,!v.isEmpty(l)){for(l=(l=(l=l.replace(/(.*)<span.*tts:fontStyle="italic">(.*)<\/span>(.*)/g,"$1<i>$2</i>$3")).replace(/(.*)<span.*tts:fontWeight="bold">(.*)<\/span>(.*)/g,"$1<b>$2</b>$3")).replace(/(.*)<span.*tts:textDecoration="under">(.*)<\/span>(.*)/g,"$1<u>$2</u>$3"),g=n(l),d._lineCountPrev=d._lineCountPrev||0,d._lineCountNext=d._lineCountNext||0;(r&&r.begin)===d.begin;)r._lineCountPrev=g+d._lineCountNext,d._lineCountNext+=n(r.text),r=i[++h];(s=new t(a(d.begin),a(d.end),l))._lineCount=g,s._lineCountPrev=d._lineCountPrev,s._lineCountNext=d._lineCountNext,s._metadata=d.metadata,s=u.call(this,s),o.addCue(s)}this._finalizeCaptions()}else this.debug&&uvpjs.error(this.DEBUG_ID,"Browser does not support dynamic captions.")},_addCuesToCaptionsElement:function(e){var t,i,s=uvpjs.util,n=this._ccEl,a='<div class="{{cntrClass}}">{{spans}}</div>',r="",o=e&&e.length;if(o){for(t=0;t<o;t++)i=e[t].text,s.isDefinedString(i)&&(r+='<span class="{{txtClass}}">'+(i=i.replace(/(\r\n|\n|\r)/g,"<br/>"))+"</span>",t+1!==o&&(r+="<br/>"));a=(a=(a=a.replace("{{spans}}",r)).replace("{{cntrClass}}",this.CAPTIONS_CONTAINER_CLASSNAME)).replace(/{{txtClass}}/g,this.CAPTIONS_TEXT_CLASSNAME),n&&(n.innerHTML=a)}}}),t=function(e,t){var i=c(e)||r(e)||r(d(e));return i&&t?h(i.r,i.g,i.b,t):e},i=function(){return{"background-opacity":"1","background-color":"#000000","font-color":"#FFFFFF","font-family":"Arial, sans-serif","font-opacity":"1","font-size":"100%","font-weight":"normal","line-height":"1","text-position":"default","text-decoration":"none","text-edge-style":"none"}},s=function(e){var t="100%";return e.indexOf("px")>-1?(t=e.replace("px",""),t=100*(t/=18)+"%"):e.indexOf("%")>-1&&(t=e),t},n=function(e){return e&&(e.match(/\n/g)||[]).length+1},a=function(e){var t,i;if(!v.isNull(e)&&!v.isUndefined(e))return i=function(e,t){return Math.round(e*Math.pow(10,t))/Math.pow(10,t)},t=e.split(":"),i(60*Number(t[0])*60+60*Number(t[1])+Number(t[2]),2)},r=function(e){e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(e,t,i,s){return t+t+i+i+s+s});var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null},o=function(e){return e instanceof window.TextTrack&&("captions"===e.kind||"subtitles"===e.kind)},l=function(e,t){if(e&&t)return v.get(window,"CSS.supports")?window.CSS.supports(e,t):"string"==typeof document.createElement("div").style[e]},u=function(e){var t,i=e._metadata;if(i){e.snapToLines=!0,t=Math.round(i.cccol/35*100),e.position=t;try{e.align=t<45?"start":t>55?"end":this._lineAlign}catch(t){e.align="center"}e.positionAlign=t<45?"line-left":t>55?"line-right":"center",e.line=i.ccrow-17+this._lineOffset,e._defaults={line:e.line,position:e.position,align:e.align,positionAlign:e.positionAlign}}return e},d=function(e){return{white:"#ffffff",yellow:"#ffff00",green:"#008000",cyan:"#00ffff",blue:"#0000ff",magenta:"#ff00ff",red:"#ff0000",black:"#000000"}[e.toLowerCase()]},c=function(e){var t;if(-1!==e.indexOf("rgba"))return{r:(t=e.substr(5,e.length).split(","))[0],g:t[1],b:t[2]}},p=function(e){if(v.isString(e)&&!v.isEmpty(e))return e.replace(/([A-Z])/g,"-$1").toLowerCase()},h=function(e,t,i,s){return"rgba("+[e,t,i,s].join(",")+")"},g=function(e){return{"drop-shadow":"2px 2px 3px #000",outline:"-1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000",raised:"-1px -1px 1px #FFF, 1px 1px 1px #000"}[e]||"none"},f=function(e){var t={};if(1===e.nodeType&&e.attributes.length>0)for(var i=0,s=e.attributes.length;i<s;i++){var n=e.attributes.item(i);t[n.nodeName]=n.nodeValue}else 3===e.nodeType&&(t=e.nodeValue);if("p"===e.nodeName&&(t.text="",v.each(e.childNodes,function(e){if("metadata"!==e.nodeName){var i=(new XMLSerializer).serializeToString(e);1===e.nodeType&&(t.text+="br"===e.tagName?"\n":i),3===e.nodeType&&(t.text+=i)}})),e.hasChildNodes())for(var a=0,r=e.childNodes.length;a<r;a++){var o=e.childNodes.item(a),l=o.nodeName;if(void 0!==t[l]){if(void 0===t[l].push){var d=t[l];t[l]=[],t[l].push(d)}t[l].push(f(o))}else t[l]=f(o)}return t}}(uvpjs.register("uvpjs")),function(e){"use strict";var t=e._;e.ConfigDataObject=uvpjs.Class.subClass({debug:!0,adCallParams:{standardParams:null,customParams:null},sessionOptions:{adBlockerCallback:null,cms:"",id3OwnerIds:null,ftag:"",mapp:"",netwk:"",partner:"",uvpc:"",ursuid:"",usesIMA:!1,usesTealium:!1,skin:!0,useBrowserControls:!1,enableDiagnosticWindow:!0,enableUnmutedAutoplay:!1,enableMutedAutoplay:!1,customCSS:null,enableReplay:!1,previewImage:null,themeName:"default",controls:null,template:null,allowConcurrentPlayback:!1,browserVer:"",contsess:"",deviceCPU:"",deviceScreenSize:"",deviceType:"",deviceVers:"",host:"",mso:"",pageUrl:"",playerCoords:"",playerId:"",playerVersion:"",playsInline:!1,preloadContent:!1,preventFlashPlayback:!1,referrer:"",resumeBeaconInterval:10,sessionId:"",useDynamicSwitching:!0,enableNativeMobileAutoplay:!1,userCountry:"",userISP:"",userId:"",userPPID:"",userStatus:"",isEmbedded:!1,deferLoadingCaptions:!1,capLevelToPlayerSize:null,enableDashJSFastSwitchABR:null,trackingConfigOverrides:null,userConnectionType:"unknown",minBitrate:-1,maxBitrate:-1,startBitrate:-1,liveSyncDurationCount:-1,errorRecovery:null},init:function(e){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.CONFIG_MANAGER,this.modules=[],this.classes=[],window.top!==window.self&&(this.sessionOptions.isEmbedded=!0,this.sessionOptions.referrer=document.referrer),this.initialize(e)},initialize:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"ConfigDataObject initialize options = ",e),this.overrideSessionOptions(e)},destroy:function(){this.modules=null,this.classes=null},getAdCallParams:function(){return this.adCallParams},setAdCallParams:function(e){var t;if(!uvpjs.util.isEmpty(e.standardParams)&&null===this.adCallParams.standardParams)for(t in this.adCallParams.standardParams={},e.standardParams)this.adCallParams.standardParams[t]=e.standardParams[t];if(!uvpjs.util.isEmpty(e.customParams)&&null===this.adCallParams.customParams)for(t in this.adCallParams.customParams={},e.customParams)this.adCallParams.customParams[t]=e.customParams[t]},overrideSessionOptions:function(e){var i=this.getSessionOptions(e);i&&t.isPlainObject(i)?this.sessionOptions=i:this.debug&&uvpjs.warn(this.DEBUG_ID,"ConfigDataObject overrideSessionOptions options undefined or not the correct type.")},getSessionOption:function(e){return this.sessionOptions[e]||null},getSessionOptions:function(e){var i,s,n;if(i=t.clone(this.sessionOptions),!e||!t.isPlainObject(e))return i;if((s=e.skinConfig)&&!t.isEmpty(s))for(n in uvpjs.warn(this.DEBUG_ID,"DEPRECATION NOTICE: The `skinConfig` session option parameter no longer exists. Please relocate the properties to the `sessionOption` object."),s)i.hasOwnProperty(n)&&(i[n]=s[n]);for(n in i)e.hasOwnProperty(n)&&(i[n]=e[n]);return i},getModule:function(e){return s(this.modules,e)},getModules:function(){return this.modules},getModuleParam:function(e,t){var i=s(this.modules,e),n=s(i.params,t);if(n&&n.hasOwnProperty("value"))return n.value},setModule:function(e){r(this.modules,e,"name",this.DEBUG_ID)},isModuleEnabled:function(e){var t=this.getModule(e);if(!t){var i="ConfigDataObject isModuleEnabled module not found: "+e;return this.debug&&uvpjs.log(this.DEBUG_ID,i),!1}return this.debug&&uvpjs.log(this.DEBUG_ID,"ConfigDataObject isModuleEnabled "+e+":",t.enabled),t.enabled},isModuleSet:function(e){return!!this.getModule(e)},getClass:function(e){return s(this.classes,e)},getClasses:function(){return this.classes},getClassProperty:function(e,t){var i=s(this.classes,e),n=a.call(this,i,"properties",this.DEBUG_ID),r=s(n,t);return a.call(this,r,"value",this.DEBUG_ID)},getClassListItems:function(e){var t=s(this.classes,e);return a.call(this,t,"list",this.DEBUG_ID)},getClassListItemProperty:function(e,t,i){var r=this.getClassListItems(e),o=n(r,t),l=a.call(this,o,"properties",this.DEBUG_ID),d=s(l,i);return a.call(this,d,"value",this.DEBUG_ID)},setClass:function(e){r(this.classes,e,"name",this.DEBUG_ID)},isCAN:function(){return t.isString(this.sessionOptions.netwk)&&"can"==this.sessionOptions.netwk.toLowerCase()},copyModules:function(e){for(var t=e.length;t--;)for(var i=e[t],s=this.modules.length;s--;){if(this.modules[s].name===i.name){this.modules[s]=i;break}}}});var i=function(e,t,i){for(var s in e)if(e[s][t]==i)return e[s];return!1},s=function(e,t){return i(e,"name",t)},n=function(e,t){return i(e,"id",t)},a=function(e,t,i){return e?e.hasOwnProperty(t)?e[t]:(this.debug&&uvpjs.warn(i,"ConfigDataObject findItemProperty no item property:",e,t),!1):(this.debug&&uvpjs.warn(i,"ConfigDataObject findItemProperty item not found:",e),!1)},r=function(e,t,i,s){for(var n in e)if(e[n][i]==t[i])return this.debug&&uvpjs.log(s,"ConfigDataObject _addItemToArray updating existing item",t),void(e[n]=t);this.debug&&uvpjs.log(s,"ConfigDataObject _addItemToArray creating item",t),e.push(t)}}(uvpjs.register("uvpjs")),function(e){var t=e._,i=Math.random();e.ConfigManager=uvpjs.Class.subClass({init:function(e,t,s){this.debug=uvpjs.debug,e&&e===i?(this.initCallback=s,this.DEBUG_ID=uvpjs.DebugManager.configParams.CONFIG_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"init sessionOptions =",t),this.CDO=new uvpjs.ConfigDataObject(t),this.debug&&uvpjs.log(this.DEBUG_ID,"init CDO =",this.CDO),this.configSources=[],this.configSources.push(this.CDO.sessionOptions.uvpc),this.debug&&uvpjs.log(this.DEBUG_ID,"init configSources =",this.configSources),this.loadConfig()):this.debug&&uvpjs.error(this.DEBUG_ID,"ERROR: ","ConfigManager is a Singleton; obtain instance via ConfigManager.getInstance().")},initialize:function(){},destroy:function(){this.initCallback=null,this.CDO.destroy(),this.CDO=null,uvpjs.ConfigManager.destroyInstance()},loadConfig:function(){if(this.configSources.length){var e=this.configSources.shift();if(null!=e)switch(e.constructor){case String:if(""===e)break;return void(new uvpjs.CodeLoader).loadXHR(e,this.onLoadComplete.bind(this),this.onLoadError.bind(this));case Array:this.configSources=e.concat(this.configSources);break;case Object:this.updateCDO(e)}this.loadConfig()}else t.isFunction(this.initCallback)&&this.initCallback(this.CDO)},onLoadComplete:function(e){var t,i,s=e.responseText,n=e.getResponseHeader("Content-Type");n.indexOf("application/json")>-1?i=JSON.parse(s):n.indexOf("text/xml")>-1||n.indexOf("application/xml")>-1?(t=(new DOMParser).parseFromString(s,"text/xml"),i=this.xmlToCDO(t)):this.debug&&uvpjs.error(this.DEBUG_ID,"Unknwon content-type.",n),i&&this.updateCDO(i),this.loadConfig()},onLoadError:function(e){var t="unknown error";switch(e.status){case 0:t="request timeout"}this.debug&&uvpjs.error(this.DEBUG_ID,"onLoadError error =",t,e),this.loadConfig()},updateCDO:function(e){t.isEmpty(e)?this.debug&&uvpjs.warn(this.DEBUG_ID,"updateCDO newObj is empty"):["classes","modules"].map(function(t){e.hasOwnProperty(t)&&(this.CDO[t]=s(this.CDO[t],e[t]))},this)},xmlToCDO:function(e){var t={},i=function(e){return"y"===e},s=n(e);return s.hasOwnProperty("player-config")&&(s=s["player-config"]),t.modules=function(){var e,t=[];if(s.modules){for(var n in e=a(s.modules.module)){var r=e[n],o={name:r.name,category:r.category,enabled:i(r.enabled),params:[]};if(e[n].hasOwnProperty("params")){var l=a(r.params.param);for(var d in l){var u=l[d];u.name&&(("y"===(c=u.value)||"n"===c)&&(u.value=i(u.value)),o.params.push(u))}}r.category;t.push(o)}var c;return t}}(),t.classes=function(){var e=a(s.classes),t=[];for(var i in e){var n=e[i];if(n.hasOwnProperty("classDef")&&(n=n.classDef),n.name){var r={name:n.name,className:n.className,properties:[],list:[]};if(n.hasOwnProperty("list")){var o=a(n.list.listitem);for(var l in o){var d=o[l];d.id&&(d.hasOwnProperty("properties")&&(d.properties=d.properties.property),r.list.push(d))}}n.hasOwnProperty("properties")&&(r.properties=n.properties.property),t.push(r)}}return t}(),t},getCDO:function(){return this.CDO}}),e.ConfigManager._instance=null,e.ConfigManager.destroyInstance=function(){this._instance=null},e.ConfigManager.getInstance=function(e,t){return this._instance||(this._instance=new uvpjs.ConfigManager(i,e,t)),this._instance};var s=function(e,t){for(var i in t){var s=!1;for(var n in e)if(e[n].name===t[i].name){s=!0;break}s||e.push(t[i])}return e},n=function(e){var t,i={};if(1===e.nodeType&&e.attributes.length>0){t=e.attributes.length;for(var s=0;s<t;s++){var a=e.attributes.item(s);i[a.nodeName]=a.nodeValue}}if(e.hasChildNodes()){t=e.childNodes.length;for(var r=0;r<t;r++){var o=e.childNodes.item(r),l=o.nodeName;if(3!==o.nodeType)if(void 0!==i[l]){if(void 0===i[l].push){var d=i[l];i[l]=[],i[l].push(d)}i[l].push(n(o))}else i[l]=n(o)}}return i},a=function(e){if(void 0!==e&&e.constructor!==String)return e.constructor===Object&&(e=[e]),e}}(uvpjs.register("uvpjs")),function(e){"use strict";var t=null,i=null,s=e._;e.VideoPlayerFacade=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.VIDEO_PLAYER_FACADE,WARNINGS:{ABR_NOT_SUPPORTED:"Adaptive Bitrate Streaming not supported.",FACADE_MUST_BE_INITIALIZED:"Facade must be initialized before you call this method",ABR_INDEX_OUT_OF_RANGE:"ABR Index is out of range",ARG_MUST_BE_BOOLEAN:"The argument must be (boolean) true or false",STARTING_BITRATE_BELOW_MIN_ALLOWED:"Unable to set start bitrate below minimum bitrate allowed threshold, upping to min threshold",STARTING_BITRATE_ABOVE_MAX_ALLOWED:"Unable to set start bitrate above maximun bitrate allowed threshold, lowering to max threshold"},MEDIA_TYPES:{VIDEO:"video",AUDIO:"audio",TEXT:"text"},eventTypes:{HTML5:{ABORT:"abort",CAN_PLAY:"canplay",CAN_PLAY_THROUGH:"canplaythrough",CLICK:"click",DURATION_CHANGE:"durationchange",ENDED:"ended",EMPTIED:"emptied",ERROR:"error",LOAD_START:"loadstart",LOADED_DATA:"loadeddata",LOADED_METADATA:"loadedmetadata",PAUSE:"pause",PLAY:"play",PLAYING:"playing",PROGRESS:"progress",RATE_CHANGE:"ratechanged",SEEKED:"seeked",SEEKING:"seeking",TIME_UPDATE:"timeupdate",VOL_CHANGE:"volumechange",STALLED:"stalled",SUSPEND:"suspend",TOUCH_END:"touchend",WAITING:"waiting",ADD_TRACK:"addtrack",CUE_CHANGE:"cuechange",WEBKIT_NEED_KEY:"webkitneedkey"},readyState:{HAVE_NOTHING:0,HAVE_METADATA:1,HAVE_CURRENT_DATA:2,HAVE_FUTURE_DATA:3,HAVE_ENOUGH_DATA:4},networkState:{NETWORK_EMPTY:0,NETWORK_IDLE:1,NETWORK_LOADING:2,NETWORK_NO_SOURCE:3},errors:{MEDIA_ERROR_ABORTED:1,MEDIA_ERROR_NETWORK:2,MEDIA_ERR_DECODE:3,MEDIA_ERR_SRC_NOT_SUPPORTED:4}},PREFIX_CONTENT:"content_",PREFIX_ADS:"ad_",CONTROLS:"controls",errors:{DATA_LOADING_ERROR_STATE:130},errorRecovery:{networkRetryAttempts:10,mediaRetryAttempts:3,MSG_NETWORK_ERROR:"fatal network error encountered - ",MSG_MEDIA_ERROR:"fatal media error encountered - ",MSG_TRYING_TO_RECOVER_PREFIX:"trying to recover",MSG_MAX_ATTEMPS_REACHED_PREFIX:"recovery attempts exceeded maximum : "},responseHeaders:{MULTI_CDN:"x-cdn"},CDN_GEO_BLOCKED_HTTP_STATUS_CODE:{AKAMAI:464},SOURCE:"source",OBJECT:"object",POSTER:"poster",VIDEO:"video",init:function(){this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"init"),this.playbackState=uvpjs.mediaCapabilities.EMPTY,this.videoTagRef=null,this.supportsTouchEvents=!1,this.resourceProvider={},this.vidContId="",this.vidContentId="",this.internalNS="",this.facadeState={},this.multiCDNEnabled=!0,this.hasPlaybackStarted=!1,this.isMobile=!1},initialize:function(e){var s=e.resourceProvider,n=s.vidContId;this.resourceProvider=s,this.eventsMgr=this.resourceProvider.eventsMgr,this.vidContId=n,this.assetURL=e.assetURL,this.vidContentId=this.PREFIX_CONTENT+n,this.internalNS="."+n+".facade",this.videoTagRef=document.getElementById(this.VIDEO+"_"+n),this.deferLoadingCaptions=e.deferLoadingCaptions,this._updateVolumeSettings(e),s.createWatermark()&&!e.suppressWatermark&&(t=new uvpjs.Watermark({containerId:n,eventsMgr:this.eventsMgr,videoEl:this.videoTagRef})),s.is360()&&!e.suppress360&&(i=new uvpjs.Kaleidoscope360({containerId:n,eventsMgr:this.eventsMgr,videoEl:this.videoTagRef})),!0!==e.suppressCreatedEvent&&this.dispatchCreated()},dispatchCreated:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTENT_FACADE_CREATED,{},this.vidContId)},destroy:function(){s.isEmpty(this.resourceProvider)?this.debug&&uvpjs.warn(this.DEBUG_ID,"VideoPlayerFacade cleanUp this.resourceProvider is empty; facade already destroyed."):(this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade cleanUp this.resourceProvider.rco.id = ",this.resourceProvider.rco.id),this.removeEvents(),t&&(t.destroy(),t=null),i&&(i.destroy(),i=null),this.resourceProvider=null,this.vidContId=null,this.videoTagRef=null,this.vidContId=null,this.vidContentId=null,this.internalNS=null,this.supportsTouchEvents=null,this.hasPlaybackStarted=!1)},_updateVolumeSettings:function(e){var t=(e=e||{}).volume,i=!0===e.isMuted,s=this.videoTagRef;this.debug&&uvpjs.log(this.DEBUG_ID,"_updateVolumeSettings",e),uvpjs.util.inRange(t,0,1)&&s.volume!==t&&(s.volume=t),"isMuted"in e&&s.muted!==i&&this.muteVideo(i)},_addHTML5Events:function(){var e,t=this.eventTypes.HTML5,i=this.supportsTouchEvents?"TOUCH_END":"CLICK";for(e in this.debug&&uvpjs.log(this.DEBUG_ID,"_addHTML5Events"),t)"CLICK"!==e&&"TOUCH_END"!==e&&this.videoTagRef.addEventListener(t[e],this,!1);this.videoTagRef.addEventListener(t[i],this,!1)},_removeHTML5Events:function(){var e,t=this.eventTypes.HTML5,i=this.supportsTouchEvents?"TOUCH_END":"CLICK";for(e in this.debug&&uvpjs.log(this.DEBUG_ID,"_removeHTML5Events"),t)"CLICK"!==e&&"TOUCH_END"!==e&&this.videoTagRef.removeEventListener(t[e],this,!1);this.videoTagRef.removeEventListener(t[i],this,!1)},handleEvent:function(e){var t=this.eventTypes.HTML5;if(this.videoTagRef)switch(e.type){case t.ABORT:break;case t.CAN_PLAY:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent CAN_PLAY"),this.videoTagRef.removeEventListener(t.CAN_PLAY,this,!1);break;case t.CAN_PLAY_THROUGH:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent CAN_PLAY_THROUGH"),this.videoTagRef.removeEventListener(t.CAN_PLAY_THROUGH,this,!1),uvpjs.mediaCapabilities.isIOS()&&(this.debug&&uvpjs.warn(this.DEBUG_ID,"VideoPlayerFacade handleEvent  CAN_PLAY_THROUGH iDevice CASE    CALL this.resourceProvider.facadeDisplayReady()"),this.resourceProvider.facadeDisplayReady());break;case t.CLICK:case t.DURATION_CHANGE:break;case t.EMPTIED:this.playbackStateChange(uvpjs.mediaCapabilities.EMPTY);break;case t.ENDED:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent ENDED"),this.videoDone();break;case t.ERROR:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent ERROR"),this.error(e.target.error);break;case t.LOAD_START:if(this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent LOAD_START"),s.isEmpty(this.resourceProvider))return void(this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade  handleEvent LOAD_START  this.resourceProvider === {}   RETURN !!!!!"));if(uvpjs.mediaCapabilities.isIOS())return void(this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade  handleEvent LOAD_START  uvpjs.mediaCapabilities.isIOS()  RETURN !!!!!"));break;case t.LOADED_METADATA:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent LOADED_METADATA"),uvpjs.mediaCapabilities.isIOS()||(this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade  handleEvent LOAD_START NON-iDEVICE CASE CALL this.resourceProvider.facadeDisplayReady()"),this.resourceProvider.facadeDisplayReady());break;case t.LOADED_DATA:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent LOADED_DATA");break;case t.PAUSE:this.debug&&uvpjs.log(this.DEBUG_ID,">>>>>>> playbackstate changed in fascade: PAUSE ENCOUNTERED"),this.getPlaybackState()===uvpjs.mediaCapabilities.PLAYING&&(this.debug&&uvpjs.log(this.DEBUG_ID,">>>>>>> playbackstate changed in fascade: PAUSE is new playback state, dispatch new state"),this.playbackStateChange(uvpjs.mediaCapabilities.PAUSED));break;case t.PLAY:break;case t.PLAYING:this.hasPlaybackStarted=!0,this.playbackStateChange(uvpjs.mediaCapabilities.PLAYING);break;case t.PROGRESS:this.videoLoading();break;case t.RATE_CHANGE:break;case t.SEEKING:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent SEEKING",e);break;case t.SEEKED:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent SEEKED",e),this.seeked(e.target.currentTime);break;case t.STALLED:case t.SUSPEND:break;case t.TIME_UPDATE:this.timeUpdated();break;case t.VOL_CHANGE:this.volumeChanged();break;case t.WAITING:}},seeked:function(e){var t=this.videoTagRef.paused,i=uvpjs.mediaCapabilities;this.playbackStateChange(t?i.PAUSED:i.PLAYING),this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade seeked "+JSON.stringify({currentTime:e,paused:t,playbackState:this.playbackState},null,2)),this.resourceProvider.facadeSeeked({seekToTime:e})},videoLoading:function(){var e;try{e=this.videoTagRef.buffered.end(0)||0}catch(t){e=0}var t={bufferLength:e,duration:this.videoTagRef.duration};this.resourceProvider.facadeLoading(t)},volumeChanged:function(){var e=this.videoTagRef.volume;!s.isNumber(e)||e<0?e=0:e>1&&(e=1),this.resourceProvider.facadeVolumeChange(e)},timeUpdated:function(){var e=this.videoTagRef.currentTime;"number"==typeof e&&this.resourceProvider.facadeTimeUpdate(e)},error:function(e){var t=uvpjs.ErrorInfo.messages,i=uvpjs.ErrorInfo.errorCodes,n=t.UNSPECIFIED_VIDEO_PLAYBACK_ERROR,a=i.UNSPECIFIED_VIDEO_PLAYBACK_ERROR,r=!0;if(e)switch(e.code){case e.MEDIA_ERR_ABORTED:r=!1,n=t.MEDIA_ERR_ABORTED,a=i.MEDIA_ERR_ABORTED;break;case e.MEDIA_ERR_NETWORK:n=t.MEDIA_ERR_NETWORK,a=i.MEDIA_ERR_NETWORK;break;case e.MEDIA_ERR_DECODE:n=t.MEDIA_ERR_DECODE,a=i.MEDIA_ERR_DECODE;break;case e.MEDIA_ERR_SRC_NOT_SUPPORTED:n=t.MEDIA_ERR_SRC_NOT_SUPPORTED,a=i.MEDIA_ERR_SRC_NOT_SUPPORTED}this.debug&&uvpjs.error(this.DEBUG_ID,"VideoPlayerFacade Error: "+n),s.isEmpty(this.resourceProvider)?this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade error(); no RP - early return."):this.resourceProvider.facadeError(new uvpjs.ErrorInfo({errorCode:a,message:n,isFatal:r}))},hideVideo:function(){this.videoTagRef&&(this.videoTagRef.style.visibility="hidden")},showVideo:function(){this.videoTagRef&&(this.videoTagRef.style.visibility="visible")},stopVideo:function(){this.videoTagRef&&(this.videoTagRef.pause(),this.playbackStateChange(uvpjs.mediaCapabilities.STOPPED))},playVideo:function(){var e;this.videoTagRef&&(this.debug&&uvpjs.log(this.DEBUG_ID,"playVideo"),void 0!==(e=this.videoTagRef.play())&&e.then(Function.prototype).catch(this.handlePlayPromiseRejection.bind(this)))},handlePlayPromiseRejection:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"Browser appears to be preventing autoplay: "+e.message),this.resourceProvider&&this.resourceProvider.facadeBrowserPlayFailure(e.message)},pauseVideo:function(){this.videoTagRef&&(this.debug&&uvpjs.log(this.DEBUG_ID,"pauseVideo"),this.videoTagRef.pause())},seekTo:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"seekTo",e),isNaN(e)||this.videoTagRef&&e>=0&&e<this.videoTagRef.duration&&(this.videoTagRef.currentTime=e)},seekToLive:function(){if(this.isHDStreamLive()||this.debug&&uvpjs.warn(this.DEBUG_ID,"seekToLive attempted on non-Live Stream"),this.videoTagRef){var e=this.videoTagRef.seekable&&this.videoTagRef.seekable.length>0&&this.videoTagRef.seekable.end(0);!isNaN(e)&&e>this.videoTagRef.currentTime&&(this.videoTagRef.currentTime=e)}},toggleMute:function(){var e;this.videoTagRef&&(e=!this.videoTagRef.muted,this.muteVideo(e))},setFullscreenState:function(e){},loadVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"loadVideo"),this.videoTagRef.addEventListener(this.eventTypes.HTML5.CAN_PLAY,this,!1),this.videoTagRef.addEventListener(this.eventTypes.HTML5.CAN_PLAY_THROUGH,this,!1),this.videoTagRef.load()},muteVideo:function(e){var t=!1!==e;this.videoTagRef&&(this.videoTagRef.muted=t,t&&!this.videoTagRef.getAttribute("muted")&&this.videoTagRef.setAttribute("muted","muted"),!t&&this.videoTagRef.removeAttribute("muted"))},unMuteVideo:function(){this.muteVideo(!1)},getVolume:function(){return this.videoTagRef&&this.videoTagRef.volume||0},setVolume:function(e){this.videoTagRef&&e>=0&&e<=1&&(this.videoTagRef.volume=e)},getDuration:function(){var e=0;return this.videoTagRef&&(e=this.videoTagRef.duration)===Number.POSITIVE_INFINITY&&null!==this.videoTagRef.seekable&&this.videoTagRef.seekable.length>0&&(e=this.videoTagRef.seekable.end(0)),e},getCurrentTime:function(){return this.hasPlaybackStarted&&this.videoTagRef&&this.videoTagRef.currentTime||0},isPlayingLive:function(){return!1},isHDStreamLive:function(){return!1},isAbrStreamingSupported:function(){return!1},useDynamicSwitching:function(e){(!this.isAbrStreamingSupported()||"boolean"!=typeof e)&&this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED)},switchUp:function(){!this.isAbrStreamingSupported()&&this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED)},switchDown:function(){!this.isAbrStreamingSupported()&&this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED)},switchToBitrate:function(e){return!this.isAbrStreamingSupported()&&this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED),-1},getMinBitrate:function(){return-1},getMaxBitrate:function(){return-1},getMinBitrateAllowed:function(){return-1},getMaxBitrateAllowed:function(){return-1},setMinBitrateAllowed:function(e){return!this.isAbrStreamingSupported()&&this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED),-1},setMaxBitrateAllowed:function(e){return!this.isAbrStreamingSupported()&&this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED),-1},getIndexForBitrate:function(e,t,i){if(e.length>0){var s=e.length,n=e[0].hasOwnProperty("bitrate")?"bitrate":"bandwidth";if(t>=e[s-1][n])return s-1;for(;s--;){if(t>=e[s][n])return i?s+1:s}}return 0},addSessionIdAndTicketToURL:function(e,t,i){if(!e)return e;var s=function(e){return-1!==e.indexOf("?")?"&":"?"};return t&&-1===e.indexOf("SessionId=")&&(e+=s(e)+"SessionId="+t),i&&-1===e.indexOf("Ticket=")&&(e+=s(e)+"Ticket="+i),e},processResponseHeader:function(e,t){switch(t){case this.responseHeaders.MULTI_CDN:this.resourceProvider.getContentVideoStateCdn()!==e&&this.resourceProvider.setContentVideoStateCdn(e)}},getCdnNameAtStartup:function(e){return""},videoDone:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade    videoDone     uvpjs.mediaCapabilities.STOPPED   this.resourceProvider.facadeDone()   "),this.playbackStateChange(uvpjs.mediaCapabilities.STOPPED),this.resourceProvider.facadeDone()},clearVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade    clearVideo     call -> this.cleanUp();"),this.cleanUp()},removeEvents:function(){},setSize:function(e,t){},getBuffered:function(){var e,t=this.videoTagRef,i=t&&t.buffered,s=0,n=0;return i&&i.length>0&&(s=i.start&&i.start(0),n=i.end&&i.end(0)),(e=n-s)>0&&e||0},getCurrentSrc:function(){if(this.videoTagRef)return this.videoTagRef.src},getError:function(){if(this.videoTagRef)return this.videoTagRef.error},getReadyState:function(){if(this.videoTagRef)return this.videoTagRef.readyState},getNetworkState:function(){if(this.videoTagRef)return this.videoTagRef.networkState},manageNativeControls:function(e){if(this.videoTagRef){var t=this.videoTagRef.hasAttribute(this.CONTROLS);e&&!t?this.videoTagRef.setAttribute("controls",this.CONTROLS):!e&&t&&this.videoTagRef.removeAttribute(this.CONTROLS)}},playbackStateChange:function(e){if(e!==this.playbackState){if(this.playbackState=e,this.debug&&uvpjs.log(this.DEBUG_ID,"playbackStateChange this.vidContId = "+this.vidContId+" newState = "+e),s.isEmpty(this.resourceProvider))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"playbackStateChange  this.resourceProvider === {}   RETURN !!!!!"));this.resourceProvider.facadePlaybackStateChange(e)}},getPlaybackState:function(){return this.playbackState},getPlaybackFramerate:function(){return-1},getCurrentBandwidth:function(){return-1},getCurrentMaxBandwidth:function(){return-1},getDroppedFramesCount:function(){return-1},getAverageDroppedFPS:function(){return-1},getFacadeState:function(){return this.facadeState},getStreamType:function(){return""},getAssetURL:function(){var e=this.resourceProvider.getAltURL();return this.usingDynamicVariantPlaylist=!s.isUndefined(e),!this.hasManifestParsingError&&this.usingDynamicVariantPlaylist||(this.usingDynamicVariantPlaylist=!1,e=this.resourceProvider.getAssetURL()),this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade getAssetURL assetURL",e),e},normalizeAudioTrackInfo:function(e,t){if(e){for(var i=[],s=0;s<e.length;s++){var n=e[s];this.checkCodecForWeb(n)&&i.push({index:s,id:n.id,type:n.type||n.kind,codec:n.codec||"n/a",label:t===uvpjs.mediaCapabilities.DASHJS?n.lang:n.label||n.name})}return i}},checkCodecForWeb:function(e){return!e.codec||-1!==e.codec.indexOf("mp4a")}})}(uvpjs.register("uvpjs")),function(e){"use strict";e.VPF_Flash=uvpjs.VideoPlayerFacade.subClass({init:function(){this._super(),this.debug&&uvpjs.log(this.DEBUG_ID,"Playback will use UVP Flash."),this.player=null,this.isPaused=!1,this.isReady=!1,this.swfService=null,this.id3Options=null,this.initOptions={},this.currFlashVideoState={averageDroppedFPS:-1,bufferLength:-1,videoFramerate:-1,curMaxBandwidth:-1,isHDStreamLive:!1,isPlayingLive:!1,isSeekable:!1},this.hasCaptions=!1,this.hasSetStartBitrate=!1,this.captionsUrl=null,this.windowLabels={},this.bitrateInfo={bitrates:null,abrInfo:null,min:null,max:null},this.pendingSwitchMode=null,this.facadeType=uvpjs.mediaCapabilities.FLASH_HLS},initialize:function(e){for(var t in e)this.initOptions[t]=e[t];e.suppress360=!0,e.suppressCreatedEvent=!0,this._super(e),this.swfService=e.swfService,this.player=this.swfService.getSwf(),this.initializeCaptionStyles(),this.addUvpFlashEventListeners(),this.processResponseHeader(this.getCdnNameAtStartup(this.assetURL),this.responseHeaders.MULTI_CDN),this.dispatchCreated()},destroy:function(){var e;for(e in this.windowLabels)window[this.windowLabels[e]]=null;this.player&&this.player.stopVideo(),this.player&&this.player.clearVideo(),this.player=null,this.swfService=null,this._super()},pauseVideo:function(){this.isPaused=!0,this.player.pauseVideo()},playVideo:function(){this.hasPlaybackStarted?this.isPaused&&this.player.playVideo():this.loadVideo(),this.isPaused=!1},muteVideo:function(){this.player&&this.player.mute()},unMuteVideo:function(){this.player&&this.player.unMute()},getVolume:function(){return this.player&&this.player.getVolume()},setVolume:function(e){this.player&&this.player.setVolume(e)},seekTo:function(e){this.player&&this.player.seekTo(e)},seekToLive:function(){},hideVideo:function(){this.player&&(this.player.style.visibility="hidden",this.player.mute())},showVideo:function(){this.player&&(this.player.style.visibility="visible",this.player.unMute())},setFullscreenState:function(e){this.swfService.resetSize()},loadCaptions:function(e){this.captionsUrl=uvpjs.util.isEmpty(e)?null:e,this.captionsUrl&&(this.deferLoadingCaptions||(this.hasCaptions=!0,this.player.loadCaptions(e)))},showCaptions:function(){!this.hasCaptions&&this.captionsUrl?(this.player.loadCaptions(this.captionsUrl),this.hasCaptions=!0,this.player.showCaptions()):this.player.showCaptions()},hideCaptions:function(){this.player.hideCaptions()},setCaptionStyle:function(e){for(var t,i,s,n=Array.isArray(e)&&e.length||0,a=uvpjs.util,r=uvpjs.VPF_Flash.styleTransform;n--;)t=e[n],s=r[i=this.dashToCamel(t.name)]?r[i](t.value):t.value,!a.isEmpty(t.value)&&this.player.setStyleAttribute(i,s)},setId3Options:function(e){this.id3Options=e},getAbrInfo:function(){return this.bitrateInfo.abrInfo||null},getStreamType:function(){return"HLS"},getBuffered:function(){return this.currFlashVideoState.bufferLength||-1},getAverageDroppedFPS:function(){return this.currFlashVideoState.averageDroppedFPS||-1},getPlaybackFramerate:function(){return this.currFlashVideoState.videoFramerate||-1},getDuration:function(){return this.player&&this.player.getDuration()},getCurrentTime:function(){return this.player&&this.player.getCurrentTime()},getCurrentMaxBandwidth:function(){return this.currFlashVideoState.curMaxBandwidth||-1},isHDStreamLive:function(){return this.currFlashVideoState.isHDStreamLive||!1},isPlayingLive:function(){return this.currFlashVideoState.isPlayingLive||!1},getDroppedFramesCount:function(){return-1},getCurrentBandwidth:function(){return-1},getFacadeState:function(){return{currentBitrate:this.currFlashVideoState.sourceBitrate,abrInfo:this.bitrateInfo.abrInfo}},isAbrStreamingSupported:function(){return!0},useDynamicSwitching:function(e){var t=!1===e?"false":"true";this.player.enableDynamicStreaming(t)},switchToBitrate:function(e){var t=this.findClosestBitrate(e);-1!==t.index&&this.player.switchStreamingIndex(t.index)},setMinBitrateAllowed:function(e){var t=this.findClosestBitrate(e);-1!==t.index&&(this.bitrateInfo.min=t.bitrate,this.player.setMinimumStreamingIndex(t.index))},setMaxBitrateAllowed:function(e){var t=this.findClosestBitrate(e);-1!==t.index&&(this.bitrateInfo.max=t.bitrate,this.player.setMaximumStreamingIndex(t.index))},switchUp:function(){var e=this.currFlashVideoState.playbackBitrate,t=this.findClosestBitrate(e),i=-1!==t.index&&this.bitrateInfo.bitrates.length;-1!==t.index&&t.index<i-1&&this.player.switchStreamingIndex(t.index+1)},switchDown:function(){var e=this.currFlashVideoState.playbackBitrate,t=this.findClosestBitrate(e);-1!==t.index&&t.index>0&&this.player.switchStreamingIndex(t.index-1)},getMinBitrateAllowed:function(){return this.bitrateInfo.min||-1},getMaxBitrateAllowed:function(){return this.bitrateInfo.max||-1},getMinBitrate:function(){return this.bitrateInfo.bitrates?this.bitrateInfo.bitrates[0]:-1},getMaxBitrate:function(){var e=this.bitrateInfo.bitrates&&this.bitrateInfo.bitrates.length;return e?this.bitrateInfo.bitrates[e-1]:-1},getStartBitrate:function(){return this.currFlashVideoState.defaultBitrate||-1},getCurrentBitrate:function(){return this.currFlashVideoState.sourceBitrate||-1},findClosestBitrate:function(e){for(var t,i=this.bitrateInfo.bitrates,s=i?i.length:0,n={bitrate:0,delta:1/0,index:-1};s--;)(t=Math.abs(e-i[s]))<n.delta&&(n.bitrate=i[s],n.index=s,n.delta=t);return n},hContentEvent:function(e){var t=uvpjs.VPF_Flash.uvpFlashEvent.content;switch(e){case t.CONTENT_START:this.isReady||(this.isReady=!0,this.hasPlaybackStarted=!0,this.initOptions.isMuted&&this.muteVideo(),this.resourceProvider.facadeDisplayReady());break;case t.CONTENT_END:}},hPlaybackEvent:function(e,t){var i,s=uvpjs.VPF_Flash.uvpFlashEvent.playback;switch(e){case s.VIDEO_STATE_CHANGE:this.isReady&&this.playbackStateChange(+t);break;case s.VIDEO_PROGRESS:this.processCvioPayload(t);break;case s.VIDEO_CUEPOINT:this.id3Options&&this.processCuepointPayload(t);break;case s.VIDEO_ERROR:this.processCvioPayload(t),this.dispatchError();break;case s.VIDEO_DONE:this.processCvioPayload(t),uvpjs.util.isEmpty(this.currFlashVideoState.errorInfo)?this.videoDone():this.dispatchError();break;case s.VIDEO_TRANSITION_COMPLETE:i=this.parsePayload(t),this.resourceProvider.facadeVideoTransitionComplete(i.newRate.rate,this.pendingSwitchMode),this.pendingSwitchMode=null;break;case s.VIDEO_TRANSITION_START:i=this.parsePayload(t),this.pendingSwitchMode=i.reason.toLowerCase().indexOf("manual")>=0?"manual":"auto",this.resourceProvider.facadeVideoTransitionStart(i.newRate.rate,this.pendingSwitchMode)}},dispatchError:function(){this.resourceProvider.facadeError(new uvpjs.ErrorInfo({eventType:uvpjs.EventType.VIDEO_PLAYBACK_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.FLASH_PLAYBACK_ERROR,message:"Error from UVP Flash: "+this.currFlashVideoState.errorInfo||null,isFatal:!0}))},processCvioPayload:function(e){var t,i,s=this.parsePayload(e,"ContentVIO");if(s){for(t in i=s.ContentVIO)this.currFlashVideoState[t]=this.getCvioValue(i[t]);null===this.bitrateInfo.bitrates&&i.currentTime>0&&this.captureBitrateInfo()}},setStartBitrate:function(){this.hasSetStartBitrate=!0},captureBitrateInfo:function(){for(var e=[],t=[],i=this.player.getContentBitrateInfo(),s="string"==typeof i&&i.split(","),n=Array.isArray(s)?s.length:0;n--;)e[n]=+s[n],t[n]={bitrate:+s[n]};this.bitrateInfo.bitrates=e,this.bitrateInfo.abrInfo=t},processCuepointPayload:function(e){var t=this.parsePayload(e,"Cuepoint"),i=this.id3Options,s={pts:null};!t||!i.dataCallback||t.text.indexOf("syncbak.cc")>=0||(s.name=i.findNielsen&&t.text.indexOf("www.nielsen.com")>-1?"www.nielsen.com":t.name,s.data=t.text,i.dataCallback(s))},getCvioValue:function(e){var t,i,s,n,a;return"boolean"==typeof e||"number"==typeof e?e:"string"==typeof e?(i=!(t="NaN"===e||"null"===e||""===e)&&"true"===e.toLowerCase(),s=!t&&!i&&"false"===e.toLowerCase(),n=!t&&!i&&!s&&parseInt(e),a=isNaN(n)?e:n,t?-1:!!i||!s&&a):void 0},parsePayload:function(e,t){var i=null;if(0===e.indexOf("{")||0===e.indexOf("[")){try{i=JSON.parse(e)}catch(e){return this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to parse "+t+"as JSON; "+e.message),null}return i}return e},addUvpFlashEventListeners:function(){var e,t,i,s,n,a=uvpjs.VPF_Flash.uvpFlashEvent,r={},o=function(e,t,i){return e["h"+(t.charAt(0).toUpperCase()+t.substr(1))+"Event"].bind(e,i)};for(i in a)for(n in t=a[i])r[s=t[n]]=o(this,i,s);for(i in e=this.windowLabels=uvpjs.UvpSwfService.setWindowMethods(r))this.player.addEventJSCallback(i,e[i])},loadVideo:function(){var e={cdn:uvpjs.UvpSwfService.constant.CDN,fileType:"m3u8"};this.initOptions.startTime&&(e.startTime=this.initOptions.startTime),this.player.loadVideoByUrl(this.assetURL,e)},initializeCaptionStyles:function(){var e,t={fontSize:14,fontColor:"0xffff00",backgroundOpacity:"75",backgroundDisplayWidth:"auto",padding:"10",yOffset:"40"};for(e in t)this.player.setStyleAttribute(e,t[e])},dashToCamel:function(e){return e.replace(/(-\w)/g,function(e){return e[1].toUpperCase()})}}),e.VPF_Flash.uvpFlashEvent={content:{CONTENT_END:"onContentEnd_cbsi",CONTENT_START:"onContentStart_cbsi"},playback:{VIDEO_CUEPOINT:"onVideoCuePoint",VIDEO_DONE:"onVideoDone",VIDEO_ERROR:"onVideoError",VIDEO_PROGRESS:"onVideoProgress",VIDEO_STATE_CHANGE:"onStateChange_cbsi",VIDEO_TRANSITION_COMPLETE:"onVideoTransitionComplete",VIDEO_TRANSITION_START:"onVideoTransitionStart"}},e.VPF_Flash.styleTransform={_opacity:function(e){return 100*+e},backgroundOpacity:function(e){return uvpjs.VPF_Flash.styleTransform._opacity(e)},fontOpacity:function(e){return uvpjs.VPF_Flash.styleTransform._opacity(e)},fontSize:function(e){var t=.01*+e.substr(0,e.indexOf("%"));return Math.round(14*t)}}}(uvpjs.register("uvpjs")),function(e){var t=e._;e.VPF_HTML5=uvpjs.VideoPlayerFacade.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.VPF_HTML5,init:function(){this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5 Init"),this.facadeType=uvpjs.mediaCapabilities.HTML5,this.onStalledEvent=this.onStalledEvent.bind(this),this.fairplayDRM=null,this.startTime=null,this.hCueChange=this.onCueChange.bind(this),this.hTextTrackAdded=this.onAddTextTrack.bind(this),this.hVideoEvent=this.onVideoEvent.bind(this),this.activeMetadataTrack=null,this._super()},destroy:function(){this.fairplayDRM&&this.fairplayDRM.destroy(),this.fairplayDRM=null,this.videoTagRef.removeAttribute("src"),this.videoTagRef.load(),this._super(),this.activeMetadataTrack=null,this.hCueChange=Function.prototype,this.hTextTrackAdded=Function.prototype},initialize:function(e){this.debug&&(uvpjs.log(this.DEBUG_ID,"VPF_HTML5 initialize resourceProvider.rco.id = ",e.resourceProvider.rco.id),uvpjs.log(this.DEBUG_ID,"VPF_HTML5 initialize this.options = ",e)),this._super(e),e.drm.enabled&&(this.fairplayDRM=new uvpjs.FairPlayDRM({drm:e.drm,videoTagRef:this.videoTagRef,eventTypes:this.eventTypes,errorCallback:this.handleFairPlayError.bind(this)})),!uvpjs.util.isEmpty(e.startTime)&&(this.startTime=Math.floor(e.startTime)),this.addEvents(),this.setSource(),this.processResponseHeader(this.getCdnNameAtStartup(this.assetURL),this.responseHeaders.MULTI_CDN),this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5  initialize  COMPLETE   this.options = ",e)},handleEvent:function(e){var t=this.eventTypes.HTML5;this.videoTagRef&&(this._super(e),e.type===t.LOADED_METADATA&&this.startTime&&(this.videoTagRef.currentTime=this.startTime,this.startTime=null))},handleFairPlayError:function(e,t){this.resourceProvider.facadeError(new uvpjs.ErrorInfo({errorCode:e,message:t,isFatal:!0}))},setSource:function(){try{this.videoTagRef.src=this.assetURL}catch(e){console.log("Error caught at setSource: ",e)}this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5 setSource this.videoTagRef.src",this.videoTagRef.src)},addEvents:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5 addEvents"),this._addHTML5Events(),this.videoTagRef.addEventListener(this.eventTypes.HTML5.STALLED,this.onStalledEvent,!1),this.videoTagRef.addEventListener(this.eventTypes.HTML5.CAN_PLAY,this.hVideoEvent,!1),this.videoTagRef.textTracks.addEventListener(this.eventTypes.HTML5.ADD_TRACK,this.hTextTrackAdded,!1)},onVideoEvent:function(e){e.type===this.eventTypes.HTML5.CAN_PLAY&&(this.videoTagRef.removeEventListener(this.eventTypes.HTML5.CAN_PLAY,this.hVideoEvent,!1),this.updateAudioTracksInfo())},switchAudioTrack:function(e){this.videoTagRef.audioTracks?(this.debug&&uvpjs.log(this.DEBUG_ID,"Audio Track switch requested - id: "+e),this.videoTagRef.audioTracks[e].enabled=!0,this.updateAudioTracksInfo()):this.debug&&uvpjs.log(this.DEBUG_ID,"Audio Track switching is not supported on this user agent")},updateAudioTracksInfo:function(){var e=this.normalizeAudioTrackInfo(this.videoTagRef.audioTracks,uvpjs.mediaCapabilities.HTML5);if(e){var t=this.getCurrentEnabledAudioTrackIndex(this.videoTagRef.audioTracks),i={tracks:e,track:e[t],index:t};this.resourceProvider.facadeSetAudioTrackInfo(i)}},getCurrentEnabledAudioTrackIndex:function(e){for(var t=e.length;t--;)if(e[t].enabled)return t;return t},onAddTextTrack:function(e){e.track&&"metadata"===e.track.kind&&(this.activeMetadataTrack=e.track),e.track.addEventListener(this.eventTypes.HTML5.CUE_CHANGE,this.hCueChange,!1)},onCueChange:function(e){e&&e.target&&e.target.activeCues&&e.target.activeCues.length>=1&&("metadata"===e.target.kind?this.resourceProvider.facadeId3Data(e.target.activeCues):"captions"!==e.target.kind&&"subtitles"!==e.target.kind||(e.target.removeEventListener(this.eventTypes.HTML5.CUE_CHANGE,this.hCueChange,!1),this.resourceProvider.facadeSetCaptionReady()))},showCaptions:function(e){if(uvpjs.util.isDefinedString(e))for(var t=this.videoTagRef.textTracks,i=0,s=t.length;i<s;i++){var n=t[i];n.mode=n.language===e?"hidden":"disabled"}},removeEvents:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5 removeEvents"),this._removeHTML5Events(),this.videoTagRef.removeEventListener(this.eventTypes.HTML5.STALLED,this.onStalledEvent,!1),this.videoTagRef.textTracks&&this.videoTagRef.textTracks.removeEventListener(this.eventTypes.HTML5.ADD_TRACK,this.hTextTrackAdded,!1),this.activeMetadataTrack&&this.activeMetadataTrack.removeEventListener(this.eventTypes.HTML5.CUE_CHANGE,this.hCueChange,!1)},getFacadeState:function(){return this.facadeState||{}},getStreamType:function(){return uvpjs.mediaCapabilities.isSafari()?"HLS":"MP4"},onStalledEvent:function(e){if(t.isEmpty(this.resourceProvider)||t.isEmpty(this.resourceProvider.cviModel))this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5 onStalledEvent event,(_.isEmpty(this.resourceProvider) || _.isEmpty(this.resourceProvider.cviModel) RETURN event = ",e);else{var i=this.resourceProvider.cviModel.contentPlaybackState.playbackStarted;this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5 onStalledEvent event, hasPlaybackStarted",e,i)}}})}(uvpjs.register("uvpjs")),uvpjs.register("uvpjs").VPF_HLSJS=uvpjs.VideoPlayerFacade.subClass({debug:"prod"!==uvpjs.Configuration.env,DEBUG_ID:uvpjs.DebugManager.configParams.VPF_HLSJS,LIB_DEBUG_ID:uvpjs.DebugManager.configParams.HLSJS_LIB,LEVEL_DEBUG_ID:uvpjs.DebugManager.configParams.HLSJS_LEVEL,FRAG_DEBUG_ID:uvpjs.DebugManager.configParams.HLSJS_FRAG,FRAME_DROP_DEBUG_ID:uvpjs.DebugManager.configParams.HLSJS_FRAME_DROP,LIVE_POINT_GRACE_SECONDS:11,init:function(){this.debug=uvpjs.debug,this._super(),this.debug&&uvpjs.log(this.DEBUG_ID,"HLS.js version: "+Hls.version),this._currentBandwidth=null,this._currentMaxBandwidth=null,this._playbackFramerate=null,this._isHdStreamLive=!1,this.id3HandlingEnabled=!1,this.mc=uvpjs.mediaCapabilities,this.facadeType=this.mc.HLSJS,this.withCredentials=!1,this.startTime=-1,this.maxBitrate=-1,this.minBitrate=-1,this.startBitrate=-1,this.bitrateList=null,this.networkErrorRecoveryCount=0,this.mediaErrorRecoveryCount=0,this.levelDetails=null,this.isMobile=uvpjs.mediaCapabilities.isMobile(),this.libConfig={debug:uvpjs.DebugManager.isParamEnabled(this.LIB_DEBUG_ID),enableWorker:!0,autoStartLoad:!1,enableCEA708Captions:!0,initialLiveManifestSize:1,liveSyncDurationCount:3,capLevelToPlayerSize:!1,xhrSetup:this.onRequest.bind(this)},this.onLibraryEvent=this.onLibraryEvent.bind(this),this.onLevelEvent=this.onLevelEvent.bind(this),this.onAudioEvent=this.onAudioEvent.bind(this),this.onFragmentEvent=this.onFragmentEvent.bind(this),this.onID3Event=this.onID3Event.bind(this),this.onError=this.onError.bind(this)},destroy:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"destroy");for(var e=this.videoTagRef.textTracks,t=0;t<e.length;t++){var i=e[t];"captions"!==i.kind&&"subtitles"!==i.kind||(i.textTrack1&&(i.textTrack1=!1),i.textTrack2&&(i.textTrack2=!1))}this.player.destroy(),this._super(),this._currentBandwidth=null,this._currentMaxBandwidth=null,this._playbackFramerate=null,this.bitrateList=null,this.levelDetails=null},initialize:function(e){return this._super(e),this.id3HandlingEnabled=e.enableId3Handling,"number"==typeof e.liveSyncDurationCount&&e.liveSyncDurationCount>0&&(this.libConfig.liveSyncDurationCount=e.liveSyncDurationCount),!0===e.capLevelToPlayerSize&&(this.libConfig.capLevelToPlayerSize=e.capLevelToPlayerSize),this.isMobile&&(this.libConfig.maxBufferLength=20,this.libConfig.maxMaxBufferLength=60,this.libConfig.liveBackBufferLength=30),uvpjs.util.isEmpty(e.hlsjsLoader)||(this.debug&&uvpjs.log(this.DEBUG_ID,"Hlsjs using custom loader."),this.libConfig.loader=e.hlsjsLoader),this.player=new Hls(this.libConfig),this.addEvents(),"number"==typeof e.startBitrate&&e.startBitrate>-1&&(this.startBitrate=e.startBitrate),"number"==typeof e.maxBitrate&&e.maxBitrate>-1&&(this.maxBitrate=e.maxBitrate),"number"==typeof e.minBitrate&&e.minBitrate>-1&&(this.minBitrate=e.minBitrate),e.startTime&&(this.startTime=Math.round(e.startTime)),e.errorRecovery&&this.setErrorRecoveryOverrides(e.errorRecovery),this.resourceProvider.rco.withCredentials&&(this.withCredentials=this.resourceProvider.rco.withCredentials),this.player.loadSource(this.assetURL),this.player.attachMedia(this.videoTagRef),this.player},seekToLive:function(){this.player&&this._isHdStreamLive?this.seekTo(this.getLiveEdgeOffset()):uvpjs.warn(this.DEBUG_ID,"Unable to seekToLive - isHDStreamLive? "+isHDStreamLive)},isAbrStreamingSupported:function(){return this.bitrateList?this.bitrateList.length>0:this._super()},useDynamicSwitching:function(e){this._super(),this.player?this.player.nextLevel=e?-1:this.player.currentLevel:uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED)},switchAudioTrack:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"Audio Track switch requested - id: "+e),this.player.audioTrack=e},switchUp:function(){this.player?this.switchToIndex(this.player.nextLoadLevel+1):uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED)},switchDown:function(){this.player?this.switchToIndex(this.player.nextLoadLevel-1):uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED)},switchToBitrate:function(e){this.switchToIndex(this.getIndexForBitrate(this.bitrateList,e,!1))},switchToIndex:function(e){if(this.isAbrStreamingSupported()){this.getMinBitrateAllowed()>0&&this.setMinBitrateAllowed(0),!this.player.config.capLevelToPlayerSize&&this.getMaxBitrateAllowed()>0&&this.setMaxBitrateAllowed(-1);var t=-1!==this.player.autoLevelCapping?this.getIndexForBitrate(this.bitrateList,this.getMaxBitrateAllowed(),!1):NaN,i=isNaN(t)?this.bitrateList.length-1:t;e>=0&&e<=i?this.player.nextLevel=e:uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_INDEX_OUT_OF_RANGE,"Range=",0,"-",i," : Index=",e)}else uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED)},showCaptions:function(){this.player.subtitleTracks.length>0&&(this.player.subtitleTrack=0)},getStartBitrate:function(){var e=this.player;return this.startBitrate||this.minBitrate||e&&e.levels&&e.levels[0]&&e.levels[0].bitrate||-1},setStartBitrate:function(e){this.player?(e<this.getMinBitrateAllowed()&&(e=this.getMinBitrateAllowed(),this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.STARTING_BITRATE_BELOW_MIN_ALLOWED)),this.player.config.startLevel=this.getIndexForBitrate(this.bitrateList,e,!1)):uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED)},getMinBitrateAllowed:function(){if(this.player){var e=this.player.minAutoLevel;return this.bitrateList?this.bitrateList[e].bitrate:this._super()}return uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED),this._super()},setMinBitrateAllowed:function(e){if(this.player){this.player.config.minAutoBitrate=e-1;var t=this.getIndexForBitrate(this.bitrateList,e,!0);this.player.currentLevel<t&&(this.player.nextAutoLevel=t),uvpjs.warn(this.DEBUG_ID,"setMinBitrateAllowed",e)}else uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED)},getMaxBitrateAllowed:function(){if(this.player){var e=this.player.maxAutoLevel;return void 0!==e?this.bitrateList[e].bitrate:this._super()}return uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED),this._super()},setMaxBitrateAllowed:function(e){if(!this.player)return uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED),this._super();this.player.autoLevelCapping=-1===e?e:this.getIndexForBitrate(this.bitrateList,e,!1),uvpjs.warn(this.DEBUG_ID,"setMaxBitrateAllowed",e)},getMinBitrate:function(){return this.isAbrStreamingSupported()?this.bitrateList[0].bitrate:(uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED),this._super())},getMaxBitrate:function(){return this.isAbrStreamingSupported()?this.bitrateList[this.bitrateList.length-1].bitrate:(uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED),this._super())},getCurrentBitrate:function(){var e=-1;return this.bitrateList&&this.bitrateList[this.player.currentLevel]&&(e=this.bitrateList[this.player.currentLevel].bitrate),e},getPlaybackFramerate:function(){return this._playbackFramerate||0},getCurrentBandwidth:function(){return this._currentBandwidth||0},getCurrentMaxBandwidth:function(){return this._currentMaxBandwidth||0},getDroppedFramesCount:function(){var e,t;if(this.player)return(t=(e=this.player.media).getVideoPlaybackQuality)&&"function"==typeof t?t.call(e).droppedVideoFrames:e.webkitDroppedFrameCount||0},getAverageDroppedFPS:function(){return this.getDroppedFramesCount()/this.getDuration()},getCappedAbrInfo:function(){var e=this.getIndexForBitrate(this.bitrateList,this.getMaxBitrateAllowed(),!1)+1,t=this.getIndexForBitrate(this.bitrateList,this.getMinBitrateAllowed(),!0);return this.bitrateList.slice(t,e)},getFacadeState:function(){this.videoTagRef&&this.videoTagRef.textTracks.length>0&&void 0!==this.videoTagRef.textTracks[0]&&this.player&&-1===this.player.subtitleTrack&&this.showCaptions();var e={startBitrate:-1,currentBitrate:-1,minBitrate:-1,maxBitrate:-1,droppedFrames:this.getDroppedFramesCount(),droppedFPS:this.getAverageDroppedFPS(),playbackFramerate:this.getPlaybackFramerate(),abrInfo:[],currentAbr:{bitrate:0,levelId:{},info:{},detail:{},stats:{},updated:!1}};return this.player&&this.bitrateList&&(e.abrInfo=this.bitrateList,e.currentAbr=this.bitrateList[this.player.currentLevel],e.cappedAbrInfo=this.getCappedAbrInfo(),e.startBitrate=this.getStartBitrate(),e.currentBitrate=this.getCurrentBitrate(),e.minBitrate=this.getMinBitrateAllowed(),e.maxBitrate=this.getMaxBitrateAllowed()),e},getStreamType:function(){return"HLS"},isPlayingLive:function(){var e=!1;if(this._isHdStreamLive&&this.levelDetails&&this.videoTagRef.currentTime>=0){var t=Math.floor(this.getLiveEdgeOffset());e=Math.ceil(this.videoTagRef.currentTime)>=t}return e},getLiveEdgeOffset:function(){var e=Number.POSITIVE_INFINITY;return this._isHdStreamLive&&this.levelDetails&&this.videoTagRef.duration>0&&(e=this.videoTagRef.duration-this.player.config.liveSyncDurationCount*this.levelDetails.targetduration),e},isHDStreamLive:function(){return this._isHdStreamLive},addEvents:function(){this._addHTML5Events();var e=Hls.Events,t=this.onLibraryEvent,i=this.onLevelEvent,s=this.onAudioEvent,n=this.onFragmentEvent;this.player.on(e.MEDIA_ATTACHING,t,!1),this.player.on(e.MEDIA_ATTACHED,t,!1),this.player.on(e.MEDIA_DETACHING,t,!1),this.player.on(e.MANIFEST_PARSED,t,!1),this.player.on(e.MANIFEST_LOADED,t,!1),this.player.on(e.MANIFEST_LOADING,t,!1),this.player.on(e.FPS_DROP,t,!1),this.player.on(e.SUBTITLE_TRACKS_UPDATED,t,!1),this.player.on(e.LEVEL_SWITCHING,i,!1),this.player.on(e.LEVEL_SWITCHED,i,!1),this.player.on(e.LEVEL_LOADING,i,!1),this.player.on(e.LEVEL_LOADED,i,!1),this.player.on(e.LEVEL_UPDATED,i,!1),this.player.on(e.LEVEL_PTS_UPDATED,i,!1),this.player.on(e.AUDIO_TRACKS_UPDATED,s,!1),this.player.on(e.AUDIO_TRACK_SWITCHED,s,!1),this.player.on(e.FRAG_LOADING,n,!1),this.player.on(e.FRAG_LOAD_PROGRESS,n,!1),this.player.on(e.FRAG_LOADED,n,!1),this.player.on(e.FRAG_PARSED,n,!1),this.player.on(e.FRAG_BUFFERED,n,!1),this.player.on(e.FRAG_CHANGED,n,!1),this.player.on(e.FRAG_PARSING_DATA,n,!1),this.id3HandlingEnabled&&this.player.on(e.FRAG_PARSING_METADATA,this.onID3Event,!1),this.player.on(e.ERROR,this.onError,!1)},removeEvents:function(){this._removeHTML5Events();var e=Hls.Events,t=this.onLibraryEvent,i=this.onLevelEvent,s=this.onAudioEvent,n=this.onFragmentEvent;this.player.off(e.MEDIA_ATTACHING,t),this.player.off(e.MEDIA_ATTACHED,t),this.player.off(e.MEDIA_DETACHING,t),this.player.off(e.MANIFEST_PARSED,t),this.player.off(e.MANIFEST_LOADED,t),this.player.off(e.MANIFEST_LOADING,t),this.player.off(e.FPS_DROP,t),this.player.off(e.SUBTITLE_TRACKS_UPDATED,t),this.player.off(e.LEVEL_SWITCHING,i),this.player.off(e.LEVEL_SWITCHED,i),this.player.off(e.LEVEL_LOADING,i),this.player.off(e.LEVEL_LOADED,i),this.player.off(e.LEVEL_UPDATED,i),this.player.off(e.LEVEL_PTS_UPDATED,i),this.player.off(e.AUDIO_TRACKS_UPDATED,s,!1),this.player.off(e.AUDIO_TRACK_SWITCHED,s,!1),this.player.off(e.FRAG_LOADING,n),this.player.off(e.FRAG_LOAD_PROGRESS,n),this.player.off(e.FRAG_LOADED,n),this.player.off(e.FRAG_PARSED,n),this.player.off(e.FRAG_BUFFERED,n),this.player.off(e.FRAG_CHANGED,n),this.player.off(e.FRAG_PARSING_DATA,n),this.id3HandlingEnabled&&this.player.off(e.FRAG_PARSING_METADATA,this.onID3Event),this.player.off(e.ERROR,this.onError)},handleManifestData:function(e){this.bitrateList=this.player.levels;for(var t,i=e.levels,s=i.length,n=[];s--;)t=i[s],n.unshift({name:t.name||null,rate:t.bitrate,width:t.width,height:t.height});n.sort(function(e,t){var i=e.rate,s=t.rate;return i<s?-1:i>s?1:0}),this.resourceProvider.facadeMetadataParsed({abrInfo:n})},onRequest:function(e,t){this.withCredentials=this.withCredentials||t.indexOf("akamaihd")>-1&&t.indexOf("csmil")>-1,e.withCredentials=this.withCredentials,(this.multiCDNEnabled||-1!==t.indexOf(".m3u8"))&&e.addEventListener("readystatechange",function(i){if(-1!==t.indexOf(".ts")&&e.readyState===XMLHttpRequest.HEADERS_RECEIVED&&this.multiCDNEnabled){var s=e.getAllResponseHeaders();this.multiCDNEnabled=-1!==s.indexOf(this.responseHeaders.MULTI_CDN);var n=this.multiCDNEnabled?e.getResponseHeader(this.responseHeaders.MULTI_CDN.toUpperCase()):this.getCdnNameAtStartup(t);this.processResponseHeader(n,this.responseHeaders.MULTI_CDN)}}.bind(this))},onLibraryEvent:function(e,t){this.debug&&uvpjs.log(this.LIB_DEBUG_ID,e,t);var i=Hls.Events;switch(e){case i.MEDIA_ATTACHING:case i.MEDIA_ATTACHED:case i.MEDIA_DETACHING:case i.MANIFEST_LOADING:break;case i.MANIFEST_PARSED:this.handleManifestData(t);break;case i.FPS_DROP:break;case i.MANIFEST_LOADED:this.maxBitrate>-1&&(this.setMaxBitrateAllowed(this.maxBitrate),this.resourceProvider.facadeMaximumBitrateAllowedChanged(this.maxBitrate)),this.minBitrate>-1&&(this.setMinBitrateAllowed(this.minBitrate),this.resourceProvider.facadeMinimumBitrateAllowedChanged(this.minBitrate)),this.startBitrate>-1&&this.setStartBitrate(this.startBitrate),this.player.autoStartLoad||this.player.startLoad(this.startTime);break;case i.SUBTITLE_TRACKS_UPDATED:this.player.subtitleDisplay=!1}},onLevelEvent:function(e,t){this.debug&&uvpjs.log(this.LEVEL_DEBUG_ID,e,t);var i=Hls.Events;switch(e){case i.LEVEL_LOADED:this.resourceProvider.facadeVideoLevelLoaded(t.details);break;case i.LEVEL_LOADING:break;case i.LEVEL_UPDATED:t.details&&(this.levelDetails=t.details,this._isHdStreamLive=t.details.live);break;case i.LEVEL_PTS_UPDATED:break;case i.LEVEL_SWITCHING:this.resourceProvider.facadeVideoTransitionStart(this.bitrateList[t.level].bitrate);break;case i.LEVEL_SWITCHED:this.resourceProvider.facadeVideoTransitionComplete(this.bitrateList[t.level].bitrate)}},onAudioEvent:function(e,t){if(e===Hls.Events.AUDIO_TRACKS_UPDATED||e===Hls.Events.AUDIO_TRACK_SWITCHED){var i=this.normalizeAudioTrackInfo(this.player.audioTracks,this.mc.HLSJS),s={tracks:i,track:i[this.player.audioTrack],index:this.player.audioTrack};this.resourceProvider.facadeSetAudioTrackInfo(s),this.debug&&uvpjs.log(this.DEBUG_ID,"Audio Track switched "+s.track.id)}},onFragmentEvent:function(e,t){var i,s,n=Hls.Events;switch(e){case n.FRAG_LOAD_PROGRESS:break;case n.FRAG_PARSING_DATA:"video"===t.type&&(this._playbackFramerate=t.nb/(t.endPTS-t.startPTS));break;case n.FRAG_LOADED:i=8e3*(s=t.stats).loaded/Number(window.performance.now()-s.trequest),this._currentBandwidth=i,this._currentMaxBandwidth=Math.max(i,this._currentMaxBandwidth),this.networkErrorRecoveryCount=0,this.mediaErrorRecoveryCount=0;break;case n.FRAG_CHANGED:}},onID3Event:function(e,t){this.resourceProvider.facadeId3Data(t.samples)},onError:function(e,t){var i=!1,s=[Hls.ErrorDetails.MANIFEST_LOAD_ERROR,Hls.ErrorDetails.MANIFEST_PARSING_ERROR];if(t.fatal&&-1===s.indexOf(t.details))switch(this.debug&&uvpjs.error(this.DEBUG_ID,e,t.type,t.details,"isFatal: "+t.fatal),t.type){case Hls.ErrorTypes.NETWORK_ERROR:(i=this.networkErrorRecoveryCount<this.errorRecovery.networkRetryAttempts)&&(this.networkErrorRecoveryCount++,this.player.startLoad(this.startTime)),uvpjs.warn(this.DEBUG_ID,this.getErrorMsg(i).network());break;case Hls.ErrorTypes.MEDIA_ERROR:i=this.tryRecoveryFromMediaError()}else t.details===Hls.ErrorDetails.BUFFER_APPENDING_ERROR?this.mc.isFirefox()&&parseInt(this.mc.getBrowserMajorVersion())<49&&(this.debug&&uvpjs.warn(this.DEBUG_ID,"Handling Firefox buffer appending error.",t.type,t.details,"isFatal: "+t.fatal),i=this.tryRecoveryFromMediaError(),setTimeout(function(){this.player.startLoad(),this.player.media.play()}.bind(this),100)):this.debug&&uvpjs.warn(this.DEBUG_ID,e,t.type,t.details,"isFatal: "+t.fatal);i||(t.response&&t.response.code&&t.response.code===this.CDN_GEO_BLOCKED_HTTP_STATUS_CODE.AKAMAI?(this.resourceProvider.facadeError(this.getErrorInfoForType(uvpjs.ErrorInfo.errorCodes.RESOURCE_GEOBLOCKED,t.details,t.fatal)),this.debug&&uvpjs.warn(this.DEBUG_ID,uvpjs.ErrorInfo.messages.RESOURCE_GEOBLOCKED)):this.resourceProvider.facadeError(this.getErrorInfoForType(t.type,t.details,t.fatal)))},tryRecoveryFromMediaError:function(){var e=this.mediaErrorRecoveryCount<this.errorRecovery.mediaRetryAttempts;return e&&(this.mediaErrorRecoveryCount++,this.player.recoverMediaError()),uvpjs.warn(this.DEBUG_ID,this.getErrorMsg(e).media()),e},getErrorMsg:function(e){var t=e?this.errorRecovery.MSG_TRYING_TO_RECOVER_PREFIX:this.errorRecovery.MSG_MAX_ATTEMPS_REACHED_PREFIX,i=" attempt : ";return{network:function(){return i+=this.networkErrorRecoveryCount+"/"+this.errorRecovery.networkRetryAttempts,this.errorRecovery.MSG_NETWORK_ERROR+t+i}.bind(this),media:function(){return i+=this.mediaErrorRecoveryCount+"/"+this.errorRecovery.mediaRetryAttempts,this.errorRecovery.MSG_MEDIA_ERROR+t+i}.bind(this)}},getErrorInfoForType:function(e,t,i){var s=uvpjs.ErrorInfo,n=Hls.ErrorTypes,a=uvpjs.ErrorInfo.errorCodes;switch(e){case n.NETWORK_ERROR:return new s({errorCode:a.HLSJS_PLAYBACK_ERROR,hlsjsErrorCode:a.HLSJS_NETWORK_ERROR,message:s.messages.HLSJS_NETWORK_ERROR.replace("{INFO}",t),isFatal:i});case n.MEDIA_ERROR:return new s({errorCode:a.HLSJS_PLAYBACK_ERROR,hlsjsErrorCode:a.HLSJS_MEDIA_ERROR,message:s.messages.HLSJS_MEDIA_ERROR.replace("{INFO}",t),isFatal:i});case n.MUX_ERROR:return new s({errorCode:a.HLSJS_PLAYBACK_ERROR,hlsjsErrorCode:a.HLSJS_MUX_ERROR,message:s.messages.HLSJS_MUX_ERROR.replace("{INFO}",t),isFatal:i});case n.OTHER_ERROR:return new s({errorCode:a.HLSJS_PLAYBACK_ERROR,hlsjsErrorCode:a.HLSJS_OTHER_ERROR,message:s.messages.HLSJS_OTHER_ERROR.replace("{INFO}",t),isFatal:i});case a.RESOURCE_GEOBLOCKED:return new s({errorCode:a.RESOURCE_GEOBLOCKED,hlsjsErrorCode:a.HLSJS_OTHER_ERROR,message:s.messages.RESOURCE_GEOBLOCKED,isFatal:i})}},setErrorRecoveryOverrides:function(e){["network","media"].forEach(function(t){e[t]&&e[t].attempts&&"number"==typeof e[t].attempts&&(this.errorRecovery[t+"RetryAttempts"]=e[t].attempts)}.bind(this))}}),function(e){"use strict";function t(e){if(!isNaN(e))return e<1048576?(e/1024).toFixed(2)+"k":e<1073741824?(e/1048576).toFixed(2)+"M":(e/1073741824).toFixed(2)+"G"}uvpjs.register("uvpjs").Diagnostic=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.VIDEO_PLAYER_FACADE,PREFIX:"diagnostic_",init:function(e){var t,i=uvpjs.Configuration;this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"Diagnostic: Create diagnostic window."),e&&(t=e.videoEl,this._videoEl=t,this._containerEl=e.containerEl,this._eventsMgr=e.eventsMgr,this._containerId=this._containerEl.id,this._diagnosticId=this.PREFIX+this._containerId,this._contentEl=t.parentNode,this._namespace="."+this._containerId+".diagnostic",this._menuEl=null,this._diagEl=null,this._styleEl=null,this._diagTableEl=null,this._showDiagBtn=null,this._hideDiagBtn=null,this._params={"player version":i.version,"stream type":null,"playback state":null,duration:null,"current time":null,"buffer length":null,"total dropped frames":null,"average dropped (fps)":null,"playback framerate (fps)":null,"switching mode":null,"available indexes":null,"transition state":null,"start index bitrate (B/s)":null,"current index bitrate (B/s)":null,"current bandwidth (B/s)":null},uvpjs.util.createStyleSheet(this._finalize.bind(this)))},destroy:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"Diagnostic: Removing diagnostic window."),this._diagEl&&this._contentEl?(this._removeEventListeners(),this._removeDiag(),this._eventsMgr=null,this._containerEl=null,this._diagnosticId=null,this._contentEl=null,this._videoEl=null,this._diagEl=null,this._menuEl=null,this._styleEl=null,this._diagTableEl=null,this._showDiagBtn=null,this._hideDiagBtn=null,this._namespace=null,this._params=null):this.debug&&uvpjs.warn(this.DEBUG_ID,"Diagnostic: unable to remove window.")},show:function(){this._showDiag()},hide:function(){this._hideDiag()},_finalize:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"Diagnostic: _finalize"),this._styleEl=e,this._createDiag(),this._addEventListeners()},_createDiag:function(){var e,t,i,s=uvpjs.util,n=this._styleEl,a=this._contentEl;this._template,this._params;a&&((e=document.createElement("div")).id=this._diagnosticId,a.insertBefore(e,a.firstChild),(i=uvpjs.util.htmlToElement("<span>x</span>")).addEventListener("click",this._handleCloseButton.bind(this),!0),e.appendChild(i),t=document.createElement("table"),e.appendChild(t),s.addCSSObject(n,e,{background:"rgba(28, 28, 28, 0.7)",border:0,"border-radius":"4px",color:"white",display:"none","font-family":"Arial, Tahoma, Geneva, sans-serif","font-size":"12px",left:"5px","line-height":"1",padding:"5px",position:"absolute",top:"5px","z-index":10}),s.addCSSObject(n,e,{color:"#777",cursor:"pointer",float:"right","font-size":"14px","line-height":"1",margin:"-15px -10px",padding:"10px"},"span"),s.addCSSObject(n,e,{color:"#fff"},"span:hover"),s.addCSSObject(n,e,{"border-spacing":"auto","margin-right":"20px",border:0,padding:0,margin:0},"table"),s.addCSSObject(n,e,{background:"transparent"},"table td"),s.addCSSObject(n,e,{color:"#c9c9c9",padding:"0 5px"},"table td:first-child"),s.addCSSObject(n,e,{width:"60px"},"table td:last-child"),this._diagEl=e,this._diagTableEl=t,this._hideDiagBtn=i)},_removeDiag:function(){var e=this._diagEl,t=this._hideDiagBtn;t&&t.removeEventListener("click",this._handleCloseButton.bind(this)),e&&e.remove()},_hideDiag:function(){var e=this._diagEl,t=this._eventsMgr;e&&(e.style.display="none"),t.dispatchEvent(t.eventTypes.DIAGNOSTIC_WINDOW_CLOSED,{},this._containerId)},_showDiag:function(){var e=this._diagEl;e&&(e.style.display="block")},_toggleDiag:function(){var e=this._diagEl;e&&("block"!==e.style.display?this._showDiag():this._hideDiag())},_handleCloseButton:function(){var e=this._eventsMgr;this.debug&&uvpjs.log(this.DEBUG_ID,"_handleCloseButton"),this._hideDiag(),e.dispatchEvent(e.eventTypes.DIAGNOSTIC_WINDOW_CLOSE_BUTTON,{},this._containerId)},_addEventListeners:function(){var e=this._namespace,t=this._eventsMgr,i=t.eventTypes;this._containerEl;t&&e?(this.debug&&uvpjs.log(this.DEBUG_ID,"Diagnostic: Adding event listeners."),t.addEventListener(i.VIDEO_PROGRESS+e,this._onVideoProgress.bind(this)),t.addEventListener(i.VIDEO_STATE_CHANGE+e,this._onVideoStateChange.bind(this)),t.addEventListener(i.VIDEO_TRANSITION_START+e,this._onVideoTransitionStart.bind(this)),t.addEventListener(i.VIDEO_TRANSITION_COMPLETE+e,this._onVideoTransitionComplete.bind(this))):this.debug&&uvpjs.warn(this.DEBUG_ID,"Diagnsotic: unable to add event listeners.")},_removeEventListeners:function(){var e=this._namespace,t=this._eventsMgr,i=t.eventTypes;this._containerEl;t&&e?(t.removeEventListener(i.VIDEO_PROGRESS+e),t.removeEventListener(i.VIDEO_STATE_CHANGE+e),t.removeEventListener(i.VIDEO_TRANSITION_START+e),t.removeEventListener(i.VIDEO_TRANSITION_COMPLETE+e)):this.debug&&uvpjs.warn(this.DEBUG_ID,"Diagnsotic: unable to remove event listeners.")},_updateTableHtml:function(){var e,t,i="",s=this._params;for(e in s)null!=(t=s[e])&&(i+="<tr><td>"+e+"</td><td>"+t+"</td></tr>");this._diagTableEl.innerHTML=i},_onVideoProgress:function(e){var i=e.payload,s=i.facadeState,n=this._params,a=s.minABRLevel,r=s.maxABRLevel;e.target===this._containerId&&(n["stream type"]=i.streamType,n.duration=i.duration,n["current time"]=i.currentTime.toFixed(2),n["buffer length"]=i.bufferLength.toFixed(2),n["total dropped frames"]=i.droppedFrames>=0&&i.droppedFrames||null,n["average dropped (fps)"]=i.averageDroppedFPS>=0&&i.averageDroppedFPS.toFixed(2)||null,n["playback framerate (fps)"]=i.playbackFramerate>=0&&i.playbackFramerate.toFixed(2)||null,n["current bandwidth (B/s)"]=i.currentBandwidth>=0&&t(i.currentBandwidth)||null,n["switching mode"]=i.switchingMode,n["current index bitrate (B/s)"]=t(s.currentAbr&&s.currentAbr.bitrate),n["start index bitrate (B/s)"]=t(s.startBitrate),void 0!==a&&void 0!==r&&(n["available indexes"]=a+" to "+r),this._updateTableHtml())},_onVideoStateChange:function(e){var t=e.payload,i=this._params;e.target===this._containerId&&(i["playback state"]=t.newState,this._updateTableHtml())},_onVideoTransitionStart:function(e){var t=e.payload,i=this._params;e.target===this._containerId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"Diagnostic: _onVideoTransitionStart",t),i["transition state"]="start",this._updateTableHtml())},_onVideoTransitionComplete:function(e){var t=e.payload,i=this._params;e.target===this._containerId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"Diagnostic: _onVideoTransitionComplete",t),i["transition state"]="complete",this._updateTableHtml())}})}(),function(e){"use strict";uvpjs.register("uvpjs").Watermark=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.VIDEO_PLAYER_FACADE,IMAGE:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJIAAAAqCAYAAABY4gKWAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpGNTVGM0ZGMTBGN0IxMUUzOEQxQ0UwRUY4QzJFQzczMyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpGNTVGM0ZGMjBGN0IxMUUzOEQxQ0UwRUY4QzJFQzczMyI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkY1NUYzRkVGMEY3QjExRTM4RDFDRTBFRjhDMkVDNzMzIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkY1NUYzRkYwMEY3QjExRTM4RDFDRTBFRjhDMkVDNzMzIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+PHDLXgAACblJREFUeNrsXAdz2zoMBjU8Yzuz+f//7rWNM7yn9Ky7DxHCUhIoS26aC+94SRuJAoEPk8OkaUrf7bud26JvFnzZFpx659S7px5D1gY9awn6/tR3p7499UPdj5lvi/TlWgacK/wMAZwyITOwjgDVCj25FJAiIL6D3wNBFIF4RvwWPfXQpKZbCmYdlXRUtVDMPwbdJAQn589af2wRQL1TH4OeQNDghQf0zDItTn2uHcMXSBnzBiC6g3+TAvEpiNuc+hJMLWrZuI8tMTuBMHfQuk2NMfrggUbjjaVUO3xz1SCoMtBMTn2I35MGxmRAZcr/ip+NACkjcARiozPRnoCRbwXMzID0o0XNNUL4KzBKI9TM6lxDicyZPMi+t4bG78+YS8arG4A6aYlXKWQ1PxdIfTAwrsm8ImBmDHxxWIW2geSi46lCoAMILGxY448Q0LwGXzPw3EGxkwvwaQalqwWkCfwuNQQgF9pf4O7+BpCYSZnL+VUgkMwK37bEA/7+BkLaeYDoXsRCl+JTIZiCkhdvAaS0JWJTgOkWGv+3WgLwjktcB7UosARWv+eR5Nx5gsiUdB86x8gI1XWkG7zQtsmUYDp4aGQbdAyRqRwE868V6XMTmr6EtmsAcatwZ0b8PIqeWM+E+H6ojPsS8GRvB+AuIF0hsPYBkXEwXBuQMphu4F58tMwHKFV/D2EZ5iKd7ireLZu7JqPlWFHTRqArUdSEtgjot2J+gSUXLoXEmHtXlDLKvnFtyyoqyEx8hJkIgg94l2tBfYxZxdAUkxhb8VJZ2yqFHIGJmjlFVmykKeZxKUHOPcK8O0Lbi3jwoswaI/AnKQHQHoqwxnMG4BsIINl1vi3eeRXufATZuebPshpJKxo5gmtNLUKmhcsCRqzxIc76QkW9petR23kmXUmf6yxXCjAHFgCrQJTNcVoxrxiCHFguKQD/Nh7WyCWbAHx4A6BT4VnGVrkmddQFh6BtJQL+Keie4G/2uynGf5d9ZGUCfSWIDvjYTuEyVnjuXpQQbLewE5oUeVhDbZD4Isx2FZh47EDx/ZVivJ2YHws3EIqmDbCHDtkYxHWyJmdEjJtWyFMCZAhrxHLlsgiXPgLLXTNNMztru1IIh4O3356B8QFEHQV4AoH+n0B3m8H9UTG3pCTuKUrDfb7/hthiDXBrQ4i+JSsj3OKzNTeZKPkkCQnAcW8p8wo07xyukd3f+x8CZWCZQvB1VokPMJ1cen8CgcsL1UJCxTM7h6aWMT4T2IOIQbSx3S/yq2j3LWuZgH8Lh/s7J9tmS3NrGZU9jMdaYIaD9Ei6tq4iIA1A+PYMYa5hfbYNAEMLvgDuJK6IZfYiXklFNlnlunroR5EWH/D7oQEl4cVxSc/UEVvxMta530swn4GV+CT47r3IHAP8vpdA0jBt2YDwtw1ZmBtlPBejV9Vd5uIZXmSOPADNTO0LIHJtbCviDt8WW7J5KQjQr6i55RIOpu0YkMH0IBQzw848EsRq0tymQNBE63lqWVVB0HYTK8ulaAWQWiDoCHfDtZ016Vf/QxGzzUqUuU/NhQgp5Vtkto5YL4vLfoii5ru/CxWavafP1VKPXlZInIMx5ADS3rPw6aIxEUDuIf54hBsyHkDaIVgveiaiZmNNI2qArljyDfgJyKqbnJv1/Gttg3itKHviBeWmwZ9A8DfQ6kgBpBSJSloBtksmKAvw0BtIX21PbiDijzKwPZP/AqcWULzTIVZ4g03FM20AyShiZkOKoludAuC/0jIh3sHNlG3tXSL1PdCf24mbAFRI+Wp+0TNxRUzY5g6NMjwM+ZlAEYz61GH+pSatwkOFVWA3yLspmwQUB7bjkpCCF0rLwo42gFQWzgxFGeAdSEfFZD/b0SXj2csyutBRhHM9NwOgpsi8uLYTnOleUtRtgoLvMtgmJQI/tGAt9yUliYlMJBgch4o6kkwHd58ESNpVc94e0iuZX0L5MZ65QkuX6HySJBY/ZbqudTmsqF0AVLaDGGcM/q8LrGa3IcvEcdmuILa8E0nAh0XbDRXsfLMGGDYApLihUsKG9Es1C1icYYWyDPCsVhhHUReSKTNXo7si/tKM2XGAZG+9m83jyVHfWUCGTWy/NQV8MABRh/LK9k66Ns2Zq4TyFeK6rYfg9o78CopNBP8zql4Jjwtc+KgihpJj8P6kV7jB3xC6hl6Xa+PqOFu4QAjTBvWsAfcWgN6lg9+39HGHSMLZpIyRdqRb/b+tGXgHlG9dHSDAfQBhl2iJiGl8inADzPmhJvg3IuurK+QNfdwcF1K+WCzbHAAIzlBOrlynVnhwTx+3shgB8g8fXCg1LqY/txpoQHRP+eIj9x4Y8gimtFli6FD1wrS9DykUQSUL77qGIlXtC6KK7Hlt/U1aponFt2dYRN/MMgCI7KNZPdS67L1qRrrhwEL9RoHmVBTShgpimRDXIT6Zgt+jGw/h+MRl18ox5bj2eT4OeB8hwFj5/ZFQorJWFPPxmXzjoHUC/vbE/z/BtSYKQBkBil8i9soMxQ2UJ3KA6CiNj21V3ki3WSsVKfOYivdsD8R4VTsLDPmdj9eu/jMt2tMgB+HSXLsSE2GpRpRXnXnbiNxK21FkjHLcskRmTu5jW7IWtsFzG8oXeEeitGAc727FO4yJK8y96EAoB+PvsnIdkBwphWQjWmqtIb+LDDjd/ImJPCrfoQatF2vZf/j9kXSHBlzzJ08eGBFLlbWJcLVlPGFwr0XsG9LHNTl5RCmkfAtMh8pPFLOsPhwojQqQH5N+p53NKFPh74vGeFEEw3Vdm1YhtqDbZc5950+eyqjZ6zWj/AKPtIQnXNca0Z/n2uT+qVB0Cfoqul/tZ6KSYl8Ak9jmPmrWZldd5NIthRIFdNkqPu+HWilp5L1AQUVNLBUJQ6gYN1HS+kqOBeSyhcIp/GDTC5W25k6VTGxbmDO4gQQuZtPi3OV3d1RyOUNB4D31sN5192u5aF1QwcmXQIH+KeULlU0ykFPN5V8EkCH3kekDwCQznzZAxIcgfPd6bTzB1AStC3JvACwMtl2NT3n2RQBa924gPuv2VpDuXuI2Ep9rZWLKT57Wnbv93QTgfTszdOghMYqpvfuROG4utZq+N7bFlG8fiJUptRFavqXqkyht3tjGAbCkRbteF1F+W11MutvqJA98bq3zaSHqXYOGkxC+O+qV3IvEZwFJMiYWTLVvTJUBHDNvqzThAZ2/DlcFosOZ4/BKvX1/pqtgaN+j2VbyMqD82FVdQElLvfKxmE3eamss7WsjRf/M7TPM38AFD0l/xycJd8tKv/BVtu/rkb9uY6vZLbCa8oQLX5K6qwv+/wUYAJgTliFeAJfvAAAAAElFTkSuQmCC",PREFIX:"watermark_",OFFSET:10,SIZE:.1,RATIO:42/146,init:function(e){var t;this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"Create CBS watermark."),e&&(t=e.videoEl,this._videoEl=t,this._eventsMgr=e.eventsMgr,this._containerId=e.containerId,this._watermarkId=this.PREFIX+this._containerId,this._contentEl=t.parentNode,this._namespace="."+this._containerId+".waterkmark",this._imgEl=null,this._createImage(),this._addEventListeners())},destroy:function(){this._imgEl&&this._contentEl?(this._removeEventListeners(),this._removeImage(),this._eventsMgr=null,this._containerId=null,this._watermarkId=null,this._contentEl=null,this._videoEl=null,this._namespace=null,this._imgEl=null):this.debug&&uvpjs.warn(this.DEBUG,"Unable to remove watermark.")},_createImage:function(){var e;this._contentEl&&((e=document.createElement("img")).id=this._watermarkId,e.src=this.IMAGE,e.style.position="absolute",e.style.display="none",this._imgEl=e,this._contentEl.appendChild(e))},_removeImage:function(){var e=this._imgEl;e&&e.parentNode&&e.parentNode.removeChild(e)},_ensureImage:function(){document.getElementById(this._watermarkId)||(this._createImage(),this._setPosition(),this._showImage())},_hideImage:function(){var e=this._imgEl;e&&(e.style.display="none")},_showImage:function(){var e=this._imgEl;e&&(e.style.display="block")},_addEventListeners:function(){var e=this._namespace,t=this._eventsMgr,i=t.eventTypes;t&&e?(t.addEventListener(i.AD_START+e,this._hideImage.bind(this)),t.addEventListener(i.CONTENT_START+e,this._showImage.bind(this)),t.addEventListener(i.CONTENT_END+e,this._hideImage.bind(this)),t.addEventListener(i.CONTAINER_RESIZE+e,this._onContainerResize.bind(this)),this._videoEl.addEventListener("canplay",this._onCanPlay.bind(this)),t.addTimedEventCallback(t.HALF_SECOND,e,this._ensureImage.bind(this))):this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to add event listeners.")},_removeEventListeners:function(){var e=this._namespace,t=this._eventsMgr,i=t.eventTypes;t&&e?(t.removeEventListener(i.AD_START+e),t.removeEventListener(i.CONTENT_START+e),t.removeEventListener(i.CONTENT_END+e),t.removeEventListener(i.CONTAINER_RESIZE+e),t.removeTimedEventCallback(this.TIMER_INTERVAL,e),this._videoEl.removeEventListener(this.HTML5_CAN_PLAY,this._onCanPlay.bind(this))):this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to remove event listeners.")},_onCanPlay:function(){this._setPosition(),this._showImage()},_onContainerResize:function(e){e.target===this._containerId&&this._setPosition()},_setPosition:function(){var e,t,i,s,n,a,r,o,l,d,u,c,h,p,g,f,v,m,_,E,A;t=this._contentEl,i=this._videoEl,(e=this._imgEl)&&i&&t&&(h=i.videoHeight,(p=i.videoWidth)&&h&&(a=this.OFFSET,d=this.SIZE,r=i.getBoundingClientRect(),g=t.getBoundingClientRect(),u=(o=r.height)/(l=r.width)/(c=h/p),s=l*c,n=o/c,f=g.bottom-r.bottom,v=g.right-r.right,u>1?(m=(o-s)/2,_=0,A=l*d+"px",E="auto"):(m=0,_=(l-n)/2,A="auto",E=o*d*(this.RATIO/c)+"px"),e.style.width=A,e.style.height=E,e.style.bottom=m+f+a+"px",e.style.right=_+v+a+"px"))}})}(),function(e){"use strict";uvpjs.register("uvpjs").Kaleidoscope360=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.VIDEO_PLAYER_FACADE,PREFIX:"360_",KALEIDOSCOPE_SDK_PATH:uvpjs.Configuration.path+"lib/kaleidoscope.min.js",init:function(e){var t;this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"Setup Kaleidoscope for 360 playback"),e&&(t=e.videoEl,this._videoEl=t,this._eventsMgr=e.eventsMgr,this._containerId=e.containerId,this._360Id=this.PREFIX+this._containerId,this._360El=null,this._contentEl=t.parentNode,this._namespace="."+this._containerId+".kaleidoscope360",this._kaleidoscopeViewer=null,this._loadKaleidoscope(this._setupKaleidoscope.bind(this)),this._addEventListeners())},destroy:function(){this._360El&&this._kaleidoscopeViewer?(this._removeEventListeners(),this._kaleidoscopeViewer&&this._kaleidoscopeViewer.destroy(),this._remove360Dom(),this._eventsMgr=null,this._containerId=null,this._contentEl=null,this._videoEl=null,this._namespace=null,this._kaleidoscopeViewer=null,this._360El=null):this.debug&&uvpjs.warn(this.DEBUG,"Unable to remove Kaleidoscope360.")},_loadKaleidoscope:function(e){if("function"==typeof e){if(this.pluginLoadedCB=function(){this.isPluginLoaded=!0,e()}.bind(this),!window.Kaleidoscope||!window.Kaleidoscope.Video)return this.codeLoader=new uvpjs.CodeLoader,void this.codeLoader.loadScript(this.KALEIDOSCOPE_SDK_PATH,this.pluginLoadedCB);this.pluginLoadedCB()}else this.debug&&uvpjs.warn(this.DEBUG_ID,"VideoPlayerFacade _loadKaleidoscope: no callback supplied.")},_setupKaleidoscope:function(){this._kaleidoscopeViewer||(this._create360Dom(),this._kaleidoscopeViewer=new window.Kaleidoscope.Video({source:this._videoEl,container:this._360El,height:this._contentEl.clientHeight,width:this._contentEl.clientWidth}))},_create360Dom:function(){this._360El=document.createElement("div"),this._360El.id=this._360Id,this._360El.style.position="absolute",this._360El.style.zIndex="1",this._contentEl.appendChild(this._360El)},_remove360Dom:function(){this._360El&&this._360El.remove()},_startKaleidoscopeRender:function(){this._kaleidoscopeViewer&&this._kaleidoscopeViewer.render()},_handleContainerResize:function(){this._kaleidoscopeViewer&&this._contentEl&&this._kaleidoscopeViewer.setSize({height:this._contentEl.clientHeight,width:this._contentEl.clientWidth})},_addEventListeners:function(){var e=this._namespace,t=this._eventsMgr,i=t.eventTypes;t&&e?(t.addEventListener(i.CONTAINER_RESIZE+e,this._handleContainerResize.bind(this)),t.addEventListener(i.CONTENT_START+e,this._startKaleidoscopeRender.bind(this))):this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to add event listeners.")},_removeEventListeners:function(){var e=this._namespace,t=this._eventsMgr,i=t.eventTypes;t&&e?(t.removeEventListener(i.CONTAINER_RESIZE+e),t.removeEventListener(i.CONTENT_START+e)):this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to remove event listeners.")}})}(),uvpjs.register("uvpjs").ResourceConfigObject=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_CONFIG_OBJECT,init:function(e,t,i){this.debug=uvpjs.debug,this.validationInfo=null,this.id=t,this.vidContId=i,this.rcoSeed={},this.initialize(e)},initialize:function(e){this.validationInfo=this.validateUserRco(e),this.validationInfo&&(this.rcoSeed=e,this.populateSelf(e))},getContextMetadata:function(){return this.contextMetadata||null},populateSelf:function(e){var t;for(t in e)e.hasOwnProperty(t)&&(this[t]=e[t])},has:function(e){return!uvpjs.util.isEmpty(this[e])},getValidationInfo:function(){return this.validationInfo},validateUserRco:function(e){return{error:!1,message:""}}}),uvpjs.register("uvpjs").RCO_URL=uvpjs.ResourceConfigObject.subClass({init:function(e,t,i){this._super(e,t,i)},validateUserRco:function(e){var t=this._super(e),i=uvpjs.util.isDefinedString(e.assetURL);return{error:t.error||!i,message:t.error?t.message:"Invalid assetURL"}}}),uvpjs.register("uvpjs").DaiRco=uvpjs.ResourceConfigObject.subClass({init:function(e,t,i){this.daiParams={adTagParameters:null,contentSourceId:null,daiVideoId:null,dfpMediaId:null,assetKey:null,apiKey:null,useSsb:!1},this._super(e,t,i)},useSsb:function(){return this.daiParams.useSsb},setCmsRefGuid:function(e){this.cmsRefGuid=e,this.daiParams.daiVideoId=e},canMakePlatformCall:function(e){var t=uvpjs.util.isDefinedString(e),i=this.has("selectorCall")&&this.selectorCall||t&&e;return!!i&&(i.indexOf("$PID$")>-1?this.has("pid"):!(i.indexOf("$GUID$")>-1)||this.has("cmsRefGuid"))},getAdTagParameters:function(){return this.daiParams.adTagParameters},getVideoId:function(){var e=this.daiParams.dfpMediaId,t=this.daiParams.daiVideoId,i=e||t||!this.has("cmsRefGuid")?null:this.cmsRefGuid;return e||t||i},getContentSourceId:function(){return this.daiParams.contentSourceId},getAssetKey:function(){return this.daiParams.assetKey},getApiKey:function(){return this.daiParams.apiKey},validateUserRco:function(e){var t=window.google&&google.ima&&google.ima.dai,i=this.validateDaiConfig(e),s=this._super(e),n=t?i?"":"Supplied RCO is not valid for rp_dai":"DAI SDK is missing.";return{error:!((e.useSsb||t)&&i&&!s.error),missingSDK:!t,message:s.error?s.message:n}},populateSelf:function(e){var t,i;for(t in e)(i=e.hasOwnProperty(t))&&void 0!==this.daiParams[t]?this.daiParams[t]=e[t]:i&&(this[t]=e[t]);this.daiParams.daiVideoId&&!this.cmsRefGuid&&(this.cmsRefGuid=this.daiParams.daiVideoId),this.checkCustomAdTagParams()},validateDaiConfig:function(e){var t=uvpjs.util,i=!t.isEmpty(e.adTagParameters),s=!t.isEmpty(e.contentSourceId),n=!t.isEmpty(e.assetKey);return e.useSsb||n||i&&s?e.useSsb?!t.isEmpty(e.assetURL):n||i&&s:(this.debug&&uvpjs.error("DaiRco: missing contentSourceId or adTagParameters."),i&&s)},checkCustomAdTagParams:function(){var e,t=uvpjs.util,i=this.daiParams.adTagParameters?this.daiParams.adTagParameters.cust_params:null;i&&"string"!=typeof i&&t.isPlainObject(i)&&(e=t.queryStrFromObj(i),this.daiParams.adTagParameters.cust_params=encodeURIComponent(e))}}),uvpjs.register("uvpjs").RCO_IMA=uvpjs.ResourceConfigObject.subClass({init:function(e,t,i){this._super(e,t,i)},validateUserRco:function(e){var t=window.google&&google.ima,i=this._super(e);return{error:!(t&&!i.error),missingSDK:!t,message:i.error?i.message:"IMA SDK is missing."}}}),uvpjs.register("uvpjs").RCO_Mdialog=uvpjs.ResourceConfigObject.subClass({init:function(e,t,i){this._super(e,t,i)},validateUserRco:function(e){var t=this._super(e);return{error:t.error||!uvpjs.util.isDefinedString(e.assetURL),message:t.err?t.message:"Invalid assetURL"}}}),uvpjs.register("uvpjs").RCO_Platform=uvpjs.ResourceConfigObject.subClass({init:function(e,t,i){this._super(e,t,i)},validateUserRco:function(e){var t=uvpjs.util,i=t.isDefinedString(e.pid),s=!i&&t.isDefinedString(e.cmsRefGuid)&&!t.isDefinedString(e.assetURL),n=this._super(e);return{error:!(!n.error&&(i||s||t.isDefinedString(e.selectorCall))),message:n.error?n.message:"Supplied RCO is not valid for type rp_platform"}}}),function(e){"use strict";e.UvpSwfService=uvpjs.Class.subClass({init:function(e){this.debugId=e.debugId,this.debug=uvpjs.debug,this.containerId=e.containerId,this.dom=e.contentVideoDom,this.playerDom=e.playerDom,this.callback=e.readyCallback,this.id3OwnerIds=e.id3OwnerIds||"",this.capLevelToPlayerSize=e.capLevelToPlayerSize,this.swf=null,this.swfName=this.containerId+"UvpSwf",this.windowLabels=null,this.initTimeoutHandle=null,this.svcC=uvpjs.UvpSwfService,this.resizeTimeoutHandle=null,setTimeout(this.initialize.bind(this),1)},destroy:function(){var e;for(e in this.dom&&this.swf&&this.dom.removeChild(this.swf),this.dom=null,this.swf=null,this.callback=Function.prototype,this.windowLabels)window[this.windowLabels[e]]=null;this.windowLabels=null},getSwf:function(){return this.swf},getContainerSize:function(){return this.dom.getBoundingClientRect()},resetSize:function(){clearTimeout(this.resizeTimeoutHandle),this.resizeTimeoutHandle=setTimeout(this.setSize.bind(this),40)},setSize:function(){var e=this.getContainerSize(),t=e.width,i=e.height;this.swf&&this.swf.setSize(t,i,0,0)},playerReadyHandler:function(){clearTimeout(this.initTimeoutHandle),this.swf=-1!==navigator.appName.indexOf("Microsoft")?window[this.swfName]:document[this.swfName],this.startTimer(),this.swf.addEventJSCallback(this.svcC.constant.PLAYER_LOADED_EVENT,this.windowLabels.playerLoaded),this.swf.addEventJSCallback(this.svcC.constant.PLUGINS_AVAILABLE,this.windowLabels.pluginsAvailable)},playerLoadedHandler:function(){this.debug&&uvpjs.log(this.debugId,"UvpSwfService: playerLoaded event rec'd from SWF."),clearTimeout(this.initTimeoutHandle),this.callback(this.swf)},pluginsAvailableHandler:function(e){},startTimer:function(){this.initTimeoutHandle=setTimeout(function(){this.callback(null,this.svcC.error.PLAYER_INIT_TIMEOUT)}.bind(this),this.svcC.constant.INIT_TIMEOUT)},embedCompleteHandler:function(e){e.success?this.startTimer():this.callback(null,this.svcC.error.EMBED_FAILED)},embed:function(e){var t=this.windowLabels;this.svcC.swfobject.embedSWF(this.svcC.constant.SWF_URL,e,"100%","100%","10.3.0",!1,{cfg:"false",clts:this.capLevelToPlayerSize?"true":"false",smode:"fit",jsReady:t.jsReady,playerReady:t.playerReady,oid:this.id3OwnerIds||""},{allowScriptAccess:"always",allowFullScreen:"true",scale:"noscale",salign:"lt",wmode:"opaque"},!1,this.embedCompleteHandler.bind(this))},initialize:function(){var e,t,i=this.dom;this.svcC.hasFlash()?(this.windowLabels=this.svcC.setWindowMethods({jsReady:function(){return!0},playerReady:this.playerReadyHandler.bind(this),playerLoaded:this.playerLoadedHandler.bind(this),pluginsAvailable:this.pluginsAvailableHandler.bind(this)}),(e=document.createElement("div")).id=this.swfName,(t=i.querySelector("video")).style.display="none",i.style.height="100%",this.playerDom.style.height="100%",i.insertBefore(e,t),this.embed(e)):this.callback(null,this.svcC.error.FLASH_NOT_DETECTED)}}),e.UvpSwfService.constant={PLAYER_LOADED_EVENT:"onPlayerLoaded_cbsi",PLUGINS_AVAILABLE:"pluginsAvailable",SWF_URL:"//vidtech.cbsinteractive.com/uvpjs/uvpjsf/js_falback.swf",INIT_TIMEOUT:3e4,CDN:"akamai_hd"},e.UvpSwfService.error={FLASH_NOT_DETECTED:"Unable to use Flash; Flash Player not available.",EMBED_FAILED:"Embed of UVP Flash via swfobject failed.",PLAYER_INIT_TIMEOUT:"Player failed to initialize before timeout of 30 sec."},e.UvpSwfService.hasFlash=function(){var e=this.swfobject.getFlashPlayerVersion().major;return!uvpjs.util.isEmpty(e)&&parseInt(e)>0},e.UvpSwfService.setWindowMethods=function(e){var t,i,s,n=uvpjs.util;for(t in e)i=e[t],s="f_"+n.uid8(),window[s]=i,e[t]=s;return e},e.UvpSwfService.swfobject=function(){var e,t,i,s,n,a,r="undefined",o="object",l="Shockwave Flash",d="application/x-shockwave-flash",u="SWFObjectExprInst",c="onreadystatechange",h=window,p=document,g=navigator,f=!1,v=[],m=[],_=[],E=[],A=!1,y=!1,S=!0,b=!1,T=function(){var e=typeof p.getElementById!=r&&typeof p.getElementsByTagName!=r&&typeof p.createElement!=r,t=g.userAgent.toLowerCase(),i=g.platform.toLowerCase(),s=/win/.test(i||t),n=/mac/.test(i||t),a=!!/webkit/.test(t)&&parseFloat(t.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")),u="Microsoft Internet Explorer"===g.appName,c=[0,0,0],v=null;if(typeof g.plugins!=r&&typeof g.plugins[l]==o)(v=g.plugins[l].description)&&typeof g.mimeTypes!=r&&g.mimeTypes[d]&&g.mimeTypes[d].enabledPlugin&&(f=!0,u=!1,v=v.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),c[0]=F(v.replace(/^(.*)\..*$/,"$1")),c[1]=F(v.replace(/^.*\.(.*)\s.*$/,"$1")),c[2]=/[a-zA-Z]/.test(v)?F(v.replace(/^.*[a-zA-Z]+(.*)$/,"$1")):0);else if(typeof h.ActiveXObject!=r)try{var m=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");m&&(v=m.GetVariable("$version"))&&(u=!0,c=[F((v=v.split(" ")[1].split(","))[0]),F(v[1]),F(v[2])])}catch(e){}return{w3:e,pv:c,wk:a,ie:u,win:s,mac:n}}();T.w3&&((typeof p.readyState!=r&&("complete"===p.readyState||"interactive"===p.readyState)||typeof p.readyState==r&&(p.getElementsByTagName("body")[0]||p.body))&&C(),A||(typeof p.addEventListener!=r&&p.addEventListener("DOMContentLoaded",C,!1),T.ie&&(p.attachEvent(c,function e(){"complete"==p.readyState&&(p.detachEvent(c,e),C())}),h==top&&function e(){if(!A){try{p.documentElement.doScroll("left")}catch(t){return void setTimeout(e,0)}C()}}()),T.wk&&function e(){A||(/loaded|complete/.test(p.readyState)?C():setTimeout(e,0))}()));function C(){if(!A&&document.getElementsByTagName("body")[0]){try{var e,t=x("span");t.style.display="none",(e=p.getElementsByTagName("body")[0].appendChild(t)).parentNode.removeChild(e),e=null,t=null}catch(e){return}A=!0;for(var i=v.length,s=0;s<i;s++)v[s]()}}function I(e){A?e():v[v.length]=e}function D(){var e=m.length;if(e>0)for(var t=0;t<e;t++){var i=m[t].id,s=m[t].callbackFn,n={success:!1,id:i};if(T.pv[0]>0){var a=j(i);if(a)if(!G(m[t].swfVersion)||T.wk&&T.wk<312)if(m[t].expressInstall&&P()){var o={};o.data=m[t].expressInstall,o.width=a.getAttribute("width")||"0",o.height=a.getAttribute("height")||"0",a.getAttribute("class")&&(o.styleclass=a.getAttribute("class")),a.getAttribute("align")&&(o.align=a.getAttribute("align"));for(var l={},d=a.getElementsByTagName("param"),u=d.length,c=0;c<u;c++)"movie"!=d[c].getAttribute("name").toLowerCase()&&(l[d[c].getAttribute("name")]=d[c].getAttribute("value"));M(o,l,i,s)}else k(a),s&&s(n);else H(i,!0),s&&(n.success=!0,n.ref=R(i),n.id=i,s(n))}else if(H(i,!0),s){var h=R(i);h&&typeof h.SetVariable!=r&&(n.success=!0,n.ref=h,n.id=h.id),s(n)}}}function R(e){var t=null,i=j(e);return i&&"OBJECT"===i.nodeName.toUpperCase()&&(t=typeof i.SetVariable!==r?i:i.getElementsByTagName(o)[0]||i),t}function P(){return!y&&G("6.0.65")&&(T.win||T.mac)&&!(T.wk&&T.wk<312)}function M(n,a,o,l){var d=j(o);if(o=B(o),y=!0,i=l||null,s={success:!1,id:o},d){"OBJECT"==d.nodeName.toUpperCase()?(e=w(d),t=null):(e=d,t=o),n.id=u,(typeof n.width==r||!/%$/.test(n.width)&&F(n.width)<310)&&(n.width="310"),(typeof n.height==r||!/%$/.test(n.height)&&F(n.height)<137)&&(n.height="137");var c=T.ie?"ActiveX":"PlugIn",g="MMredirectURL="+encodeURIComponent(h.location.toString().replace(/&/g,"%26"))+"&MMplayerType="+c+"&MMdoctitle="+encodeURIComponent(p.title.slice(0,47)+" - Flash Player Installation");if(typeof a.flashvars!=r?a.flashvars+="&"+g:a.flashvars=g,T.ie&&4!=d.readyState){var f=x("div");o+="SWFObjectNew",f.setAttribute("id",o),d.parentNode.insertBefore(f,d),d.style.display="none",N(d)}O(n,a,o)}}function k(e){if(T.ie&&4!=e.readyState){e.style.display="none";var t=x("div");e.parentNode.insertBefore(t,e),t.parentNode.replaceChild(w(e),t),N(e)}else e.parentNode.replaceChild(w(e),e)}function w(e){var t=x("div");if(T.win&&T.ie)t.innerHTML=e.innerHTML;else{var i=e.getElementsByTagName(o)[0];if(i){var s=i.childNodes;if(s)for(var n=s.length,a=0;a<n;a++)1==s[a].nodeType&&"PARAM"==s[a].nodeName||8==s[a].nodeType||t.appendChild(s[a].cloneNode(!0))}}return t}function O(e,t,i){var s,n=j(i);if(i=B(i),T.wk&&T.wk<312)return s;if(n){var a,l,u,c=T.ie?x("div"):x(o);for(u in typeof e.id==r&&(e.id=i),t)t.hasOwnProperty(u)&&"movie"!==u.toLowerCase()&&L(c,u,t[u]);for(a in T.ie&&(c=function(e,t){var i=x("div");return i.innerHTML="<object classid='clsid:D27CDB6E-AE6D-11cf-96B8-444553540000'><param name='movie' value='"+e+"'>"+t+"</object>",i.firstChild}(e.data,c.innerHTML)),e)e.hasOwnProperty(a)&&("styleclass"===(l=a.toLowerCase())?c.setAttribute("class",e[a]):"classid"!==l&&"data"!==l&&c.setAttribute(a,e[a]));T.ie?_[_.length]=e.id:(c.setAttribute("type",d),c.setAttribute("data",e.data)),n.parentNode.replaceChild(c,n),s=c}return s}function L(e,t,i){var s=x("param");s.setAttribute("name",t),s.setAttribute("value",i),e.appendChild(s)}function N(e){var t=j(e);t&&"OBJECT"==t.nodeName.toUpperCase()&&(T.ie?(t.style.display="none",function e(){if(4==t.readyState){for(var i in t)"function"==typeof t[i]&&(t[i]=null);t.parentNode.removeChild(t)}else setTimeout(e,10)}()):t.parentNode.removeChild(t))}function U(e){return e&&e.nodeType&&1===e.nodeType}function B(e){return U(e)?e.id:e}function j(e){if(U(e))return e;var t=null;try{t=p.getElementById(e)}catch(e){}return t}function x(e){return p.createElement(e)}function F(e){return parseInt(e,10)}function G(e){e+="";var t=T.pv,i=e.split(".");return i[0]=F(i[0]),i[1]=F(i[1])||0,i[2]=F(i[2])||0,t[0]>i[0]||t[0]==i[0]&&t[1]>i[1]||t[0]==i[0]&&t[1]==i[1]&&t[2]>=i[2]}function V(e,t,i,s){var o=p.getElementsByTagName("head")[0];if(o){var l="string"==typeof i?i:"screen";if(s&&(n=null,a=null),!n||a!=l){var d=x("style");d.setAttribute("type","text/css"),d.setAttribute("media",l),n=o.appendChild(d),T.ie&&typeof p.styleSheets!=r&&p.styleSheets.length>0&&(n=p.styleSheets[p.styleSheets.length-1]),a=l}n&&(typeof n.addRule!=r?n.addRule(e,t):typeof p.createTextNode!=r&&n.appendChild(p.createTextNode(e+" {"+t+"}")))}}function H(e,t){if(S){var i=t?"visible":"hidden",s=j(e);A&&s?s.style.visibility=i:"string"==typeof e&&V("#"+e,"visibility:"+i)}}function $(e){return null!=/[\\\"<>\.;]/.exec(e)&&typeof encodeURIComponent!=r?encodeURIComponent(e):e}v[0]=function(){f?function(){var e=p.getElementsByTagName("body")[0],t=x(o);t.setAttribute("style","visibility: hidden;"),t.setAttribute("type",d);var i=e.appendChild(t);if(i){var s=0;!function n(){if(typeof i.GetVariable!=r)try{var a=i.GetVariable("$version");a&&(a=a.split(" ")[1].split(","),T.pv=[F(a[0]),F(a[1]),F(a[2])])}catch(e){T.pv=[8,0,0]}else if(s<10)return s++,void setTimeout(n,10);e.removeChild(t),i=null,D()}()}else D()}():D()};T.ie&&window.attachEvent("onunload",function(){for(var e=E.length,t=0;t<e;t++)E[t][0].detachEvent(E[t][1],E[t][2]);for(var i=_.length,s=0;s<i;s++)N(_[s]);for(var n in T)T[n]=null;for(var a in T=null,swfobject)swfobject[a]=null;swfobject=null});return{registerObject:function(e,t,i,s){if(T.w3&&e&&t){var n={};n.id=e,n.swfVersion=t,n.expressInstall=i,n.callbackFn=s,m[m.length]=n,H(e,!1)}else s&&s({success:!1,id:e})},getObjectById:function(e){if(T.w3)return R(e)},embedSWF:function(e,t,i,s,n,a,l,d,u,c){var h=B(t),p={success:!1,id:h};T.w3&&!(T.wk&&T.wk<312)&&e&&t&&i&&s&&n?(H(h,!1),I(function(){i+="",s+="";var g={};if(u&&typeof u===o)for(var f in u)g[f]=u[f];g.data=e,g.width=i,g.height=s;var v={};if(d&&typeof d===o)for(var m in d)v[m]=d[m];if(l&&typeof l===o)for(var _ in l)if(l.hasOwnProperty(_)){var E=b?encodeURIComponent(_):_,A=b?encodeURIComponent(l[_]):l[_];typeof v.flashvars!=r?v.flashvars+="&"+E+"="+A:v.flashvars=E+"="+A}if(G(n)){var y=O(g,v,t);g.id==h&&H(h,!0),p.success=!0,p.ref=y,p.id=y.id}else{if(a&&P())return g.data=a,void M(g,v,t,c);H(h,!0)}c&&c(p)})):c&&c(p)},switchOffAutoHideShow:function(){S=!1},enableUriEncoding:function(e){b=typeof e===r||e},ua:T,getFlashPlayerVersion:function(){return{major:T.pv[0],minor:T.pv[1],release:T.pv[2]}},hasFlashPlayerVersion:G,createSWF:function(e,t,i){return T.w3?O(e,t,i):void 0},showExpressInstall:function(e,t,i,s){T.w3&&P()&&M(e,t,i,s)},removeSWF:function(e){T.w3&&N(e)},createCSS:function(e,t,i,s){T.w3&&V(e,t,i,s)},addDomLoadEvent:I,addLoadEvent:function(e){if(typeof h.addEventListener!=r)h.addEventListener("load",e,!1);else if(typeof p.addEventListener!=r)p.addEventListener("load",e,!1);else if(typeof h.attachEvent!=r)!function(e,t,i){e.attachEvent(t,i),E[E.length]=[e,t,i]}(h,"onload",e);else if("function"==typeof h.onload){var t=h.onload;h.onload=function(){t(),e()}}else h.onload=e},getQueryParamValue:function(e){var t=p.location.search||p.location.hash;if(t){if(/\?/.test(t)&&(t=t.split("?")[1]),null==e)return $(t);for(var i=t.split("&"),s=0;s<i.length;s++)if(i[s].substring(0,i[s].indexOf("="))==e)return $(i[s].substring(i[s].indexOf("=")+1))}return""},expressInstallCallback:function(){if(y){var n=j(u);n&&e&&(n.parentNode.replaceChild(e,n),t&&(H(t,!0),T.ie&&(e.style.display="block")),i&&i(s)),y=!1}},version:"2.3"}}()}(uvpjs.register("uvpjs")),function(e){var t=e._;e.ResourceProvider=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,init:function(e){this.debug=uvpjs.debug,this.vidContId="",this.containers=e.containers,this.internalNS="",this.rco={},this.contentDataProxy=null,this.cviMgr={},this.eventsMgr={},this.cviModel={},this.RPM={},this.metadata={},this.facade={},this.dataLoadedCB=Function.prototype,this.dataLoadErrorCB=Function.prototype,this.errorInfo=null,this.contentStartOpen=!1,this.uvpSwfService=null,this._previousLocalStorageTime=0,this._previousResumeBeaconTime=0,this._localStorageInterval=3e3,this.preloadContent=!1,this.bufferingDetected=null,this.bufferingCheckInterval=1e3,this.bufferingCheckOffset=1/this.bufferingCheckInterval,this.bufferingCheckLastTime=0,this.deferLoadingCaptions=e.deferLoadingCaptions,this.id3HandlingEnabled=!1,this.id3Parser=null,this.id3EventQueue=null,this.p2pClient=e.p2pClient,this.multiCdnClient=e.multiCdnClient,this.suppressFacadePlay=!1,this._overrideAssetUrlFailure=!1,this.mc=uvpjs.mediaCapabilities,this.providerType="",this._seekToTime=null,this._seekFromTime=null,this.initialize(e.rco,e.cviMgr,e.vidContId)},initialize:function(e,i,s){var n;this.debug&&uvpjs.log(this.DEBUG_ID,"initialize rcObj = ",e),this.rco=e,this.vidContId=s,this.cviMgr=i,this.eventsMgr=this.cviMgr.getEventsMgr(),this.cviModel=this.cviMgr.getModelRef(),this.RPM=this.cviMgr.RPM,this.internalNS="."+this.vidContId+".rp",(n=this.cviModel.contentVideoState).sendResumeEvent=!1,n.startTime=0,n.elapsedTime=0,n.showPreroll=!0,n.playedChapterTime=0,n.previousSessionId="",this.contentDataProxy=new uvpjs.ContentDataProxy({cviModel:this.cviModel,eventsManager:this.eventsMgr}),t.isUndefined(this.cviModel.sessionOptions.resumeBeaconInterval)?this._resumeBeaconInterval=1e4:this._resumeBeaconInterval=1e3*this.cviModel.sessionOptions.resumeBeaconInterval,this.id3HandlingEnabled=this.cviModel.isId3HandlingRequired()},getProviderType:function(){return this.providerType},_addVideoProgressTimerCallback:function(){var e=this.eventsMgr;this._removeTimers(),e.addTimedEventCallback(e.TENTH_SECOND,this.internalNS,this.onUVPJSTimerTick.bind(this)),e.addTimedEventCallback(this.bufferingCheckInterval,this.internalNS,this.checkBuffering.bind(this))},setCaptionStyle:function(e){this._hasFacade()&&this.facade.setCaptionStyle&&this.facade.setCaptionStyle(e)},_removeTimers:function(){var e=this.eventsMgr;e.removeTimedEventCallback(e.TENTH_SECOND,this.internalNS),e.removeTimedEventCallback(this.bufferingCheckInterval,this.internalNS)},cleanUp:function(){var e=this.rco&&this.rco.rcoSeed;this.debug&&uvpjs.log(this.DEBUG_ID,"cleanUp dispatches CONTENT_END",this.rco?this.rco.id:"No current RCO."),this.dispatchVideoDone(),this.id3Parser&&this.id3Parser.destroy(),this.id3Parser=null,this.contentStartOpen&&(this.contentStartOpen=!1,this.dispatchContentEnd()),this.p2pClient&&this.p2pClient.destroy(),this.multiCdnClient&&this.multiCdnClient.destroy(),this.p2pClient=null,this.multiCdnClient=null,this._removeTimers(),this._removeUVPEventListeners(),this.destroyFacade(),this.cleanUpObjects(),this.killDataProxy(),this.RPM.resourceEnd(e)},cleanUpObjects:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"cleanUpObjects"),this.removeCaptionEventListeners(),this.uvpSwfService&&(this.uvpSwfService&&this.uvpSwfService.destroy(),this.uvpSwfService=null),this.vidContId=null,this.internalNS=null,this.rco=null,this.cviMgr=null,this.eventsMgr=null,this.cviModel=null,this.metadata=null,this.facade={},this.dataLoadedCB=Function.prototype,this.dataLoadErrorCB=Function.prototype,this.errorInfo=null,this._overrideAssetUrlFailure=!1,this._seekToTime=null,this._seekFromTime=null},killDataProxy:function(){this.contentDataProxy&&this.contentDataProxy.destroy(),this.contentDataProxy=null},loadVideoAndBeginPlayback:function(e){var t=this.cviModel;this.debug&&uvpjs.log(this.DEBUG_ID,"loadVideoAndBeginPlayback vidContId, rco",this.vidContId,this.rco),t.setNonDefaultContentVideoStateItems(this.contentDataProxy.getModel()),t.setContentVideoStateItems(this.rco),this.setModelRcoOverrides(),t.mergeCDOData(),this.killDataProxy(),this.suppressFacadePlay=e,this.multiCdnClient?this.multiCdnClient.getDecision(this.handleCdnDecision.bind(this,null)):this.doFlashCheck(null)},doFlashCheck:function(e){this.shouldUseFlash()?(this.cviModel.contentVideoState.isFlash=!0,this.uvpSwfService=new uvpjs.UvpSwfService({capLevelToPlayerSize:!0===this.rco.capLevelToPlayerSize,debugId:this.DEBUG_ID,containerId:this.vidContId,id3OwnerIds:this.cviModel.getConfiguredId3OwnerIds(),contentVideoDom:this.containers.contentVideoDom,playerDom:this.containers.playerDom,readyCallback:this.handleUvpFlashPlayerLoaded.bind(this,e)})):this.finishLoadVideoAndBeginPlayback(e),this.prepForCaptionEvents()},handleContainerResize:function(){this.cviModel.contentVideoState.isFlash?this.uvpSwfService.resetSize():uvpjs.util.isFunction(this.facade.containerResize)&&this.facade.containerResize()},handleUvpFlashPlayerLoaded:function(e,t,i){var s,n=uvpjs.ErrorInfo;if(i)return s=new n({errorCode:n.errorCodes.FLASH_RELATED_ERROR,message:"Unable to use Flash: "+i,isFatal:!0}),void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PLAYER_START_ERROR,{errorInfo:s},this.vidContId);setTimeout(this.finishLoadVideoAndBeginPlayback.bind(this,e),2)},handleCdnDecision:function(e,t){this.setNewAssetUrlAndCdn(t),this.doFlashCheck(e)},shouldUseFlash:function(){var e=this.mc.systemInfo,t=this.cviModel.getSessionOption("preventFlashPlayback"),i=e.supportsNativeHls||e.isHlsjsEligible,s=!t&&e.isDesktop&&uvpjs.UvpSwfService.hasFlash(),n=this.mc.isHlsUrl(this._getAssetUrl()),a=uvpjs.Configuration.env;return!("local"!==a&&"dev"!==a&&"stage"!==a||!window.forceFlash||!s)||n&&!i&&s},prepForCaptionEvents:function(){for(var e=this.eventsMgr.eventTypes,t=[e.CONTROL_HIDE_CAPTIONS,e.CONTROL_SHOW_CAPTIONS,e.CAPTIONS_READY,e.SET_CAPTIONS_LANG],i=t.length;i--;)this.eventsMgr.addEventListener(t[i]+this.internalNS,this.hCaptionEventForUvp.bind(this))},removeCaptionEventListeners:function(){for(var e=this.eventsMgr.eventTypes,t=[e.CONTROL_HIDE_CAPTIONS,e.CONTROL_SHOW_CAPTIONS,e.CAPTIONS_READY,e.SET_CAPTIONS_LANG],i=t.length;i--;)this.eventsMgr.removeEventListener(t[i]+this.internalNS)},hCaptionEventForUvp:function(e){var t=this.eventsMgr.eventTypes;if(this._hasFacade()&&e.target===this.vidContId)switch(e.type){case t.CAPTIONS_READY:uvpjs.util.isFunction(this.facade.loadCaptions)&&this.facade.loadCaptions(this.cviModel.contentVideoState.closedCaptionPath);break;case t.CONTROL_SHOW_CAPTIONS:uvpjs.util.isFunction(this.facade.showCaptions)&&this.facade.showCaptions(e.payload.language);break;case t.CONTROL_HIDE_CAPTIONS:uvpjs.util.isFunction(this.facade.hideCaptions)&&this.facade.hideCaptions();break;case t.SET_CAPTIONS_LANG:uvpjs.util.isFunction(this.facade.setCaptionLanguage)&&this.facade.setCaptionLanguage(e.payload.language)}},finishLoadVideoAndBeginPlayback:function(e){var t,i=this.cviModel;this.cviMgr.setPlaybackInfoOnModel(),this.cviMgr.setContextMetadata(this.rco.getContextMetadata()),this.dispatchContentDataLoaded(),this.RPM.resourceStart(this.rco.rcoSeed),this._addUVPEventListeners(),i.incrementMedNum(),this.createFacade(),t=this.facade.facadeType,this.id3HandlingEnabled&&this.createId3Parser(t),!0!==this.suppressFacadePlay&&(this.facade.showVideo(),this.facade.playVideo()),t===this.mc.FLASH_HLS&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CAPTIONS_READY,{vidState:this.cviModel.getContentVideoState()},this.vidContId)},dispatchContentDataLoaded:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTENT_DATA_LOADED,{vidState:this.cviModel.getContentVideoState()},this.vidContId)},setNewAssetUrlAndCdn:function(e){var t,i,s,n=e&&e.providers||null,a=n&&n[0]?n[0]:null,r=a&&a.host||null,o=a&&a.provider||null;r&&(t=this._getAssetUrl(),r!==(i=uvpjs.util.parseUrl(t)).host&&(s=i.protocol+"//"+r+i.pathname+i.search,this.cviModel.contentVideoState.assetURL=s)),o&&this.setContentVideoStateCdn(o)},setContentVideoStateCdn:function(e){this.cviModel.contentVideoState.cdn=e,this.debug&&uvpjs.log(this.DEBUG_ID,"CDN has been updated: ",e),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CDN_UPDATED,{cdn:e},this.vidContId)},getContentVideoStateCdn:function(e){return this.cviModel.contentVideoState.cdn},setModelRcoOverrides:function(){var e=function(e){var t=i.getSessionOption(e);return"boolean"==typeof t?t:void 0!==i.getVideoPlaybackCDOProperty(e)&&i.getVideoPlaybackCDOProperty(e)},t=function(e){var t=i.getSessionOption(e);return"number"==typeof t&&t>=0?t:void 0!==i.getVideoPlaybackCDOProperty(e)?Number(i.getVideoPlaybackCDOProperty(e)):-1},i=this.cviModel,s=t(i.START_BITRATE),n=t(i.MIN_BITRATE),a=t(i.MAX_BITRATE),r=t(i.LIVE_SYNC_DURATION_COUNT),o=e(i.CAP_LEVEL_TO_PLAYER_SIZE),l=e(i.DASHJS_FAST_SWITCH_ABR),d=i.getSessionOption("useDynamicSwitching"),u=i.getSessionOption("errorRecovery"),c=Number(this.rco.startBitrate)||-1,h=Number(this.rco.minBitrate)||-1,p=Number(this.rco.maxBitrate)||-1,g=Number(this.rco.liveSyncDurationCount)||-1,f=this.rco.capLevelToPlayerSize,v=this.rco.enableDashJSFastSwitchABR,m=this.rco.useDynamicSwitching,_=(m=this.rco.useDynamicSwitching,this.rco.errorRecovery);c>-1?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override Start Bitrate w RCO Value:",c),i.setStartBitrate(c)):i.setStartBitrate(s),h>-1?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override Min Bitrate w RCO Value:",h),i.setMinBitrate(h)):i.setMinBitrate(n),p>-1?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override Max Bitrate w RCO Value:",p),i.setMaxBitrate(p)):i.setMaxBitrate(a),g>-1?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override Live Sync Duration Count w RCO Value:",g),i.setLiveSyncDurationCount(g)):i.setLiveSyncDurationCount(r),"boolean"==typeof f?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override Cap Level To Player Size w RCO Value:",f),i.setCapLevelToPlayerSize(f)):i.setCapLevelToPlayerSize(o),"boolean"==typeof v?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override FastSwitch ABR value w RCO Value:",v),i.setDashJSFastSwitchABR(v)):i.setDashJSFastSwitchABR(l),"boolean"==typeof m?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override useDynamicABR value w RCO Value:",m),i.setUseDynamicSwitching(m)):i.setUseDynamicSwitching(d),"object"==typeof _?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override session options errorRecovery value with RCO value:",_),i.setErrorRecovery(_)):i.setErrorRecovery(u)},createId3Parser:function(e){this.id3EventQueue=[];var t={ownerIdList:this.cviModel.getConfiguredId3OwnerIds(),findNielsen:this.cviModel.isNielsenTrackingEnabled(),dataCallback:this.handleId3Metadata.bind(this)};switch(e){case this.mc.HLSJS:this.id3Parser=new uvpjs.FrameId3Parser(t);break;case this.mc.HTML5:this.id3Parser=new uvpjs.TrackId3Parser(t);break;case this.mc.FLASH_HLS:t.dataCallback=this.dispatchCuepointEvent.bind(this),this.facade.setId3Options(t)}},handleId3Metadata:function(e){this.id3EventQueue&&this.id3EventQueue.push(e)},checkId3Events:function(e){for(var t,i=this.id3EventQueue,s=i&&i.length||0;s--;)e>=(t=i[s]).pts&&(this.dispatchCuepointEvent(t),this.id3EventQueue.splice(s,1))},dispatchCuepointEvent:function(e){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_CUEPOINT,e,this.vidContId)},createFacade:function(){var e=this.cviModel,t=e.getContentVideoState(),i=this._getAssetUrl(),s={enableId3Handling:this.id3HandlingEnabled,assetURL:i,isMuted:e.isMuted,resourceProvider:this,startTime:t.startTime,startBitrate:e.startBitrate,maxBitrate:e.maxBitrate,minBitrate:e.minBitrate,useDynamicSwitching:e.useDynamicSwitching,liveSyncDurationCount:e.liveSyncDurationCount,volume:e.volume,capLevelToPlayerSize:e.capLevelToPlayerSize,enableDashJSFastSwitchABR:e.enableDashJSFastSwitchABR,deferLoadingCaptions:this.deferLoadingCaptions,errorRecovery:e.errorRecovery,drm:t.drm};this.debug&&uvpjs.log(this.DEBUG_ID,"createFacade",s),this.facade=this.getFacade(i),this.facade.facadeType===this.mc.HLSJS&&this.p2pClient&&(s.hlsjsLoader=this.p2pClient.getHlsjsLoader()),this.facade.facadeType===this.mc.FLASH_HLS&&(s.swfService=this.uvpSwfService);var n=this.facade.initialize(s);!n||this.facade.facadeType!==this.mc.HLSJS&&this.facade.facadeType!==this.mc.DASHJS||this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PLAYBACK_LIBRARY_LOADED,{player:n,facadeType:this.facade.facadeType},this.vidContId),this.facade.manageNativeControls(e.nativeControls)},destroyFacade:function(){var e=this._hasFacade()&&"function"==typeof this.facade.destroy;this.debug&&uvpjs.log(this.DEBUG_ID,"destroyFacade"),e?(this.facade.destroy(),this.facade={}):this.debug&&uvpjs.warn(this.DEBUG_ID,"Facade already cleaned up.")},muteContentForAdPlay:function(e){var t=this.cviModel,i=this.facade;this._hasFacade()&&(!1!==e?i.muteVideo():t.isMuted||i.unMuteVideo())},getModule:function(e){return this.cviModel.getModule(e)},getModuleParam:function(e,t){return this.cviModel.getModuleParam(e,t)},createWatermark:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"createWatermark"),this.cviModel.contentVideoState.useWatermark},is360:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"is360"),this.cviModel.contentVideoState.is360},startVideoProgressTimer:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"startVideoProgressTimer"),this.onUVPJSTimerTick(),this._addVideoProgressTimerCallback()},dispatchContentStart:function(){var e=this.cviModel.getContentVideoState();this.debug&&uvpjs.log(this.DEBUG_ID,"CONTENT_START; state = ",e),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTENT_START,{contentData:e},this.vidContId)},dispatchContentEnd:function(){var e=this.cviModel.getContentVideoState();this.debug&&uvpjs.log(this.DEBUG_ID,"CONTENT_END; state = ",e),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTENT_END,{contentData:e},this.vidContId)},dispatchSeekDone:function(){var e=this.eventsMgr;e.dispatchEvent(e.eventTypes.SEEK_DONE,{seekFromTime:this._seekFromTime,seekToTime:this._seekToTime},this.vidContId),this._seekToTime=null,this._seekFromTime=null},dispatchVideoDone:function(){var e=this.cviModel&&this.cviModel.contentPlaybackState.fatalError,t=e?"Fatal ERROR encountered":"";this.eventsMgr&&(this.debug&&uvpjs.log(this.DEBUG_ID,"About to dispatch Video Done. "+t),!e&&this.clearLocalStorageItems(),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_DONE,{},this.vidContId))},dispatchVideoStateChange:function(e){isNaN(e)||this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_STATE_CHANGE,{newState:e,isAd:!1},this.vidContId)},facadeBrowserPlayFailure:function(e){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_START_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.VIDEO_START_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.USER_GESTURE_REQUIRED,message:"Browser autoplay policy may be preventing video play: "+e,isFatal:!1})},this.vidContId)},facadeDisplayReady:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"facadeDisplayReady  this.rco.id = "+this.rco.id),this.startVideoProgressTimer(),this.contentStartOpen=!0,this.dispatchContentStart()},facadeMetadataParsed:function(e){e&&e.abrInfo&&this.cviModel.setAbrInfo(e.abrInfo)},facadeProgress:function(e){!uvpjs.util.isEmpty(e)&&"object"==typeof e&&e.currentTime&&e.duration&&(this.cviModel.setContentPlaybackStateItems({currentTime:e.currentTime}),this.setModelDuration(parseInt(e.duration)))},facadeDurationChanged:function(e){!uvpjs.util.isEmpty(e)&&"object"==typeof e&&e.duration},setModelDuration:function(e){e>0&&this.cviModel.contentVideoState.duration!==e&&(this.cviModel.setContentVideoStateItems({duration:e}),this.cviModel.setContentPlaybackStateItems({duration:e}))},facadeDone:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"facadeDone; this.rco.id = "+this.rco.id),this.cleanUp()},facadeSeeked:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"facadeSeeked",e),this._seekFromTime?(this._seekToTime=e.seekToTime,this.dispatchSeekDone()):this.debug&&uvpjs.log(this.DEBUG_ID,"Facade seek doesn't appear to be user generated. Not dispatching SEEK_DONE.")},facadeError:function(e){var t,i,s,n,a=uvpjs.util,r=this.RPM&&this.RPM.currRP,o=this.eventsMgr,l=this.cviModel,d=!a.isEmpty(l),u=e.isFatal;if(this.debug&&uvpjs.log(this.DEBUG_ID,"facadeError; vc id= "+this.vidContId+";"+e.message),d&&u&&(i=(t=this.cviModel.getContentVideoState()).playbackStarted,s=a.isDefinedString(t.overrideAssetURL),!i&&s&&!this._overrideAssetUrlFailure))this._handleOverrideAssetURLError(e);else if(d||this.debug&&uvpjs.log(this.DEBUG_ID,"facadeError; RP has no cviModel **"),a.isEmpty(o)?this.debug&&uvpjs.log(this.DEBUG_ID,"facadeError; RP has no events mgr **"):(n=e.eventType||o.eventTypes.VIDEO_PLAYBACK_ERROR,e.eventType=n,o.dispatchEvent(n,{errorInfo:e},this.vidContId)),u){if(this.debug&&uvpjs.warn(this.DEBUG_ID,"facadeError fatal error."),d&&(l.contentPlaybackState.fatalError=!0),r&&r.rco&&r.rco.type===uvpjs.mediaCapabilities.RP_IMA)return void r.imaContentComplete();this.debug&&uvpjs.log(this.DEBUG_ID,"facadeError; RP; RPM.currRP is null"),this.cleanUp()}},facadePlaybackStateChange:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"facadePlaybackStateChange id = "+this.rco.id+" newState = "+e),this.dispatchVideoStateChange(e)},facadeVideoLevelLoaded:function(e){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.LEVEL_LOADED,{details:e},this.vidContId)},facadeVideoTransitionStart:function(e,t){var i=t||(this.cviModel.useDynamicSwitching?"auto":"manual");uvpjs.log(this.DEBUG_ID,"facadeVideoTransitionStart id = "+this.rco.id+" bitrate = "+e+" mode = "+i),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_TRANSITION_START,{bitrate:e,mode:i},this.vidContId)},facadeVideoTransitionComplete:function(e,t){var i=t||(this.cviModel.useDynamicSwitching?"auto":"manual");uvpjs.log(this.DEBUG_ID,"facadeVideoTransitionComplete id = "+this.rco.id+" bitrate = "+e+" mode = "+i),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_TRANSITION_COMPLETE,{bitrate:e,mode:i},this.vidContId)},facadeSetCaptionReady:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CAPTIONS_READY,{},this.vidContId)},facadeSetAudioTrackInfo:function(e){this.cviModel.setAudioTrackInfo(e)},facadeId3Data:function(e){this.id3Parser&&this.id3Parser.parse(e)},facadeMinimumBitrateAllowedChanged:function(e){this.cviModel.setMinBitrate(e)},facadeMaximumBitrateAllowedChanged:function(e){this.cviModel.setMaxBitrate(e)},getFacade:function(e){var t,i=this.mc.STREAMING,s=(e=e||this._getAssetUrl(),this.mc.isHlsUrl(e)),n=this.mc.isDashUrl(e),a=this.cviModel.contentVideoState.isFlash;if(this.debug&&uvpjs.log(this.DEBUG_ID,"getFacade"),(a||s||n)&&this._setDeliveryType(i),!a&&s)this.mc.canPlayHLSJS()&&(t=new uvpjs.VPF_HLSJS);else if(!a&&n)if(uvpjs.VPF_DASHJS)t=new uvpjs.VPF_DASHJS;else{if(!uvpjs.VPF_SHAKA)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to create facade; DASHJS or Shaka Facade not available. - make sure you are using the correct .min file"));t=new uvpjs.VPF_SHAKA}else a&&(t=new uvpjs.VPF_Flash);return t||new uvpjs.VPF_HTML5},_addUVPEventListeners:function(){var e=this.eventsMgr,t=e.eventTypes,i=this.internalNS,s=this.rco&&this.rco.id;this.debug&&uvpjs.log(this.DEBUG_ID,"_addUVPEventListeners this.rco.id = ",s),this._uvpEventListenersAdded||(this._uvpEventListenersAdded=!0,e.addEventListener(t.CONTROL_SEEK+i,this.onVideoSeekTo.bind(this)),e.addEventListener(t.CONTROL_SEEK_TO_LIVE_POINT+i,this.onVideoSeekToLive.bind(this)),e.addEventListener(t.CONTROL_PAUSE+i,this.onPauseVideo.bind(this)),e.addEventListener(t.CONTROL_PLAY+i,this.onPlayVideo.bind(this)),e.addEventListener(t.CONTROL_MUTE+i,this.onMuteVideo.bind(this)),e.addEventListener(t.CONTROL_UNMUTE+i,this.onUnMuteVideo.bind(this)),e.addEventListener(t.CONTROL_VOLUME_SET+i,this.onChangeVideoVolume.bind(this)),e.addEventListener(t.CONTROL_FULLSCREEN+i,this.onFullscreen.bind(this)),e.addEventListener(t.SWITCH_REQUEST+i,this.onSwitchRequest.bind(this)),e.addEventListener(t.USE_DYNAMIC_SWITCHING+i,this.onUseDynamicSwitching.bind(this)),e.addEventListener(t.MAXIMUM_BITRATE_ALLOWED+i,this.onMaximumBitrateAllowed.bind(this)),e.addEventListener(t.MINIMUM_BITRATE_ALLOWED+i,this.onMinimumBitrateAllowed.bind(this)),e.addEventListener(t.CONTAINER_RESIZE+i,this.handleContainerResize.bind(this)),e.addEventListener(t.SWITCH_AUDIO_TRACK+i,this.onSwitchAudioTrack.bind(this)))},_removeUVPEventListeners:function(){var e=this.eventsMgr,t=e.eventTypes,i=this.internalNS,s=this.rco&&this.rco.id;this.debug&&uvpjs.log(this.DEBUG_ID,"_removeUVPEventListeners this.rco.id = ",s),e.removeEventListener(t.CONTROL_SEEK+i),e.removeEventListener(t.CONTROL_SEEK_TO_LIVE_POINT+i),e.removeEventListener(t.CONTROL_PAUSE+i),e.removeEventListener(t.CONTROL_PLAY+i),e.removeEventListener(t.CONTROL_MUTE+i),e.removeEventListener(t.CONTROL_UNMUTE+i),e.removeEventListener(t.CONTROL_VOLUME_SET+i),e.removeEventListener(t.SWITCH_REQUEST+i),e.removeEventListener(t.USE_DYNAMIC_SWITCHING+i),e.removeEventListener(t.MAXIMUM_BITRATE_ALLOWED+i),e.removeEventListener(t.MINIMUM_BITRATE_ALLOWED+i),e.removeEventListener(t.CONTROL_SHOW_CAPTIONS+i),e.removeEventListener(t.CONTROL_HIDE_CAPTIONS+i),e.removeEventListener(t.CAPTIONS_READY+i),e.removeEventListener(t.CONTAINER_RESIZE+i),e.removeEventListener(t.SWITCH_AUDIO_TRACK+i)},_getAssetUrl:function(e){var t=uvpjs.util,i=e||this.cviModel.getContentVideoState(),s=i.overrideAssetURL,n=t.isDefinedString(s)&&!this._overrideAssetUrlFailure,a=n?s:i.assetURL;return this.debug&&uvpjs.log(this.DEBUG_ID,"_getAssetUrl (using override: "+n+")",a),a},_setDeliveryType:function(e){this.cviModel.setContentVideoStateItems({deliveryType:e})},_handleOverrideAssetURLError:function(e){var t=uvpjs.ErrorInfo,i=this.eventsMgr,s=i.eventTypes.VIDEO_START_ERROR,n=t.messages.DYNAMIC_VARIANT_MANIFEST_PARSE_ERROR;this.debug&&uvpjs.warn(this.DEBUG_ID,n+" Error using overrideAssetURL; will use assetURL."),e.eventType=s,e.message=n,e.isFatal=!1,e.errorCode=t.errorCodes.DYNAMIC_VARIANT_MANIFEST_PARSE_ERROR,i.dispatchEvent(s,{errorInfo:e},this.vidContId),this._overrideAssetUrlFailure=!0,this.destroyFacade(),this.createFacade(),this.facade.showVideo(),this.facade.playVideo()},onSwitchRequest:function(e){var t=e&&e.target,i=e&&e.payload,s=i&&i.bitrate,n=this.cviModel,a=this.facade;if(t===this.vidContId&&s&&this._hasFacade())switch(typeof s){case"string":if("up"===s)n.setUseDynamicSwitching(!1),a.switchUp();else if("down"===s)n.setUseDynamicSwitching(!1),a.switchDown();else{if(s=Number(s),isNaN(s))return;n.setUseDynamicSwitching(!1),a.switchToBitrate(s)}break;case"number":n.setUseDynamicSwitching(!1),a.switchToBitrate(s);break;default:this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to switch to a selected bitrate.",s)}},onSwitchAudioTrack:function(e){uvpjs.util.isFunction(this.facade.switchAudioTrack)&&this.facade.switchAudioTrack(e.payload.id)},onUseDynamicSwitching:function(e){if(e&&e.target===this.vidContId&&e.payload){var t=e.payload.data;this.cviModel.setUseDynamicSwitching(t),this._hasFacade()&&(this.facade.useDynamicSwitching(t),t&&(this.facade.setMinBitrateAllowed(this.cviModel.minBitrate),this.facade.setMaxBitrateAllowed(this.cviModel.maxBitrate))),this.debug&&uvpjs.log(this.DEBUG_ID,"facadeDynamicSwitchingChange  this.rco.id = "+this.rco.id+" useDynamic = ",t)}},onMinimumBitrateAllowed:function(e){var t=e.payload,i=t&&t.bitrate,s=this.facade;e.target===this.vidContId&&(i&&"number"==typeof i?(this.cviModel.setMinBitrate(i),this._hasFacade()&&s.setMinBitrateAllowed(i)):this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to set minimum bitrate to "+i,typeof i))},onMaximumBitrateAllowed:function(e){var t=e.payload,i=t&&t.bitrate,s=this.facade;e.target===this.vidContId&&(i&&"number"==typeof i?(this.cviModel.setMaxBitrate(i),this._hasFacade()&&s.setMaxBitrateAllowed(i)):this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to set minimum bitrate to "+i,typeof i))},onVideoSeekTo:function(e){var t=e&&e.target,i=e&&e.payload,s=i&&i.seekTime,n=this.cviModel.contentVideoState.duration,a=this.cviModel.contentPlaybackState.currentTime,r=this.facade;"number"==typeof s&&t===this.vidContId&&(s<0||s>n?this.debug&&uvpjs.warn(this.DEBUG_ID,"onVideoSeekTo out of range seekTime = "+s):(this._seekFromTime=this._seekFromTime||a,this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoSeekTo "+JSON.stringify({seekTime:s,seekFromTime:this._seekFromTime},null,2)),this._hasFacade()&&r.seekTo(s)))},onVideoSeekToLive:function(){var e=this.facade;this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoSeekToLive"),this._hasFacade()&&e.seekToLive()},facadeVolumeChange:function(e){!t.isNaN(e)&&t.isNumber(e)&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_VOLUME_CHANGE,{vol:e},this.vidContId)},facadeLoading:function(e){var t={data:e};e&&(e.bufferLength||e.loaded)&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_LOADING,t,this.vidContId)},facadeTimeUpdate:function(e){this.cviModel.setContentPlaybackStateItems({currentTime:e})},onFullscreen:function(e){this.facade&&this.facade.facadeType===this.mc.FLASH_HLS&&this.facade.setFullscreenState(e.payload.isFs)},onPauseVideo:function(e){var t=e&&e.target,i=this.facade;this.debug&&uvpjs.log(this.DEBUG_ID,"onPauseVideo this.vidContId = ",this.vidContId," evtObj.target = ",t),t===this.vidContId&&this._hasFacade()&&i.pauseVideo()},onPlayVideo:function(e){var t=e&&e.target,i=this.facade;this.debug&&uvpjs.log(this.DEBUG_ID,"onPauseVideo this.vidContId = ",this.vidContId," evtObj.target = ",t),t===this.vidContId&&this._hasFacade()&&i.playVideo()},onChangeVideoVolume:function(e){var t=e&&e.target,i=e&&e.payload,s=i&&i.vol,n=uvpjs.util.inRange(s,0,1),a=this.cviModel.isMuted,r=this.facade;t===this.vidContId&&n&&!a&&this._hasFacade()&&r.setVolume(s)},onMuteVideo:function(e){var t=e&&e.target,i=this.facade;t===this.vidContId&&this._hasFacade()&&i.muteVideo()},onUnMuteVideo:function(e){var t=e&&e.target,i=this.facade;t===this.vidContId&&this._hasFacade()&&i.unMuteVideo()},onUVPJSTimerTick:function(){if(this._hasFacade()&&this.facade.getPlaybackState()===this.mc.PLAYING){var e={};this.cviModel.contentVideoState.episodeFlag&&(Date.now()-this._previousLocalStorageTime>this._localStorageInterval&&(this._previousLocalStorageTime=Date.now(),this.setLocalStorageItems()),e=this.cviModel.getContentVideoState(),!t.isEmpty(this.cviModel.sessionOptions.userId)&&Date.now()-this._previousResumeBeaconTime>this._resumeBeaconInterval&&(this._previousResumeBeaconTime=Date.now(),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PLAYBACK_DURATION_RESUME,{contentData:e},this.vidContId))),this.cviModel.contentVideoState.sendResumeEvent&&(this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_RESUME,{contentTime:this.cviModel.contentVideoState.startTime},this.vidContId),this.cviModel.contentVideoState.sendResumeEvent=!1);var i=this.getVideoProgressPayload();this.setModelDuration(i.duration),this.id3HandlingEnabled&&this.checkId3Events(i.currentTime),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_PROGRESS,i,this.vidContId)}},checkBuffering:function(e){var t,i=this.cviModel?this.cviModel.contentPlaybackState:null;i&&i.playbackStarted&&i.playbackState!==this.mc.PAUSED&&this._hasFacade()&&this.facade.facadeType!==this.mc.FLASH_HLS&&(t=e||i.currentTime||0,!this.bufferingDetected&&t<this.bufferingCheckLastTime+this.bufferingCheckOffset?(this.bufferingDetected=!0,this.facade.playbackStateChange(this.mc.BUFFERING)):this.bufferingDetected&&t>=this.bufferingCheckLastTime+this.bufferingCheckOffset&&(this.bufferingDetected=!1,this.facade.playbackStateChange(this.mc.PLAYING)),this.bufferingCheckLastTime=t)},getVideoProgressPayload:function(){this.cviModel.getCurrentVideoState();var e={averageDroppedFPS:0,bufferLength:0,currentBandwidth:0,currentContentSegment:1,currentMaxBandwidth:0,currentTime:0,droppedFrames:0,duration:this.facade.getDuration(),errorInfo:"",facadeState:{},isAd:!1,isHDStreamLive:!1,isPlayingLive:!1,isSeeking:!1,lastPercentageCompleted:0,lastSecondCompleted:0,playbackState:this.mc.EMPTY,playbackBitrate:0,playbackComplete:!1,playbackFramerate:0,playbackStarted:!0,sourceBitrate:0,streamType:null,switchingMode:"auto",videoFramerate:0};return this.setFacadeStateOnProgressPayload(e),e},setFacadeStateOnProgressPayload:function(e){var t=this.facade,i=this._hasFacade()&&t.getFacadeState();if(!i)return e;e.facadeState=i,e.averageDroppedFPS=t.getAverageDroppedFPS(),e.bufferLength=t.getBuffered()||0,e.currentTime=t.getCurrentTime()||0,e.currentBandwidth=t.getCurrentBandwidth(),e.currentMaxBandwidth=t.getCurrentMaxBandwidth(),e.droppedFrames=t.getDroppedFramesCount(),e.playbackFramerate=t.getPlaybackFramerate(),e.playbackState=t.getPlaybackState(),e.streamType=t.getStreamType(),e.isHDStreamLive=t.isHDStreamLive(),e.isPlayingLive=t.isPlayingLive(),e.switchingMode=this.cviModel.useDynamicSwitching?"auto":"manual"},setLocalStorageItems:function(){uvpjs.util.supportsLocalStorage()&&(localStorage.setItem("UVPJS.resumePid",this.rco.pid),localStorage.setItem("UVPJS.resumeContentTime",this.cviModel.contentPlaybackState.currentTime),localStorage.setItem("UVPJS.resumeEpochTime",Date.now()),localStorage.setItem("UVPJS.resumeSessionId",this.cviModel.sessionId))},populateContentVideoStateFromLocalStorage:function(){var e=this.cviModel.contentVideoState,t=localStorage.getItem("UVPJS.resumePid")||null,i=localStorage.getItem("UVPJS.resumeContentTime")||null,s=localStorage.getItem("UVPJS.resumeEpochTime")||null,n=localStorage.getItem("UVPJS.resumeSessionId")||null;uvpjs.util.supportsLocalStorage()&&(t&&(e.resumePid=t),i&&(e.resumeContentTime=i),s&&(e.resumeEpochTime=s),n&&(e.resumeSessionId=n))},clearLocalStorageItems:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"clearLocalStorageItems"),uvpjs.util.supportsLocalStorage()&&(localStorage.setItem("UVPJS.resumePid",""),localStorage.setItem("UVPJS.resumeContentTime",0),localStorage.setItem("UVPJS.resumeEpochTime",0),localStorage.setItem("UVPJS.resumeSessionId",""))},resetModelState:function(){var e=this.cviModel;e&&(e.resetAdVideoState(),e.resetContentVideoState())},_hasFacade:function(){return!uvpjs.util.isEmpty(this.facade)}})}(uvpjs.register("uvpjs")),function(e){var t=e._,i="pubads.g.doubleclick.net",s="ad.doubleclick.net",n="request.php",a="Request.jsp";e.ContentDataProxy=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.CONTENT_DATA_PROXY,init:function(e){this.debug=uvpjs.debug,this.mdl={},this.retryLimit=3,this.callAttempts=0,this.selectorCall=null,this.callDelays=[0,20,1e3],this.opts=e||{},this.startErrorName=uvpjs.EventType.VIDEO_START_ERROR,this.cviModel=this.opts.cviModel,this.eventsMgr=this.opts.eventsManager,this.cviModel.contentVideoStateDefaults&&this.populateDefaults(this.cviModel.contentVideoStateDefaults),this.opts.url&&this.loadData(this.opts.url,this.opts.queryParams)},destroy:function(){this.mdl=null,this.opts&&delete this.opts.errorCallback,this.opts&&delete this.opts.successCallback,this.opts=null},setOptions:function(e){var t;for(t in e)this.opts[t]=e[t]},getModel:function(){return this.mdl},getProperty:function(e){return this.mdl[e]},setProperty:function(e,t){this.mdl[e]=t},loadData:function(e,t){var i,s="callback=uvpHandleJsonpResult",n=t||this.opts.queryParams,a=!1,r=!uvpjs.util.isEmpty(n);if(this.opts.url=e,this.opts.queryParams=t,r)for(i in e+=e.indexOf("?")<0?"?":"&",n)e+=(a?"&":"")+i+"="+n[i],a=!0;e.indexOf(s)<0&&(e+=(e.indexOf("?")<0?"?":"&")+s),this.selectorCall=e,this.tz=Date.now(),this.makeSelectorCall()},makeSelectorCall:function(){var e=new uvpjs.CodeLoader;this.callAttempts++,this.debug&&uvpjs.log(this.DEBUG_ID,"ContentDataProxy making selector call: "+this.selectorCall),e.loadXHR(this.selectorCall,this.handleData.bind(this),this.handleError.bind(this))},signalError:function(e){"function"==typeof this.opts.errorCallback&&this.opts.errorCallback(e)},signalSuccess:function(){"function"==typeof this.opts.successCallback&&this.opts.successCallback()},parseSmilXML:function(e){var t,i,s,n,a,r,o,l,d,u=e.getElementsByTagName("ref"),c=null,h=u[0],p=!1,g=this.mdl,f=h&&this.checkForPlatformError(h);if(this.debug&&uvpjs.log(this.DEBUG_ID,"ContentDataProxy.parseSmilXML; SMIL document:",e),f&&f.error)return f;if(null===(i=(t=e.getElementsByTagName("switch"))[0]?t[0].getElementsByTagName("video"):e.getElementsByTagName("video"))[0])return{error:!0,errorInfo:new uvpjs.ErrorInfo({eventType:this.startErrorName,errorCode:uvpjs.ErrorInfo.errorCodes.RESOURCE_UNAVAILABLE,message:uvpjs.ErrorInfo.messages.UNEXPECTED_ABSENCE_OF_VIDEO,isFatal:!0})};if(g.chapterTimesString="",h)for(s=0,n=u.length;s<n;s++)o=(a=u[s]).attributes.src.nodeValue,this.isAdCallURL(o)?(!p&&(g.imaAdCall=o),p=!0):c||(c=a,g.assetURL=c.getAttribute("src"),l=a.getElementsByTagName("param")),null!==a.getAttribute("clipEnd")&&(g.chapterTimesString+=a.getAttribute("clipEnd")+",");for(s=0,n=i.length;s<n&&(o=(r=i[s]).attributes.src.nodeValue,c||(c=r,g.assetURL=c.getAttribute("src"),l=r.getElementsByTagName("param"),null!==r.getAttribute("clipEnd")));s++)null!==r.getAttribute("clipEnd")&&(g.chapterTimesString+=r.getAttribute("clipEnd")+",");return d=l&&this.extractParams(l)||{},this.populateModelFromContentNodeAndParams(c,d),{error:!1}},populateModelFromContentNodeAndParams:function(e,t){var i,s,n=this.mdl,a=uvpjs.mediaCapabilities,r={episodeAbstract:"abstract",copyright:"copyright",sourceHeight:"height",keywords:"keywords",videoTitle:"title",sourceWidth:"width"},o={contentType:"contentType",excludeNielsenTracking:"excludeNielsenTracking",episodeNumber:"EpisodeNumber",cdn:"IsLiveCDN",category:"PrimaryCategoryName",seasonNumber:"SeasonNumber",VTAG:"VTAG",closedCaptionPath:"ClosedCaptionURL",seriesTitle:"SeriesTitle"},l="true";for(q in r)n[q]=e.getAttribute(r[q])||"";for(q in o)n[q]=t[o[q]]||"";n.mediaId=this.getMediaId(t),n.duration=this.getDuration(e),n.sourceOwner=this.getSourceOwner(t),n.cmsRefGuid=e.getAttribute("guid")||e.getAttribute("vid")||"",n.isEmbedable=t.Embeddable===l,n.isLive=t.IsLive===l,n.episodeFlag=t.EpisodeFlag===l,n.useWatermark=t.WatermarkPlayback===l,n.chapterTimesString.length>0?(s=(i=n.chapterTimesString).length-1,i.lastIndexOf(",")===s&&(n.chapterTimesString=i.substring(0,s)),n.chapterStartTimes=this.convertChapterTimesToSeconds(n.chapterTimesString)):n.chapterStartTimes=[],n.assetURL.indexOf(a.M3U)>-1?(n.cdn="",n.fileType=a.M3U):n.assetURL.indexOf(a.MP3)>-1?n.fileType=a.MP3:n.fileType=a.MP4;var d=this.cviModel.getVideoPlaybackCDOProperty("matchPageUrlProtocol")||!1;d&&(n.assetURL=n.assetURL.replace(/^\w*:/,"")),this.debug&&uvpjs.log(this.DEBUG_ID,"ContentDataProxy mdl",n,d)},handleData:function(e){var t=e.responseText,i=uvpjs.util,s=t.substring(t.indexOf("{"),t.lastIndexOf("}")+1),n=this.isValidJsonStr(s)&&JSON.parse(s)||null,a=i.isEmpty(n)?null:n.metafile,r=a&&new DOMParser,o=r&&r.parseFromString(a,"application/xml"),l=o&&this.parseSmilXML(o);if(this.callAttempts=0,l){if(l.error)return this.debug&&uvpjs.error(this.DEBUG_ID,"ContentDataProxy Error: "+l.errorInfo.message),void this.signalError(l.errorInfo);this.defineProperties(),this.signalSuccess()}else this.debug&&uvpjs.error(this.DEBUG_ID,"ContentDataProxy Error: Invalid response"),this.signalError(this.createInvalidResourceFormatError())},isValidJsonStr:function(e){return"string"==typeof e&&("{"===e.charAt(0)&&"}"===e.charAt(e.length-1)||"["===e.charAt(0)&&"]"===e.charAt(e.length-1))},handleError:function(e){var t,i="ContentDataProxy Error: Unable to load url "+uvpjs.util.getErrorMessageForXHRStatus(e.status);this.debug&&uvpjs.error(this.DEBUG_ID,i,this.selectorCall),this.shouldRetryCall(e)?(t=this.callDelays[this.callAttempts],this.callAttempts>=1&&this.eventsMgr.dispatchEvent(this.startErrorName,{errorInfo:new uvpjs.ErrorInfo({eventType:this.startErrorName,errorCode:uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,message:"Selector call failed; now on retry "+this.callAttempts+"; dly = "+t,isFatal:!1})}),setTimeout(this.makeSelectorCall.bind(this),t)):(this.callAttempts=0,this.signalError(new uvpjs.ErrorInfo({eventType:this.startErrorName,errorCode:uvpjs.ErrorInfo.errorCodes.RESOURCE_UNAVAILABLE,message:i+" URL: "+this.selectorCall,isFatal:!0,serverCode:e.status})))},shouldRetryCall:function(e){var t=e.status;return this.selectorCall.indexOf("link.theplatform")>-1&&this.callAttempts<this.retryLimit&&500!==t&&404!==t&&403!==t&&0!==t},defineProperties:function(){},checkForPlatformError:function(e){var t=e&&this.parseSmilRefNodeForException(e);return t?{error:!0,errorInfo:new uvpjs.ErrorInfo({eventType:this.startErrorName,errorCode:uvpjs.ErrorInfo.errorCodes.RESOURCE_UNAVAILABLE,message:this.composePlatformErrorMessage(t),serverCode:t.responseCode,isFatal:!0})}:{error:!1}},createInvalidResourceFormatError:function(){return new uvpjs.ErrorInfo({eventType:this.startErrorName,errorCode:uvpjs.ErrorInfo.errorCodes.INVALID_RESOURCE_FORMAT,message:uvpjs.ErrorInfo.messages.INVALID_RESOURCE_FORMAT,isFatal:!0})},composePlatformErrorMessage:function(e){var t=e.responseCode||"n/a",i="; PID: "+(this.opts.pid||"n/a")+"; ",s=this.opts&&this.opts.cmsRefGuid+"; "||"",n=e.abstract?e.abstract+" ":"";return"Platform Error; code: "+t+i+s+(e.exception||"Resource Unavailable.")+" "+n},populateDefaults:function(e){!uvpjs.util.isEmpty(e)&&t.assign(this.mdl,e)},parseSmilRefNodeForException:function(e){var t,i=e.getElementsByTagName("param"),s={};if(i&&i.length){for(t=i.length;t--;)s[i[t].getAttribute("name")]=i[t].getAttribute("value");if("true"===s.isException)return s.abstract=e.getAttribute("abstract")||"",s}return null},extractParams:function(e){var t,i,s,n,a={};if(uvpjs.util.isEmpty(e))return a;for(n=e.length;n--;)i=(t=e[n]).getAttribute("name"),s=t.getAttribute("value"),i&&s&&(a[i]=s);return a},isAdCallURL:function(e){return e.indexOf(s)>-1||e.indexOf(i)>-1||e.indexOf(n)>-1||e.indexOf(a)>-1},getMediaId:function(e){var t,i,s,n="",a=e.trackingData;if(uvpjs.util.isEmpty(a))return"";for(i=0,s=(t=a.split("|")).length;i<s;i++)t[i].indexOf("cid=")>-1&&(n=t[i].split("=")[1]);return n},getSourceOwner:function(e){var t=e.Source;return uvpjs.util.isEmpty(t)&&"true"===e.WatermarkPlayback?"Entertainment":t||""},getDuration:function(e){var t=parseInt(e.getAttribute("dur"))||0;return t>0?.001*t:t},convertChapterTimesToSeconds:function(e){for(var t=[],i=e.split(","),s=i.length,n=function(e){var t=parseInt;switch((e=i[s].split(":")).length){case 1:return t(e[0]);case 2:return 60*t(e[0])+t(e[1]);case 3:return 3600*t(e[0])+60*t(e[1])+t(e[2])}};s--;)t.unshift(n(i[s]));return t}})}(uvpjs.register("uvpjs")),function(e){var t=e._;e.RP_URL=uvpjs.ResourceProvider.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,init:function(e){this._super(e),this.providerType=uvpjs.mediaCapabilities.RP_URL},initialize:function(e,t,i){this._super(e,t,i)},loadData:function(e,i){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_URL loadData"),t.isFunction(e)&&t.isFunction(i)?(this.dispatchVideoStateChange(this.mc.LOADING),this.dataLoadedCB=e,this.dataLoadErrorCB=i,this.dataLoadedCB()):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"RP_URL loadData Callbacks missing or invalid RETURN WITHOUT LOADING DATA"},this.internalNS)},loadVideoAndBeginPlayback:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_URL loadVideoAndBeginPlayback this.rco = ",this.rco),this.resetModelState(),this.cviModel.isCurrVideoAd=!1,this._super(e)}})}(uvpjs.register("uvpjs")),uvpjs.register("uvpjs").RP_Platform=uvpjs.ResourceProvider.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,ONE_HOUR_MS:36e5,init:function(e){this._super(e),this.providerType=uvpjs.mediaCapabilities.RP_PLATFORM},loadData:function(e,t){var i=this.getSelectorCall(),s=i.url||null,n=null;if(i.error)return this.debug&&uvpjs.error(this.DEBUG_ID,"RP_Platform ERROR: "+i.message),void("function"==typeof t&&t(new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.PLAYER_START_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.SELECTOR_CALL_ERROR,message:uvpjs.ErrorInfo.messages.SELECTOR_CALL_ERROR+" "+i.message,isFatal:!0})));this.dispatchVideoStateChange(this.mc.LOADING),this.dataLoadedCB=e,uvpjs.util.isDefinedString(this.rco.sig)&&(n={sig:this.rco.sig}),this.contentDataProxy.setOptions({pid:this.rco.pid||null,cmsRefGuid:this.rco.cmsRefGuid||null,successCallback:this.onDataProxyComplete.bind(this),errorCallback:t}),this.contentDataProxy.loadData(s,n)},loadVideoAndBeginPlayback:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Platform loadVideoAndBeginPlayback; roc = ",this.rco),this.resetModelState(),this._super(e)},getSelectorCall:function(){var e,t,i,s,n,a,r,o=this.rco,l=o.has("selectorCall")&&o.selectorCall||null;if(!l){if(i=(l=this.cviModel.getClassListItemProperty("VideoSourceManager","Platform_MPX","MultiBitrateURL"))&&l.indexOf("$PID$")>-1,s=l&&l.indexOf("$GUID$")>-1,e=o.has("pid")&&o.pid||null,t=o.has("cmsRefGuid")&&o.cmsRefGuid||null,(n=!i&&!s)||!e&&!t)return{error:!0,message:"Config error: "+(n?"Suitable selector call not found in config or RCO.":"Missing expected param: "+(i?"pid":"cmsRefGuid"))};a=i?e:t,r=i?/\$PID\$/g:/\$GUID\$/g,l=(l=l.replace(r,a)).replace(/manifest=f4m/g,"manifest=m3u")}return{error:!1,url:l}},onDataProxyComplete:function(){this.debug&&uvpjs.log(this.DEBUG_ID,'RP_Platform - ContentDataProxy "complete" callback invoked'),this.manageLocalAndGlobalResume(),this.setContinuationParams(),this.dataLoadedCB()},setContinuationParams:function(){var e=uvpjs.util;e.isEmpty(this.cviModel.sessionOptions.contsess)||this.contentDataProxy.setProperty("previousSessionId",this.cviModel.sessionOptions.contsess),e.isEmpty(this.rco.contPlayState)||this.contentDataProxy.setProperty("contPlayState",this.rco.contPlayState)},manageLocalAndGlobalResume:function(){var e,t,i,s,n,a,r,o,l,d=this.cviModel.contentVideoState,u=this.contentDataProxy,c=this.rco;this.populateContentVideoStateFromLocalStorage(),t=Date.now()-+d.resumeEpochTime,u.setProperty("resumePid",d.resumePid),u.setProperty("resumeEpochTime",+d.resumeEpochTime),u.setProperty("resumeSessionId",d.resumeSessionId),u.setProperty("resumeContentTime",+d.resumeContentTime),u.setProperty("playedChapterTime",+d.playedChapterTime),u.setProperty("showPreroll",d.showPreroll),u.setProperty("sendResumeEvent",!1),u.getProperty("episodeFlag")&&!0!==d.isLive&&(l=u.getProperty("duration"),n=!(i=!uvpjs.util.isEmpty(c.globalResumeTime)&&c.globalResumeTime>0&&l>0&&l-c.globalResumeTime>20)&&c.pid===d.resumePid,i||n?(this.debug&&uvpjs.log(this.DEBUG_ID,"Local"),s=i?c.globalResumeTime:+d.resumeContentTime||0,e=i?0:t||0,o=!i&&t>this.ONE_HOUR_MS,r=i?this.cviModel.sessionId:"",a=this.getPlayedChapterTimeForContentResume(s),u.setProperty("sendResumeEvent",!0),u.setProperty("startTime",s),u.setProperty("elapsedTime",e),u.setProperty("showPreroll",o),u.setProperty("playedChapterTime",a),u.setProperty("previousSessionId",r),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.USER_GESTURE,{gestureInfo:[(n?"local":"global")+"Resume"],startTime:s},this.vidContId)):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Platform; No global or local resume."),this.clearLocalStorageItems()))},getPlayedChapterTimeForContentResume:function(e){var t,i=0,s=this.contentDataProxy.getProperty("chapterStartTimes"),n=s.length||0;if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Platform: chapterStartTimes = ",s),n)for(;n--;)if(e>=(t=s[n])){e-t>=4?i=t:(this.contentDataProxy.setProperty("startTime",e-4),n>0&&(i=s[n-1]));break}return this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Platform resume using playedChapTime = ",i),i}}),function(e){var t=e._;e.RP_Mdialog=uvpjs.ResourceProvider.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,init:function(e){this.debug=uvpjs.debug,this._super(e),this.providerType=uvpjs.mediaCapabilities.RP_MDIALOG},initialize:function(e,t,i){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Mdialog initialize vidContId        = ",i),this._super(e,t,i)},loadData:function(e,i){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Mdialog loadData"),t.isFunction(e)?(this.dataLoadedCB=e,this.dataLoadErrorCB=i,this.dataLoadedCB()):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"ResourceProvider initialize init params missing or invalid RETURN WITHOUT CREATING A RESOURCE PROVIDER"},this.internalNS)}})}(uvpjs.register("uvpjs")),function(e){"use strict";var t=e._;e.RP_IMA=uvpjs.RP_Platform.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,STUCK_AD_DEBUG_ID:uvpjs.DebugManager.configParams.STUCK_AD,AD_SETTINGS:"AdSettings",AD_CALL_OVERRIDE:"adCallOverride",AD_BITRATE_THRESHOLD:2500,AD_CALL_ONLY:"adCallOnly",PLATFORM:"platform",CONTENT_AND_AD_CALL:"contentAndAdCall",MDIALOG:"mdialog",AD_BLOCKER_POLLING_INTERVAL:120,IMA_TIMEOUT:"imaTimeout",STUCK_AD_NUM_INTERVALS:10,trueXInteractionIds:{CHOICE_CARD_LOADED:"TrueXChoiceCardLoaded",OPT_IN:"TrueXUserOptIn",OPT_OUT:"TrueXUserOptOut",TIME_OUT:"TrueXUserTimeOut",CREDIT:"TrueXCredit",CLOSED_AFTER_CREDIT:"TrueXClosedAfterCredit",CLOSED_BEFORE_CREDIT:"TrueXClosedBeforeCredit"},init:function(e){this.imaAdCall="",this.imaScenario="",this.APM={},this.currAdPod={},this.isRP_IMACleanedUp=!1,this.dynamicMidRollPodCount=0,this.lastAdBlockCheckTime=0,this.imaCuePoints=[],this.viewGuid="",this.renderSettings={},this.trueXStatus={inProgress:!1,choicePending:!1,discardBreakOnComplete:!1},this.stuckAdCheckDisabled=!1,this.dynamicAdSessionInProgress=!1,this._uvpEventListenersAdded=!1,this.adTrackingHandle=null,this.contentPlayheadTracker={currentTime:0,pendingSeekTime:-1,seeking:!1,duration:0},this.adCallUrl="",this.ad=null,this.previousRemainingTime=null,this.stuckIntervals=0,this.seekPending=!1,this._super(e),this.providerType=uvpjs.mediaCapabilities.RP_IMA},initialize:function(e,t,i){var s,n;this.debug&&(uvpjs.log(this.DEBUG_ID,"RP_IMA Initializing; IMA version = ",google.ima.VERSION),uvpjs.log(this.DEBUG_ID,"RP_IMA Initializing: rcObj = ",e),uvpjs.log(this.DEBUG_ID,"RP_IMA Initializing: vidContId = ",i)),this.playbackState=this.mc.EMPTY,this.vidContId=i,this.adsLoader=null,this.adsManager=null,this.remainingTimeInterval=0,this.refreshFrequency=300,this.duration=0,this.currImaAdTime=0,this.savedSeekToTime=-1,this.adPodInProgress=!1,this.adStartEventReceived=!1,this.uvpjsAdStartOpened=!1,this.uvpjsContentStartOpened=!1,this.contentVideoPresent=!1,this.contentNeedsToBeLoaded=!1,this.rco=e,this.isContentScenario=!1,this._super(e,t,i),this.cviModel.isCurrVideoAd=!1,this.imaScenario=this._determineIMAScenario(this.rco),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA initialize this.imaScenario = ",this.imaScenario),null===this.imaScenario?(s=this.getUnknownImaScenarioError(),this.eventsMgr.dispatchEvent(s.eventType,{errorInfo:s},i)):(n=document.getElementById(uvpjs.domConstants.CONTENT_ID_PREFIX+this.vidContId),this.videoPlayerDiv=document.getElementById(this.vidContId),this.contentVideoTag=n.getElementsByTagName("video")[0],this.cviModel.setAdVideoState())},loadData:function(e,t){switch(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA loadData"),this._updateIMAPlaybackState(this.mc.LOADING),!this.mc.isChromecast()&&this._updateAdSize(0,0),this.imaScenario){case this.AD_CALL_ONLY:e();break;case this.PLATFORM:this._super(e,t);break;case this.CONTENT_AND_AD_CALL:e()}},onDataProxyComplete:function(){this.setImaAdUrl(),this._super()},loadVideoAndBeginPlayback:function(e){var t=this.rco,i=this.cviModel,s=uvpjs.util.isDefinedString(t.adCall)?t.adCall:null,n=this.imaScenario===this.PLATFORM,a=s||(n?this.imaAdCall:null);this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA load/beginPlay, id= "+this.vidContId+"; RCO= ",this.rco),this.cviMgr.contentInitializedForIMA=!1,this.resetModelState(),this.setModelRcoOverrides(),this._addUVPEventListeners(),this.adsLoader=this.cviMgr.adsLoader,this.imaScenario===this.AD_CALL_ONLY?(i.mergeCDOData(),this.finishLoadVideoAndBeginPlayback(a)):(i.setNonDefaultContentVideoStateItems(this.contentDataProxy.getModel()),i.setContentVideoStateItems(t),i.mergeCDOData(),this.multiCdnClient?this.multiCdnClient.getDecision(this.handleCdnDecision.bind(this,a)):this.doFlashCheck(a))},finishLoadVideoAndBeginPlayback:function(e){var t="",i=uvpjs.adUtil,s=this.cviModel;this.cviMgr.setPlaybackInfoOnModel(),this.imaScenario!==this.AD_CALL_ONLY&&(this.dispatchContentDataLoaded(),this.contentNeedsToBeLoaded=!0,s.incrementMedNum(),this.isContentScenario=!0),e?(t=i.populateImaAdCallValues(e,s,this.isContentScenario),this.viewGuid=i.getDwViewGuid(s),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA assembled ad call...",t)):this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA finishLoadVideoAndBeginPlayback: No ad call."),this.killDataProxy(),this.RPM.resourceStart(this.rco.rcoSeed),this.requestAdsManagerOrResume(t)},dispatchContentStart:function(){this.resetTrueXStatus(),this.stuckAdCheckDisabled=!1,this._super()},requestAdsManagerOrResume:function(e){t.isString(e)&&!t.isEmpty(e)?this._requestAdsManager(e):this._onContentResumeRequested()},setImaAdUrl:function(){var e=this.checkForAdCallOverride();e?(this.contentDataProxy.setProperty("imaAdCall",e),this.imaAdCall=e):this.imaAdCall=this.contentDataProxy.getProperty("imaAdCall")},checkForAdCallOverride:function(){var e=this.cviModel.getModule(this.AD_SETTINGS),i=null!=e&&1==e.enabled,s=this.cviModel.getModuleParam(this.AD_SETTINGS,this.AD_CALL_OVERRIDE),n=null;return i&&!t.isUndefined(s)&&(n=s),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA dCallOverride: "+(n||"null")),n},manageLocalAndGlobalResume:function(){this._super(),this.contentDataProxy.setProperty("podsToSkip",this.getPodsToSkip())},getPodsToSkip:function(){var e,t="",i=this.contentDataProxy,s=i.getProperty("chapterStartTimes");return i.getProperty("showPreroll")||(t="1"),s.length>0&&(e=s.indexOf(i.getProperty("playedChapterTime")))>=0&&(e+=2,t=t.length>0?t+","+String(e):String(e)),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Platform getPodsToSkip returning: ",t),t},getUnknownImaScenarioError:function(){return new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.PLAYER_START_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.IMA_SCENARIO_UNKNOWN,message:uvpjs.ErrorInfo.messages.IMA_SCENARIO_UNKNOWN,isFatal:!0})},createContentFacade:function(){this.createFacade(),this.id3HandlingEnabled&&this.createId3Parser(this.facade.facadeType)},facadeDisplayReady:function(){this.facade.facadeType===this.mc.FLASH_HLS&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CAPTIONS_READY,{vidState:this.cviModel.getContentVideoState()},this.vidContId)},facadeDone:function(){this.imaContentComplete()},processInteractionEvent:function(e){var t=e&&e.id,i=this.trueXInteractionIds;switch(t){case i.CLOSED_BEFORE_CREDIT:case i.CHOICE_CARD_LOADED:this.resetTrueXStatus(),this.trueXStatus.choicePending=!0;break;case i.OPT_IN:this.trueXStatus.choicePending=!1,this.trueXStatus.inProgress=!0;break;case i.OPT_OUT:case i.TIME_OUT:this.resetTrueXStatus();break;case i.CREDIT:this.trueXStatus.discardBreakOnComplete=!0}this.stuckAdCheckDisabled=this.trueXStatus.choicePending||this.trueXStatus.inProgress},resetTrueXStatus:function(){this.trueXStatus={inProgress:!1,choicePending:!1,discardBreakOnComplete:!1}},assembleAdPodInfo:function(e){var t=this.getAdPodInfo(e),i=t.podIndex,s=0===i?"pre":-1===i?"post":"mid_"+i;if(this.currAdPod=this.APM.getAdPodById(s),void 0===this.currAdPod)return this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA: currAdPod is undefined."),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.IMA_AD_ERROR,message:uvpjs.ErrorInfo.messages.IMA_ADPOD_ERROR,isFatal:!1,adInfo:this.extractAdInfo(e)}),adCallUrl:this.adCallUrl},this.vidContId),!1;var n=this.currAdPod;return n.adCount=t.totalAds,n.podDuration=t.maxDuration,n.isBumper=t.isBumper,n.imaPodIndex=t.podIndex,n.timeOffset=t.timeOffset,n.totalAds=t.totalAds,n.imaAdPostion=t.adPosition,this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA Ad Pod encountered; podIdx = ",i,this.currAdPod),!0},getAdPodInfo:function(e,t){var i=e.getAdPodInfo(),s=t||{};return s.adPosition=i.getAdPosition(),s.isBumper=i.getIsBumper(),s.maxDuration=i.getMaxDuration(),s.podIndex=i.getPodIndex(),s.timeOffset=i.getTimeOffset(),s.totalAds=i.getTotalAds(),s},assembleAdInfo:function(e){return{adId:e.getAdId(),adPodInfo:this.getAdPodInfo(e),adSystem:e.getAdSystem(),advertiserName:e.getAdvertiserName(),apiFramework:e.getApiFramework(),contentType:e.getContentType(),creativeAdId:e.getCreativeAdId(),creativeId:e.getCreativeId(),dealId:e.getDealId(),description:e.getDescription(),duration:e.getDuration(),height:e.getHeight(),mediaUrl:e.getMediaUrl(),minSuggestedDuration:e.getMinSuggestedDuration(),skipTimeOffset:e.getSkipTimeOffset(),surveyUrl:e.getSurveyUrl(),title:e.getTitle(),traffickingParams:e.getTraffickingParameters(),traffickingParametersString:e.getTraffickingParametersString(),uiElements:e.getUiElements(),universalAdIdRegistry:e.getUniversalAdIdRegistry(),universalAdIdValue:e.getUniversalAdIdValue(),vastMediaHeight:e.getVastMediaHeight(),vastMediaWidth:e.getVastMediaWidth(),vastMediaBitrate:e.getVastMediaBitrate(),width:e.getWidth(),wrapperAdIds:e.getWrapperAdIds(),wrapperAdSystems:e.getWrapperAdSystems(),wrapperCreativeIds:e.getWrapperCreativeIds(),isLinear:e.isLinear()}},onAdEvent:function(e){var i,s=e.getAdData(),n=e.getAd(),a=google.ima.AdEvent.Type;if(e.type!==a.INTERACTION){if(!this.trueXStatus.choicePending)switch(!0===this.cviModel.isCurrVideoAd&&this.trackAdEvent(e.type),e.type){case a.LOADED:if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.LOADED ad = ",n),this.cviModel.setAdVideoStateItems({adAssetUrl:this._getAdAssetUrl(e)}),!this.adPodInProgress){if(!this.assembleAdPodInfo(n))return void this.adErrorCheckForContentVideoBeforeCallingCleanUp();this.adPodInProgress=!0,(this.APM.isMidRoll(this.currAdPod)||this.dynamicMidRollPodCount>0)&&(this.uvpjsContentStartOpened=!1,this.dispatchContentEnd()),this.dispatchAdPodStart()}this._populateAdVideoState(n,{isCustomClickTrackingUsed:this.adsManager.isCustomClickTrackingUsed(),adAssetUrl:this._getAdAssetUrl(e)}),this._dispatchAdLoaded(this.assembleAdInfo(n));break;case a.STARTED:var r,o,l=n.getContentType();this.ad=n,this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.STARTED"),this.adStartEventReceived=!0,this.cviModel.isCurrVideoAd=!0,this.cviModel.incrementAdNum(),this.cviModel.resetAdPlaybackState(),this.duration=n.getDuration(),this._populateAdVideoState(n,{isCustomClickTrackingUsed:this.adsManager.isCustomClickTrackingUsed(),adAssetUrl:this._getAdAssetUrl(e)}),this.cviModel.mergeCDOData(),"application/javascript"!==l&&"application/x-shockwave-flash"!==l||this.cviModel.setAdVideoStateItems({isVPAID:!0}),"application/x-shockwave-flash"===l&&console.warn("IMA delivered FLash VPAID: application/x-shockwave-flash!"),this.trackAd(n),this.trackAdEvent(a.STARTED),(r=n.getAdPodInfo())&&(o=r.getTotalAds()),this._dispatchAdStart(o),this._updateIMAPlaybackState(this.mc.PLAYING),this.onUVPJSTimerTick(),this._addVideoProgressTimerCallback(),this._startRemainingTimeInterval();break;case a.AD_BUFFERING:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.AD_BUFFERING"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_BUFFERING,{},this.vidContId);break;case a.FIRST_QUARTILE:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.FIRST_QUARTILE"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_QUARTILE,{percent:25},this.vidContId);break;case a.MIDPOINT:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.MIDPOINT"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_QUARTILE,{percent:50},this.vidContId);break;case a.THIRD_QUARTILE:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.THIRD_QUARTILE"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_QUARTILE,{percent:75},this.vidContId),this._checkForContentPreload();break;case a.COMPLETE:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.COMPLETE"),this.ad=null,this._updateIMAPlaybackState(this.mc.STOPPED),this.untrackAd(),this._dispatchAdEnd(),this.trueXStatus.discardBreakOnComplete&&(this.resetTrueXStatus(),this.adsManager.discardAdBreak());break;case a.ALL_ADS_COMPLETED:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.ALL_ADS_COMPLETED"),this.imaScenario===this.AD_CALL_ONLY||t.isEmpty(this.facade)?this.cleanUpRP_IMA():this._destroyAdsManagerAndRemoveAdsManagerListeners();break;case a.CLICK:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.CLICK this.adsManager.pause()"),this.adsManager.pause(),(i=this.cviModel.getAdVideoState()).paused=!0,this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_CLICK,{adData:i},this.vidContId);break;case a.PAUSED:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.PAUSED"),this._updateIMAPlaybackState(this.mc.PAUSED);break;case a.RESUMED:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.RESUMED"),this._updateIMAPlaybackState(this.mc.PLAYING);break;case a.USER_CLOSE:this.stopVideo(),this.adErrorCheckForContentVideoBeforeCallingCleanUp();break;case a.SKIPPED:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.SKIPPED"),this.ad=null,i=this.cviModel.getAdVideoState(),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_SKIPPED,{adData:i,adCallUrl:this.adCallUrl},this.vidContId),uvpjs.warn(this.DEBUG_ID,"DEPRECATION NOTICE: The AD_SKIPPED event will be removed in a future release. Please listen for AD_END and reference the `skipped` boolean in the event object payload (e.g. `adData: { skipped: true }`)."),this._dispatchAdEnd(!0);break;case a.LOG:var d,u=s&&s.adError,c=(uvpjs.ErrorInfo,null===n);this.eventsMgr.eventTypes.AD_ERROR;!u&&c?(d=this.cviModel.getSessionOption("adBlockerCallback"))&&"function"==typeof d&&d()&&this.dispatchAdBlockedEvent():this.dispatchAdErrorEvent(u,n,"Unknown error - IMA.AdEvent.Type.LOG "),this.checkForAdBlocker(),c&&!u&&this.savedSeekToTime>-1&&this.resumeContentPlay();break;default:return void(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent UNKNOWN AD EVENT adEvent.type = ",a))}}else this.processInteractionEvent(s)},_populateAdVideoState:function(e,i){var s,n;if(t.isObject(e)){if(n=uvpjs.adUtil.extractAdStateData(e,uvpjs.adUtil.context.IMA),i)for(s in i)n[s]=i[s];this.cviModel.setAdVideoState(n),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _populateAdVideoState; mdl.adVideoState: ",this.cviModel.getAdVideoState())}else this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA _populateAdVideoState !_.isObject(ad) RETURN")},_requestAdsManager:function(e){var t=this.cviModel;if(this.checkForAdBlocker(),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _requestAdsManager adCallUrl = ",e),this.adStartEventReceived=!1,this.adCallUrl=e,uvpjs.util.isEmpty(this.adsLoader))return this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,message:"Unexpected condtion: Encountered invalid ima.AdsLoader instance.",isFatal:!1}),adCallUrl:this.adCallUrl},this.vidContId),void this.resumeContentPlay();var i=new google.ima.AdsRequest;i.adTagUrl=e,this._updateAdSize(),i.linearAdSlotWidth=this.containerWidth,i.linearAdSlotHeight=this.containerHeight,i.nonLinearAdSlotWidth=this.containerWidth,i.nonLinearAdSlotHeight=this.containerHeight,"function"==typeof i.setAdWillAutoPlay&&(i.setAdWillAutoPlay(t.isAutoplay),i.setAdWillPlayMuted(t.isMuteAtPlayStart&&!t.userHasUnmuted)),this._dispatchAdRequest(),this.adsLoader.requestAds(i)},onAdsManagerLoaded:function(e){var i,s,n,a=this.imaScenario===this.AD_CALL_ONLY?this.contentVideoTag:this.contentPlayheadTracker,r=uvpjs.util;if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA adsManagerLoadedEvent = ",e),this._dispatchAdResponse(),r.isEmpty(this.RPM)||r.isEmpty(this.RPM.currRP)||r.isEmpty(this.cviModel))return this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdsManagerLoaded: resrc provider or cviModel is null"),void(null!==this.adsManager&&(this.adsManager.destroy(),this.adsManager=null));this.renderSettings=new google.ima.AdsRenderingSettings;var o=this.renderSettings;o.bitrate=this.getAdPlaybackBitrate(),o.restoreCustomPlaybackStateOnAdBreakComplete=!1,o.enablePreloading=!1,o.loadVideoTimeout=this._returnIMATimeout(),i=this.adsManager=e.getAdsManager(a,o),this.debug&&(uvpjs.log(this.DEBUG_ID,"RP_IMA - adsMgr.isCustomPlaybackUsed() = ",i.isCustomPlaybackUsed()),uvpjs.log(this.DEBUG_ID,"RP_IMA - adsMgr.isCustomClickTrackingUsed() = ",i.isCustomClickTrackingUsed()),uvpjs.log(this.DEBUG_ID,"RP_IMA - adsMgr.getCuePoints() = ",i.getCuePoints())),this.imaScenario!==this.PLATFORM&&this.imaScenario!==this.CONTENT_AND_AD_CALL||(s=this.cviModel.contentVideoState.chapterStartTimes,this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA - chapterStartTimes = ",s)),this.imaCuePoints=this.adsManager.getCuePoints(),t.isEmpty(this.imaCuePoints)&&(this.imaCuePoints=[0]),this.cviModel.APM=new uvpjs.AdPlaylistManager,this.APM=this.cviModel.APM,this.imaScenario===this.PLATFORM?this.APM.initialize(this.vidContId,s,this.imaCuePoints,this.imaAdCall):this.imaScenario===this.CONTENT_AND_AD_CALL?(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA; CONTENT_AND_AD_CALL chapterStartTimes = ",s),this.APM.initialize(this.vidContId,s,this.imaCuePoints,this.rco.adCall)):this.APM.initialize(this.vidContId,[],this.imaCuePoints,this.rco.adCall),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdsManagerLoaded this.imaCuePoints = ",this.imaCuePoints),this._addAdsManagerEventListeners(),n=this.cviModel.isFullscreen?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL,this.adsManager.init(this.containerWidth,this.containerHeight,n),this.adsManager.setVolume(this.cviModel.isMuted?0:this.cviModel.volume),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdsManagerLoaded.. starting ads"),this.imaUsesContentVideoTag()&&(this._cleanUpContentVideoFacade(),this.contentNeedsToBeLoaded=!0),this.startAds()},getAdPlaybackBitrate:function(){var e=this.cviModel.contentPlaybackState.facadeState.currentBitrate,t=900;return!uvpjs.util.isEmpty(e)&&e>0&&(t=Math.min(e/1e3,this.AD_BITRATE_THRESHOLD)),t},startAds:function(){var e,t,i=null,s=null;this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA startAds");try{this.adsManager.start()}catch(n){this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA ERROR startAds adError = ",n),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.NO_AD_CONTENT,{},this.vidContId),e=(t=uvpjs.ErrorInfo).messages.NO_AD_CONTENT,n&&"function"==typeof n.getMessage&&(e+=": "+n.getMessage(),i=n.getErrorCode(),s=n.getVastErrorCode()),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new t({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:t.errorCodes.IMA_AD_ERROR,message:e,imaErrorCode:i,imaVastErrorCode:s,isFatal:!1}),adCallUrl:this.adCallUrl},this.vidContId),this.adErrorCheckForContentVideoBeforeCallingCleanUp()}},imaUsesContentVideoTag:function(){return this.adsManager&&this.adsManager.isCustomPlaybackUsed()},_onContentPauseRequested:function(){var e,i=!1;this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _onContentPauseRequested by AdsManager"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_PLUGIN_CONTENT_PAUSE_REQUEST,{},this.vidContId),t.isEmpty(this.facade)||(i=this.cviModel.contentVideoState.isLive,!(e=this.imaUsesContentVideoTag())&&this.facade.hideVideo(),i&&!e?this.muteContentForAdPlay(!0):(this.facade.pauseVideo(),e&&(this.savedSeekToTime=i?-1:this.facade.getCurrentTime())),this.adsManager.setVolume(this.cviModel.isMuted?0:this.cviModel.volume))},_onContentResumeRequested:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_PLUGIN_CONTENT_RESUME_REQUEST,{},this.vidContId),this.resumeContentPlay()},imaContentComplete:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA imaContentComplete"),!t.isEmpty(this.APM)&&this.APM.hasPostRoll()?(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA imaContentComplete this.APM.hasPostRoll() call this.adsLoader.contentComplete();"),this.adsLoader.contentComplete(),this._cleanUpContentVideoFacade()):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA imaContentComplete !this.APM.hasPostRoll() NO POST ROLL wrap it up! call this.cleanUpRP_IMA();"),this.cleanUpRP_IMA())},stopVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA stopVideo"),this.adsManager&&this.adsManager.stop(),this._updateIMAPlaybackState(this.mc.STOPPED)},resumeContentPlay:function(){if(this.contentPlayheadTracker.pendingSeekTime=-1,this.adPodInProgress&&(this.currAdPod.hasPlayed=!0,this.adPodInProgress=!1,this.handleAdPodEnd(),this.dynamicAdSessionInProgress&&(this.dynamicAdSessionInProgress=!1,this._destroyAdsManagerAndRemoveAdsManagerListeners())),t.isEmpty(this.APM)||!this.APM.isPostRoll(this.currAdPod)){if(this.contentNeedsToBeLoaded&&(this.contentNeedsToBeLoaded=!1,this.createContentFacade()),!this.adStartEventReceived)return this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA resumeContentPlay this.adStartEventReceived === FALSE error case, ad load request made but ad start event never received"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.IMA_AD_ERROR,message:uvpjs.ErrorInfo.messages.IMA_AD_START_FAILED,isFatal:!1}),adCallUrl:this.adCallUrl},this.vidContId),void this.adErrorCheckForContentVideoBeforeCallingCleanUp();if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA resumeContentPlay this.adStartEventReceived === TRUE this._clearRemainingTimeInterval();"),this._clearRemainingTimeInterval(),t.isEmpty(this.facade))this.debug&&uvpjs.log(this.DEBUG_ID,"resumeContentPlay facade Empty, no video to play; CHECK FOR POST-ROLL and force cleanup"),this.imaScenario===this.AD_CALL_ONLY&&!t.isEmpty(this.APM)&&this.APM.hasPostRoll()&&(this.debug&&uvpjs.warn(this.DEBUG_ID,"resumeContentPlay; facade isEmpty, no video; HAS POST-ROLL FORCE CLEANUP"),this.cleanUpRP_IMA());else{if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA resumeContentPlay this.facade.playVideo() PLAY THE CONTENT VIDEO"),this.cviModel.isCurrVideoAd=!1,this.uvpjsContentStartOpened=!0,this.contentVideoPresent=!0,this.dispatchContentStart(),this.facade.setVolume(this.cviModel.volume),this.muteContentForAdPlay(!1),this.savedSeekToTime>-1){if(this.mc.isIOS()&&!this.cviModel.contentVideoState.isLive)return this.seekPending=!0,void this.facade.playVideo();this.facade.seekTo(this.savedSeekToTime),this.savedSeekToTime=-1}this.facade.showVideo(),this.facade.playVideo()}}else this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA resumeContentPlay by AdsManager post-roll case, content already done RETURN")},facadePlaybackStateChange:function(e){this.seekPending&&e===this.mc.PLAYING&&(this.facade.seekTo(this.savedSeekToTime),this.savedSeekToTime=-1,this.seekPending=!1),this._super(e)},_updateIMAPlaybackState:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _updateIMAPlaybackState this.playbackState = "+this.playbackState," newState = ",e),e!==this.playbackState&&(this.playbackState=e,this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _updateIMAPlaybackState dispatch VIDEO_STATE_CHANGE newState = ",e),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_STATE_CHANGE,{currentState:this.cviModel.getAdPlaybackState().playbackState,newState:this.playbackState,isAd:!0,adCallUrl:this.adCallUrl,adAssetUrl:this.cviModel.getAdVideoState().adAssetUrl},this.vidContId))},_dispatchAdStart:function(e){var t=this.cviModel.getAdVideoState();this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _dispatchAdStart dispatch AD_START"),this.uvpjsAdStartOpened=!0,this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_START,{podAdCount:e||1,adData:t,isDynamicAdCall:this.dynamicAdSessionInProgress,currAdPod:this.currAdPod,adCallUrl:this.adCallUrl},this.vidContId)},_dispatchAdEnd:function(e){var t;this.uvpjsAdStartOpened&&((t=this.cviModel.getAdVideoState()).skipped=!0===e,this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _dispatchAdEnd dispatch AD_END"),this.uvpjsAdStartOpened=!1,this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_END,{adData:t,adCallUrl:this.adCallUrl},this.vidContId))},_getAdAssetUrl:function(e){var t="function"==typeof e.getAdData?e.getAdData():{},i="function"==typeof e.getAd?e.getAd():{};return("function"==typeof i.getMediaUrl?i.getMediaUrl():t.mediaUrl)||null},_dispatchAdLoaded:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _dispatchAdLoaded dispatch AD_LOADED"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_LOADED,{adCallUrl:this.adCallUrl,adAssetUrl:this.cviModel.getAdVideoState().adAssetUrl,adData:this.cviModel.getAdVideoState(),imaAdData:e},this.vidContId)},_dispatchAdRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _dispatchAdRequest dispatch AD_REQUEST"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_REQUEST,{adCallUrl:this.adCallUrl},this.vidContId)},_dispatchAdResponse:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _dispatchAdResponse dispatch AD_RESPONSE"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_RESPONSE,{adCallUrl:this.adCallUrl},this.vidContId)},dispatchAdPodStart:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA dispatchAdPodStart dispatch AD_POD_START this.currAdPod = ",this.currAdPod),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_POD_START,{adPod:this.currAdPod},this.vidContId)},handleAdPodEnd:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA handleAdPodEnd dispatch AD_POD_END this.currAdPod = ",this.currAdPod),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_POD_END,{adPod:this.currAdPod},this.vidContId),this.cviModel.setAdVideoState(),this.currAdPod={}},getPlaybackState:function(){return this.playbackState},_updateAdSize:function(e,t){var i,s,n;e&&(this.containerWidth=e),t&&(this.containerHeight=t),this.mc.isChromecast()||(i=parseInt(window.getComputedStyle(this.videoPlayerDiv,null).getPropertyValue("width")),s=parseInt(window.getComputedStyle(this.videoPlayerDiv,null).getPropertyValue("height")),i===this.containerWidth&&s===this.containerHeight||(this.containerWidth=i,this.containerHeight=s,this.adsManager&&(n=this.cviModel.isFullscreen?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL,this.adsManager.resize(this.containerWidth,this.containerHeight,n))))},_updateCurrentAdTime:function(){if(this._updateAdSize(),this.adsManager&&this.playbackState!==this.mc.PAUSED&&this.playbackState!==this.mc.EMPTY){var e=this.adsManager.getRemainingTime();this._checkForStuckAd(e)?this.adsManager.discardAdBreak():(this.currImaAdTime=Math.floor(this.duration-e),this.cviModel.setAdPlaybackStateItems({currentTime:this.currImaAdTime}))}},_checkForStuckAd:function(e){if(this.stuckAdCheckDisabled)return!1;if(null===this.previousRemainingTime)return this.previousRemainingTime=e,!1;var t=this.previousRemainingTime-e;if(this.debug&&uvpjs.log(this.STUCK_AD_DEBUG_ID,"RP_IMA _checkForStuckAd, timeDelta: "+t),0===t?(this.stuckIntervals++,this.debug&&uvpjs.log(this.STUCK_AD_DEBUG_ID,"RP_IMA _checkForStuckAd, stuckIntervals: "+this.stuckIntervals)):this.stuckIntervals=0,this.stuckIntervals===this.STUCK_AD_NUM_INTERVALS){var i="Ad playback stuck for "+this.stuckIntervals+" intervals.",s=new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.STUCK_AD_ERROR,message:i,isFatal:!1,adInfo:this.extractAdInfo(this.ad)});return this.debug&&uvpjs.error(this.STUCK_AD_DEBUG_ID,i,s),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:s,adCallUrl:this.adCallUrl},this.vidContId),!0}return this.previousRemainingTime=e,!1},_startRemainingTimeInterval:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA this.startRemainingTimeInterval()"),0===this.remainingTimeInterval&&(this.previousRemainingTime=null,this.stuckIntervals=0,this.remainingTimeInterval=window.setInterval(this._updateCurrentAdTime.bind(this),this.refreshFrequency,this))},_clearRemainingTimeInterval:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _clearRemainingTimeInterval"),0!==this.remainingTimeInterval&&window.clearInterval(this.remainingTimeInterval),this.remainingTimeInterval=0,this.previousRemainingTime=null,this.stuckIntervals=0},_destroyAdsManagerAndRemoveAdsManagerListeners:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _destroyAdsManagerAndRemoveAdsManagerListeners"),null!==this.adsManager&&(this._removeAdsManagerEventListeners(),this.adsManager.destroy(),this.adsManager=null),this.dynamicAdSessionInProgress=!1},onAdError:function(e){var t=e&&e.getAd&&e.getAd()||null;this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.NO_AD_CONTENT,{},this.vidContId),this.dispatchAdErrorEvent(e.getError(),t),this.checkForAdBlocker(),this.adErrorCheckForContentVideoBeforeCallingCleanUp()},handleAdsLoaderError:function(e){this.dispatchAdErrorEvent(e.getError()),this.adErrorCheckForContentVideoBeforeCallingCleanUp()},extractAdInfo:function(e){return uvpjs.adUtil.extractAdInfo(e,uvpjs.adUtil.context.IMA)},dispatchAdErrorEvent:function(e,t,i){var s,n=null,a=null,r=null,o=uvpjs.ErrorInfo,l=uvpjs.util.isFunction;e&&l(e.getMessage)&&(n=e.getMessage(),n+=" imaErrorCode: "+(a=e.getErrorCode()||"n/a")+"; vastErrorCode: "+(r=e.getVastErrorCode()||"n/a")),e&&l(e.getInnerError)&&(s=e.getInnerError())&&(!n&&(n=""),n+=" Inner error: "+(l(s.getMessage)?s.getMessage():s.message||"n/a")+"; inner error code: "+(l(s.getErrorCode)?s.getErrorCode():"n/a")),this.debug&&uvpjs.warn(this.DEBUG_ID,"AD_ERROR: "+n),i&&(n=i+" "+n),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new o({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:o.errorCodes.IMA_AD_ERROR,message:o.messages.IMA_AD_ERROR_EVENT_RECEIVED+(n||" Unspecified IMA ad error."),isFatal:!1,imaErrorCode:a,imaVastErrorCode:r,adInfo:this.extractAdInfo(t)}),adCallUrl:this.adCallUrl},this.vidContId)},dispatchAdBlockedEvent:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_BLOCKED,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_BLOCKED,errorCode:uvpjs.ErrorInfo.errorCodes.AD_BLOCKING_DETECTED,message:uvpjs.ErrorInfo.messages.AD_BLOCKING_DETECTED,isFatal:!1})},this.vidContId)},adErrorCheckForContentVideoBeforeCallingCleanUp:function(){if(this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA adErrorCheckForContentVideoBeforeCallingCleanUp this.vidContId = ",this.vidContId),this.contentNeedsToBeLoaded&&(this.contentNeedsToBeLoaded=!1,this.createContentFacade()),t.isEmpty(this.facade))return this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA adErrorCheckForContentVideoBeforeCallingCleanUp this.facade is empty = ",this.facade),void this.cleanUpRP_IMA();this.cviModel.isCurrVideoAd=!1,this.contentVideoPresent||(this.contentVideoPresent=!0,this.onUVPJSTimerTick(),this._addVideoProgressTimerCallback()),this.uvpjsContentStartOpened||(this.uvpjsContentStartOpened=!0,this.dispatchContentStart()),this.facade.setVolume(this.cviModel.volume),this.cviModel.isMuted?this.facade.muteVideo():this.facade.unMuteVideo(),this.facade.showVideo(),this.facade.playVideo()},cleanUpRP_IMA:function(){if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA cleanUpRP_IMA RP_IMA this.isRP_IMACleanedUp = ",this.isRP_IMACleanedUp),!this.isRP_IMACleanedUp){var e=this.rco.rcoSeed;this.isRP_IMACleanedUp=!0,this._updateIMAPlaybackState(this.mc.STOPPED),this.adTrackingHandle=null,this._dispatchAdEnd(),this._clearRemainingTimeInterval(),this._removeTimers(),this._removeUVPEventListeners(),this._destroyAdsManagerAndRemoveAdsManagerListeners(),this.adPodInProgress&&(this.adPodInProgress=!1,this.handleAdPodEnd()),this.killDataProxy(),this.platformContentVideoState={},this.APM={},this.cviModel.APM=null,this._cleanUpContentVideoFacade(),this.cleanUpObjects(),this.RPM.resourceEnd(e)}},_cleanUpContentVideoFacade:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _cleanUpContentVideoFacade"),this.contentVideoPresent&&(this.contentVideoPresent=!1,this.dispatchVideoDone(),this.uvpjsContentStartOpened&&(this.uvpjsContentStartOpened=!1,this.dispatchContentEnd())),this.destroyFacade()},loadDynamicAdCall:function(e){var t;this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA loadDynamicAdCall adCall = ",e),null===this.adsManager?(this.dynamicMidRollPodCount++,t=uvpjs.adUtil.populateImaAdCallValues(e,this.cviModel,this.isContentScenario,this.rco.cpAB),this.mc.isIOS()&&!this.cviModel.contentVideoState.isLive&&(this.savedSeekToTime=this.facade&&this.facade.getCurrentTime()||-1),this.dynamicAdSessionInProgress=!0,this.rco.adCall=t,this._requestAdsManager(t)):this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA loadDynamicAdCall WARNING this.adsManager != null; RETURN before making dynamic ad call")},forceDynamicMidrollPodEnd:function(){this.dynamicAdSessionInProgress&&(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA closing dynamic ad session"),this._updateIMAPlaybackState(this.mc.STOPPED),this._dispatchAdEnd(),this._destroyAdsManagerAndRemoveAdsManagerListeners(),this.resumeContentPlay())},onPauseVideo:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onPauseVideo this.adsManager.pause(); this.vidContId = ",this.vidContId," this.adPodInProgress = ",this.adPodInProgress),t.has(e,"target")&&e.target===this.vidContId&&(this.adPodInProgress?this.adsManager&&(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onPauseVideo adPodInProgress TRUE this.adsManager.pause(); this.vidContId = ",this.vidContId),this.adsManager.pause()):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onPauseVideo adPodInProgress FALSE this._super(evtObj); have the Resource Provider parent pause the CONTENT video"),this._super(e)))},onPlayVideo:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onPlayVideo aka resume ima this.vidContId = ",this.vidContId," this.adPodInProgress = ",this.adPodInProgress),t.has(e,"target")&&e.target===this.vidContId&&(this.adPodInProgress?this.adsManager&&(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onPlayVideo adPodInProgress TRUE this.adsManager.resume(); this.vidContId = ",this.vidContId),this.adsManager.resume()):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onPlayVideo adPodInProgress FALSE this._super(evtObj); have the Resource Provider parent play the CONTENT video"),this._super(e)))},onVideoSeekTo:function(e){var i,s,n,a=this.cviModel.contentPlaybackState.currentTime;if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onVideoSeekTo evtObj = ",e),e.target===this.vidContId&&!t.isEmpty(this.facade)&&this.canSeek(e&&e.payload)){if(t.isEmpty(this.APM)||!this.APM.hasMidRoll())return this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onVideoSeekTo NO MID-ROLLS CALL SUPER with evtObj argument and seek content"),void this._super(e);i=e.payload.seekTime,this._seekFromTime=a,s=this.imaScenario===this.MDIALOG?this.returnAbsSeekTime(i):i,n=this.APM.returnPrecedingUnplayedAdPod(s),t.isEmpty(n)||n.hasPlayed?(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onVideoSeekTo NO UNPLAYED POD CALL SUPER with evtObj argument and seek content"),this._super(e)):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onVideoSeekTo UNPLAYED AD POD FOUND unplayedPod.startTime = ",n.startTime),this.savedSeekToTime=s,n.hasPlayed=!0,this.contentPlayheadTracker.pendingSeekTime=n.startTime)}else this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onVideoSeekTo BAD or out of range PARAMS, RETURN")},canSeek:function(e){return void 0!==e.seekTime&&null!==e.seekTime&&e.seekTime>=0&&e.seekTime<=this.cviModel.contentVideoState.duration},returnAbsSeekTime:function(e){return e},onChangeVideoVolume:function(e){t.has(e,"target")&&e.target===this.vidContId&&!this.cviModel.isMuted&&e.payload.vol>=0&&e.payload.vol<=1&&(this.adPodInProgress?this.adsManager.setVolume(e.payload.vol):this._super(e))},onMuteVideo:function(e){t.has(e,"target")&&e.target===this.vidContId&&(this.adPodInProgress?(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA muteVideo adPodInProgress TRUE; set volume via adsManager for vidContId = ",this.vidContId),this.adsManager.setVolume(0)):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA muteVideo adPodInProgress FALSE; passing to super..."),this._super(e)))},onUnMuteVideo:function(e){t.has(e,"target")&&e.target===this.vidContId&&(this.adPodInProgress?(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA unmuteVideo adPodInProgress TRUE; set volume via adsManager for vidContId = ",this.vidContId),this.adsManager.setVolume(this.cviModel.volume)):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA unmuteVideo adPodInProgress FALSE; passing to super..."),this._super(e)))},_createBoundAdEventHandlers:function(){this._onContentPauseRequested=this._onContentPauseRequested.bind(this),this._onContentResumeRequested=this._onContentResumeRequested.bind(this),this.onAdError=this.onAdError.bind(this),this.onAdEvent=this.onAdEvent.bind(this)},_addAdsManagerEventListeners:function(){var e,t=this.adsManager,i=google.ima.AdEvent.Type;this._createBoundAdEventHandlers(),e=this.onAdEvent,t.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdError),t.addEventListener(i.CONTENT_PAUSE_REQUESTED,this._onContentPauseRequested),t.addEventListener(i.CONTENT_RESUME_REQUESTED,this._onContentResumeRequested),t.addEventListener(i.LOADED,e),t.addEventListener(i.STARTED,e),t.addEventListener(i.AD_BUFFERING,e),t.addEventListener(i.FIRST_QUARTILE,e),t.addEventListener(i.MIDPOINT,e),t.addEventListener(i.THIRD_QUARTILE,e),t.addEventListener(i.COMPLETE,e),t.addEventListener(i.ALL_ADS_COMPLETED,e),t.addEventListener(i.CLICK,e),t.addEventListener(i.PAUSED,e),t.addEventListener(i.RESUMED,e),t.addEventListener(i.USER_CLOSE,e),t.addEventListener(i.SKIPPED,e),t.addEventListener(i.LOG,e),t.addEventListener(i.VOLUME_CHANGED,e),t.addEventListener(i.VOLUME_MUTED,e),t.addEventListener(i.INTERACTION,e)},_removeAdsManagerEventListeners:function(){var e=this.onAdEvent,t=this.adsManager,i=google.ima.AdEvent.Type;t&&(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _removeAdsManagerEventListeners REMOVE listeners"),t.removeEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdError),t.removeEventListener(i.CONTENT_PAUSE_REQUESTED,this._onContentPauseRequested),t.removeEventListener(i.CONTENT_RESUME_REQUESTED,this._onContentResumeRequested),t.removeEventListener(i.LOADED,e),t.removeEventListener(i.STARTED,e),t.removeEventListener(i.AD_BUFFERING,e),t.removeEventListener(i.FIRST_QUARTILE,e),t.removeEventListener(i.MIDPOINT,e),t.removeEventListener(i.THIRD_QUARTILE,e),t.removeEventListener(i.COMPLETE,e),t.removeEventListener(i.ALL_ADS_COMPLETED,e),t.removeEventListener(i.CLICK,e),t.removeEventListener(i.PAUSED,e),t.removeEventListener(i.RESUMED,e),t.removeEventListener(i.USER_CLOSE,e),t.removeEventListener(i.SKIPPED,e),t.removeEventListener(i.LOG,e),t.removeEventListener(i.VOLUME_CHANGED,e),t.removeEventListener(i.VOLUME_MUTED,e))},onUVPJSTimerTick:function(){var e,t,i,s,n=uvpjs.util,a=this.imaScenario===this.PLATFORM||this.imaScenario===this.CONTENT_AND_AD_CALL,r=!n.isEmpty(this.adsManager),o=!n.isEmpty(this.facade);if(r){var l=this.getAdPlaybackBitrate();l!==this.renderSettings.bitrate&&(this.renderSettings.bitrate=l,this.adsManager.updateAdsRenderingSettings(this.renderSettings))}if(a&&(this.contentPlayheadTracker.duration=this.cviModel.contentPlaybackState.duration,this.contentPlayheadTracker.pendingSeekTime>-1?this.contentPlayheadTracker.currentTime=this.contentPlayheadTracker.pendingSeekTime:o?(e=this.facade.getCurrentTime(),this.contentPlayheadTracker.currentTime=e):this.contentPlayheadTracker.currentTime=0),!this.adPodInProgress)return t=(s=r&&a&&(this.cviModel.sessionOptions.adBlockerCallback||null))&&this._checkForCloseToMidrollPod(this.contentPlayheadTracker.currentTime),s&&(i=(new Date).getTime())&&(this.lastAdBlockCheckTime<i||t)&&(this.lastAdBlockCheckTime=i+1e3*this.AD_BLOCKER_POLLING_INTERVAL,this.checkForAdBlocker()),void this._super();if(this.id3HandlingEnabled&&o&&this.checkId3Events(e),this.playbackState===this.mc.PLAYING){var d=this.createAdVideoProgressPayload();this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_PROGRESS,d,this.vidContId)}},_checkForCloseToMidrollPod:function(e){var t,i,s,n=this.APM.getMidRollPods();if(e<=0)return!1;for(t=n.length;t--;)if((i=(s=n[t]).startTime-e)>0&&i<1&&!s.hasPlayed&&!s.hasBeenChecked)return s.hasBeenChecked=!0,!0;return!1},createAdVideoProgressPayload:function(){return{isAd:!0,duration:this.duration,playbackStarted:!0,playbackComplete:!1,sourceBitrate:0,playbackBitrate:0,videoFramerate:0,isSeeking:!1,isHDStreamLive:!1,isPlayingLive:!1,currentContentSegment:1,currentMaxBandwidth:0,averageDroppedFPS:0,errorInfo:"",lastSecondCompleted:0,lastPercentageCompleted:0,currentTime:this.currImaAdTime,bufferLength:0,playbackState:this.playbackState,facadeState:{}}},_determineIMAScenario:function(e){var t=uvpjs.util,i=this._getAssetUrl(e),s=t.isDefinedString(e.pid),n=t.isDefinedString(e.cmsRefGuid),a=t.isDefinedString(e.selectorCall),r=t.isDefinedString(e.assetURL);return s||n&&!r||a?this.PLATFORM:t.isDefinedString(i)?this.CONTENT_AND_AD_CALL:t.isDefinedString(e.adCall)?this.AD_CALL_ONLY:(this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA Cannot determine IMA Scenario from RCO."),null)},checkForAdBlocker:function(){var e=uvpjs.adUtil.checkForAdBlocker(this.cviModel);return e&&(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA: ad blocking detected."),this.dispatchAdBlockedEvent()),e},_checkForContentPreload:function(){var e=this.imaScenario===this.PLATFORM||this.imaScenario===this.CONTENT_AND_AD_CALL,t=this.adsManager.isCustomPlaybackUsed(),i=this.currAdPod.adCount===this.cviModel.adVideoState.adPosition&&!t;this.cviModel.sessionOptions.preloadContent&&this.contentNeedsToBeLoaded&&e&&this.duration>5&&i&&(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA Will start loading content video; creating facade."),this.contentNeedsToBeLoaded=!1,this.createContentFacade())},_returnIMATimeout:function(){var e=-1,t=this.cviModel.getModule(this.AD_SETTINGS),i=t&&t.enabled&&this.cviModel.getModuleParam(this.AD_SETTINGS,this.IMA_TIMEOUT);return i&&(e=(e=parseInt(i))>0?1e3*e:-1),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _returnIMATimeout: "+e),e},trackAd:function(){this.adTrackingHandle=uvpjs.adUtil.trackAd({adVideoContainer:this.cviMgr.adVideoDiv,context:uvpjs.adUtil.context.IMA,model:this.cviModel})},untrackAd:function(){this.adTrackingHandle=null},trackAdEvent:function(e){this.adTrackingHandle&&uvpjs.adUtil.trackAdEvent({trackingHandle:this.adTrackingHandle,eventName:e,context:uvpjs.adUtil.context.IMA,volume:this.adsManager.getVolume()})}})}(uvpjs.register("uvpjs")),function(e){"use strict";e._;var t,i=["LOADED","STREAM_INITIALIZED","STARTED","AD_BREAK_STARTED","AD_BREAK_ENDED","AD_PROGRESS","FIRST_QUARTILE","MIDPOINT","THIRD_QUARTILE","CLICK","COMPLETE","CUEPOINTS_CHANGED","ERROR"],s=["hStreamLoaded","hStreamInitialized","hAdStarted","hAdBreakStart","hAdBreakEnd","hAdProgress","hAdProgress","hAdProgress","hAdProgress","hAdClick","hAdComplete","hCuePointsChanged","hStreamError"];e.DaiResourceProvider=uvpjs.RP_Platform.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,AD_SETTINGS:"AdSettings",AD_CALL_OVERRIDE:"adCallOverride",init:function(e){this.debug=uvpjs.debug,this.daiStreamId=null,this.streamManager=null,this.adClickElement=null,this.isLiveStream=!1,this.adBreakPending=!1,this.currAdPercentComplete=0,this.currAd=null,this.contentDuration=null,this.suppressFacadePlayOnLoad=!1,this.lastAdBlockCheckTime=0,this.adBlockCheckInterval=60,this.hMap={},this.adPods=null,this.currAdPod=null,this.adTrackingHandle=null,this.pendingSeekTime=null,this._super(e),this.providerType=uvpjs.mediaCapabilities.RP_DAI},initialize:function(e,i,s){var n=document.getElementById(uvpjs.domConstants.CONTENT_ID_PREFIX+s),a=n.getElementsByTagName("video")[0];!t&&(t=google.ima.dai.api),this.debug&&this.log("DAI RP init'ing, IMA version = "+google.ima.VERSION),this.streamManager=new t.StreamManager(a),this.adClickElement=this.createAdClickElement(a),this.streamManager.setClickElement(this.adClickElement),this._super(e,i,s),this.resetAdStates(),this.contentVideoDiv=n,this.hStreamEvent=this.hStreamEvent.bind(this)},cleanUp:function(){this.removeStreamEventListeners(),this.streamManager=null,this.isAdPlaying()&&(this.currAd&&this.dispatchAdEnd(),this.currAdPod&&this.dispatchAdPodEnd(),this.resetAdStates()),this.adClickElement=null,this.adClickElement=null,this.adTrackingHandle=null,this.currAdPod=null,this.currAd=null,this.adPods=null,this.hMap=null,this.hStreamEvent=Function.prototype,this.resetModelState(),this._super()},loadData:function(e,t){var i=this.cviModel.getClassListItemProperty("VideoSourceManager","Platform_MPX","MultiBitrateURL");this.dispatchLoading(),this.rco.canMakePlatformCall(i)?this._super(e,t):(this.dataLoadedCB=e,this.onDataProxyComplete())},onDataProxyComplete:function(){var e=this.contentDataProxy.getProperty("cmsRefGuid");!uvpjs.util.isEmpty(e)&&!this.rco.getVideoId()&&this.rco.setCmsRefGuid(e),this._super()},loadVideoAndBeginPlayback:function(e){var t,i=this.rco,s=this.cviModel,n=this.contentDataProxy.getModel();if(this.suppressFacadePlayOnLoad=!0===e,this._addUVPEventListeners(),this.addStreamEventListeners(),this.resetModelState(),this.setModelRcoOverrides(),s.setNonDefaultContentVideoStateItems(n),s.setContentVideoStateItems(i),s.mergeCDOData(),this.killDataProxy(),!(t=this.assembleResourceDefinition()))return this.debug&&this.log("DAI RP Fatal error: Invalid RCO",this.rco,"error"),void this.dispatchError(this.eventsMgr.eventTypes.VIDEO_START_ERROR,"DAI RP: Invalid RCO",uvpjs.ErrorInfo.errorCodes.INVALID_RESOURCE_FORMAT,!0);this.cviMgr.setPlaybackInfoOnModel(),this.requestStream(t)},requestStream:function(e){var i=!uvpjs.util.isEmpty(e.assetKey),s=new(i?t.LiveStreamRequest:t.VODStreamRequest);s.apiKey=e.apiKey||null,s.adTagParameters=e.adTagParameters,i?(s.assetKey=e.assetKey,s.attemptPreroll=!0,this.isLiveStream=!0,this.id3HandlingEnabled=!0):(s.contentSourceId=e.contentSourceId,s.videoId=e.videoId),this.streamManager.requestStream(s)},createContentFacade:function(){this.debug&&this.log("DAI RP creating facade; ID3 handling = "+this.id3HandlingEnabled),this.createFacade(),this.id3HandlingEnabled&&this.createId3Parser(this.facade.facadeType)},hStreamLoaded:function(e){var t=e.getStreamData().url;if(!uvpjs.util.isDefinedString(t))return this.debug&&this.log("DAI RP: No asset url in StreamLoaded event StreamData",null,"error"),void this.dispatchError(this.eventsMgr.eventType.VIDEO_START_ERROR,uvpjs.ErrorInfo.messages.DAI_ASSET_URL_ERROR,uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,!0);this.cviModel.contentVideoState.assetURL=t,this.cviModel.contentVideoState.isLive=this.isLiveStream,this.dispatchContentDataLoaded(),this.cviModel.incrementMedNum(),this.RPM.resourceStart(this.rco.rcoSeed),this.createContentFacade(),this.suppressFacadePlayOnLoad||(this.facade.showVideo(),this.facade.playVideo())},hStreamInitialized:function(e){this.daiStreamId=e.getStreamData().streamId,this.cviModel.daiStreamId=this.daiStreamId},hAdBreakStart:function(e){this.showAdClickEl(!0),this.resetAdStates(),this.checkForAdBlocker(this.facade.getCurrentTime(),!0),this.contentStartOpen&&(this.dispatchContentEnd(),this.contentStartOpen=!1),this.adBreakPending=!0},hAdBreakEnd:function(e){this.showAdClickEl(!1),this.dispatchAdPodEnd(this.currAdPod),this.resetAdStates(),this.currAdPod=null,this.pendingSeekTime&&(this._hasFacade()&&this.facade.seekTo(this.pendingSeekTime),this.pendingSeekTime=null)},hCuePointsChanged:function(e){this.currAdPod=this.getNewPod(e.getStreamData().cuepoints)},hAdStarted:function(e){var t=e.getAd();this.resetAdStates(),!this.currAdPod&&this.isLiveStream&&(this.currAdPod={played:!0}),this.updateAdModel(t),this.currAd=t,this.trackAd(),this.adBreakPending&&(this.adBreakPending=!1,this.trackAdEvent(e.type),this.dispatchAdPodStart()),this.cviModel.incrementAdNum(),this.dispatchAdStart()},hAdComplete:function(){this.dispatchAdEnd(),this.resetAdStates()},hAdProgress:function(e){var i,s,n,a=e.type,r=t.StreamEvent.Type,o=null;switch(a){case r.FIRST_QUARTILE:o=25;break;case r.MIDPOINT:o=50;break;case r.THIRD_QUARTILE:o=75;break;case r.AD_PROGRESS:(n=(s=(i=e.getStreamData())&&i.adProgressData)&&this.createAdProgressPayload(s))&&this.dispatchVideoProgress(n)}o&&(this.checkForAdBlocker(this.facade.getCurrentTime(),!0),this.currAdPercentComplete=o,this.dispatchAdQuartile(o))},hStreamError:function(e){var t=e.getStreamData(),i=t&&t.errorMessage;this.debug&&this.log("DAI StreamManager Error: "+i,null,"error"),this.dispatchError(this.eventsMgr.eventTypes.VIDEO_START_ERROR,i||"Unknown DAI stream error.",uvpjs.ErrorInfo.errorCodes.DAI_STREAM_ERROR,!0)},hAdClick:function(e){},hStreamEvent:function(e){this.isAdPlaying()&&this.trackAdEvent(e.type),this[this.hMap[e.type]](e)},onVideoSeekTo:function(e){var t,i=e&&e.target,s=e&&e.payload,n=s&&s.seekTime,a=this.facade,r=this._hasFacade(),o=a.getDuration(),l=this.facade.getCurrentTime();"number"==typeof n&&i===this.vidContId&&((n=this.streamManager.streamTimeForContentTime(n))<0||n>o?this.debug&&uvpjs.warn(this.DEBUG_ID,"onVideoSeekTo out of range seekTime = "+n):((t=this.getSkippedPod(n))&&(this.pendingSeekTime=n,n=t.startTime-1),this._seekFromTime=this._seekFromTime||l,this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoSeekTo "+JSON.stringify({seekTime:n,seekFromTime:this._seekFromTime},null,2)),r&&a.seekTo(n)))},getSkippedPod:function(e){var t,i,s,n,a=[];for(t in this.adPods)a.push(this.adPods[t].startTime);for(a.sort(function(e,t){return e-t}),i=a.length;i--;)if((s=a[i])<e)return(n=this.adPods["t_"+s]).hasPlayed?null:n;return null},dispatch:function(e,t){this.eventsMgr.dispatchEvent(e,t,this.vidContId)},dispatchLoading:function(){this.dispatch(this.eventsMgr.eventTypes.VIDEO_STATE_CHANGE,{newState:this.mc.LOADING})},dispatchContentDataLoaded:function(){var e=this.cviModel.getContentVideoState();this.dispatch(this.eventsMgr.eventTypes.CONTENT_DATA_LOADED,{vidState:e})},dispatchAdPodStart:function(){this.dispatch(this.eventsMgr.eventTypes.AD_POD_START,{adPod:this.currAdPod})},dispatchAdPodEnd:function(){this.dispatch(this.eventsMgr.eventTypes.AD_POD_END,{adPod:this.currAdPod})},dispatchAdStart:function(){var e=this.cviModel.getAdVideoState();this.dispatch(this.eventsMgr.eventTypes.AD_LOADED,{adData:e}),this.dispatch(this.eventsMgr.eventTypes.AD_START,{adData:e})},dispatchAdEnd:function(){var e=this.cviModel.getAdVideoState();this.dispatch(this.eventsMgr.eventTypes.AD_END,{adData:e})},dispatchAdQuartile:function(e){this.dispatch(this.eventsMgr.eventTypes.AD_QUARTILE,{percent:e})},dispatchVideoProgress:function(e){this.dispatch(this.eventsMgr.eventTypes.VIDEO_PROGRESS,e)},dispatchError:function(e,t,i,s){this.dispatch(e,{errorInfo:new uvpjs.ErrorInfo({eventType:e,errorCode:i,message:t+"; DAI stream id: "+(this.daiStreamId||"n/a"),isFatal:!0===s,adInfo:this.currAd?this.extractAdInfo(this.currAd):null})})},dispatchAdBlockedEvent:function(){this.dispatch(this.eventsMgr.eventTypes.AD_BLOCKED,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_BLOCKED,errorCode:uvpjs.ErrorInfo.errorCodes.AD_BLOCKING_DETECTED,message:uvpjs.ErrorInfo.messages.AD_BLOCKING_DETECTED,isFatal:!1})})},getNewPod:function(e){var t,i,s=null,n=e&&e.length;for(n&&!this.adPods&&this.createAdPods(e);n--;)t=e[n],i=this.adPods["t_"+t.start],s||i.hasPlayed===t.played||(s=i),i.hasPlayed=t.played;return s},createAdPods:function(e){var t,i,s,n,a,r=0,o=[],l=e.length;for(this.adPods={},i=0;i<l;i++)t=e[i],a=i,s=l>1&&a===l-1?"post":0===a?"pre":"mid",n=t.start,o.push(n),this.adPods["t_"+n]={startTime:n,hasPlayed:!1,adPodId:s+("mid"===s?"_"+r++:"_0"),adCount:0,podDuration:t.end-n};this.cviModel.contentVideoState.chapterStartTimes=o},resetAdStates:function(){var e=this.cviModel;e.resetAdPlaybackState(),e.resetAdVideoState(),e.isCurrVideoAd=!1,this.currAdPercentComplete=0,this.currAd=null,this.showAdClickEl(!1),this.untrackAd()},updateAdModel:function(e){var t=e.getAdPodInfo();this.populateAdVideoState(e),t&&this.currAdPod&&(this.currAdPod.adCount=t.getTotalAds(),this.currAdPod.podDuration=t.getMaxDuration()),this.cviModel.isCurrVideoAd=!0,this.cviModel.mergeCDOData()},populateAdVideoState:function(e){var t=uvpjs.adUtil.extractAdStateData(e,uvpjs.adUtil.context.DAI,this.isLiveStream);t.adBitrate=this.cviModel.getContentPlaybackState().facadeState.currentBitrate,this.cviModel.setAdVideoState(t)},createAdProgressPayload:function(e){var t=this.getVideoProgressPayload(),i=e.currentTime;return t.isAd=!0,t.duration=e.duration,t.currentTime=i,t.absoluteStreamTime=this.facade.getCurrentTime(),t.lastSecondCompleted=Math.floor(i),t.lastPercentageCompleted=this.currAdPercentComplete,t},extractAdInfo:function(e){return uvpjs.adUtil.extractAdInfo(e,uvpjs.adUtil.context.DAI)},trackAd:function(){this.adTrackingHandle=uvpjs.adUtil.trackAd({adVideoContainer:this.contentVideoDiv,context:uvpjs.adUtil.context.DAI,model:this.cviModel})},untrackAd:function(){this.adTrackingHandle=null},trackAdEvent:function(e){this.adTrackingHandle&&e!=t.StreamEvent.Type.AD_PROGRESS&&this.facade&&uvpjs.adUtil.trackAdEvent({trackingHandle:this.adTrackingHandle,eventName:e,context:uvpjs.adUtil.context.DAI,volume:this.cviModel.isMuted?0:this.facade.getVolume()})},startOrResumeContent:function(){this.contentDuration||this.isLiveStream||(this.contentDuration=this.streamManager.contentTimeForStreamTime(this.facade.getDuration()),this.cviModel.contentVideoState.duration=this.contentDuration),this.contentStartOpen=!0,this.showAdClickEl(!1),this.dispatchContentStart()},onUVPJSTimerTick:function(){var e,t,i;this.facade&&this.facade.getPlaybackState()===this.mc.PLAYING&&!this.isAdPlaying()&&(t=this.facade.getCurrentTime(),this.checkForAdBlocker(t,!1),e=this.streamManager.contentTimeForStreamTime(t),!this.contentStartOpen&&(e>0||this.isLiveStream)&&this.startOrResumeContent(),this.id3HandlingEnabled&&this.checkId3Events(e),i=this.createVideoProgressPayload(e,t),this.dispatchVideoProgress(i))},createVideoProgressPayload:function(e,t){var i=this.getVideoProgressPayload();return i.currentTime=e,i.absoluteStreamTime=t,i.duration=this.contentDuration||-1,i},checkBuffering:function(e){this.cviModel.playbackState!==this.mc.PAUSED&&this._super(this.facade.getCurrentTime())},checkForAdBlocker:function(e,t){var i=e-this.lastAdBlockCheckTime>this.adBlockCheckInterval,s=t||i,n=s&&uvpjs.adUtil.checkForAdBlocker(this.cviModel);return s&&(this.lastAdBlockCheckTime=e),n&&(this.debug&&uvpjs.log(this.DEBUG_ID,"DaiResourceProvider: ad blocking detected."),this.dispatchAdBlockedEvent()),!!n},assembleResourceDefinition:function(){var e=this.rco.getAdTagParameters(),t=this.rco.getVideoId(),i=this.rco.getContentSourceId(),s=this.rco.getAssetKey();return s&&e||e&&t&&i?{adTagParameters:e,videoId:t||null,contentSourceId:i||null,assetKey:s||null}:null},addStreamEventListeners:function(){this.streamManager&&this.addOrRemoveStreamListeners("add")},removeStreamEventListeners:function(){this.streamManager&&this.addOrRemoveStreamListeners("remove")},addOrRemoveStreamListeners:function(e){for(var n,a="add"===e?"addEventListener":"removeEventListener",r="addEventListener"===a,o=t.StreamEvent.Type,l=i.length;l--;)n=o[i[l]],r&&(this.hMap[n]=s[l]),!r&&delete this.hMap[n],this.streamManager[a](n,this.hStreamEvent)},createAdClickElement:function(e){var t,i,s,n,a=e.nextSibling;if(a&&"uvpjsDaiContainer"===a.getAttribute("data-role"))return a;for(s in(t=document.createElement("div")).setAttribute("data-role","uvpjsDaiContainer"),i={position:"absolute",width:"100%",height:"100%",left:0,top:0,zIndex:1},n=t.style,i)n[s]=i[s];return e.insertAdjacentElement("afterend",t),t},onPauseVideo:function(e){(e&&e.target)===this.vidContId&&this._hasFacade()&&(this.facade.pauseVideo(),this.isAdPlaying()&&this.trackAdEvent(e.type))},onPlayVideo:function(e){(e&&e.target)===this.vidContId&&this._hasFacade()&&(this.facade.showVideo(),this.facade.playVideo(),this.isAdPlaying()&&this.trackAdEvent(e.type))},onChangeVideoVolume:function(e){var t=e&&e.target,i=e&&e.payload,s=i&&i.vol,n=uvpjs.util.inRange(s,0,1),a=this.cviModel.isMuted;t===this.vidContId&&n&&!a&&this._hasFacade()&&(this.facade.setVolume(s),this.isAdPlaying()&&this.trackAdEvent(e.type))},onMuteVideo:function(e){(e&&e.target)===this.vidContId&&this._hasFacade()&&(this.facade.muteVideo(),this.isAdPlaying()&&this.trackAdEvent(e.type))},onUnMuteVideo:function(e){(e&&e.target)===this.vidContId&&this._hasFacade()&&(this.facade.unMuteVideo(),this.isAdPlaying()&&this.trackAdEvent(e.type))},facadeId3Data:function(e){if(this.streamManager){var t=function(e){this.streamManager.processMetadata("ID3",e.data,e.pts)}.bind(this);e&&e.forEach(t)}},facadeProgress:function(e){},facadeTimeUpdate:function(e){},facadeDurationChanged:function(e){this.contentDuration=this.streamManager.contentTimeForStreamTime(e.duration),this.cviModel.contentVideoState.duration=this.contentDuration},facadeDisplayReady:function(){this.startVideoProgressTimer()},isAdPlaying:function(){return this.cviModel&&!0===this.cviModel.isCurrVideoAd},showAdClickEl:function(e){this.adClickElement&&(this.adClickElement.style.display=!1!==e?"block":"none")},log:function(e,t,i){uvpjs[i||"log"](this.DEBUG_ID,e,t||"")}})}(uvpjs.register("uvpjs")),function(e){"use strict";var t={google_ad_start:"handleAdStart",google_ad_end:"handleAdEnd"};e.DaiSsbResourceProvider=uvpjs.ResourceProvider.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,init:function(e){this.debug=uvpjs.debug,this.isLiveStream=!1,this.suppressFacadePlayOnLoad=!1,this.quartiles={25:0,50:0,75:0},this.contentStartOpen=!1,this.contentDuration=null,this.absoluteDuration=null,this.contentStartTime=null,this.contentVideoDiv=null,this.vidEl=null,this._super(e),this.providerType=uvpjs.mediaCapabilities.RP_DAI},initialize:function(e,t,i){this._super(e,t,i),this.contentVideoDiv=document.getElementById(uvpjs.domConstants.CONTENT_ID_PREFIX+i),this.vidEl=this.contentVideoDiv.getElementsByTagName("video")[0],this.resetAdStates()},cleanUp:function(){this.isAdPlaying()&&(this.dispatchAdEnd(),this.dispatchAdPodEnd(),this.resetAdStates()),this.unlistenForTextTrackId3(),this.resetModelState(),this._super()},loadData:function(e){e()},loadVideoAndBeginPlayback:function(e){var t,i=this.rco,s=this.cviModel;this.suppressFacadePlayOnLoad=!0===e,this._addUVPEventListeners(),this.resetModelState(),this.setModelRcoOverrides(),s.setNonDefaultContentVideoStateItems(this.contentDataProxy.getModel()),s.setContentVideoStateItems(i),s.mergeCDOData(),this.killDataProxy(),this.contentDuration=s.contentVideoState.duration,this.debug&&this.log("DaiSsb: content duration (from rco) = "+this.contentDuration),(t=this.assembleAssetUrl(i))?(this.cviModel.contentVideoState.assetURL=t,this.dispatchContentDataLoaded(),this.cviModel.incrementMedNum(),this.RPM.resourceStart(i.rcoSeed),this.createContentFacade(),this.id3HandlingEnabled&&this.createId3Parser(this.facade.facadeType),!this.suppressFacadePlayOnLoad&&this.facade.playVideo()):this.dispatchError(this.eventsMgr.eventTypes.VIDEO_START_ERROR,"Missing 'assetURL' in RCO",uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,!0)},assembleAssetUrl:function(e){var t,i,s=e.assetURL,n=uvpjs.util;return n.isEmpty(s)?null:s.indexOf("?")>-1?s:(t=(i=e.getAdTagParameters())?n.queryStrFromObj(i):null,n.isEmpty(t)?s:s+"?"+t)},createContentFacade:function(){this.createFacade(),this.listenForTextTrackId3()},handleAdStart:function(e){this.resetAdStates(),this.cviModel.incrementAdNum(),this.updateAdModel(),this.dispatchAdPodStart(e),this.dispatchAdStart()},handleAdEnd:function(){this.dispatchAdEnd(),this.dispatchAdPodEnd(),this.resetAdStates(),this.contentStartTime=this.facade.getCurrentTime(),this.debug&&this.log("DaiSsb provider: contentStartTime = "+this.contentStartTime),this.startContent()},dispatch:function(e,t){this.eventsMgr.dispatchEvent(e,t,this.vidContId)},dispatchContentDataLoaded:function(){var e=this.cviModel.getContentVideoState();this.dispatch(this.eventsMgr.eventTypes.CONTENT_DATA_LOADED,{vidState:e})},dispatchAdPodStart:function(e){var t=this.getPrerollPod(e);this.dispatch(this.eventsMgr.eventTypes.AD_POD_START,{adPod:t})},dispatchAdPodEnd:function(){var e=this.getPrerollPod();e.hasPlayed=!0,this.dispatch(this.eventsMgr.eventTypes.AD_POD_END,{adPod:e})},dispatchAdStart:function(){var e=this.cviModel.getAdVideoState();this.dispatch(this.eventsMgr.eventTypes.AD_START,{adData:e})},dispatchAdEnd:function(){var e=this.cviModel.getAdVideoState();this.dispatch(this.eventsMgr.eventTypes.AD_END,{adData:e})},dispatchAdQuartile:function(e){this.dispatch(this.eventsMgr.eventTypes.AD_QUARTILE,{percent:e})},dispatchVideoProgress:function(e){this.dispatch(this.eventsMgr.eventTypes.VIDEO_PROGRESS,e)},dispatchError:function(e,t,i,s){this.dispatch(e,{errorInfo:new uvpjs.ErrorInfo({eventType:e,errorCode:i,message:t,isFatal:!0===s,adInfo:null})})},getPrerollPod:function(e){return this.adPod||(this.adPod={startTime:e,hasPlayed:!1,adPodId:"pre_0",adCount:1,podDuration:this.getPrerollAdDuration()}),this.adPod},resetAdStates:function(){var e=this.cviModel;e.resetAdPlaybackState(),e.resetAdVideoState(),e.isCurrVideoAd=!1},updateAdModel:function(){this.populateAdVideoState(),this.cviModel.isCurrVideoAd=!0,this.cviModel.mergeCDOData()},populateAdVideoState:function(){var e=uvpjs.adUtil.getAdStateBlank();e.adServerName="dai_ssb",e.duration=this.getPrerollAdDuration(),e.adClipID="pre_0",e.adPosition=1,e.adType="pre",this.cviModel.setAdVideoState(e)},getPrerollAdDuration:function(){var e=this.getAbsoluteDuration();return e>0&&this.contentDuration>0?e-this.contentDuration:-1},getAbsoluteDuration:function(){return this.absoluteDuration||(this.absoluteDuration=this.facade.getDuration()),this.absoluteDuration},createAdProgressPayload:function(){var e,t,i=this.getVideoProgressPayload(),s=this.facade.getCurrentTime(),n=this.getPrerollAdDuration(),a=Math.floor(s/n*100);switch(a){case 25:e=this.quartiles[25],t=25;break;case 50:e=this.quartiles[50],t=50;break;case 75:e=this.quartiles[75],t=75}return t&&!e&&this.dispatchAdQuartile(t),t&&(this.quartiles[String(t)]=1),i.isAd=!0,i.duration=n,i.currentTime=s,i.absoluteStreamTime=this.facade.getCurrentTime(),i.lastSecondCompleted=Math.floor(s),i.lastPercentageCompleted=a,i},startContent:function(){this.contentStartOpen||(this.contentStartOpen=!0,this.dispatchContentStart())},onUVPJSTimerTick:function(){var e,t=this.facade&&this.facade.getPlaybackState()===this.mc.PLAYING,i=this.isAdPlaying(),s=this.contentStartOpen,n=t&&this.facade.getCurrentTime();t&&(e=i?this.createAdProgressPayload():s?this.createVideoProgressPayload():null,n>1&&!s&&!i&&(this.debug&&this.log("DaiSsb provider: A 'no ad' start @ "+n),this.contentStartTime=n,this.startContent()),this.id3HandlingEnabled&&this.checkId3Events(n),e&&this.dispatchVideoProgress(e))},createVideoProgressPayload:function(){var e=this.getVideoProgressPayload(),t=this.facade.getCurrentTime(),i=t-this.contentStartTime;return e.currentTime=i,e.absoluteStreamTime=t,e.duration=this.contentDuration||-1,e},checkBuffering:function(e){this.cviModel.playbackState!==this.mc.PAUSED&&this._super(this.facade.getCurrentTime())},onVideoSeekTo:function(e){var t=e&&e.target,i=e&&e.payload,s=i&&i.seekTime,n=this.facade,a=this._hasFacade(),r=a&&(this.absoluteDuration||n.getDuration()),o=this.getPrerollAdDuration(),l=this.facade.getCurrentTime();"number"==typeof s&&t===this.vidContId&&r&&((s+=o>0?o:0)<0||s>r?this.debug&&uvpjs.warn(this.DEBUG_ID,"onVideoSeekTo out of range seekTime = "+s):(this._seekFromTime=this._seekFromTime||l,this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoSeekTo "+JSON.stringify({seekTime:s,seekFromTime:this._seekFromTime},null,2)),a&&n.seekTo(s)))},facadeProgress:function(e){},facadeTimeUpdate:function(e){},facadeDurationChanged:function(e){!this.absoluteDuration&&(this.absoluteDuration=e.duration)},facadeDisplayReady:function(){this.startVideoProgressTimer()},listenForTextTrackId3:function(){this.hAddTextTrack=this.hAddTextTrack.bind(this),this.hCueChange=this.hCueChange.bind(this),this.vidEl.textTracks.addEventListener("addtrack",this.hAddTextTrack,!1)},unlistenForTextTrackId3:function(){var e=this.vidEl.textTracks;e.removeEventListener("addtrack",this.hAddTextTrack,!1);for(var t=0,i=e.length;t<i;t++)e[t].removeEventListener("cuechange",this.hCueChange,!1)},hAddTextTrack:function(e){e.track&&"metadata"===e.track.kind&&(e.track.addEventListener("cuechange",this.hCueChange,!1),e.track.mode="hidden")},hCueChange:function(e){e.target&&e.target.activeCues&&1==e.target.activeCues.length&&this.handleId3Cue(e.target.activeCues[0])},handleId3Cue:function(e){var i,s,n=e.value;"TXXX"===n.key&&(i=""!==n.info?n.info:n.data,(s=t[i])&&this[s](e.startTime))},isAdPlaying:function(){return this.cviModel&&!0===this.cviModel.isCurrVideoAd},log:function(e,t,i){uvpjs[i||"log"](this.DEBUG_ID,e,t||"")}})}(uvpjs.register("uvpjs")),function(e){"use strict";e.P2pClient=uvpjs.Class.subClass({init:function(e){this.clientName=e.clientName||null,this.requiredParams=e.requiredParams||null},destroy:function(){this.requiredParams=null},getHlsjsLoader:function(){var e=uvpjs.P2pClient.clientMap[this.clientName];return e&&e.getHlsjsLoader&&(e.getHlsjsLoader()||null)}}),e.P2pClient.debugId=uvpjs.DebugManager.configParams.P2P_CLIENT,e.P2pClient.clientMap={peer5:{uvpcModuleName:"Peer5PluginJS",sdkPath:"//api.peer5.com/peer5.js?id=",hlsjsLoaderPath:"//api.peer5.com/peer5.hlsjs.loader.js",requires:["apiKey"],validateScriptLoad:function(){return null!==this.getHlsjsLoader()},getHlsjsLoader:function(){return window.peer5&&window.peer5.HlsJsLoader||null},getApi:function(){return window.peer5},loadScripts:function(e,t){var i;this.getHlsjsLoader()?e():t.apiKey?(i=this.loadHlsLoader.bind(this,e),uvpjs.VideoDeliveryPluginService.load(this.sdkPath+t.apiKey,i,2e3)):e(!0)},loadHlsLoader:function(e,t){if(t)return uvpjs.debug&&uvpjs.log(uvpjs.P2pClient.debugId,"P2pClient: Peer5 SDK load failed",t),void e(!0);uvpjs.VideoDeliveryPluginService.load(this.hlsjsLoaderPath,e,2e3)}}}}(uvpjs.register("uvpjs")),function(e){"use strict";e.MultiCdnClient=uvpjs.Class.subClass({init:function(e){this.clientName=e.clientName||null,this.requiredParams=e.requiredParams||null,this.url=uvpjs.MultiCdnClient.clientMap[this.clientName].getDecisionUrl(this.requiredParams),this.decisionCallback=null,this.timeoutHandle=null,this.aborted=!1,this.inFlight=!1},destroy:function(){this.decisionCallback=Function.prototype,this.requiredParams=null},getDecision:function(e){this.inFlight||(this.inFlight=!0,this.decisionCallback=e,this.timeoutHandle=setTimeout(this.abortOnTimeout.bind(this),2e3),(new uvpjs.CodeLoader).loadXHR(this.url,this.handleDecision.bind(this),this.handleError.bind(this),"json"))},abortOnTimeout:function(){this.aborted=!0,this.decisionCallback(null)},handleDecision:function(e){clearTimeout(this.timeoutHandle),!this.aborted&&this.decisionCallback(e.response),this.reset()},handleError:function(){clearTimeout(this.timeoutHandle),!this.aborted&&this.decisionCallback(null),this.reset()},reset:function(){this.inFlight=!1,this.aborted=!1}}),e.MultiCdnClient.clientMap={cedexis:{uvpcModuleName:"CedexisMultiCDNPlugin",decisionUrl:"//hopx.cedexis.com/zones/1/customers/{customerId}/apps/{appId}/decision",requires:["customerId","appId"],getDecisionUrl:function(e){return e&&e.customerId&&e.appId?this.decisionUrl.replace("{customerId}",e.customerId).replace("{appId}",e.appId):null},validateScriptLoad:function(){return!0},loadScripts:function(e){e()}}}}(uvpjs.register("uvpjs")),function(e){"use strict";e.VideoDeliveryPluginService=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.CORE_VIDEO_INSTANCE,init:function(e,t){var i=uvpjs.VideoDeliveryPluginService.clientType;this.model=t,this.callback=e,this.staticSvc=uvpjs.VideoDeliveryPluginService,this.p2pClientOptions=this.getClientOptions(i.P2P),this.multiCdnClientOptions=this.getClientOptions(i.MULTI_CDN)},destroy:function(){this.model=null,this.callback=Function.prototype,this.p2pClientOptions=null,this.multiCdnClientOptions=null},createPlugins:function(){this.p2pClientOptions.canUse||this.multiCdnClientOptions.canUse?this.loadDeliveryPluginScripts():this.callback(null,null)},handleAllScriptsLoaded:function(){var e=null,t=null;this.p2pClientOptions&&(this.p2pClientOptions.canUse&&(e=this.createClient(this.staticSvc.clientType.P2P,this.p2pClientOptions)),this.multiCdnClientOptions.canUse&&(t=this.createClient(this.staticSvc.clientType.MULTI_CDN,this.multiCdnClientOptions)),this.callback(e,t))},handleMcdnReady:function(e){var t=this.multiCdnClientOptions;!e&&this.validateScriptLoad(this.staticSvc.clientType.MULTI_CDN,t.clientName)||(t.canUse=!1,this.debug&&uvpjs.log(this.DEBUG_ID,"Error loading SDK for "+t.clientName)),this.handleAllScriptsLoaded()},loadMultiCdn:function(){var e=this.multiCdnClientOptions;this.loadClientScripts(this.staticSvc.clientType.MULTI_CDN,e.clientName,this.handleMcdnReady.bind(this),e.requiredParams)},handleP2pReady:function(e,t){var i=this.p2pClientOptions;!t&&this.validateScriptLoad(this.staticSvc.clientType.P2P,i.clientName)||(i.canUse=!1,this.debug&&uvpjs.log(this.DEBUG_ID,"Error loading SDK for "+i.clientName)),e?this.loadMultiCdn():this.handleAllScriptsLoaded()},loadDeliveryPluginScripts:function(){var e=this.p2pClientOptions,t=this.multiCdnClientOptions.canUse;e.canUse?this.loadClientScripts(this.staticSvc.clientType.P2P,e.clientName,this.handleP2pReady.bind(this,t),e.requiredParams):t?this.loadMultiCdn():this.handleAllScriptsLoaded()},loadClientScripts:function(e,t,i,s){var n=this.getClientObject(e,t);n||i(!0),n.loadScripts(i,s)},validateScriptLoad:function(e,t){var i=this.getClientObject(e,t);return i&&i.validateScriptLoad()||!1},createClient:function(e,t){return new e(t)},getClientOptions:function(e){var t,i,s,n,a,r,o,l,d,u=this.model,c=this.getSupportedClients(e),h={canUse:!1,clientName:null};if(e===this.staticSvc.clientType.P2P&&!uvpjs.mediaCapabilities.canUseP2p())return h;for(t in c)if((l=(s=c[i=t])&&s.uvpcModuleName)&&u.isModuleEnabled(l)){for(a=(n=s.requiredParams)&&n.length||0,o={},d=!0;a--;){if(r=u.getModuleParam(l,n[a]),uvpjs.util.isEmpty(r)){d=!1;break}o[n[a]]=r}return{canUse:d,clientName:i,requiredParams:o}}return h},getSupportedClients:function(e){var t,i,s={},n=e.clientMap;if(!n)return s;for(t in n)i=n[t],s[t]={uvpcModuleName:i.uvpcModuleName,requiredParams:i.requires};return s},getClientObject:function(e,t){return e.clientMap[t]||null}});var t=e.VideoDeliveryPluginService;t.clientType={P2P:uvpjs.P2pClient,MULTI_CDN:uvpjs.MultiCdnClient},t.load=function(e,t,i){(new uvpjs.CodeLoader).loadScript(e,t,i)}}(uvpjs.register("uvpjs")),function(e){e.FullscreenManager=uvpjs.Class.subClass({init:function(e){var t=uvpjs.util,i=e||{},s=uvpjs.mediaCapabilities;this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.SKIN_MANAGER,i.videoElement&&i.container?(this.videoEl=i.videoElement,this.container=i.container,this.fullscreenChangeCallback=t.isFunction(i.fullscreenChangeCallback)&&i.fullscreenChangeCallback,this.readyCallback=t.isFunction(i.readyCallback)&&i.readyCallback,this.fsElement=null,this.hasFsApiSupport=!1,this.hasValidEntryMethod=!1,this.enterEvt=null,this.exitEvt=null,this.exitScope=null,this.canUseFullscreen=!1,this.enterMethod=s.getEnterFullscreenMethodName(),this.exitMethod=s.getExitFullscreenMethodName(),this.fsElementName=s.getFullScreenElementName(),this.isFullscreenProperty=s.getIsFullscreenPropertyName(),this.hMetadataLoaded=this.hMetadataLoaded.bind(this),this.hFullScreenEvent=this.hFullScreenEvent.bind(this),this.initialize()):uvpjs.error(this.DEBUG_ID,"FullscreenManager: constructor missing required options.")},destroy:function(){this.hasFsApiSupport?this.fsElement&&this.fsElement.removeEventListener(this.enterEvt,this.hFullScreenEvent,!1):this.fsElement&&(this.fsElement.removeEventListener(this.enterEvt,this.hFullScreenEvent,!1),this.fsElement.removeEventListener(this.exitEvt,this.hFullScreenEvent,!1)),this.videoEl=null,this.fsElement=null,this.container=null,this.exitScope=null,this.fullscreenChangeCallback=null,this.hMetadataLoaded=this.hFullScreenEvent=this.readyCallback=Function.prototype},enterFullscreen:function(){!this.isFullscreen()&&this.hasValidEntryMethod&&this.fsElement[this.enterMethod]()},exitFullscreen:function(){this.isFullscreen()&&this.hasValidExitMethod&&this.exitScope[this.exitMethod]()},isFullscreenAvailable:function(){return uvpjs.mediaCapabilities.isFullscreenAvailable(this.videoEl)},isFullscreen:function(){return!!(this.hasFsApiSupport?document[this.fsElementName]:this.videoEl[this.isFullscreenProperty])},usesFullscreenApi:function(){return this.hasFsApiSupport},hFullScreenEvent:function(e){var t=this.isFullscreen();e.stopPropagation(),this.fullscreenChangeCallback&&this.fullscreenChangeCallback(t)},hMetadataLoaded:function(){this.canUseFullscreen=this.isFullscreenAvailable(),this.readyCallback&&this.readyCallback(this.canUseFullscreen),this.videoEl.removeEventListener("loadedmetadata",this.hMetadataLoaded,!1),this.hMetadataLoaded=Function.prototype},getInfo:function(){return{userAgent:navigator.userAgent,hasFullscreenApiSupport:this.hasFsApiSupport,canUseFullscreen:this.canUseFullscreen,enterEvent:this.enterEvt,enterMethod:this.enterMethod,exitEvent:this.exitEvt,exitMethod:this.exitMethod,fullScreenElementTag:this.fsElement.tagName,documentFullscreenElement:this.fsElementName}},getExitScope:function(){var e=document[this.exitMethod]?document:this.videoEl[this.exitMethod]?this.videoEl:null;return e&&uvpjs.util.isFunction(e[this.exitMethod])?e:null},validateEntryAndExitMethods:function(){var e=this.fsElement&&this.fsElement[this.enterMethod],t=this.exitScope&&this.exitScope[this.exitMethod],i=uvpjs.util;this.hasValidEntryMethod=i.isFunction(e),this.hasValidExitMethod=i.isFunction(t)},initialize:function(){var e,t,i,s=uvpjs.mediaCapabilities;this.hasFsApiSupport=s.supportsFullscreenApi(),this.hasFsApiSupport&&(this.canUseFullscreen=this.isFullscreenAvailable()),this.exitScope=this.getExitScope(),this.hasFsApiSupport?(i=s.getFullscreenEventName(),(s.isFirefox()||s.isIE()?document:this.container).addEventListener(i,this.hFullScreenEvent,!1),this.fsElement=this.container):this.enterMethod&&(this.fsElement=this.videoEl,e=s.getFullscreenEnterEventName(),t=s.getFullscreenExitEventName(),this.fsElement.addEventListener(e,this.hFullScreenEvent,!1),this.fsElement.addEventListener(t,this.hFullScreenEvent,!1),this.enterEvt=e,this.exitEvt=t),this.validateEntryAndExitMethods(),this.hasValidEntryMethod?(this.canUseFullscreen&&this.readyCallback&&this.readyCallback(!0),this.hasFsApiSupport&&this.canUseFullscreen||this.videoEl.addEventListener("loadedmetadata",this.hMetadataLoaded,!1),this.debug&&uvpjs.log("Fullscreen management init'd; info: ",this.getInfo())):this.debug&&uvpjs.log("Fullscreen determined not available",this.getInfo())}}),e.FullscreenManager.hasFullscreenSupport=function(){return!!uvpjs.mediaCapabilities.getEnterFullscreenMethodName()}}(uvpjs.register("uvpjs")),function(e){"use strict";var t,i,s,n,a=e._;e.SkinManager=uvpjs.Class.subClass({DEFAULT_SKIN_PATH:"css/default.css",NULL_TIME:"00:00",HIDE_DELAY:2e3,TAP_THRESHOLD:300,THROTTLE_WAIT:250,INITIAL_DOM_SETUP_WAIT:100,CAPTION_PADDING:10,SIZE_XS_BREAKPOINT:480,SIZE_SM_BREAKPOINT:550,SIZE_MD_BREAKPOINT:992,SIZE_LG_BREAKPOINT:1200,AD_CONTAINER_ID_PREFIX:"ad",CONTENT_CONTAINER_ID_PREFIX:"content",CONTROLS_CONTAINER_ID_PREFIX:"controls",VIDEO_CONTAINER_ID_PREFIX:"video",AD_LEARNMORE_ID_PREFIX:"learnMore",AD_COUNTDOWN_ID_PREFIX:"countDown",AD_LEARNMORE_TEXT:"Learn More",PRIMARY_BLOCK:"uvpjs",AD_MODIFIER:"ad",LIVE_MODIFIER:"live",PAUSED_MODIFIER:"paused",STREAMING_MODIFIER:"streaming",ACTIVE_MODIFIER:"active",DISABLED_MODIFIER:"disabled",FULLSCREEN_MODIFIER:"fullscreen",HIDDEN_MODIFIER:"hidden",MOBILE_MODIFIER:"mobile",TOUCH_MODIFIER:"touch",SIZE_XS_MODIFIER:"xs",SIZE_SM_MODIFIER:"sm",SIZE_MD_MODIFIER:"md",SIZE_LG_MODIFIER:"lg",BLOCK_DELIMITER:"_",BLOCK_ELEMENT_DELIMITER:"__",ELEMENT_DELIMITER:"-",ELEMENT_MODIFIER_DELIMITER:"--",MODIFIER_DELIMETER:"-",CLASS_SELECTOR_PREFIX:".",ID_SELECTOR_PREFIX:"#",css:{CONTENT:"content",VIDEO:"video",AD:"ad",AD_LEARNMORE:"ad-learnmore",CONTROLS:"controls",PREVIEW_BTN:"btn-preview",REPLAY_BTN:"btn-replay",LARGE_PLAY_BTN:"btn-large-play",BUFFERING_FRAME:"buffering-frame",SETTINGS_MENU:"settings-menu",SETTINGS_MENU_ITEM:"settings-menu-item",SETTINGS_MENU_INPUT:"settings-menu-input",CONTROL_BAR:"controlbar",PLAYSTATE_BTN:uvpjs.Type.Button.PLAYSTATE,TIME:"time",TIME_CURRENT:"time-current",TIME_DURATION:"time-duration",TIME_LIVE:"time-live",VOLUME_BTN:uvpjs.Type.Button.VOLUME,CLOSED_CAPTION_BTN:uvpjs.Type.Button.CLOSED_CAPTION,SETTINGS_BTN:uvpjs.Type.Button.SETTINGS,FULLSCREEN_BTN:uvpjs.Type.Button.FULLSCREEN,PROGRESS:"progress",PROGRESS_SLIDER:"progress-slider",PROGRESS_LOADED:"progress-loaded",VOLUME_SLIDER:"volume-slider"},settingsMenu:[{name:"controls",label:"Controls",enabled:!1,items:[{name:"background-opacity",label:"Background opacity",items:[{value:".25",label:"25%"},{value:".50",label:"50%"},{value:".75",label:"75%"},{value:"1",label:"100%",default:!0}]}]},{name:"cc",label:"Subtitles/CC",enabled:!1,items:[{name:"background-color",label:"Background color",items:[{value:"#ffffff",label:"White"},{value:"#ffff00",label:"Yellow"},{value:"#008000",label:"Green"},{value:"#00ffff",label:"Cyan"},{value:"#0000ff",label:"Blue"},{value:"#ff00ff",label:"Magenta"},{value:"#ff0000",label:"Red"},{value:"#000000",label:"Black",default:!0}]},{name:"background-opacity",label:"Background opacity",items:[{value:"0",label:"0%"},{value:".25",label:"25%"},{value:".50",label:"50%"},{value:".75",label:"75%"},{value:"1",label:"100%",default:!0}]},{name:"font-color",label:"Font color",items:[{value:"#ffffff",label:"White",default:!0},{value:"#ffff00",label:"Yellow"},{value:"#008000",label:"Green"},{value:"#00ffff",label:"Cyan"},{value:"#0000ff",label:"Blue"},{value:"#ff00ff",label:"Magenta"},{value:"#ff0000",label:"Red"},{value:"#000000",label:"Black"}]},{name:"font-opacity",label:"Font opacity",items:[{value:"0",label:"0%"},{value:".25",label:"25%"},{value:".50",label:"50%"},{value:".75",label:"75%"},{value:"1",label:"100%",default:!0}]},{name:"font-size",label:"Font size",items:[{value:"50%"},{value:"75%"},{value:"100%",default:!0},{value:"125%"},{value:"150%"},{value:"175%"},{value:"200%"}]},{name:"font-weight",label:"Font weight",items:[{value:"Normal",default:!0},{value:"Bold"}]},{name:"font-family",label:"Font family",items:[{value:"Arial",label:"Arial",default:!0},{value:"Avenir"},{value:"Copperplate"},{value:"Courier"},{value:"Helvetica"},{value:"Iowan"},{value:"Menlo"},{value:"sans-serif",label:"Sans Serif"},{value:"Trebuchet"}]},{name:"text-position",label:"Position",enabled:!0,items:[{value:"default",label:"Default"},{value:"top-left",label:"Top Left"},{value:"top-center",label:"Top Center"},{value:"top-right",label:"Top Right"},{value:"middle-left",label:"Middle Left"},{value:"middle-center",label:"Middle Center"},{value:"middle-right",label:"Middle Right"},{value:"bottom-left-floated",label:"Bottom Left"},{value:"bottom-center-floated",label:"Bottom Center",default:!0},{value:"bottom-right-floated",label:"Bottom Right"}]},{name:"text-edge-style",label:"Text edge style",items:[{value:"none",label:"None",default:!0},{value:"drop-shadow",label:"Drop Shadow"},{value:"raised",label:"Raised"},{value:"outline",label:"Outline"}]}]}],diagnosticMenuCfg:{name:"debug",label:"Debug",enabled:!0,items:[{value:"diagnostic-window",label:"Show diagnostics"}]},init:function(e){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.SKIN_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"init"),this.vci=e.vci,this.dom=this.vci.dom,this._namespace=null,this._containerEl=this.dom.outer.el,this._contentEl=this.dom.content.el,this._videoEl=this.dom.video.el,this._adEl=this.dom.ad.el,this._controlsEl=this.dom.controls.el,this._containerId=this._containerEl.id,this._controlsId=this._controlsEl.id,this._skinReadyCB=e.skinReadyCallback,this.mc=uvpjs.mediaCapabilities,this.fullscreenMgr=null,this._autoPlay=!1,this._playbackState=this.mc.EMPTY,this._controlList={},this._controlCache={},this._intervals={},this._disabledButtons=[],this._downloaded=0,this._isMouseActive=!1,this._previewCallbackDone=!1,this._canFullscreen=!1,this._captionsLoaded=!1,this._ccEnabledByUser=!1,this._enableReplay=!1,this._isSliding=!1,this._isTouchActive=!1,this._cssPath="",this._cssRules={},this._styleEl=null,this._previewImage="",this._waitCount=0,this._vendorPrefix=this.mc.getBrowserVendorPrefix(),this._isMSEdge=this.mc.isEdge(),this._isTouch=this.mc.isMobile()&&this.mc.isTouch(),this._hasFirstTouch=!1,this._isIOS=this.mc.isIOS(),this.isAndroidOnHlsjs=this.mc.canPlayHlsjsAndriod(this.vci.CVI_Mgr.cviModel.getModuleParam("VideoPlaybackSettings","forceHlsjs")),this._isAndroid=this.mc.isAndroid(),this._playstateBtn=null,this._playToggleFrame=null,this._progress=null,this._progressSlider=null,this._controlBar=null,this._previewBtn=null,this._replayBtn=null,this._volumeSlider=null,this._volumeBtn=null,this._ccBtn=null,this._settingsBtn=null,this._fullscreenBtn=null,this._touchStartTime=null,this.isMonitoringMuting=!1,this.muteMonitorIntervalId=null,this.currVolumeInfo=null,this.durationChecked=!1,this.controlsVisible=!1,this.ignoreVideoStateChange=!1,this._menuSelections={},this._hPlay=null,this._onSettingsMenuBtnClick=this._onSettingsMenuBtnClick.bind(this),this._onSettingsMenuInputClick=this._onSettingsMenuInputClick.bind(this),this._intervals[this._getClassName(this.PRIMARY_BLOCK,this.ACTIVE_MODIFIER)]=-1,this.initialize(e.skinConfig)},destroy:function(){var e=function(){};this._clearIntervals(),this._removeUIEventListeners(),this._removeUVPJSEventListeners(),this._removeMenuEventListeners(),clearTimeout(this.muteMonitorIntervalId),this.vci=null,this.mc=null,this.dom=null,this._containerEl=null,this._contentEl=null,this._videoEl=null,this._adEl=null,this._controlsEl=null,this._containerId=null,this._controlsId=null,this._playstateBtn=null,this._playToggleFrame=null,this._progress=null,this._progressSlider=null,this._controlBar=null,this._previewBtn=null,this._replayBtn=null,this._volumeSlider=null,this._volumeBtn=null,this._ccBtn=null,this._settingsBtn=null,this._fullscreenBtn=null,this._updateProgressSlider=null,this._skinReadyCB=e,this._replayCB=e,this._controlList=null,this._controlCache=null,this._intervals=null,this._previewImage=null,this._disabledButtons=null,this._touchStartTime=null},initialize:function(e){var t=uvpjs.util,i=uvpjs.Configuration.path,s=this._containerId,n=e.customCSS;this._namespace="."+s+".skin",this._autoPlay=e.isMutedAutoplay||e.isUnmutedAutoplay,this._isMutedAutoplay=e.isMutedAutoplay,this._previewImage=e.previewImage,this._enableReplay=e.enableReplay,this._themeName=e.themeName,this._controls=e.controls,this._template=e.template,this._canFullscreen=uvpjs.FullscreenManager.hasFullscreenSupport(),this._cssPath=t.isDefinedString(n)&&n||i+this.DEFAULT_SKIN_PATH,this.vci.usesDiagnosticWindow()&&this.settingsMenu.push(this.diagnosticMenuCfg),this.debug&&uvpjs.log(this.DEBUG_ID,"initialize cfg",JSON.stringify(e)),this._hideContainers(),this._setupDom(),this._addStylesheetToDom(),this._disableButton(this.css.FULLSCREEN_BTN),this._canFullscreen&&(this.fullscreenMgr=new uvpjs.FullscreenManager({videoElement:this._videoEl,container:this._containerEl,readyCallback:this._handleFullscreenMgrReady.bind(this),fullscreenChangeCallback:this._handleFullscreenChange.bind(this)}))},setPlaystate:function(e){this._playbackState=e,this._updatePlaybackStateUI(this._playbackState)},disableButton:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"disableButton",e),a.includes(this._disabledButtons,e)||this._disabledButtons.push(e),this._disableButton(e)},enableButton:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"enableButton",e),a.pull(this._disabledButtons,e),this._enableButton(e)},_handleFullscreenMgrReady:function(e){e&&this._enableButton(this.css.FULLSCREEN_BTN)},_handleFullscreenChange:function(e){var t=this.fullscreenMgr.usesFullscreenApi();this._hide(this.css.VOLUME_SLIDER),e?(this.vci.fullscreen(!0),t&&this._addModifier(this.PRIMARY_BLOCK,this.FULLSCREEN_MODIFIER),this._isIOS&&this.monitorMuting(!0)):(this.vci.fullscreen(!1),t&&this._removeModifier(this.PRIMARY_BLOCK,this.FULLSCREEN_MODIFIER),this._isIOS&&this.monitorMuting(!1,!0))},_disableButton:function(e){var t=this._queryByElementName(e);this.debug&&uvpjs.log(this.DEBUG_ID,"_disableButton",e),this._disable(e),t&&t.setAttribute("disabled","disabled")},_enableButton:function(e){var t=this._queryByElementName(e);this.debug&&uvpjs.log(this.DEBUG_ID,"_enableButton",e),a.includes(this._disabledButtons,e)||(this._enable(e),t&&t.removeAttribute("disabled"))},_addUVPJSEventListeners:function(){var e=this.vci,t=this._namespace,i=uvpjs.EventType;e.addEventListener(i.AD_START+t,this._onAdStart.bind(this)),e.addEventListener(i.AD_END+t,this._onAdEnd.bind(this)),!this._isIOS&&e.addEventListener(i.CAPTIONS_READY+t,this._onCaptionsReady.bind(this)),e.addEventListener(i.CONTENT_START+t,this._onContentStart.bind(this)),e.addEventListener(i.CONTENT_END+t,this._onContentEnd.bind(this)),e.addEventListener(i.VIDEO_PROGRESS+t,this._onVideoProgress.bind(this)),e.addEventListener(i.VIDEO_STATE_CHANGE+t,this._onVideoStateChange.bind(this)),e.addEventListener(i.VIDEO_LOADING+t,this._onVideoLoading.bind(this)),e.addEventListener(i.CONTROL_MUTE+t,this._onControlMuteUnmute.bind(this)),e.addEventListener(i.CONTROL_UNMUTE+t,this._onControlMuteUnmute.bind(this)),e.addEventListener(i.RESOURCE_START+t,this._onResourceStart.bind(this)),e.addEventListener(i.RESOURCE_END+t,this._onResourceEnd.bind(this)),e.addEventListener(i.CONTAINER_RESIZE+t,this._onUVPJSResize.bind(this)),e.addEventListener(i.DIAGNOSTIC_WINDOW_CLOSE_BUTTON+t,this._onDiagCloseButton.bind(this))},_removeUVPJSEventListeners:function(){var e=this.vci,t=this._namespace,i=uvpjs.EventType;e&&e instanceof uvpjs.VideoControlInterface&&(e.removeEventListener(i.AD_START+t),e.removeEventListener(i.AD_END+t),!this._isIOS&&e.removeEventListener(i.CAPTIONS_READY+t),e.removeEventListener(i.CONTENT_START+t),e.removeEventListener(i.CONTENT_END+t),e.removeEventListener(i.VIDEO_PROGRESS+t),e.removeEventListener(i.VIDEO_STATE_CHANGE+t),e.removeEventListener(i.VIDEO_LOADING+t),e.removeEventListener(i.CONTROL_MUTE+t),e.removeEventListener(i.CONTROL_UNMUTE+t),e.removeEventListener(i.RESOURCE_END+t),e.removeEventListener(i.CONTAINER_RESIZE+t))},_addUIEventListeners:function(){for(var e=this.mc.isIE()?"change":"input",t=this._containerEl,i=this.css,s=this.shouldTrapTaps(),n=["_hideMenu","_onUVPJSGestureEvent","_onPreviewBtn","_onReplayBtn","_onControlBarMouseOver","_onControlBarMouseOut","_onProgressMouseOver","_onProgressMouseOut","_onProgressSliderEvent","_onVolumeSliderEvent","_onPlayToggle","_onVolumeBtnEvent","_onClosedCaptionBtnClick","_onSettingsBtnClick","_onFullscreenBtnClick","_hNonTap"],a=n.length;a--;)"_onClosedCaptionBtnClick"===n[a]&&this._isIOS||(this[n[a]]=this[n[a]].bind(this));var r=this._onUVPJSGestureEvent,o=this._hNonTap,l=this._onProgressSliderEvent,d=this._onVolumeSliderEvent,u=this._onVolumeBtnEvent;document.addEventListener("click",this._hideMenu,!1),window.addEventListener("scroll",o),t.addEventListener("mouseenter",r,!0),t.addEventListener("mouseleave",r,!0),t.addEventListener("mousemove",r,!0),t.addEventListener("mousedown",r,!1),t.addEventListener("mouseup",r,!1),t.addEventListener("click",r,!1),t.addEventListener("touchstart",r,!0),t.addEventListener("touchend",r,!0),this._previewBtn=this._queryByElementName(i.PREVIEW_BTN),this._previewBtn.addEventListener("touchend",this._onPreviewBtn,!0),this._previewBtn.addEventListener("touchmove",o),!this._isTouch&&this._previewBtn.addEventListener("click",this._onPreviewBtn,!0),this._replayBtn=this._queryByElementName(i.REPLAY_BTN),this._replayBtn.addEventListener("touchend",this._onReplayBtn,!0),!this._isTouch&&this._replayBtn.addEventListener("click",this._onReplayBtn,!0),this._controlBar=this._queryByElementName(i.CONTROL_BAR),this._controlBar.addEventListener("mouseover",this._onControlBarMouseOver,!1),this._controlBar.addEventListener("mouseout",this._onControlBarMouseOut,!1),this._progress=this._queryByElementName(i.PROGRESS),this._progress.addEventListener("mouseover",this._onProgressMouseOver,!1),this._progress.addEventListener("mouseout",this._onProgressMouseOut,!1),this._progressSlider=this._queryByElementName(i.PROGRESS_SLIDER),this._progressSlider.addEventListener(e,l,!1),this._progressSlider.addEventListener("mousedown",l,!1),this._progressSlider.addEventListener("mouseup",l,!1),this._progressSlider.addEventListener("touchstart",l,!0),this._progressSlider.addEventListener("touchend",l,!0),this._volumeSlider=this._queryByElementName(i.VOLUME_SLIDER),this.mc.supportsVolume()?(this._volumeSlider.addEventListener(e,d,!1),this._volumeSlider.addEventListener("mouseover",d,!1),this._volumeSlider.addEventListener("mouseout",d,!1)):this._disable(this.css.VOLUME_SLIDER),this._playToggleFrame=this._queryByElementName(i.LARGE_PLAY_BTN),!s&&this._playToggleFrame.addEventListener("click",this._onPlayToggle,!1),this._playstateBtn=this._queryByElementName(i.PLAYSTATE_BTN),!s&&this._playstateBtn.addEventListener("click",this._onPlayToggle,!1),this._volumeBtn=this._queryByElementName(i.VOLUME_BTN),!s&&this._volumeBtn.addEventListener("click",u,!1),this._volumeBtn.addEventListener("mouseover",u,!1),this._volumeBtn.addEventListener("mouseout",u,!1),this._isIOS||(this._ccBtn=this._queryByElementName(i.CLOSED_CAPTION_BTN),!s&&this._ccBtn.addEventListener("click",this._onClosedCaptionBtnClick,!1)),this._settingsBtn=this._queryByElementName(i.SETTINGS_BTN),!s&&this._settingsBtn.addEventListener("click",this._onSettingsBtnClick,!1),this._updateProgressSlider=this._updateSliderUI.bind(this,this._progressSlider,i.PROGRESS_SLIDER),this._fullscreenBtn=this._queryByElementName(i.FULLSCREEN_BTN),this._canFullscreen&&this._listenToFullscreenBtn()},_removeUIEventListeners:function(){var e=this.mc.isIE()?"change":"input",t=this._containerEl,i=this._hNonTap,s=this._onUVPJSGestureEvent,n=this._onProgressSliderEvent,a=this._onVolumeSliderEvent,r=this._onVolumeBtnEvent;document.removeEventListener("click",this._hideMenu,!1),window.removeEventListener("scroll",i,!1),t.removeEventListener("mouseenter",s,!0),t.removeEventListener("mouseleave",s,!0),t.removeEventListener("mousemove",s,!0),t.removeEventListener("mousedown",s,!1),t.removeEventListener("mouseup",s,!1),t.removeEventListener("click",s,!1),t.removeEventListener("touchstart",s,!0),t.removeEventListener("touchend",s,!0),this._previewBtn&&(this._previewBtn.removeEventListener("touchend",this._onPreviewBtn,!0),this._previewBtn.removeEventListener("touchmove",i,!0),this._previewBtn.removeEventListener("click",this._onPreviewBtn,!0)),this._replayBtn&&(this._replayBtn.removeEventListener("touchend",this._replayBtn,!0),this._replayBtn.removeEventListener("click",this._replayBtn,!0)),this._controlBar&&(this._controlBar.removeEventListener("mouseover",this._onControlBarMouseOver,!1),this._controlBar.removeEventListener("mouseout",this._onControlBarMouseOut,!1)),this._progress&&(this._progress.removeEventListener("mouseover",this._onProgressMouseOver,!1),this._progress.removeEventListener("mouseout",this._onProgressMouseOut,!1)),this._progressSlider&&(this._progressSlider.removeEventListener(e,n,!1),this._progressSlider.removeEventListener("mousedown",n,!1),this._progressSlider.removeEventListener("mouseup",n,!1),this._progressSlider.removeEventListener("touchstart",n,!0),this._progressSlider.removeEventListener("touchend",n,!0)),this._volumeSlider&&(this._volumeSlider.removeEventListener(e,a,!1),this._volumeSlider.removeEventListener("mouseover",a,!1),this._volumeSlider.removeEventListener("mouseout",a,!1)),this._playstateBtn&&this._playstateBtn.removeEventListener("click",this._onPlayToggle,!1),this._playToggleFrame&&this._playToggleFrame.removeEventListener("click",this._onPlayToggle,!1),this._volumeBtn&&(this._volumeBtn.removeEventListener("click",r,!1),this._volumeBtn.removeEventListener("mouseover",r,!1),this._volumeBtn.removeEventListener("mouseout",r,!1)),this._isIOS||this._ccBtn&&this._ccBtn.removeEventListener("click",this._onClosedCaptionBtnClick,!1),this._settingsBtn&&this._settingsBtn.removeEventListener("click",this._onSettingsBtnClick,!1),this._canFullscreen&&this._fullscreenBtn&&(this._fullscreenBtn.removeEventListener("touchend",this._onFullscreenBtnClick,!0),this._fullscreenBtn.removeEventListener("click",this._onFullscreenBtnClick,!1))},_addStylesheetToDom:function(){var e=this._setStyleSheet.bind(this,this._waitForControls.bind(this,this._finalizeSkin));uvpjs.util.createStyleSheet(e,this._cssPath)},_haveControlsLoaded:function(){this.debug&&(uvpjs.log(this.DEBUG_ID,"_haveControlsLoaded."),uvpjs.log(this.DEBUG_ID,"controlsLoaded: control list: ",this._controlList));var e=!0;for(var t in this._controlList)this._checkControlOnDOM(this._controlList[t])||(e=!1);return e},_waitForControls:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"_waitForControls.");setTimeout(function(){++this._waitCount>100||(this._haveControlsLoaded()?e.call(this):this._waitForControls(e))}.bind(this),50)},_clearMouseMoveInterval:function(e){var t=this._getClassName(e,this.ACTIVE_MODIFIER);this._intervals&&-1!==this._intervals[t]&&(clearInterval(this._intervals[t]),this._intervals[t]=-1)},_clearIntervals:function(){var e,t=this._intervals;for(e in t)-1!==t[e]&&(clearInterval(t[e]),t[e]=-1)},_setupDom:function(){var e=this.css;this.debug&&uvpjs.log(this.DEBUG_ID,"creating skin controls",this._containerId),t(this._containerEl,this.PRIMARY_BLOCK),t(this._contentEl,this._getClassName(e.CONTENT)),t(this._controlsEl,this._getClassName(e.CONTROLS)),this.debug&&uvpjs.log(this.DEBUG_ID,"_themeName",this._themeName),this._setDataAttribute(this._containerEl,"theme",this._themeName),this._adEl&&t(this._adEl,this._getClassName(e.AD)),this._hide(e.CONTROLS),this._setupControlsContainer(),this._createAdLearnMoreButton(),this._addBufferingIndicator(),this._hide(e.BUFFERING_FRAME),this._hide(e.LARGE_PLAY_BTN),this._hide(e.CONTROL_BAR),this._hide(e.PROGRESS),this._hide(e.VOLUME_SLIDER),this._show(e.CONTROLS),this._hide(e.BUFFERING_FRAME),this._hide(e.SETTINGS_MENU),this._hide(e.PREVIEW_BTN),this._hide(e.REPLAY_BTN),!0!==this._autoPlay&&this._setupPreview()},_finalizeSkin:function(){this._disableControls(),this._disableInactiveButtons(),this._addUVPJSEventListeners(),this._addUIEventListeners(),this._determineBreakpoint(),this.mc.isMobile()&&this._addModifier(this.PRIMARY_BLOCK,this.MOBILE_MODIFIER),this._skinReadyCB(),setTimeout(this._showContainers.bind(this),this.INITIAL_DOM_SETUP_WAIT)},_hideContainers:function(){this._containerEl.style.visibility="hidden",this._contentEl.style.visibility="hidden",this._videoEl.style.visibility="hidden",this._controlsEl.style.visibility="hidden"},_showContainers:function(){this._containerEl.style.visibility="visible",this._contentEl.style.visibility="visible",this._videoEl.style.visibility="visible",this._controlsEl.style.visibility="visible"},_appendControlList:function(e){this._controlList[this.ID_SELECTOR_PREFIX+this._controlsId+" "+this.CLASS_SELECTOR_PREFIX+e]=e},_setupControlsContainer:function(){var e=JSON.parse(JSON.stringify(this._controls))||[{el:"PREVIEW_BTN",type:"button",label:"Start video"},{el:"REPLAY_BTN",type:"button",label:"Replay video"},{el:"LARGE_PLAY_BTN",type:"button",label:"Large play-pause toggle"},{el:"CONTROL_BAR",type:"div",children:[{el:"PLAYSTATE_BTN",type:"button",label:"Play pause"},{el:"TIME",type:"div",children:[{el:"TIME_CURRENT",type:"span",text:this.NULL_TIME},{el:"TIME_DURATION",type:"span",text:this.NULL_TIME},{el:"TIME_LIVE",type:"span",text:"Live"}]},{el:"CLOSED_CAPTION_BTN",type:"button",label:"Closed captions"},{el:"SETTINGS_BTN",type:"button",label:"Settings"},{el:"VOLUME_BTN",type:"button",label:"Volume"},{el:"FULLSCREEN_BTN",type:"button",label:"Fullscreen"}]},{el:"PROGRESS",type:"div",children:[{el:"PROGRESS_SLIDER",type:"range",value:0,step:1e-4},{el:"PROGRESS_LOADED",type:"progress",value:0,step:1e-4}]},{el:"VOLUME_SLIDER",type:"range",value:1,step:.05},{el:"SETTINGS_MENU",type:"div",children:[]}];this._controlsEl.innerHTML=this._templateToHTML(e)},_generateSettingsMenu:function(e,t){var i,s,n,r,o,l,d,u,c=this._queryByElementName(this.css.SETTINGS_MENU),h=this._getClassName(this.css.SETTINGS_MENU_ITEM),p=a.assign({},this._menuSelections,this._getCaptionsStyle()),g=document.createRange(),f=uvpjs.util,v=[],m=this.shouldTrapTaps();for(u=e&&e.length,d=0;d<u;d++)n=t,(r=(o=e[d]).name)&&(n=f.isDefinedString(t)&&[t,r].join(":")||r),v.push(_(o,n));for(t&&((l=_(this._findMenuItem(t),n=t.split(":").slice(0,-1).join(":"))).cls=h+"--back",v.unshift(l)),g.selectNodeContents(c),g.deleteContents(),c.insertAdjacentHTML("beforeend",this._templateToHTML(v)),i=this._queryAllByElementName(this.css.SETTINGS_MENU_ITEM),s=this._queryAllByElementName(this.css.SETTINGS_MENU_INPUT),d=i&&i.length;d--;)!m&&i[d].addEventListener("click",this._onSettingsMenuBtnClick);for(d=s&&s.length;d--;)!m&&s[d].addEventListener("click",this._onSettingsMenuInputClick);function _(e,t){var i,s,n,r,o={};if(!1!==e.enabled)return void 0===e.value?(o.el="SETTINGS_MENU_ITEM",o.type="button",o.label=e.label,o.target=t):(o.el="SETTINGS_MENU_INPUT",o.type="menu",o.label=e.label||e.value,o.value=e.value,o.property=t&&a.last(t.split(":")),o.selected=(s=(i=o).value,n=i.property,!(((r=n&&p[n])&&r.toLowerCase())!==(s&&s.toLowerCase())))),o}},_removeMenuEventListeners:function(){var e,t=this._queryAllByElementName(this.css.SETTINGS_MENU_ITEM),i=this._queryAllByElementName(this.css.SETTINGS_MENU_INPUT);for(e=t&&t.length;e--;)t[e].removeEventListener("click",this._onSettingsMenuBtnClick);for(e=i&&i.length;e--;)i[e].removeEventListener("click",this._onSettingsMenuInputClick)},_findMenuItem:function(e){var t={items:this.settingsMenu};if(a.isEmpty(e))return t;var i=this,s=e.split(":");return a(s).each(function(e){i.debug&&uvpjs.log(i.DEBUG_ID,"_findMenuItem key",e),t=a.find(t.items,function(t){return t.name===e})}),t},_createAdLearnMoreButton:function(){},_setupPreview:function(){var e=uvpjs.util,t=this.css.PREVIEW_BTN,i=this._previewImage,s=this._queryByElementName(t);uvpjs.log(this.DEBUG_ID,"_setupPreview",i),e.isDefinedString(i)&&(s.style.backgroundImage="url('"+i+"')"),this._show(t)},_setupReplay:function(){var e=uvpjs.util,t=this.css,i=t.REPLAY_BTN,s=this._previewImage,n=this._queryByElementName(i);this.debug&&uvpjs.log(this.DEBUG_ID,"_setupReplay"),e.isDefinedString(s)&&(n.style.backgroundImage="url('"+s+"')"),this._hide(t.LARGE_PLAY_BTN),this._hide(t.PREVIEW_BTN),this._hide(t.BUFFERING_FRAME),this._show(t.CONTROLS),this._hide(t.CONTROL_BAR),this._hide(t.PROGRESS),this._show(i),this._disableControls(),this._replayCB=this.vci.replayVideo.bind(this.vci)},_addBufferingIndicator:function(){var e=this._getClassName(this.css.BUFFERING_FRAME);new Spinner({lines:7,length:0,width:12,radius:9,scale:1,corners:1,color:"#ecf0f1",opacity:0,rotate:0,direction:1,speed:1.2,trail:95,fps:30,zIndex:2e9,className:e,top:"50%",left:"50%",shadow:!1,hwaccel:!1,position:"absolute"}).spin(this._controlsEl)},_disableInactiveButtons:function(){!this._isIOS&&this._disableCaptions(),this.mc.supportsMute()||this._disableButton(this.css.VOLUME_BTN)},_onAdStart:function(e){var t=this.css;this._containerId===e.target&&(this.ignoreVideoStateChange=this.shouldIgnoreStateChange(e.payload.isDynamicAdCall),this.currVolumeInfo={muted:this.vci.getPlayerMuted(),volume:this._videoEl.volume},this.debug&&uvpjs.log(this.DEBUG_ID,"_onAdStart"),this.mc.supportsMute()&&this._enableButton(t.VOLUME_BTN),this._disableButton(t.SETTINGS_BTN),this._disableButton(t.CLOSED_CAPTION_BTN),this._disableProgress(),this._addModifier(this.PRIMARY_BLOCK,this.AD_MODIFIER),!this._hasHidden(this.css.CONTROL_BAR)&&this._show(t.PROGRESS),this._hasActive(t.CLOSED_CAPTION_BTN)&&!this._isIOS&&this.vci.hideCaptions(),e.payload.adData.isCustomClickTrackingUsed||this._disable(t.LARGE_PLAY_BTN))},shouldIgnoreStateChange:function(e){return this.vci.getContentVideoData().isLive&&!!e},_onAdEnd:function(e){this._containerId===e.target&&(this.ignoreVideoStateChange=!1,this.debug&&uvpjs.log(this.DEBUG_ID,"_onAdEnd",this._containerId,e.target),this._removeModifier(this.PRIMARY_BLOCK,this.AD_MODIFIER),this._enable(this.css.LARGE_PLAY_BTN),this._isWaitingForFirstTouch=!1,this._resetProgressSlider())},_onCaptionsReady:function(e){this._isIOS||(this.debug&&uvpjs.log(this.DEBUG_ID,"_onCaptionsReady",e),this._captionsLoaded=!0,this._enableCaptions(),this.isAndroidOnHlsjs||this._enableButton(this.css.SETTINGS_BTN))},_onCaptionsUnavailable:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"_onCaptionsUnavailable",e),this._isIOS||this._disableCaptions()},_onContentStart:function(e){var t=this.css;this.debug&&uvpjs.log(this.DEBUG_ID,"_onContentStart",e),this._containerId===e.target&&(this._isWaitingForFirstTouch=!1,this.ignoreVideoStateChange=!1,this.currVolumeInfo={muted:this.vci.getPlayerMuted(),volume:this._videoEl.volume},this.debug&&uvpjs.log(this.DEBUG_ID,"_onContentStart this._captionsLoaded",this._captionsLoaded),!this._isLive()&&this._enableProgress(),this._enableSettingsBtn(),this.mc.supportsMute()&&this._enableButton(t.VOLUME_BTN),this._captionsLoaded&&this._enableButton(t.CLOSED_CAPTION_BTN),this._hasAd()&&(this._removeModifier(this.PRIMARY_BLOCK,this.AD_MODIFIER),this._enable(t.LARGE_PLAY_BTN)),this._isLive()?(this._setDataAttribute(this._containerEl,"stream",this.LIVE_MODIFIER),this._hide(t.PROGRESS)):this._isStreaming()&&(this._addModifier(this.PRIMARY_BLOCK,this.STREAMING_MODIFIER),!this._hasHidden(this.css.CONTROL_BAR)&&this._show(t.PROGRESS)),!this._isIOS&&this._hasActive(t.CLOSED_CAPTION_BTN)&&this.vci.showCaptions())},_onContentEnd:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"_onContentEnd"),this._containerId===e.target&&(this._removeDataAttribute(this._containerEl,"stream"),this._removeModifier(this.PRIMARY_BLOCK,this.STREAMING_MODIFIER),this._resetProgressSlider(),this._disableProgress(),this._hide(this.css.PROGRESS))},_onControlMuteUnmute:function(e){var t="controlMute"===e.type;this._containerId===e.target&&this._updateVolumeUI(this._volumeSlider.value,t)},_onDiagCloseButton:function(e){this._containerId===e.target&&(uvpjs.log(this.DEBUG_ID,"_onDiagCloseButton",e),this._menuSelections.debug=null)},_onResourceStart:function(e){(e&&e.target)===this._containerId&&(uvpjs.log(this.DEBUG_ID,"_onResourceStart",e),this.durationChecked=!1,this._previewCallbackDone=!0,this._show(this.css.CONTROLS))},_onResourceEnd:function(e){var t=e.target,i=0===e.payload.playlistLength;this._containerId===t&&(uvpjs.log(this.DEBUG_ID,"_onResourceEnd",e),this._hide(this.css.CONTROLS),this._enableReplay&&i&&this._setupReplay(),this._captionsLoaded&&(this._captionsLoaded=!1,this._disableCaptions()),this._resetProgressSlider())},_onVideoProgress:function(e){var t,i,s=e.payload,n=s.playbackState,a=this.vci.getVolume(),r=this.css.TIME_DURATION,o=this.css.TIME_CURRENT,l=!1;this._containerId===e.target&&(a!==Number(this._volumeSlider.value)&&this._updateVolumeUI(a),n!==this._playbackState&&(this._playbackState=n,this._updatePlaybackStateUI(this._playbackState)),this._updateProgressLoad(s),n!==this.mc.PLAYING||this._isSliding||s.duration!==1/0&&(t=this._queryByElementName(r),i=this._queryByElementName(o),this._isLive()||this.durationChecked?this._isLive()&&!this.durationChecked&&s.duration>=3600&&(this.durationChecked=l=!0):(this.durationChecked=!0,s.duration>=3600&&(l=!0)),l&&(i.parentNode.style.width="100px"),t.innerHTML=this._formatTimestampByType(r,s.duration),i.innerHTML=this._formatTimestampByType(o,s.currentTime),this._updateProgressUI(s)),this.isMonitoringMuting&&this.checkMute())},_onVideoLoading:function(e){a.has(e,"target")&&this._containerId===e.target&&a.isObject(e)&&a.has(e,"payload.data")&&this._updateProgressLoad(e.payload.data)},_onVideoStateChange:function(e){if(this.debug&&uvpjs.log(this.DEBUG_ID,"_onVideoStateChange",e),a.isObject(e)&&this._containerId===e.target&&a.isObject(e.payload)&&a.isNumber(parseInt(e.payload.newState))&&(!this.ignoreVideoStateChange||t===this.mc.PAUSED||t===this.mc.PLAYING)){var t=e.payload.newState;t!==this._playbackState&&(this._playbackState=t,this._updatePlaybackStateUI(this._playbackState)),t===this.mc.PAUSED&&this.isMonitoringMuting?this.monitorMuting(null,!0,!0):this.isMonitoringMuting&&this.monitorMuting(null,!0,!1)}},monitorMuting:function(e,t,i){null!==e&&(this.isMonitoringMuting=e),t&&clearInterval(this.muteMonitorIntervalId),i&&(this.muteMonitorIntervalId=setInterval(this.checkMute.bind(this),300))},checkMute:function(){var e=this._videoEl&&this._videoEl.muted;this.currVolumeInfo&&e!==this.currVolumeInfo.muted&&(this.currVolumeInfo.muted=e,e?this.vci.mute():this.vci.unMute())},_onUVPJSGestureEvent:function(e){var t=!1;switch(e.type){case"mouseenter":this._onUVPJSMouseEnter(e);break;case"mouseleave":this._onUVPJSMouseLeave(e);break;case"mousemove":this._onUVPJSMouseMove(e);break;case"mousedown":this._onUVPJSMouseDown(e);break;case"mouseup":this._onUVPJSMouseUp(e);break;case"click":this._showControlBar(e),t=!0;break;case"touchstart":this._onUVPJSTouchStart(e);break;case"touchend":this._onUVPJSTouchEnd(e),t=!0}!this._hasFirstTouch&&t&&(this._hasFirstTouch=!0,this.vci.handleFirstGesture(this._getTargetInfo(e)))},_getTargetInfo:function(e){var t=e.target;return{isVolumeButton:-1!==t.className.indexOf(this.css.VOLUME_BTN),isPlayPauseToggle:-1!==t.className.indexOf(this.css.PLAYSTATE_BTN)}},_onProgressSliderEvent:function(e){switch(e.type){case"input":case"change":this._onProgressSliderChange(e);break;case"touchstart":case"mousedown":this._onProgressSliderStart(e);break;case"touchend":case"mouseup":this._onProgressSliderEnd(e)}},_onVolumeSliderEvent:function(e){switch(e.type){case"input":case"change":this._onVolumeSliderChange(e);break;case"mouseover":this._showVolumeSlider(e);break;case"mouseout":this._hideVolumeSlider(e)}},_onVolumeBtnEvent:function(e){switch(e.type){case"click":case"touchend":this._onVolumeBtnClick(e);break;case"mouseover":this._showVolumeSlider(e);break;case"mouseout":this._hideVolumeSlider(e)}},_onUVPJSMouseEnter:function(e){e.stopPropagation(),this._containerEl===e.target&&(this._hasPaused()||this._showControlBar(e))},_onUVPJSMouseDown:function(e){e.stopPropagation(),this._hasAd()||(this._addModifier(this.PRIMARY_BLOCK,this.ACTIVE_MODIFIER),this._isMouseActive=!0)},_onUVPJSTouchStart:function(e){var t,i=this.vci.getCurrentPlaybackState().playbackState;if(this.debug&&uvpjs.log(this.DEBUG_ID,"_onUVPJSTouchStart"),e.target.getAttribute("disabled"))return e.stopPropagation(),void e.preventDefault();if(this._touchStartTime=e.timeStamp,this._previewCallbackDone){if(!this._hasDisabled(this.css.CONTROLS)&&i!==this.mc.EMPTY&&(this._isTouchActive=this._hasModifier(this.PRIMARY_BLOCK,this.TOUCH_MODIFIER),e.target===this._progressSlider)){var s=e.target.getBoundingClientRect(),n=(e.pageX||e.targetTouches[0].pageX)-s.left;t=1-(e.target.clientWidth-n)/e.target.clientWidth,this._onProgressSliderChange(e,t)}}else this.debug&&uvpjs.log(this.DEBUG_ID,"Ignoring touchstart; preview callback not executed yet.")},_onUVPJSTouchEnd:function(e){var t,i,s,n,a=this.css,r=this._isTap(e.timeStamp),o=[a.CLOSED_CAPTION_BTN,a.VOLUME_BTN,a.PLAYSTATE_BTN,a.SETTINGS_BTN,a.SETTINGS_MENU,a.SETTINGS_MENU_ITEM,a.SETTINGS_MENU_INPUT,a.LARGE_PLAY_BTN,a.FULLSCREEN_BTN],l=o.length,d=e.target.className;if(e.target.getAttribute("disabled"))return e.stopPropagation(),void e.preventDefault();if(!this._hasDisabled(a.CONTROLS)){for(;l--&&!(i=i||d.indexOf(o[l])>-1););if(this.shouldTrapTaps()&&i&&l<o.length-1)return e.stopPropagation(),e.preventDefault(),void this.handleTap(o[l],e);(s=!(i||this._isTouchActive&&r))&&e.preventDefault(),s&&this._addModifier(this.PRIMARY_BLOCK,this.TOUCH_MODIFIER),n=t||s?this.HIDE_DELAY:0,t&&clearTimeout(t),t=setTimeout(function(){if(this._hasPaused())return;t=null,this._removeModifier(this.PRIMARY_BLOCK,this.TOUCH_MODIFIER)}.bind(this),n)}},handleTap:function(e,t){var i=this.css;if(!this._queryByElementName(e).hasAttribute("disabled"))switch(e){case i.CLOSED_CAPTION_BTN:this._onClosedCaptionBtnClick(t);break;case i.VOLUME_BTN:this._onVolumeBtnEvent(t);break;case i.PLAYSTATE_BTN:case i.LARGE_PLAY_BTN:this._onPlayToggle(t);break;case i.SETTINGS_BTN:this._onSettingsBtnClick(t);break;case i.SETTINGS_MENU_ITEM:this._onSettingsMenuBtnClick(t);break;case i.SETTINGS_MENU_INPUT:this._onSettingsMenuInputClick(t)}},shouldTrapTaps:function(){return this._isIOS},_onUVPJSMouseUp:function(e){e.stopPropagation(),this._removeModifier(this.PRIMARY_BLOCK,this.ACTIVE_MODIFIER),this._isMouseActive=!1},_onUVPJSMouseMove:function(e){var t=this._getClassName(this.PRIMARY_BLOCK,this.ACTIVE_MODIFIER);-1===this._intervals[t]&&(this._hasHidden(this.css.CONTROL_BAR)&&this._showControlBar(),this._addModifier(this.PRIMARY_BLOCK,this.ACTIVE_MODIFIER),this._intervals[t]=setInterval(this._onUVPJSMouseMoveStop.bind(this,this.PRIMARY_BLOCK),this.HIDE_DELAY))},_onUVPJSMouseMoveStop:function(e){this._isMouseActive||(this._clearMouseMoveInterval(e),this._removeModifier(e,this.ACTIVE_MODIFIER),this._hideControlBar())},_onUVPJSMouseLeave:function(e){e.stopPropagation(),this._containerEl===e.target&&(this._hasPaused()||this._hasHidden(this.css.CONTROL_BAR)||this._hideControlBar())},_onControlBarMouseOver:function(e){e.stopPropagation(),this._addModifier(this.css.CONTROL_BAR,this.ACTIVE_MODIFIER)},_onControlBarMouseOut:function(e){e.stopPropagation(),this._removeModifier(this.css.CONTROL_BAR,this.ACTIVE_MODIFIER)},_onUVPJSResize:function(e){e.target===this._containerId&&this._determineBreakpoint()},_determineBreakpoint:function(){var e=this._containerEl.offsetWidth;e>=this.SIZE_XS_BREAKPOINT&&this._addModifier(this.PRIMARY_BLOCK,this.SIZE_XS_MODIFIER),e>=this.SIZE_SM_BREAKPOINT&&this._addModifier(this.PRIMARY_BLOCK,this.SIZE_SM_MODIFIER),e>=this.SIZE_MD_BREAKPOINT&&this._addModifier(this.PRIMARY_BLOCK,this.SIZE_MD_MODIFIER),e>=this.SIZE_LG_BREAKPOINT&&this._addModifier(this.PRIMARY_BLOCK,this.SIZE_LG_MODIFIER),e<this.SIZE_XS_BREAKPOINT&&this._removeModifier(this.PRIMARY_BLOCK,this.SIZE_XS_MODIFIER),e<this.SIZE_SM_BREAKPOINT&&this._removeModifier(this.PRIMARY_BLOCK,this.SIZE_SM_MODIFIER),e<this.SIZE_MD_BREAKPOINT&&this._removeModifier(this.PRIMARY_BLOCK,this.SIZE_MD_MODIFIER),e<this.SIZE_LG_BREAKPOINT&&this._removeModifier(this.PRIMARY_BLOCK,this.SIZE_LG_MODIFIER)},_onVolumeBtnClick:function(e){var t=this.vci.getPlayerMuted();this._hasDisabled(this.css.VOLUME_BTN)||(t?this.vci.unMute():this.vci.mute())},_onVolumeSliderChange:function(e){var t=parseFloat(e.target.value),i=this.vci.getPlayerMuted();i&&t>0&&this.vci.unMute(),this.vci.setVolume(t),this._updateVolumeUI(t,i)},_onFullscreenBtnClick:function(e){e.stopPropagation(),this._hideVolumeSlider(),this.fullscreenMgr.isFullscreen()?this.fullscreenMgr.exitFullscreen():this.fullscreenMgr.enterFullscreen()},_onPlayToggle:function(e){if(this.debug&&uvpjs.log(this.DEBUG_ID,"_onPlayToggle this.vci.vidContId = ",this.vci.vidContId),e.stopPropagation(),e.preventDefault(),this.ignoreVideoStateChange&&this._isLive())this._hasModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER)?(this._removeModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER),this.vci.playVideo()):(this._addModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER),this.vci.pauseVideo());else{var t=this.vci.getCurrentPlaybackState().playbackState;if(this.debug&&uvpjs.log(this.DEBUG_ID,"_onPlayToggle playbackState = ",t),t===this.mc.PAUSED||t===this.mc.EMPTY||t===this.mc.LOADING)return this._removeModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER),void this.vci.playVideo();t!==this.mc.BUFFERING&&(this._addModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER),this.vci.pauseVideo())}},_onPreviewBtn:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"_onPreviewBtn"),!this._isTouch||this._isTap(e.timeStamp)?(e.stopPropagation(),this.vci.onPreviewButton(this._skinReadyCB.bind(this))):this.debug&&uvpjs.warn(this.DEBUG_ID,"Long touch detected; not executing preview-button callback.")},_hNonTap:function(){this._touchStartTime=null},_onReplayBtn:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"_onReplayBtn"),e.stopPropagation(),this._hide(this.css.REPLAY_BTN),this._show(this.css.BUFFERING_FRAME),this._replayCB&&this._replayCB()},_listenToFullscreenBtn:function(){this._canFullscreen&&(this._fullscreenBtn.addEventListener("touchend",this._onFullscreenBtnClick.bind(this),!0),!this._isTouch&&this._fullscreenBtn.addEventListener("click",this._onFullscreenBtnClick.bind(this),!1))},_onClosedCaptionBtnClick:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"_onClosedCaptionBtnClick"),e.stopPropagation();var t=this.css.CLOSED_CAPTION_BTN,i=this._hasActive(t);if(this._ccEnabledByUser=!i,i)return this._removeModifier(this.css.CLOSED_CAPTION_BTN,this.ACTIVE_MODIFIER),void this.vci.hideCaptions();this._addModifier(this.css.CLOSED_CAPTION_BTN,this.ACTIVE_MODIFIER),this.vci.showCaptions(),this._setCCPosition()},_onSettingsBtnClick:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsBtnClick"),e.stopPropagation();var t=this.css.SETTINGS_MENU,i=this._hasHidden(t);if(uvpjs.log(this.DEBUG_ID,"_onSettingsBtnClick isHidden",i),i)return this._addModifier(t,this.ACTIVE_MODIFIER),this._generateSettingsMenu(this.settingsMenu),void this._show(t);this._removeModifier(t,this.ACTIVE_MODIFIER),this._hide(t)},_onSettingsMenuBtnClick:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsMenuBtnClick",e);var t=e.target.getAttribute("data-target");this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsMenuBtnClick target",t),e.target.parentNode.setAttribute("data-target",t);var i=this._findMenuItem(t);this._generateSettingsMenu(i.items,t)},_onSettingsMenuInputClick:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsMenuInputClick",e);var t=e.target.parentNode.getAttribute("data-target");switch(t&&t.split(":")[0]){case"cc":this._onSettingsCaptionsChange(e);break;case"controls":this._onSettingsControlsChange(e);break;case"debug":this._onSettingsDiagWindowChange(e)}},_onSettingsCaptionsChange:function(e){var t=e.target,i=t.parentNode,s=t.getAttribute("data-property"),n=t.getAttribute("data-value").toLowerCase();this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsCaptionsChange property, value",s,n),a(i.children).each(function(e){e.setAttribute("data-selected","false")}.bind(this)),t.setAttribute("data-selected","true"),"text-position"!==s?this.vci.setCaptionsStyleProperty(s,n):this._setCCPosition(n)},_onSettingsControlsChange:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsControlsChange",e);var t=e.target,i=t.getAttribute("data-property"),s=t.getAttribute("data-value").toLowerCase(),n="#"+this._containerId+" ";if("background-opacity"===i){i="background-color";var a=this._queryByElementName(this.css.CONTROL_BAR),r=getComputedStyle(a).getPropertyValue(i);if(-1===r.indexOf("rgba"))return;s=r.split(",").slice(0,-1).join(",")+", "+s+")",this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsControlsChange value",s),n+=this._getClassName(this.css.CONTROL_BAR)}this._addCSSRule(n,i,s)},_onSettingsDiagWindowChange:function(e){var t=e.target,i=t.getAttribute("data-property"),s=t.getAttribute("data-value"),n=!("true"===t.getAttribute("data-selected"));this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsDiagWindowChange",e),this._menuSelections[i]=s,t.setAttribute("data-selected",n),n?this.vci.showDiagnosticWindow():this.vci.hideDiagnosticWindow()},_setCaptionsStyle:function(e){!this._isIOS&&this._captionsLoaded&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_setCaptionsStyle",e),this.vci.setCaptionsStyle(e))},_setCaptionsStyleProperty:function(e,t){!this._isIOS&&this._captionsLoaded&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_setCaptionsStyleProperty",e,t),this.vci.setCaptionsStyleProperty(e,t))},_setCueProperty:function(e,t){!this._isIOS&&this._captionsLoaded&&(this._videoEl.textTracks&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_setCueProperty",e,t),this.vci.setCaptionsCueProperty(e,t)))},_setCCPosition:function(e){var t="text-position";!this._isIOS&&this._captionsLoaded&&(e=e||this._getCaptionsStyle()[t],this.debug&&uvpjs.log(this.DEBUG_ID,"_setCCPosition prop, value",t,e),this.vci.setCaptionsStyleProperty(t,e))},_showControlBar:function(e){var t=this.vci.getCurrentPlaybackState().playbackState,i=this.css;this._hasHidden(this.css.CONTROL_BAR)&&!this._hasDisabled(this.css.CONTROLS)&&t!==this.mc.EMPTY&&(a.isUndefined(this._hideControlBar.hide)||this._hideControlBar.hide.cancel(),this._removeModifier(this.PRIMARY_BLOCK,[i.CONTROL_BAR,this.HIDDEN_MODIFIER]),this._show(i.CONTROL_BAR),this.controlsVisible=!0,this._show(i.PROGRESS))},_hideMenu:function(e){this._hasHidden(this.css.SETTINGS_MENU)||e.target.className.indexOf(this._getClassName(this.css.SETTINGS_MENU))>-1||this._hide(this.css.SETTINGS_MENU)},_hideControlBar:function(e){this._hasHidden(this.css.CONTROL_BAR)||this._hasDisabled(this.css.CONTROLS)||(this._hideControlBar.hide=a.debounce(function(){this._hasActive(this.PRIMARY_BLOCK)||this._hasActive(this.css.PROGRESS)||this._hasActive(this.css.PROGRESS_SLIDER)||this._hasActive(this.css.VOLUME_SLIDER)||this._hasActive(this.css.CONTROL_BAR)||!this._hasHidden(this.css.SETTINGS_MENU)||this._hasPaused()||this._isTouch?this._hideControlBar.hide.cancel():(this.controlsVisible=!1,this._addModifier(this.PRIMARY_BLOCK,[this.css.CONTROL_BAR,this.HIDDEN_MODIFIER]),this._hideVolumeSlider(),this._hide(this.css.CONTROL_BAR),this._hide(this.css.PROGRESS))},e||this.HIDE_DELAY),this._hideControlBar.hide.cancel(),this._hideControlBar.hide.call(this))},_showVolumeSlider:function(e){var t=this.css;this._hasDisabled(t.VOLUME_BTN)||this._hasDisabled(t.CONTROLS)||(this._hasActive(t.SETTINGS_MENU)&&this._hide(t.SETTINGS_MENU),this._setDataAttribute(this._containerEl,t.VOLUME_SLIDER,!0),this._addModifier(t.VOLUME_SLIDER,this.ACTIVE_MODIFIER),this._show(t.VOLUME_SLIDER))},_hideVolumeSlider:function(e){this._isMouseActive||(this._removeDataAttribute(this._containerEl,this.css.VOLUME_SLIDER),this._removeModifier(this.css.VOLUME_SLIDER,this.ACTIVE_MODIFIER),this._hide(this.css.VOLUME_SLIDER))},_disableControls:function(){this._disable(this.css.CONTROLS)},_enableControls:function(){this._enable(this.css.CONTROLS)},_disableProgress:function(){this._disable(this.css.PROGRESS)},_enableProgress:function(){this._enable(this.css.PROGRESS)},_enableCaptions:function(){this._isIOS||(this.debug&&uvpjs.log(this.DEBUG_ID,"_enableCaptions"),this._enableMenuItem("cc"),this.enableButton(this.css.CLOSED_CAPTION_BTN),this._ccEnabledByUser&&(this._addModifier(this.css.CLOSED_CAPTION_BTN,this.ACTIVE_MODIFIER),this.vci.showCaptions()))},_disableCaptions:function(){this._isIOS||(this._removeModifier(this.css.CLOSED_CAPTION_BTN,this.ACTIVE_MODIFIER),this._disableButton(this.css.CLOSED_CAPTION_BTN),this._disableButton(this.css.SETTINGS_BTN))},_enableSettingsBtn:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_enableSettingsBtn"),a.some(this.settingsMenu,"enabled")&&this._enableButton(this.css.SETTINGS_BTN)},_updateVolumeUI:function(e,t){var i,s=uvpjs.util,n=this._containerEl;!0===this.vci.getPlayerMuted()?i="mute":e>.85?i="full":s.inRange(e,.5,.85)?i="high":s.inRange(e,.15,.5)?i="medium":s.inRange(e,0,.15)&&(i="low"),this._volumeSlider.value=e||this._videoEl.volume,this._setDataAttribute(n,"volume-level",i),this._updateSliderUI(this._volumeSlider,this.css.VOLUME_SLIDER,e)},_onProgressSliderChange:function(e,t){var i,s,n=this.vci.getContentVideoData(),a=this.vci.getCurrentPlaybackState(),r=this.css.TIME_CURRENT,o=this._queryByElementName(r),l=t||this._progressSlider.value;l=l>1?1:l<0?0:l,i=Math.ceil(l*n.duration*1e4)/1e4,s=Math.abs((a.currentTime-i)/i),this._updateProgressSlider(l),o.innerHTML=this._formatTimestampByType(r,i),this._hasActive(this.css.PROGRESS_SLIDER)||s<=.02||this.vci.seekTo(i)},_onProgressMouseOver:function(e){e.stopPropagation(),this._addModifier(this.css.PROGRESS,this.ACTIVE_MODIFIER)},_onProgressMouseOut:function(e){e.stopPropagation(),this._removeModifier(this.css.PROGRESS,this.ACTIVE_MODIFIER)},_onProgressSliderStart:function(e){var t=this.css;if(this._hasAd()||this._hasDisabled(t.PROGRESS))return e.stopPropagation(),void e.preventDefault();this._addModifier(t.PROGRESS_SLIDER,this.ACTIVE_MODIFIER),this._isSliding=!0},_onProgressSliderEnd:function(e){if(this._hasAd()||this._hasDisabled(this.css.PROGRESS))return e.stopPropagation(),void e.preventDefault();this._removeModifier(this.css.PROGRESS_SLIDER,this.ACTIVE_MODIFIER),this._isSliding=!1,this._onProgressSliderChange(e)},_resetProgressSlider:function(){this._updateProgressSlider&&this._updateProgressSlider(0)},_updateProgressLoad:function(e){var t;this._isLive()||(t=Math.ceil(e.bufferLength/e.duration*1e4)/1e4,a.isNaN(t)||t===1/0||t<=0||(this._downloaded=t,this._hasAd()||(this._queryByElementName(this.css.PROGRESS_LOADED).value=this._downloaded)))},_updatePlaybackStateUI:function(e){var t=this.css;switch(this.debug&&uvpjs.log(this.DEBUG_ID,"_updatePlaybackStateUI newState = ",e),e){case this.mc.PLAYING:this._show(t.CONTROLS),this._enableControls(),this._isTouch&&this._showControlBar(),this._hide(t.LARGE_PLAY_BTN),this._hide(t.PREVIEW_BTN),this._hide(t.REPLAY_BTN),this._hide(t.BUFFERING_FRAME),this._removeModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER),this.controlsVisible&&!this._isLive()&&this._show(t.PROGRESS);break;case this.mc.PAUSED:this._show(t.CONTROLS),this.controlsVisible&&this._showControlBar(),this._hide(t.BUFFERING_FRAME),this._addModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER),this._show(t.LARGE_PLAY_BTN);break;case this.mc.STOPPED:this._hide(t.CONTROLS);break;case this.mc.BUFFERING:case this.mc.LOADING:this._show(t.CONTROLS),this._hide(t.PREVIEW_BTN),this._hide(t.REPLAY_BTN),this._hide(t.LARGE_PLAY_BTN),this._show(t.BUFFERING_FRAME)}},_updateProgressUI:function(e){var t=Math.ceil(e.currentTime/e.duration*1e4)/1e4;this._updateProgressSlider(t)},_updateSliderUI:function(e,t,i){var s=this,n={};if(!a.isUndefined(this._vendorPrefix)&&!a.isUndefined(e))if(n.id="#"+this._containerId,n.cls=s._getClass(t),n.pseudo={moz:"::-moz-range-track",webkit:"::-webkit-slider-runnable-track"}[s._vendorPrefix],this._isMSEdge&&(n.pseudo=""),n.add=function(e,t,i){if(!a.isUndefined(this.pseudo)){var n=this.id+(t||"")+" "+this.cls+(i||"")+this.pseudo;s._addCSSRule(n,"background-size",100*e+"% 100%")}},n.before=function(e,t){var i=s._getClass(s.PRIMARY_BLOCK);t&&(i+=s._getClass(s.PRIMARY_BLOCK,t)),this.add(e,i,null)},n.after=function(e,t){this.add(e,null,t)},t!==s.css.VOLUME_SLIDER){var r=i*e.offsetWidth,o=(.5-i)*e.offsetHeight,l=r/e.offsetWidth,d=(r+o)/e.offsetWidth;e.value=i;var u=s._hasAd();n.before(l,u?s.AD_MODIFIER:null),this._isTouch&&n.before(d,s.TOUCH_MODIFIER)}else n.add(i)},_checkControlOnDOM:function(e){var t=this.ID_SELECTOR_PREFIX+this._controlsId+" "+this.CLASS_SELECTOR_PREFIX+e;return!!this._controlCache[t]},_getClassName:function(e,t){var i=this.PRIMARY_BLOCK;return e!==this.PRIMARY_BLOCK&&(i+=this.BLOCK_ELEMENT_DELIMITER+e),t&&(i+=this.ELEMENT_MODIFIER_DELIMITER+t),i},_getClass:function(e,t){return this.CLASS_SELECTOR_PREFIX+this._getClassName(e,t)},_queryByClassName:function(e){var t,i;if(this._containerId)return t=this.ID_SELECTOR_PREFIX+this._containerId,e!==this.PRIMARY_BLOCK&&(t+=" "+this.CLASS_SELECTOR_PREFIX+e),(i=this._controlCache[t]||document.querySelector(t))&&(this._controlCache[t]=i),i},_queryAllByClassName:function(e){var t=this.ID_SELECTOR_PREFIX+this._containerId;return e!==this.PRIMARY_BLOCK&&(t+=" "+this.CLASS_SELECTOR_PREFIX+e),document.querySelectorAll(t)},_queryByElementName:function(e){return this._queryByClassName(this._getClassName(e))},_queryAllByElementName:function(e){return this._queryAllByClassName(this._getClassName(e))},_show:function(e){if(e===this.css.PROGRESS&&!this._isLive()){var t=this._queryByElementName(e),i=t.querySelector("input"),s=t.querySelector("progress");t&&(t.style.display="block"),i&&(i.style.display="block"),s&&(s.style.display="block")}this._removeModifier(e,this.HIDDEN_MODIFIER)},_hide:function(e){if(e===this.css.PROGRESS){var t=this._queryByElementName(e),i=t.querySelector("input"),s=t.querySelector("progress");t&&(t.style.display="none"),i&&(i.style.display="none"),s&&(s.style.display="none")}this._addModifier(e,this.HIDDEN_MODIFIER)},_enable:function(e){this._removeModifier(e,this.DISABLED_MODIFIER)},_disable:function(e){this._addModifier(e,this.DISABLED_MODIFIER)},_enableMenuItem:function(e){var t;e&&(t=this._findMenuItem(e))&&(t.enabled=!0)},_hasHidden:function(e){return this._hasModifier(e,this.HIDDEN_MODIFIER)},_hasActive:function(e){return this._hasModifier(e,this.ACTIVE_MODIFIER)},_hasAd:function(){return this._hasModifier(this.PRIMARY_BLOCK,this.AD_MODIFIER)},_hasDisabled:function(e){return this._hasModifier(e,this.DISABLED_MODIFIER)},_hasPaused:function(){return this._hasModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER)},_isLive:function(){return this.vci.getContentVideoData().isLive&&this._isStreaming()},_isPlaying:function(){var e=this.vci.getContentVideoData();return e.deliveryType&&e.deliveryType===this.mc.PLAYING},_isStreaming:function(){var e=this.vci.getContentVideoData();return e.deliveryType&&e.deliveryType===this.mc.STREAMING},_hasModifier:function(e,t){a.isArray(t)&&(t=t.join(this.MODIFIER_DELIMETER));var s=this._getClassName(e,t),n=this._queryByElementName(e);return!!n&&i(n,s)},_addModifier:function(e,i){a.isArray(i)&&(i=i.join(this.MODIFIER_DELIMETER));var s=this._getClassName(e,i),n=this._queryByElementName(e);n&&t(n,s)},_removeModifier:function(e,t){var i,n=this._queryByElementName(e);a.isArray(t)&&(t=t.join(this.MODIFIER_DELIMETER)),i=this._getClassName(e,t),n&&s(n,i)},_toggleModifier:function(e,t){a.isArray(t)&&(t=t.join(this.MODIFIER_DELIMETER));var i=this._getClassName(e,t),s=this._queryByElementName(e);s&&n(s,i)},_setDataAttribute:function(e,t,i){e.setAttribute("data-"+t,i)},_removeDataAttribute:function(e,t){e.removeAttribute("data-"+t)},_formatTimestamp:function(e){var t,i;return uvpjs.util.isEmpty(e)||e===1/0?this.NULL_TIME:(isNaN(e)&&(e=0),(t=new Date(null)).setSeconds(Math.round(e)),i=t.toISOString(),e>=3600?i.substr(11,8):i.substr(14,5))},_formatTimestampByType:function(e,t){if(void 0===t||t<0){if(e===this.css.TIME_DURATION)return this.NULL_TIME;if(e===this.css.TIME_CURRENT)return this.NULL_TIME}return this._formatTimestamp(t)},_addCSSRule:function(e,t,i){var s=this._styleEl.sheet,n=s.cssRules.length,r=this._cssRules[e];if(!a.isUndefined(r)){var o=s.rules||s.cssRules;if(o.length>0&&o[r])return void(o[r].style[t]=i)}this._cssRules[e]=n,uvpjs.util.addCSSRule(this._styleEl,e,t,i)},_setStyleSheet:function(e){var t=!1;this.debug&&uvpjs.log(this.DEBUG_ID,"_setStyleSheet",this.styleSheet),this._styleEl||uvpjs.util.createStyleSheet(function(i){this._styleEl=i,t||"function"!=typeof e||(this.debug&&uvpjs.log(this.DEBUG_ID,"_setStyleSheet executing callback."),t=!0,e())}.bind(this))},_templateToHTML:function(e){if(a.isArray(e)&&!a.isEmpty(e)){var t=function(e){return this._getClassName(this.css[e]||e)}.bind(this),i=JSON.parse(JSON.stringify(this._template))||{button:'<button class="${ o.cls }" data-target="${ o.target }" aria-label="${ o.label }">${ o.label }</button>\n',div:'<div class="${ o.cls }">${ o.children }</div>\n',span:'<span class="${ o.cls }">${ o.text }</span>\n',menu:'<button class="${ o.cls }" data-property="${ o.property }" data-value="${ o.value }" data-selected="${ o.selected }">${ o.label }</button>\n',range:'<input type="range" value="${ o.value }" min="0" max="1" step="${ o.step }" class="${ o.cls }" />\n',progress:'<progress class="${ o.cls }" value="${ o.value }" max="1" step="${ o.step }"></progress>\n'},s=this._isIOS;return function e(n){var r="";return a(n).each(function(n){n&&("CLOSED_CAPTION_BTN"!==n.el&&"SETTINGS_BTN"!==n.el||!s)&&(n.cls=a.isUndefined(n.cls)?t(n.el):[n.cls,t(n.el)].join(" "),n.children&&(n.children=e(n.children)),r+=a.template(i[n.type],{variable:"o"})(n))}),r}(e)}},_getCaptionsStyle:function(){return this.vci.getCaptionsStyle()},_isTap:function(e){return!!this._touchStartTime&&e-this._touchStartTime<this.TAP_THRESHOLD}}),i=function(e,t){return!a.isNull(e.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)")))},t=function(e,t){i(e,t)||(e.className=(e.className+=" "+t).trim())},s=function(e,t){e.className=e.className.replace(new RegExp("(\\s|^)"+t+"(\\s|$)")," ").trim()},n=function(e,n){i(e,n)?s(e,n):t(e,n)}}(uvpjs.register("uvpjs")),function(e){var t=e._;e.AdPlaylistManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,PRE:"pre",MID:"mid",MID_:"mid_",POST:"post",init:function(){this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager init"),this.vidContId="",this.midRollPods=null,this.adPods={}},initialize:function(e,i,s,n){this.debug&&(uvpjs.log(this.DEBUG_ID,"AdPlaylistManager initialize vidContId    = ",e),uvpjs.log(this.DEBUG_ID,"AdPlaylistManager initialize adStartTimes = ",i),uvpjs.log(this.DEBUG_ID,"AdPlaylistManager initialize imaCuePoints = ",s)),t.isArray(i)?(this.vidContId=e,this._generateAdPods(i,s,n)):this.debug&&uvpjs.warn("AdPlaylistManager initialize  !_.isArray(adStartTimes) RETURN")},_generateAdPods:function(e,t,i){var s,n,a,r=t.length,o=function(e,t,i){return{hasBeenChecked:!1,startTime:i||0,hasPlayed:!1,adPodId:e,adCount:0,podDuration:0,adCallURL:t}};for(this.debug&&(uvpjs.log(this.DEBUG_ID,"AdPlaylistManager _generateAdPods adStartTimes = ",e),uvpjs.log(this.DEBUG_ID,"AdPlaylistManager _generateAdPods imaCuePoints = ",t)),this.adPods={},r>0&&(t.indexOf(0)>-1&&(this.adPods[this.PRE]=o(this.PRE+"_0",i)),t.indexOf(-1)>-1&&(this.adPods[this.POST]=o(this.POST+"_0",i))),s=0;s<r;s++)n=0===t[0]?s:s+1,a=t[s],isNaN(a)||0===a||-1===a||(this.adPods[this.MID_+n]=o(this.MID_+n,i,a));this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager _generateAdPods this.adPods = ",this.adPods)},getAdPodById:function(e){if(this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager getAdPodById      adPodId = ",e),t.isString(e)){var i=this.adPods[e];return this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager getAdPodById RETURN adPod = ",i),i}},getAdPods:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager getAdPods",this.adPods),this.adPods},getNumberOfPods:function(){var e=Object.keys(this.adPods).length;return this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager getNumberOfPods",e),e},getMidRollPods:function(){var e,t=[];if(!this.midRollPods){for(e in t=[],this.adPods)e.indexOf(this.MID)>=0&&t.push(this.adPods[e]);this.midRollPods=t}return this.midRollPods},isPreRoll:function(e){return!t.isUndefined(e.adPodId)&&e.adPodId.indexOf(this.PRE)>-1},isMidRoll:function(e){return!t.isUndefined(e.adPodId)&&e.adPodId.indexOf(this.MID)>-1},isPostRoll:function(e){return!t.isUndefined(e.adPodId)&&e.adPodId.indexOf(this.POST)>-1},hasMidRoll:function(){for(var e in this.adPods)if(e.indexOf(this.MID)>-1)return!0;return!1},hasPostRoll:function(){return this.adPods.hasOwnProperty(this.POST)},returnPrecedingUnplayedAdPod:function(e){var t,i,s,n=null,a="No eligible ad pod found.";for(s in this.adPods)this.adPods.hasOwnProperty(s)&&(t=this.adPods[s],this.isPreRoll(t)||this.isPostRoll(t)||t.startTime<=e&&(n?e-t.startTime<e-n.startTime&&(n=t):n=t));return n&&(i=n.hasPlayed?"has played, returning null.":"not yet played - returning found pod.",a="Found Ad pod; adPodId = "+n.adPodId+"; "+i),this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager returnPreceedingUnplayedAdPod() for absSeekTime: "+e+";  "+a),n}})}(uvpjs.register("uvpjs")),function(e){var t,s=e._;e.TrackingManager=uvpjs.Class.subClass({debug:uvpjs.DebugManager.isEnabled,PLAYER_NAME:uvpjs.Configuration.name+"_"+uvpjs.Configuration.version,PLAYER_NAME_ONLY:uvpjs.Configuration.name,PLAYER_VERSION_ONLY:uvpjs.Configuration.version,ADOBE_HEARTBEAT_MODULE_NAME:"SiteCatalyst",COMSCORE_SS_MODULE_NAME:"ComScore_ss",CONVIVA_MODULE_NAME:"ConvivaQOSPluginJS",DW_MODULE_NAME:"DWTracking",LEGACY_DW_MODULE_NAME:"CNetTracking",NIELSEN_MODULE_NAME:"NielsenTracking_SDK",AKAMAI_ANALYTICS_MODULE_NAME:"AkamaiQOSPluginJS",MUX_MODULE_NAME:"MuxQOSPluginJS",CONCURRENCY_BEACON_MODULE_NAME:"Beacon",OZTAM_MODULE_NAME:"OzTam",DATAZOOM_MODULE_NAME:"Datazoom",DEFAULT_SITEID:"17",PLATFORM_CMS:"platform",LUMIERE_CMS:"lumiere",PI_CMS:"pi",ZDNET_CMS:"zdnet",CONCURRENCY_BEACON_SITE_ID:164,CONCURRENCY_BEACON_USER_ID:-1,progressEvents:{FIRST_QUARTILE:"firstQuartile",MID_QUARTILE:"midQuartile",THIRD_QUARTILE:"thirdQuartile",TIMED:"timed"},agentConfigs:[],beaconEndPoint:{},_hasAgentInit:!1,init:function(e){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"init"),this.eventCBs={},this.vidContId=null,this.eventsMgr=null,this.cviModel=null,this.internalNS=null,this._contentFirstQFired=!1,this._contentMidFired=!1,this._contentThirdQFired=!1,this._contentTimeFired={},this.componentid="",this._lastContentSecondCompleted=0,this.resourceStartTime=0,this.contextMetadata={},this._contentLength=0,this._adLength=0,this._beaconElement=!1,this.agents=[],this.mc=uvpjs.mediaCapabilities,e&&this.initialize(e.vidContId,e.cviMgr)},destroy:function(){for(var e,t=this.agents.length;t--;)this.agents[t]&&"function"==typeof this.agents[t].destroy&&this.agents[t].destroy(),this.agents.splice(t,1);for(e in this.eventCBs)this.eventsMgr.removeEventListener(e+this.internalNS+".agent"),delete this.eventsMgr[e];for(e in this.progressEvents)delete this.progressEvents[e];this._removeTrackingEventListeners(),this.eventsMgr=null,this.cviModel=null,this.mc=null,this.agents=null,this.eventCBs=null,this.progressEvents=null,this.contextMetadata=null,this._beaconElement=null,this._contentFirstQFired=!1,this._contentMidFired=!1,this._contentThirdQFired=!1,this._contentTimeFired={},this._lastContentSecondCompleted=0,this._contentLength=0,this._adLength=0},initialize:function(e,t){this.debug&&uvpjs.log(this.DEBUG_ID,"initialize"),s.isString(e)&&s.isObject(t)&&(this.vidContId=e,this.eventsMgr=t.getEventsMgr(),this.cviModel=t.getModelRef(),this.internalNS="."+this.vidContId+".trackingMgr",this.componentid=this.cviModel.sessionId,this._beaconElement=document.createElement("div"),this._beaconElement.id="uvpjs-tracking-"+(new Date).getTime(),document.getElementsByTagName("body")[0].appendChild(this._beaconElement),this._addTrackingEventListeners())},hasTrackingConfigOverrides:function(e){return null!==e&&e.hasOwnProperty("trackingConfigOverrides")&&null!==e.trackingConfigOverrides},getAgentConfig:function(e,t){for(var i=null,s=e.length;s-- >0;){var n=e[s];if(n.name===t){i=n;break}}return i},_overrideUvpc:function(){var e=this.cviModel;if(this.hasTrackingConfigOverrides(e)){for(var t=e.getModules().slice(0),i=t.length;i-- >0;){var s=t[i],n=this.getAgentConfig(e.trackingConfigOverrides,s.name);null!==n&&(t[i]=n)}this.agentConfigs=t}else this.agentConfigs=e.getModules().slice(0)},isTrackingAgentEnabled:function(e){var t,i=this.getAgentConfig(this.agentConfigs,e),s=this.mc.systemInfo.trackingAvailability,n=!1;for(t in uvpjs.tracking)if(uvpjs.tracking[t]===e&&s[t]){n=!0;break}return this.debug&&i&&i.enabled&&!n&&uvpjs.warn(this.DEBUG_ID,"Agent enabled in the config but sdk did not load",i,s),null!==i&&i.enabled&&n},_createAgentsArray:function(e){var t,i,s,n,a,r,o;if(this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray"),i=e||this.cviModel,this.debug&&uvpjs.log(this.DEBUG_ID,"agentConfigs",this.agentConfigs),n=i.isModuleEnabled.bind(i),a=i.isModuleSet.bind(i),o=this.getPlayerName(),s={trackingMgr:this,cviModel:this.cviModel,eventsMgr:this.eventsMgr,playerName:o,playerVersion:this.PLAYER_VERSION_ONLY},this.isTrackingAgentEnabled(this.ADOBE_HEARTBEAT_MODULE_NAME)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray AdobeHeartbeatAgent"),s.moduleName=this.ADOBE_HEARTBEAT_MODULE_NAME,t=new uvpjs.AdobeHeartbeatAgent(s),this.agents.push(t)),this.isTrackingAgentEnabled(this.AKAMAI_ANALYTICS_MODULE_NAME)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray AkamaiAnalyticsAgent"),s.moduleName=this.AKAMAI_ANALYTICS_MODULE_NAME,t=new uvpjs.AkamaiAnalyticsAgent(s),this.agents.push(t)),this.isTrackingAgentEnabled(this.COMSCORE_SS_MODULE_NAME)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray ComScoreAgent"),s.moduleName=this.COMSCORE_SS_MODULE_NAME,s.playerName=this.getPlayerName("|","_"),t=new uvpjs.ComScoreAgent(s),this.agents.push(t)),this.isTrackingAgentEnabled(this.CONVIVA_MODULE_NAME)&&(null!=this.cviModel&&this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray ConvivaAgent"),s.moduleName=this.CONVIVA_MODULE_NAME,t=new uvpjs.ConvivaAgent(s),this.agents.push(t)),((r=n(this.DW_MODULE_NAME))||n(this.LEGACY_DW_MODULE_NAME))&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray DWAgent"),s.moduleName=r?this.DW_MODULE_NAME:this.LEGACY_DW_MODULE_NAME,s.playerName=this.getPlayerName(";"),t=new uvpjs.DWAgent(s),this.agents.push(t)),this.isTrackingAgentEnabled(this.NIELSEN_MODULE_NAME)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray NielsenAgent"),s.moduleName=this.NIELSEN_MODULE_NAME,t=new uvpjs.NielsenAgent(s),this.agents.push(t)),a(this.MUX_MODULE_NAME)&&!this.isTrackingAgentEnabled(this.MUX_MODULE_NAME))this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray MuxAgent. Mux Disabled in UVPC");else{this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray MuxAgent");var l=this.cviModel.getModuleParam.bind(this.cviModel,this.MUX_MODULE_NAME);s.moduleName=this.MUX_MODULE_NAME,s.playerName=this.PLAYER_NAME_ONLY,s.playerVersion=this.PLAYER_VERSION_ONLY,s.useDefaultProperty=!l("propertyKey"),t=new uvpjs.MuxAgent(s),this.agents.push(t)}var d=this.getAgentConfig(this.agentConfigs,this.CONCURRENCY_BEACON_MODULE_NAME);if(d&&d.params&&d.params.length>0)for(var u=d.params.length;u-- >0;)this.beaconEndPoint[d.params[u].name]=d.params[u].value;this.isTrackingAgentEnabled(this.OZTAM_MODULE_NAME)&&(s.moduleName=this.OZTAM_MODULE_NAME,t=new uvpjs.OzTamAgent(s),this.agents.push(t));var c=this.getAgentConfig(this.agentConfigs,this.DATAZOOM_MODULE_NAME);c&&c.enabled&&(s.moduleName=this.DATAZOOM_MODULE_NAME,t=new uvpjs.DatazoomAgent(s),this.agents.push(t))},_addTrackingEventListeners:function(){var e=this.eventsMgr,t=e.eventTypes,i=this.internalNS;e.addEventListener(t.CONTEXT_METADATA+i,this._onContextMetadata.bind(this)),e.addEventListener(t.VIDEO_STATE_CHANGE+i,this._onVideoStateChange.bind(this)),e.addEventListener(t.VIDEO_PROGRESS+i,this._onVideoProgress.bind(this)),e.addEventListener(t.RESOURCE_START+i,this._onResourceStart.bind(this)),e.addEventListener(t.PLAYBACK_DURATION_RESUME+i,this._onPlaybackDurationResume.bind(this))},_removeTrackingEventListeners:function(){var e=this.eventsMgr,t=e.eventTypes,i=this.internalNS;e.removeEventListener(t.VIDEO_PROGRESS+i),e.removeEventListener(t.AD_QUARTILE+i),e.removeEventListener(t.RESOURCE_START+i)},_initializeAgents:function(){if(this.debug&&uvpjs.log(this.DEBUG_ID,"_initializeAgents",this.agents),s.isEmpty(this.agents))this.debug&&uvpjs.warn(this.DEBUG_ID,"loadAgentPlugins no tracking agents enabled.");else{for(var e=this.agents.length;e--;)this.agents[e].initialize();this._addAgentEventListeners()}},fireTrackingPixel:function(e){var t=document.createElement("img");t.setAttribute("src",e),t.setAttribute("width","1"),t.setAttribute("height","1"),t.setAttribute("border","0"),t.style.position="absolute",t.style.bottom="0",t.style.right="0",this._beaconElement.appendChild(t)},registerEventCallbacks:function(e){if(s.isPlainObject(e)&&!s.isEmpty(e))for(var t in e)this.eventCBs[t]=this.eventCBs[t]||[],this.eventCBs[t].push(e[t])},registerProgressEvents:function(e){if(s.isPlainObject(e)&&!s.isEmpty(e))for(var t in e)this.debug&&uvpjs.log(this.DEBUG_ID,"registerEventCallbacks progressEvent",t),this.progressEvents[t]=this.progressEvents[t]||[],this.progressEvents[t].push(e[t])},getContentPlayhead:function(){var e=this.cviModel.contentPlaybackState.currentTime;return parseInt(e)},getPlayerName:function(e,t){var i=this.PLAYER_NAME;return s.isEmpty(i)?"UVPJS":(e&&(i=i.replace("_",e)),t&&(i=i.replace(/\./g,t)),i)},getAdLength:function(){return this._adLength=t(this._adLength,this.cviModel.adVideoState.duration),this._adLength},getContentLength:function(){return this._contentLength=t(this._contentLength,this.cviModel.contentVideoState.duration),this._contentLength},_addAgentEventListeners:function(){for(var e in this.eventCBs)this.eventsMgr.addEventListener(e+this.internalNS+".agent",this._onTrackingEvent.bind(this))},_onTrackingEvent:function(e){if(e.target===this.vidContId){var t,i=this.eventCBs[e.type];if(!s.isEmpty(i)){t=i.length;for(var n=0;n<t;n++)i[n](e)}}},_onContextMetadata:function(e){this.contextMetadata=e.payload.contextMetadata},_onVideoStateChange:function(e){if(e.payload.newState===this.mc.LOADING&&!this._hasAgentInit){var t,i=this.cviModel.cviMgr.RPM.currRP,s=this.cviModel.cviMgr.RPM.rscProviders;i&&i.rco&&i.rco.uvpc?t=i.rco.uvpc:s&&s.length>0&&(t=s[0].rco.uvpc),t&&t.modules&&this.cviModel.copyModules(t.modules),this._overrideUvpc(),this._createAgentsArray(),this._initializeAgents(),this._hasAgentInit=!0}},_onResourceStart:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"_onResourceStart",e),this.resourceStartTime=new Date,this._contentFirstQFired=!1,this._contentMidFired=!1,this._contentThirdQFired=!1,this._contentTimeFired={},this._lastContentSecondCompleted=0},_onProgressEvent:function(e){var t,n=this.progressEvents[e];if(!s.isEmpty(n))for(t=n.length,i=0;i<t;i++)n[i]()},_onPlaybackDurationResume:function(t){var i=this.cviModel.getModuleParam.bind(this.cviModel,this._moduleName),s=this.cviModel.getContentVideoState(),n={ts:Math.floor(Date.now()/1e3),contentid:s.cmsRefGuid,userid:this.cviModel.getSessionOption("userId")||this.CONCURRENCY_BEACON_USER_ID,siteid:i("siteid")||this.CONCURRENCY_BEACON_SITE_ID,sessionid:this.cviModel.sessionId,platform:this.mc.isDesktop()?"desktop":"mobile_web",premium:s.isPaidContent,affiliate:s.isAffiliateFeed,medtime:Math.round(this.cviModel.contentPlaybackState.currentTime)},a=(new e.BeaconBuilder).concurrencyBeacon(this.beaconEndPoint).queryParams(n).devMode(this.debug).buildUrl();this.fireTrackingPixel(a)},_onVideoProgress:function(e){var t,i=e.payload,n=Math.floor(i.currentTime),a=i.duration;if(n&&a&&!i.isAd&&!(this._lastContentSecondCompleted>=n)){if(this._lastContentSecondCompleted=n,n%15==0&&n<=60||n%60==0){if(this._contentTimeFired[n])return;this._contentTimeFired[n]=!0,this.debug&&uvpjs.log(this.DEBUG_ID,"_onVideoProgress flooredTime",n),this._onProgressEvent(this.progressEvents.TIMED)}i.isPlayingLive||a<=10||((t=Math.floor(n/a*100))!==this.percentDone&&(this.percentDone=t),s.inRange(t,25,50)&&!this._contentFirstQFired&&(this._contentFirstQFired=!0,this.debug&&uvpjs.log(this.DEBUG_ID,"_onVideoProgress FIRST_QUARTILE"),this._onProgressEvent(this.progressEvents.FIRST_QUARTILE)),s.inRange(t,50,75)&&!this._contentMidFired&&(this._contentMidFired=!0,this.debug&&uvpjs.log(this.DEBUG_ID,"_onVideoProgress MID_QUARTILE"),this._onProgressEvent(this.progressEvents.MID_QUARTILE)),t>=75&&!this._contentThirdQFired&&(this._contentThirdQFired=!0,this.debug&&uvpjs.log(this.DEBUG_ID,"_onVideoProgress THIRD_QUARTILE"),this._onProgressEvent(this.progressEvents.THIRD_QUARTILE)))}}}),t=function(e,t){var i=t>0?Math.floor(1e3*t):0;return uvpjs.util.inRange(e,i-1e3,i+1e3)?e:i}}(uvpjs.register("uvpjs")),uvpjs.register("uvpjs").TrackingAgent=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.TRACKING_MANAGER,debug:"prod"!==uvpjs.Configuration.env,options:null,vo:null,sdkEvent:null,hasSdk:!1,hasResourceStart:!1,hasContentStart:!1,isPaused:!1,isBuffering:!1,isSeekDone:!1,trackQosEvent:!1,trackContentStartEvent:!1,contextMetadata:{},initTime:null,init:function(e){this.options=e,this.initTime=new Date,this.contextMetadata=e.trackingMgr.contextMetadata||{}},initialize:function(){var e=this.options.eventsMgr.eventTypes,t={};t[e.RESOURCE_START]=this.onResourceStart.bind(this),t[e.CONTENT_START]=this.onContentStart.bind(this),t[e.VIDEO_STATE_CHANGE]=this.onVideoStateChange.bind(this),t[e.CONTROL_SEEK]=this.onSeekStart.bind(this),t[e.SEEK_DONE]=this.onSeekDone.bind(this),t[e.RESOURCE_END]=this.onResourceEnd.bind(this),t[e.CONTEXT_METADATA]=this.onContextMetadata.bind(this),t[e.CDN_UPDATED]=this.onCdnUpdated.bind(this),t[e.AD_POD_START]=this.onAdPodStart.bind(this),t[e.AD_POD_END]=this.onAdPodEnd.bind(this),t[e.AD_START]=this.onAdStart.bind(this),t[e.AD_CLICK]=this.onAdClick.bind(this),t[e.AD_END]=this.onAdEnd.bind(this),t[e.VIDEO_TRANSITION_START]=this.onVideoTransition.bind(this),t[e.VIDEO_PROGRESS]=this.onVideoProgress.bind(this),t[e.USER_GESTURE]=this.onUserGesture.bind(this),t[e.FORCE_TRACK_SESSION_END]=this.onForceTrackSessionEnd.bind(this),this.options.trackingMgr.registerEventCallbacks(t),(t={})[(e=this.options.trackingMgr.progressEvents).FIRST_QUARTILE]=this.onQuartileProgress.bind(this,this.sdkEvent.FIRST_QUARTILE),t[e.MID_QUARTILE]=this.onQuartileProgress.bind(this,this.sdkEvent.MID_QUARTILE),t[e.THIRD_QUARTILE]=this.onQuartileProgress.bind(this,this.sdkEvent.THIRD_QUARTILE),this.options.trackingMgr.registerProgressEvents(t)},onResourceStart:function(e){this.hasResourceStart||(this.sendTrackEvent(this.sdkEvent.SESSION_START,this.vo.getSessionStartInfo()),this.hasResourceStart=!0)},onContentStart:function(e){this.trackContentStartEvent=!0,this.hasContentStart&&this.isPaused&&(this.sendTrackEvent(this.sdkEvent.PLAY_RESUME),this.isPaused=!1)},onQuartileProgress:function(e){this.sendTrackEvent(e,this.vo.getQuartileInfo())},onVideoStateChange:function(e){if(this.options.cviModel.getCurrentPlaybackState().playbackStarted)switch(e.payload.newState){case uvpjs.mediaCapabilities.PAUSED:this.isPaused||(this.isPaused=!0,this.sendTrackEvent(this.sdkEvent.PAUSE));break;case uvpjs.mediaCapabilities.BUFFERING:this.isBuffering||(this.isBuffering=!0,this.sendTrackEvent(this.sdkEvent.BUFFER_START));break;case uvpjs.mediaCapabilities.PLAYING:this.isPaused&&(this.isPaused=!1,this.sendTrackEvent(this.sdkEvent.PLAY_RESUME)),this.isBuffering&&(this.isBuffering=!1,this.sendTrackEvent(this.sdkEvent.BUFFER_COMPLETE),this.sendTrackEvent(this.sdkEvent.PLAY_RESUME))}},onSeekStart:function(e){this.sendTrackEvent(this.sdkEvent.SEEK_START,this.vo.getSeekInfo())},onSeekDone:function(e){this.sendTrackEvent(this.sdkEvent.SEEK_COMPLETE,this.vo.getSeekInfo()),this.isSeekDone=!0},onResourceEnd:function(e){this.hasContentStart&&this.vo.isCompletedMarker()&&(this.sendTrackEvent(this.sdkEvent.CONTENT_COMPLETE,this.vo.getContentCompleteInfo()),this.sendTrackEvent(this.sdkEvent.SESSION_END),this.hasResourceStart=!1,this.hasContentStart=!1)},onContextMetadata:function(e){this.contextMetadata=e.payload.contextMetadata},onCdnUpdated:function(e){this.sendTrackEvent(this.sdkEvent.CDN_UPDATED,{cdn:e.payload.cdn})},onAdPodStart:function(e){this.sendTrackEvent(this.sdkEvent.AD_BREAK_START,this.vo.getAdBreakInfo())},onAdPodEnd:function(e){this.sendTrackEvent(this.sdkEvent.AD_BREAK_COMPLETE)},onAdStart:function(e){this.sendTrackEvent(this.sdkEvent.AD_START,this.vo.getAdItemInfo())},onAdClick:function(e){this.sendTrackEvent(this.sdkEvent.AD_CLICK)},onAdEnd:function(e){this.sendTrackEvent(this.sdkEvent.AD_COMPLETE)},onVideoTransition:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"bitrate",e.payload.bitrate),this.trackQosEvent=!0},onVideoProgress:function(e){this.trackQosEvent&&(this.trackQosEvent=!1,this.sendTrackEvent(this.sdkEvent.QOS,this.vo.getQosInfo())),this.trackContentStartEvent&&(this.trackContentStartEvent=!1,this.hasContentStart||(this.sendTrackEvent(this.sdkEvent.CONTENT_START,this.vo.getContentStartInfo()),this.hasContentStart=!0)),this.isSeekDone&&(this.isSeekDone=!1,this.sendTrackEvent(this.sdkEvent.PLAY_RESUME))},onUserGesture:function(e){e.payload.startTime>0&&(this.options.resumeTime=e.payload.startTime)},onForceTrackSessionEnd:function(e){this.onResourceEnd(e)},destroy:function(){this.vo.destroy(),this.DEBUG_ID=null,this.options=null,this.initTime=null,this.vo=null,this.contextMetadata=null}}),function(e){"use strict";var t,i,s,n,a,r;r=e._,e.AdobeHeartbeatAgent=uvpjs.Class.subClass({SDK_VERSION:"2.0.1",TEALIUM_SETUP_TIMEOUT:1e4,TEALIUM_RETRY_INTERVAL:100,scriptPaths:{APP_MEASUREMENT:uvpjs.Configuration.path+"lib/tracking/adobe/AppMeasurement-2.3.0.min.js",HEARTBEAT:uvpjs.Configuration.path+"lib/tracking/adobe/VideoHeartbeat-2.0.2.min.js"},ACCOUNT_PARAM_NAME:"account",BRAND_PARAM_NAME:"brand",CHAR_SET_PARAM_NAME:"charSet",CURRENCY_CODE_PARAM_NAME:"currencyCode",EDITION_PARAM_NAME:"edition",HEARTBEAT_ADOBE_PUBLISHER_ID_PARAM_NAME:"heartbeatAdobePublisherId",HEARTBEAT_TRACKING_SERVER_PARAM_NAME:"heartbeatTrackingServer",HEARTBEAT_MKTNG_CLOUD_ORG_ID:"heartbeatVisitorMarketingCloudOrgId",PARTNER_ID_PARAM_NAME:"partnerID",SITE_CODE_PARAM_NAME:"siteCode",SITE_TYPE_PARAM_NAME:"siteType",TRACKING_SERVER_PARAM_NAME:"trackingServer",VISITOR_NAMESPACE_PARAM_NAME:"visitorNamespace",SEGMENT_OWNER_PARAM_NAME:"id3SegmentOwner",PAGE_REPORT_SUITE_ID_KEY:"sitePrimaryRsid",PAGE_SITE_ACCOUNT_KEY:"siteRsids",HEARTBEAT_AD_START:"AdStart",HEARTBEAT_AD_COMPLETE:"AdComplete",HEARTBEAT_AD_SKIP:"AdSkip",HEARTBEAT_AD_BREAK_START:"AdBreakStart",HEARTBEAT_AD_BREAK_COMPLETE:"AdBreakComplete",HEARTBEAT_BUFFER_START:"BufferStart",HEARTBEAT_BUFFER_COMPLETE:"BufferComplete",HEARTBEAT_CHAPTER_START:"ChapterStart",HEARTBEAT_CHAPTER_COMPLETE:"ChapterComplete",HEARTBEAT_PLAY:"Play",HEARTBEAT_PAUSE:"Pause",HEARTBEAT_COMPLETE:"Complete",HEARTBEAT_SEEK_START:"SeekStart",HEARTBEAT_SEEK_COMPLETE:"SeekComplete",HEARTBEAT_SESSION_START:"SessionStart",HEARTBEAT_SESSION_END:"SessionEnd",CLIPS:"clips",FULL_EPISODES:"fullepisodes",MOVIES:"movies",TRACKING_SERVER_SSL_PREFIX:"s",LIVE_CONTENT_LENGTH:86400,init:function(e){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.LIB_DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_LIB,this.trackingMgr=e.trackingMgr,this.cviModel=e.cviModel,this.eventsMgr=e.eventsMgr,this._moduleName=e.moduleName,this._playerName=e.playerName,this._mediaHeartbeat=null,this._videoInfo=null,this._qosObject=null,this._adBreakInfo=null,this._adInfo=null,this._chapterInfo=null,this._adObject=null,this._adBreakObject=null,this._chapterObject=null,this._mediaObject=null,this._adContextData=null,this._chapterCustomMetadata=null,this._getTealiumTimer=null,this._segmentOwner=null,this.mc=null,this._videoLoaded=!1,this._isBuffering=!1,this._adBreakStartSent=!1,this._initialPlaySent=!1,this._heartbeatDebug=!1,this._contextMetadataCBSetup=!1,this._seekPending=!1,this._contentStarted=!1,this._appMeasurementData={},this._heartbeatData={},this._visitorData={},this._contextMetadata=this.trackingMgr.contextMetadata||{},this._sessionMetadata={},this._s=null,this._usesTealium=!1,this._waitForTealium=!1,this.isPluginLoaded=!1,this.pluginLoadedCB=Function.prototype,this._startUpTime=0,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent init")},destroy:function(){this.trackingMgr=null,this.eventsMgr=null,this.cviModel=null,this._moduleName=null,this._playerName=null,this.mc=null,this._mediaHeartbeat=null,this._appMeasurementData=null,this._heartbeatData=null,this._visitorData=null,this._contextMetadata=null,this._sessionMetadata=null,this._adContextData=null,this._chapterCustomMetadata=null,this._mediaObject=null,this._videoInfo=null,this._adBreakInfo=null,this._adInfo=null,this._chapterInfo=null,this._adObject=null,this._adBreakObject=null,this._chapterObject=null,this._segmentOwner=null,this._s=null,this._getTealiumTimer=null,this.pluginLoadedCB=Function.prototype},initialize:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent initialize"),this.mc=uvpjs.mediaCapabilities,this._loadSessionOptions(),this._loadConfigData(),r.isUndefined(this._visitorData.marketingCloudOrgId)?this.debug&&uvpjs.warn(this.DEBUG_ID,"AdobeHeartbeatAgent initialize no Adobe Marketing Cloud Org ID."):this.loadPlugin(this._initializePlugin.bind(this))},loadPlugin:function(e,t){var i;if(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent loadPlugin"),r.isFunction(e)){i=t?t.sessionOptions:this.cviModel.sessionOptions,this.pluginLoadedCB=function(){this.isPluginLoaded=!0,e()}.bind(this),this._usesTealium=i.usesTealium;var s=[this.scriptPaths.APP_MEASUREMENT,this.scriptPaths.HEARTBEAT];if(this._usesTealium&&(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent loadPlugin not loading AppMeasurement script."),s=r.without(s,this.scriptPaths.APP_MEASUREMENT)),n()&&!this.isPluginLoaded)return this.codeLoader=new uvpjs.CodeLoader,void this.codeLoader.loadScript(s,this.pluginLoadedCB);this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent loadPlugin plugin already loaded into the page"),this.pluginLoadedCB()}else this.debug&&uvpjs.warn(this.DEBUG_ID,"AdobeHeartbeatAgent loadPlugin no callback supplied!")},getVideoInfo:function(){return this._videoInfo},getAdBreakInfo:function(){return this._adBreakInfo},getAdInfo:function(){return this._adInfo},getChapterInfo:function(){return this._chapterInfo},getQoSInfo:function(){var e=this._qosObject;return t.createQoSObject(e.bitrate,e.startupTime,e.fps,e.droppedFrames)},getCurrentPlaybackTime:function(){return this._videoInfo?this._videoInfo.playhead:0},_loadConfigData:function(){var e=this.cviModel.getModuleParam.bind(this.cviModel,this._moduleName),t=e(this.HEARTBEAT_TRACKING_SERVER_PARAM_NAME),i=e(this.TRACKING_SERVER_PARAM_NAME);this._segmentOwner=e(this.SEGMENT_OWNER_PARAM_NAME),this.mc.isSecure()&&(r.isString(i)&&0!==i.indexOf(this.TRACKING_SERVER_SSL_PREFIX)&&(i=this.TRACKING_SERVER_SSL_PREFIX+i),r.isString(t)&&(t=t.replace("heartbeats.omtrdc.net","cbsinteractive.hb.omtrdc.net"))),this._appMeasurementData={account:e(this.ACCOUNT_PARAM_NAME),charSet:e(this.CHAR_SET_PARAM_NAME),trackingServer:i},this._heartbeatData={publisher:e(this.HEARTBEAT_ADOBE_PUBLISHER_ID_PARAM_NAME),trackingServer:t},this._visitorData={marketingCloudOrgId:e(this.HEARTBEAT_MKTNG_CLOUD_ORG_ID),trackingServer:i},this._heartbeatDebug=uvpjs.DebugManager.isParamEnabled(this.LIB_DEBUG_ID),this.debug&&(uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _loadConfigData this._heartbeatData =",this._heartbeatData),uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _loadConfigData this._visitorData =",this._visitorData),uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _loadConfigData this._appMeasurementData =",this._appMeasurementData))},_loadSessionOptions:function(){var e=this.cviModel.sessionOptions;this._usesTealium=e.usesTealium;r.each({ftag:"ftag",netwk:"Network"},function(t,i){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _loadSessionOptions",t,i);var s=e[i];r.isNull(s)||r.isUndefined(s)||r.isEmpty(s)||(this._sessionMetadata[t]=s)}.bind(this)),this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _loadSessionOptions this._sessionMetadata",this._sessionMetadata)},_setupEventCallbacks:function(){var e=this.eventsMgr.eventTypes,t={};this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _setupEventCallbacks"),t[e.AD_START]=this._onAdStart.bind(this),t[e.AD_END]=this._onAdEnd.bind(this),t[e.AD_POD_START]=this._onAdPodStart.bind(this),t[e.AD_POD_END]=this._onAdPodEnd.bind(this),t[e.AD_CLICK]=this._onAdClick.bind(this),t[e.CONTENT_START]=this._onContentStart.bind(this),t[e.CONTENT_END]=this._onContentEnd.bind(this),t[e.CONTROL_PLAY]=this._onControlPlay.bind(this),t[e.CONTROL_PAUSE]=this._onControlPause.bind(this),t[e.CONTROL_SEEK]=this._onControlSeek.bind(this),t[e.SEEK_DONE]=this._onSeekDone.bind(this),t[e.RESOURCE_END]=this._onResourceEnd.bind(this),t[e.VIDEO_STATE_CHANGE]=this._onVideoStateChange.bind(this),t[e.VIDEO_PROGRESS]=this._updatePlayhead.bind(this),t[e.PLAYER_DATA_LOADED]=this._updateVideoInfo.bind(this),t[e.PLAYER_LOADED]=this._updateVideoInfo.bind(this),t[e.RESOURCE_START]=this._updateVideoInfo.bind(this),t[e.VIDEO_RESUME]=this._updateVideoInfo.bind(this),t[e.VIDEO_DONE]=this._updateVideoInfo.bind(this),t[e.VIDEO_CUEPOINT]=this._onVideoCuePoint.bind(this),this._contextMetadataCBSetup||(t[e.CONTEXT_METADATA]=this._onContextMetadata.bind(this)),this.trackingMgr.registerEventCallbacks(t)},_setupContextMetadataEventCallback:function(){var e={};e[this.eventsMgr.eventTypes.CONTEXT_METADATA]=this._onContextMetadata.bind(this),this.trackingMgr.registerEventCallbacks(e),this._contextMetadataCBSetup=!0},_initializePlugin:function(){var e,o,l,d;if(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _initializePlugin"),n())this.debug&&uvpjs.warn(this.DEBUG_ID,"AdobeHeartbeatAgent _initializePlugin AdobeHeartbeat SDK not properly loaded.");else if(this._mediaHeartbeat)this.debug&&uvpjs.warn(this.DEBUG_ID,"AdobeHeartbeatAgent: plugin already initialized. No further page context metadata updates used.");else{if(t=ADB.va.MediaHeartbeat,i=ADB.va.MediaHeartbeatConfig,s=ADB.va.MediaHeartbeatDelegate,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent loadPlugin this._s, this._usesTealium, this._waitForTealium",this._s,this._usesTealium,this._waitForTealium),this._usesTealium&&!a(this._s)&&!this._waitForTealium)return this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent: Tealium detected on the page."),void this._getTealium();if(this._usesTealium)o=this._s,this.debug&&uvpjs.log(this.DEBUG_ID,'AdobeHeartbeatAgent setting appMeasurement to Tealium "s" object.');else{if("undefined"==typeof Visitor)return void(this.debug&&uvpjs.error(this.DEBUG_ID,"AdobeHeartbeatAgent: Unable to create Visitor object. Adobe Heartbeat tracking setup failed."));if("undefined"==typeof AppMeasurement)return void(this.debug&&uvpjs.error(this.DEBUG_ID,"AdobeHeartbeatAgent: Unable to create AppMeasurement object. Adobe Heartbeat tracking setup failed."));if(e=this._appMeasurementData.account,r.isString(e)&&r.isEmpty(e))return this._setupContextMetadataEventCallback(),void(this.debug&&uvpjs.warn(this.DEBUG_ID,'AdobeHeartbeatAgent: "account" param is an empty string. Waiting for API call to define "account" param and continue initiaization.'));(d=new Visitor(this._visitorData.marketingCloudOrgId)).trackingServer=this._visitorData.trackingServer,d.setCustomerIDs({userId:{id:this._visitorData.dpid},puuid:{id:this._visitorData.dpuuid}}),(o=new AppMeasurement(e)).visitor=d,o.account=e,o.trackingServer=this._appMeasurementData.trackingServer,o.pageName=this._appMeasurementData.pageName,o.charSet=this._appMeasurementData.charSet,o.visitorID=this._appMeasurementData.visitorID}r.isNull(o)?this.debug&&uvpjs.error(this.DEBUG_ID,"AdobeHeartbeatAgent: Error while setting up AppMeasurement object. Adobe Heartbeat tracking setup failed."):((l=new i).trackingServer=this._heartbeatData.trackingServer,l.playerName=this._playerName,l.channel=this._heartbeatData.channel,l.debugLogging=this._heartbeatDebug,l.appVersion=this.SDK_VERSION,l.ssl=this.mc.isSecure(),l.ovp="",this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _initializePlugin mediaConfig",l),r.extend(u.prototype,s.prototype),u.prototype.getCurrentPlaybackTime=function(){return this._agent.getCurrentPlaybackTime()},u.prototype.getQoSObject=function(){return this._agent.getQoSInfo()},this._mediaHeartbeat=new t(new u(this),l,o),this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent this._mediaHeartbeat object created."),this._setupEventCallbacks(),this.cviModel.getCurrentPlaybackState().playbackStarted&&this._setVideoLoad())}function u(e){this._agent=e}},_getTealium:function(){if(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getTealium."),a(this._s)||this._waitForTealium)this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent Tealium already loaded.");else{if(this._getTealiumTimer||(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getTealium setting timeout."),this._getTealiumTimer=setTimeout(this._onTealiumTimeout.bind(this),this.TEALIUM_SETUP_TIMEOUT)),!r.has(window,"s")||!a(window.s))return this.debug&&uvpjs.warn(this.DEBUG_ID,'AdobeHeartbeatAgent "usesTealium" is "true", but no Tealium "s" object detected.',window.s),void setTimeout(this.loadPlugin.bind(this,this.pluginLoadedCB.bind(this)),this.TEALIUM_RETRY_INTERVAL);this._s=window.s,this._waitForTealium=!0,this._initializePlugin()}},_onTealiumTimeout:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_onTealiumTimeout."),this._waitForTealium||(this.debug&&uvpjs.error(this.DEBUG_ID,"Tealium wait-time expired. Failed to load Tealium from the page."),this._getTealiumTimer=null,this._waitForTealium=!0,this._initializePlugin())},_trackHeartbeatInfo:function(e,i){if(r.isNull(this._mediaHeartbeat))this.debug&&uvpjs.warn(this.DEBUG_ID,"AdobeHeartbeatAgent _trackHeartbeatInfo no player plugin defined");else switch(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _trackHeartbeatInfo action =",e),e){case this.HEARTBEAT_SESSION_START:this._mediaHeartbeat.trackSessionStart(this._mediaObject,this._getContentVideoMetadata());break;case this.HEARTBEAT_SESSION_END:this._mediaHeartbeat.trackSessionEnd();break;case this.HEARTBEAT_PLAY:this._mediaHeartbeat.trackPlay();break;case this.HEARTBEAT_PAUSE:this._mediaHeartbeat.trackPause();break;case this.HEARTBEAT_COMPLETE:this._mediaHeartbeat.trackComplete();break;case this.HEARTBEAT_SEEK_START:this._mediaHeartbeat.trackEvent(t.Event.SeekStart);break;case this.HEARTBEAT_SEEK_COMPLETE:this._mediaHeartbeat.trackEvent(t.Event.SeekComplete);break;case this.HEARTBEAT_BUFFER_START:this._mediaHeartbeat.trackEvent(t.Event.BufferStart);break;case this.HEARTBEAT_BUFFER_COMPLETE:this._mediaHeartbeat.trackEvent(t.Event.BufferComplete);break;case this.HEARTBEAT_AD_BREAK_START:this._mediaHeartbeat.trackEvent(t.Event.AdBreakStart,this._adBreakObject);break;case this.HEARTBEAT_AD_BREAK_COMPLETE:this._mediaHeartbeat.trackEvent(t.Event.AdBreakComplete);break;case this.HEARTBEAT_AD_START:this._mediaHeartbeat.trackEvent(t.Event.AdStart,this._adObject,this._adContextData);break;case this.HEARTBEAT_AD_SKIP:this._mediaHeartbeat.trackEvent(t.Event.AdSkip);break;case this.HEARTBEAT_AD_COMPLETE:this._mediaHeartbeat.trackEvent(t.Event.AdComplete);break;case this.HEARTBEAT_CHAPTER_START:this._mediaHeartbeat.trackEvent(t.Event.ChapterStart,this._chapterObject,this._chapterCustomMetadata);break;case this.HEARTBEAT_CHAPTER_COMPLETE:this._mediaHeartbeat.trackEvent(t.Event.ChapterComplete);break;case this.HEARTBEAT_BITRATE_CHANGE:this._mediaHeartbeat.trackBitrateChange();break;case this.HEARTBEAT_VIDEO_PLAYER_ERROR:this._mediaHeartbeat.trackError(i)}},_getContentVideoMetadata:function(){var e,t,i=this.cviModel.getContentVideoState(),s=this._contextMetadata,n=this._sessionMetadata,a={};for(e in s)s.hasOwnProperty(e)&&(a[e]=s[e]);for(e in n)n.hasOwnProperty(e)&&(a[e]=n[e]);if(i.contextMetadata)for(e in t=i.contextMetadata)t.hasOwnProperty(e)&&(a[e]=t[e]);return a.tl=i.videoTitle,a.mediaAutoPlay=this.cviModel.isAutoplay.toString(),a.mediaMuted=this.cviModel.isMuteAtPlayStart.toString(),a.mediaIsPaidContent=i.isPaidContent.toString(),this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getContentVideoMetadata metadata",a),a},_onContextMetadata:function(e){var t,i=e.payload.contextMetadata;if(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onContextMetadata",e),!r.isEmpty(i)&&(this._contextMetadata=i,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onContextMetadata this._contextMetadata",this._contextMetadata),r.isEmpty(i[this.PAGE_REPORT_SUITE_ID_KEY]),t=i[this.PAGE_SITE_ACCOUNT_KEY],!r.isEmpty(t))){var s=r.isEmpty(this._appMeasurementData.account);this._appMeasurementData.account=t,s&&(this.debug&&uvpjs.warn(this.DEBUG_ID,'AdobeHeartbeatAgent: No "account" specified in config. Attempting to reinitialize plugin with "account" = '+t),this._initializePlugin())}},_setVideoLoad:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _setVideoLoad",this._mediaHeartbeat,this._startUpTime),this._updateVideoInfo(),this._videoLoaded=!0,this._qosObject={droppedFrames:0,startupTime:this._startUpTime,fps:0,bitrate:0},this._trackHeartbeatInfo(this.HEARTBEAT_SESSION_START)},_setChapterInfo:function(e){var i,s,n,a,r,o=e.chapterStartTimes,l=o&&o.length||0,d=parseInt(e.currentContentSegment);this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getChapter",e),isNaN(d)&&(d=1),s=(i=d<0?0:d-1)<=0?0:o[i],r=(n=i+1>l?e.duration:o[i+1])-s,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getChapter",n,s),(a={}).name="",a.length=isNaN(r)?0:r,a.position=d,a.startTime=o[i],this._chapterObject=t.createChapterObject(a.name,a.position,a.length,a.startTime),this._chapterInfo=a,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getChapter this._chapterInfo",this._chapterInfo)},_onAdStart:function(e){var i,s,n,a,o,l;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onAdStart",e),"pre"===(a=(o=(l=e.payload.adData).adClipID.split("_"))[0])?n=1:"mid"===a?n=parseInt(o[1])+1:"post"===a&&(n=this.cviModel.getNumberOfAdPods()),(s={}).name=r.isEmpty(l.adVideoTitle)?"na":l.adVideoTitle,s.position=n,s.playerName=this._playerName,s.startTime=this.getCurrentPlaybackTime(),(i={}).id=r.isEmpty(l.adVideoId)?r.isEmpty(l.adVatId)?"na":l.adVatId:l.adVideoId,i.name=s.name,i.length=l.duration,i.position=l.adPosition,this._adObject=t.createAdObject(i.name,i.id,i.position,i.length),this._adBreakObject=t.createAdBreakObject(s.name,s.position,s.startTime),this._adInfo=i,this._adBreakInfo=s,this._adContextData={},this._sendInitialPlay(),this._adBreakStartSent||(this._trackHeartbeatInfo(this.HEARTBEAT_AD_BREAK_START),this._adBreakStartSent=!0),this._trackHeartbeatInfo(this.HEARTBEAT_AD_START)},_onAdEnd:function(e){var t=this.HEARTBEAT_AD_COMPLETE;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onAdEnd"),this._trackHeartbeatInfo(t)},_onAdClick:function(e){var t=!0===e.payload.adData.paused;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onAdPaused"),t&&this._trackHeartbeatInfo(this.HEARTBEAT_PAUSE)},_onAdPodStart:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onAdPodStart"),this._adBreakStartSent=!1},_onAdPodEnd:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onAdPodEnd"),this._adBreakStartSent&&this._trackHeartbeatInfo(this.HEARTBEAT_AD_BREAK_COMPLETE)},_onContentStart:function(e){var t=e.payload.contentData;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onContentStart",t),this._contentStarted=!0,this._startUpTime=Math.abs(new Date-this.trackingMgr.resourceStartTime)/1e3,this._sendInitialPlay(),t.chapterStartTimes.length>0&&(this._setChapterInfo(t),this._trackHeartbeatInfo(this.HEARTBEAT_CHAPTER_START))},_onContentEnd:function(e){var t=e.payload.contentData;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent; ContentEnd",t),this._seekPending=!1,this._videoLoaded&&this._chapterInfo&&t.chapterStartTimes.length>0&&(this._chapterInfo=null,this._trackHeartbeatInfo(this.HEARTBEAT_CHAPTER_COMPLETE))},_onResourceEnd:function(e){var t=this._videoInfo,i=this._contentStarted&&t&&Math.ceil(t.playhead)>=.95*t.length,s=this.cviModel.getContentVideoState().isLive;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent; ResourceEnd; completed ? ",i),this._videoInfo=null,this._adBreakInfo=null,this._adInfo=null,this._chapterInfo=null,this._initialPlaySent=!1,this._qosObject={droppedFrames:0,startupTime:0,fps:0,bitrate:0},this._videoLoaded&&(this._videoLoaded=!1,this._seekPending=!1,!s&&i&&this._trackHeartbeatInfo(this.HEARTBEAT_COMPLETE),this._contentStarted=!1,this._trackHeartbeatInfo(this.HEARTBEAT_SESSION_END))},_onControlPlay:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onControlPlay"),this._seekPending||this._trackHeartbeatInfo(this.HEARTBEAT_PLAY)},_onControlPause:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onControlPause"),this._trackHeartbeatInfo(this.HEARTBEAT_PAUSE)},_onControlSeek:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onControlSeek"),this._seekPending||(this._seekPending=!0,this._trackHeartbeatInfo(this.HEARTBEAT_SEEK_START))},_onSeekDone:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onSeekDone"),this._seekPending&&this._trackHeartbeatInfo(this.HEARTBEAT_SEEK_COMPLETE),this._seekPending=!1},_onVideoStateChange:function(e){var t=e.payload.newState,i=this.mc.isMobile()&&this.mc.isIOS()&&this.cviModel.isFullscreen;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onVideoStateChange",t),this._videoLoaded&&(this._isBuffering||t!==this.mc.BUFFERING?this._isBuffering&&t!==this.mc.BUFFERING&&(this._isBuffering=!1,this._trackHeartbeatInfo(this.HEARTBEAT_BUFFER_COMPLETE)):(this._isBuffering=!0,this._trackHeartbeatInfo(this.HEARTBEAT_BUFFER_START)),t===this.mc.PLAYING&&this._trackHeartbeatInfo(this.HEARTBEAT_PLAY),i&&t===this.mc.PAUSED&&this._onControlPause(e))},_updateVideoInfo:function(){var e,i=this.cviModel.getCurrentPlaybackState(),s=this.cviModel.getContentVideoState(),n=t.StreamType,a=s.duration,o=s.isLive,l=s.episodeFlag,d={};r.isEmpty(s.cmsRefGuid)?r.isEmpty(s.mediaId)?r.isEmpty(s.pid)?r.isEmpty(s.assetURL)?d.id="na":d.id=s.assetURL:d.id=s.pid:d.id=s.mediaId:d.id=s.cmsRefGuid,d.name=s.videoTitle,d.playerName=this._playerName,d.length=o?this.LIVE_CONTENT_LENGTH:isNaN(a)?0:a,d.playhead=i.currentTime,o?e=n.LIVE:(e=n.VOD,e+=":"+(l?this.FULL_EPISODES:this.CLIPS)),d.streamType=e,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _updateVideoInfo MediaHeartbeat",t),this._mediaObject=t.createMediaObject(d.name,d.id,d.length,d.streamType),this._videoInfo=d,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _updateVideoInfo this._videoInfo",this._videoInfo)},_updateQosObj:function(e){var t=e&&e.facadeState,i=this._qosObject;t&&i&&(i.bitrate=t.currentBitrate||0,i.droppedFrames=t.droppedFrames||0,i.fps=t.playbackFramerate||0)},_updatePlayhead:function(e){var t=e.payload;this._videoInfo&&t&&(t.isAd||(this._updateQosObj(t),this._videoInfo.playhead=t.currentTime))},_sendInitialPlay:function(){!this._videoLoaded&&this._setVideoLoad(),this._initialPlaySent||(this._trackHeartbeatInfo(this.HEARTBEAT_PLAY),this._initialPlaySent=!0)},_onVideoCuePoint:function(e){if(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onVideoCuePoint",e),this._isSegmentOwner(e.payload)){var t=e.payload.data;(t=t.split("|")).length>0&&this._segmentStart({segmentId:t[0],segmentTitle:t[1]})}},_segmentStart:function(e){if(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _segmentStart",e),e.segmentId){this._mediaHeartbeat.trackComplete(),this._mediaHeartbeat.trackSessionEnd(),this._mediaObject.data["a.videoId"]=e.segmentId,this._mediaObject.data["a.name"]=e.segmentTitle;var t=this._getContentVideoMetadata();t.tl=e.segmentTitle,this._mediaHeartbeat.trackSessionStart(this._mediaObject,t),this._mediaHeartbeat.trackPlay()}},_isSegmentOwner:function(e){return this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _isOwner",this._segmentOwner),e.data&&e.data.indexOf("|")>-1&&e.name===this._segmentOwner}}),n=function(){return"undefined"==typeof ADB||"undefined"===r.get(ADB,"va.Heartbeat")},a=function(e){return r.isObject(e)&&!r.isEmpty(e)&&r.isFunction(e.isReadyToTrack)}}(uvpjs.register("uvpjs")),function(e){var t,i=e._,s=function(e){return(e>0&&e<10?"0":"")+e.toString()},n={publisherBrand:"ns_st_pu",programTitle:"ns_st_pr",episodeTitle:"ns_st_ep",seasonNumber:"ns_st_sn",episodeNumber:"ns_st_en",stationTitle:"ns_st_st",clipLength:"ns_st_cl",contentGenre:"ns_st_ge",tmsGracenoteId:"ns_st_ti",episodeId:"ns_st_tep",adLoadFlag:"ns_st_ia",fullEpisodeFlag:"ns_st_ce",digitalAirDate:"ns_st_ddt",tvAirDate:"ns_st_tdt"};e.ComScoreAgent=uvpjs.Class.subClass({debug:"prod"!==uvpjs.Configuration.env,_shouldTrackPlayStart:!1,_comScoreConfig:null,_contentMetadata:null,_adMetadata:null,_adType:null,_contentType:null,_liveSegmentData:null,init:function(e){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent init"),this.trackingMgr=e.trackingMgr,this.cviModel=e.cviModel,this.eventsMgr=e.eventsMgr,this._moduleName=e.moduleName,this._playerName=e.playerName,this.streamingTag=null,this._isAd=!1,this._mc=null},destroy:function(){this.trackingMgr=null,this.cviModel=null,this.eventsMgr=null,this._moduleName=null,this._playerName=null,this._isAd=!1,this._comScoreConfig=null,this._contentMetadata=null,this._adMetadata=null,this._adType=null,this._contentType=null,this._mc=null},initialize:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent initialize"),this._mc=uvpjs.mediaCapabilities,this._loadConfigData(),this._initializePlugin()},_loadConfigData:function(){var e=this.cviModel.getModuleParam.bind(this.cviModel,this.trackingMgr.COMSCORE_SS_MODULE_NAME);this._comScoreConfig={publisherId:e("c2")||"31824268",ns_st_pu:e("partnerID")||this.cviModel.sessionOptions.partner},this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _loadConfigData this",this)},_setupEventCallbacks:function(){var e=this.eventsMgr.eventTypes,t={};t[e.AD_START]=this._onAdStart.bind(this),t[e.AD_END]=this._onAdEnd.bind(this),t[e.CONTENT_START]=this._onContentStart.bind(this),t[e.CONTENT_END]=this._onContentEnd.bind(this),t[e.CONTROL_PLAY]=this._onControlPlay.bind(this),t[e.CONTROL_PAUSE]=this._onControlPause.bind(this),t[e.RESOURCE_START]=this._onResourceStart.bind(this),t[e.RESOURCE_END]=this._onResourceEnd.bind(this),t[e.LIVE_SEGMENT_START]=this._onLiveSegmentStart.bind(this),t[e.LIVE_SEGMENT_END]=this._onLiveSegmentEnd.bind(this),t[e.VIDEO_PROGRESS]=this._onVideoProgress.bind(this),t[e.VIDEO_STATE_CHANGE]=this._onVideoStateChange.bind(this),this.trackingMgr.registerEventCallbacks(t)},_initializePlugin:function(){t()?this.debug&&uvpjs.warn(this.DEBUG_ID,"ComScoreAgent _initializePlugin comScore SDK not properly loaded."):this._setupEventCallbacks()},_createStreamingTag:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _createStreamingTag",e),this.streamingTag=new ns_.ReducedRequirementsStreamingAnalytics(e)},_getContentMetadata:function(){var e,t,i=this.cviModel.getContentVideoState(),a=(this.cviModel.getContentPlaybackState(),uvpjs.util),r=this.cviModel.getModuleParam.bind(this.cviModel,this.trackingMgr.COMSCORE_SS_MODULE_NAME),o=this.cviModel.getContentVideoState().isLive,l=parseInt(i.episodeNumber),d=parseInt(i.seasonNumber),u=(i.seriesTitle,i.videoTitle),c=u&&u.split("-")[1],h=!isNaN(l),p=!isNaN(d),g=null!==i.contextMetadata&&i.contextMetadata.comscore_c4,f=u;h&&p&&(e=s(l),f+="--"+(t=s(d))+e);var v={ns_st_ci:a.getDefinedString(i.cmsRefGuid,i.mediaId,"0"),ns_st_cl:o?0:this.trackingMgr.getContentLength(),ns_st_pu:this._comScoreConfig[n.publisherBrand],ns_st_pr:a.getDefinedString(i.seriesTitle,i.videoTitle),ns_st_ep:c,ns_st_sn:p&&t||"*null",ns_st_en:h&&e||"*null",ns_st_ge:i.category||"*null",ns_st_ia:o?1:0,ns_st_ddt:"*null",ns_st_tdt:"*null",ns_st_st:r("c4")||"*null",ns_st_ce:i.episodeFlag?1:0,c3:r("c3")||this._playerName,c4:g||r("c4")||"*null",c6:r("c6")||f};return["ns_st_ge","ns_st_st","ns_st_pu","ns_ap_an","ns_st_ddt","ns_st_tdt"].forEach(function(e){var t=r(e);t&&(v[e]=t)}),v},_onAdStart:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onAdStart",e),this._isAd=!0,this._adMetadata={ns_st_cl:this.trackingMgr.getAdLength()},this._adType=this._getAdType(),this._trackAdPlay()},_onAdEnd:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onAdEnd",e),this._isAd=!1,this._trackStop()},_onContentStart:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onContentStart",e);var t=ns_.ReducedRequirementsStreamingAnalytics.ContentType;this._contentType=this.cviModel.getContentVideoState().isLive?t.Live:t.LongFormOnDemand,this._contentMetadata=this._getContentMetadata(),this._isAd=!1,this._shouldTrackPlayStart=!0},_onContentEnd:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onContentEnd",e),this._trackStop()},_onControlPlay:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onControlPlay",e),this.streamingTag?this._isAd?this._trackAdPlay():this._trackContentPlay():this.debug&&uvpjs.warn(this.DEBUG_ID,"Streaming tag not initialized")},_onControlPause:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onControlPause"),this._trackStop()},_onResourceStart:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onResourceStart",e),this._createStreamingTag(this._comScoreConfig)},_onResourceEnd:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onResourceEnd",e),this.streamingTag=null},_onLiveSegmentStart:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onLiveSegmentStart",e),this._isLiveEvent(e)&&(this._shouldTrackPlayStart=!0,this._liveSegmentData=e.payload.liveSegmentData,this._trackStop(),null==this._contentMetadata||this._isSameLiveStation(this._liveSegmentData)||this._createStreamingTag(this._comScoreConfig))},_onLiveSegmentEnd:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onLiveSegmentEnd",e),this._trackStop()},_onVideoProgress:function(e){this._shouldTrackPlayStart&&(this._trackContentPlay(),this._shouldTrackPlayStart=!1)},_onVideoStateChange:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onVideoStateChange",e);var t=e.payload.newState;this._mc.isMobile()&&this._mc.isIOS()&&this.cviModel.isFullscreen&&(t===this._mc.PAUSED?this._onControlPause(e):t===this._mc.PLAYING&&this._onControlPlay(e))},_trackAdPlay:function(){this.streamingTag&&this.streamingTag.playVideoAdvertisement(this._adMetadata,this._adType)},_trackContentPlay:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _trackContentPlay"),this._contentMetadata=e.util.copyObjectWithKeyMap(n).from(this._liveSegmentData).to(this._contentMetadata),this.streamingTag&&this.streamingTag.playVideoContentPart(this._contentMetadata,this._contentType)},_trackStop:function(){this.streamingTag&&this.streamingTag.stop()},_isLiveEvent:function(e){return this.cviModel.getContentVideoState().isLive&&e.payload&&e.payload.hasOwnProperty("liveSegmentData")&&"object"==typeof e.payload.liveSegmentData},_isSameLiveStation:function(e){return e.stationTitle===this._contentMetadata[n.stationTitle]},_getAdType:function(){var e,t=ns_.ReducedRequirementsStreamingAnalytics.AdType,i=this.cviModel.getAdVideoState().adClipID.split("_")[0];return e="pre"===i?t.LinearOnDemandPreRoll:"mid"===i?t.LinearOnDemandMidRoll:t.LinearOnDemandPostRoll,this.cviModel.getContentVideoState().isLive&&(e=t.LinearLive),e}}),t=function(){return"undefined"==typeof ns_||i.isUndefined(ns_.ReducedRequirementsStreamingAnalytics)}}(uvpjs.register("uvpjs")),function(e){"use strict";e.ConvivaAgent=uvpjs.Class.subClass({init:function(e){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: construct",e),this.convivaClient=null,this.convivaSystemFactory=null,this.convivaAdPlayerStateManager=null,this.convivaAdSessionKey=null,this.hasConvivaAdSession=!1,this.hasConvivaAdPaused=!1,this.convivaPlayerStateManager=null,this.convivaSessionKey=null,this.hasConvivaSession=!1,this.hasContentStarted=!1,this.isSeekPending=!1,this.isSeekDone=!1,this.currAdPodInfo=null,this.trackingMgr=e.trackingMgr,this.cviModel=e.cviModel,this.eventTypes=e.eventsMgr&&e.eventsMgr.eventTypes||null,this.moduleName=e.moduleName,this.playerName=e.playerName,this.moduleParams=null,this.defaultHeartbeatInterval=20,this.adPodInProgress=!1,this.startEvents={ad:0,content:0},this.podCount=0,this.adEventHandlerMap=null,this.contextMetadata=this.trackingMgr.contextMetadata||{}},destroy:function(){this.hasConvivaSession&&this._killConvivaSession(),this.convivaClient&&this.convivaClient.release(),this.convivaSystemFactory&&this.convivaSystemFactory.release(),this.convivaClient=null,this.convivaSystemFactory=null,this.convivaAdPlayerStateManager=null,this.convivaAdSessionKey=null,this.trackingMgr=null,this.cviModel=null,this.eventTypes=null,this.moduleParams=null,this.contextMetadata=null},initialize:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent initialize()"),this._gatherModuleParams(),this._initializePlugin()},_initializePlugin:function(){if(void 0!==window.Conviva){var e=this.eventTypes,t=this.adEventHandlerMap={};t[e.AD_POD_START]=this.hPodStart.bind(this),t[e.AD_POD_END]=this.hPodEnd.bind(this),t[e.AD_LOADED]=this.hAdLoaded.bind(this),t[e.AD_START]=this.hAdStart.bind(this),t[e.AD_END]=this.hAdEnd.bind(this),t[e.AD_ERROR]=this.hAdError.bind(this),t[e.AD_BUFFERING]=this.hAdBuffering.bind(this),this.cviModel&&(this.convivaClient=this._createConvivaClient(),null!==this.convivaClient&&(this._setupEventCallbacks(),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: created Conviva client.")))}else this.debug&&uvpjs.warn(this.DEBUG_ID,"ConvivaAgent: Conviva SDK not properly loaded.")},_getAdType:function(e){var t="string"==typeof e?e.toLowerCase():null,i=Conviva.Client.AdPosition,s=uvpjs.ConvivaAgent.adPositions;return t?t.indexOf(s.PRE)>=0?i.PREROLL:t.indexOf(s.MID)>=0?i.MIDROLL:t.indexOf(s.POST)>=0?i.POSTROLL:void 0:i.PREROLL},_getArgsForStartAd:function(e){var t=Conviva.Client.AdStream,i=Conviva.Client.AdPlayer,s="ima"==e.adServerName;return{key:this.convivaSessionKey,pos:this._getAdType(e.adType),stream:s?t.SEPARATE:t.CONTENT,player:s?i.SEPARATE:i.CONTENT}},_onAdEvent:function(e){var t=e.type;this.startEvents.content=0,this.hasConvivaSession||t===this.eventTypes.AD_ERROR||this._createConvivaSession(),this.adEventHandlerMap[t](e.payload,e)},hPodStart:function(e,t){this.podCount++,this._onContentPaused(t),this.currAdPodInfo=this._buildAdPodInfo(e.adPod),this.adPodInProgress=!0,this._sendCustomEvent("Conviva.PodStart",this.currAdPodInfo);var i=this._getArgsForStartAd(e);this.convivaClient.detachPlayer(this.convivaSessionKey),this.convivaClient.adStart(i.key,i.stream,i.player,i.pos),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent Ad Start",i),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent AD_POD_START",this.currAdPodInfo)},hAdLoaded:function(e,t){var i=this._buildAdInfo(e);this.hasConvivaAdSession&&this._killConvivaAdSession(),this.convivaAdSessionKey=this.convivaClient.createAdSession(this.convivaSessionKey,i),this.convivaAdPlayerStateManager=this.convivaClient.getPlayerStateManager(),this._attachPlayerToAdSession(),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent AD_LOADED, created Ad Session with key:",this.convivaAdSessionKey)},hAdStart:function(e,t){this.adPodInProgress&&this.hasConvivaAdSession&&this.convivaAdPlayerStateManager&&(this.startEvents.ad=1,this.convivaAdPlayerStateManager.setBitrateKbps(this.cviModel.getAdVideoState().adBitrate),this.convivaAdPlayerStateManager.setPlayerState(Conviva.PlayerStateManager.PlayerState.PLAYING))},hAdEnd:function(e,t){this.startEvents.ad=0,this._killConvivaAdSession()},hPodEnd:function(e,t){var i=this.currAdPodInfo||{},s=this.convivaSessionKey;this.adPodInProgress=!1,uvpjs.util.isEmpty(s)||s===Conviva.Client.NO_SESSION_KEY?this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent Unable to call ad end - no session key"):(this.convivaClient.adEnd(this.convivaSessionKey),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent AD_END")),this._sendCustomEvent("Conviva.PodEnd",i),this.currAdPodInfo=null,this.convivaClient.attachPlayer(this.convivaSessionKey,this.convivaPlayerStateManager),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent AD_POD_END")},hAdError:function(e,t){var i=e.errorInfo;this.hasConvivaAdSession?(this._sendError(i.errorCode,Conviva.Client.ErrorSeverity.FATAL,!0),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: actionable ad error",i)):this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: non-actionable ad error",i)},hAdBuffering:function(e,t){this.hasConvivaAdSession?(this.convivaAdPlayerStateManager.setPlayerState(Conviva.PlayerStateManager.PlayerState.BUFFERING),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent AD_BUFFERING")):this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent Unable to call ad buffering - no session key")},_onContentEvent:function(e){var t=!1;this.startEvents.ad=0,e.type===this.eventTypes.CONTENT_DATA_LOADED?(this.startEvents.content&&this.hasConvivaSession&&this._killConvivaSession(),!this.hasConvivaSession&&this._createConvivaSession(),t=!0):e.type==this.eventTypes.CONTENT_START&&(this.startEvents.content=1,t=!0,this.hasContentStarted=!0,this._killConvivaAdSession()),t&&(this.adPodInProgress=!1,this.currAdPodInfo=null)},_onContentPaused:function(e){this._setConvivaPlayerState(Conviva.PlayerStateManager.PlayerState.PAUSED)},_onContentPlaying:function(e){this._setConvivaPlayerState(Conviva.PlayerStateManager.PlayerState.PLAYING)},_onContentBuffering:function(e){!this.isSeekPending&&this._setConvivaPlayerState(Conviva.PlayerStateManager.PlayerState.BUFFERING)},_onControlSeek:function(e){this.hasConvivaSession&&this.convivaPlayerStateManager&&(this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent _onControlSeek",e),this.convivaPlayerStateManager.setPlayerSeekStart(Math.floor(1e3*e.payload.seekTime))),this.isSeekPending=!0},_onSeekDone:function(e){this.isSeekPending&&this.hasConvivaSession&&this.convivaPlayerStateManager&&(this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent _onSeekDone",e),this.convivaPlayerStateManager.setPlayerSeekEnd()),this.isSeekPending=!1,this.isSeekDone=!0},_onVideoProgress:function(e){this.isSeekDone&&(this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent play after seek",e),this._onContentPlaying(e),this.isSeekDone=!1)},_onVideoEvent:function(e){var t=this.eventTypes;switch(e.type){case t.VIDEO_STATE_CHANGE:var i=e.payload.newState,s=this._getMediaCapabilities();this.hasConvivaAdSession?i===s.PLAYING&&this.hasConvivaAdPaused?this._onAdResume(e):i===s.PAUSED&&this._onAdPaused(e):this.hasConvivaSession&&(i===s.PLAYING?this._onContentPlaying(e):i===s.PAUSED?this._onContentPaused(e):i===s.BUFFERING&&this.hasContentStarted&&this._onContentBuffering(e));break;case t.VIDEO_TRANSITION_COMPLETE:case t.VIDEO_DONE:this._onVideoTransition(e);break;case t.RESOURCE_END:this._killConvivaSession()}},_onCdnUpdated:function(e){var t=this.hasConvivaSession?this.convivaSessionKey:Conviva.Client.NO_SESSION_KEY,i=new Conviva.ContentMetadata;i.defaultResource=this._validateStr(e.payload.cdn,""),this.convivaClient.updateContentMetadata(t,i)},_onError:function(e){var t=e.payload.errorInfo;t.isFatal?(!this.hasConvivaSession&&this._createConvivaSession(),this._sendError(t.errorCode,Conviva.Client.ErrorSeverity.FATAL,!1),this._killConvivaAdSession(),this._killConvivaSession()):this._sendError(t.errorCode,Conviva.Client.ErrorSeverity.WARNING,!1)},_attachPlayerToAdSession:function(){this.convivaAdSessionKey!==Conviva.Client.NO_SESSION_KEY?(this.convivaClient.attachPlayer(this.convivaAdSessionKey,this.convivaAdPlayerStateManager),this.hasConvivaAdSession=!0,this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent Ad session created; attaching player",this.convivaAdSessionKey)):(this.debug&&uvpjs.warn(this.DEBUG_ID,"ConvivaAgent AdSession creation failed"),this.hasConvivaAdSession=!1)},_onAdPaused:function(e){this.hasConvivaAdSession&&this.convivaAdPlayerStateManager&&(this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent _onAdPaused PAUSED"),this.convivaAdPlayerStateManager.setPlayerState(Conviva.PlayerStateManager.PlayerState.PAUSED),this.hasConvivaAdPaused=!0)},_onAdResume:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent _onAdResume",e),this.hasConvivaAdSession&&this.convivaAdPlayerStateManager&&(this.convivaAdPlayerStateManager.setPlayerState(Conviva.PlayerStateManager.PlayerState.PLAYING),this.hasConvivaAdPaused=!1)},_onVideoTransition:function(e){var t=e.payload.bitrate;this.hasConvivaSession&&this.convivaPlayerStateManager&&(t>0&&(t*=.001),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent _onVideoTransition",t),this.convivaPlayerStateManager.setBitrateKbps(t))},_onContextMetadata:function(e){this.contextMetadata=e.payload.contextMetadata||{}},_createConvivaSession:function(){if(this.convivaClient){var e=this.cviModel,t=(this._getMediaCapabilities(),Conviva.PlayerStateManager.PlayerState,{userId:e.getSessionOption("userId"),userPPID:e.getSessionOption("userPPID"),userStatus:e.getSessionOption("userStatus")}),i=new Conviva.ContentMetadata;this._setContentMetadata(i,t),this.convivaSessionKey=this.convivaClient.createSession(i),this.convivaPlayerStateManager=this.convivaClient.getPlayerStateManager(),this.convivaClient.attachPlayer(this.convivaSessionKey,this.convivaPlayerStateManager),this.hasConvivaSession=!0,this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: Conviva session created")}},_killConvivaSession:function(){this.convivaClient&&this.hasConvivaSession&&(this.convivaPlayerStateManager&&(this.convivaPlayerStateManager.setPlayerState(Conviva.PlayerStateManager.PlayerState.STOPPED),this.convivaClient.releasePlayerStateManager(this.convivaPlayerStateManager)),this.convivaPlayerStateManager=null,this.convivaClient.cleanupSession(this.convivaSessionKey),this.convivaSessionKey=null,this.hasConvivaSession=!1,this.hasContentStarted=!1,this.adPodInProgress=!1,this.currAdPodInfo=null,this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: Conviva session killed"))},_killConvivaAdSession:function(){this.hasConvivaAdSession&&this.convivaClient&&this.convivaAdSessionKey&&this.convivaAdSessionKey!==Conviva.Client.NO_SESSION_KEY&&this.convivaAdPlayerStateManager&&(this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: _killConvivaAdSession"),this.convivaAdPlayerStateManager.setPlayerState(Conviva.PlayerStateManager.PlayerState.STOPPED),this.convivaClient.releasePlayerStateManager(this.convivaAdPlayerStateManager),this.convivaClient.cleanupSession(this.convivaAdSessionKey),this.convivaAdPlayerStateManager=null,this.hasConvivaAdSession=!1)},_sendCustomEvent:function(e,t){var i=this.hasConvivaSession?this.convivaSessionKey:Conviva.Client.NO_SESSION_KEY;this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: _sendCustomEvent",e,t),this.convivaClient&&this.convivaClient.sendCustomEvent(i,e,t)},_sendError:function(e,t,i){if(this.hasConvivaSession){var s="";e=uvpjs.mapErrorCode(e).toString(),!0===i?(s=" AD",this.convivaClient.reportError(this.convivaAdSessionKey,e,t)):this.convivaPlayerStateManager.sendError(e,t),this.debug&&uvpjs.warn(this.DEBUG_ID,"ConvivaAgent: sent"+s+" ERROR: "+e)}},_setConvivaPlayerState:function(e){this.hasConvivaSession&&this.convivaPlayerStateManager&&(this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent _setConvivaPlayerState",e),this.convivaPlayerStateManager.setPlayerState(e))},_setContentMetadata:function(e,t){var i=this.cviModel,s=Conviva.ContentMetadata.StreamType,n=i.contentVideoState,a=n.defaultBitrate;e.applicationName=this.playerName,e.assetName=this._validateStr(n.videoTitle,"N/A"),e.defaultBitrateKbps=a&&a>0?a:700,e.defaultResource=this._validateStr(n.cdn,""),e.duration=n.duration,e.streamType=n.isLive?s.LIVE:s.VOD,e.streamUrl=this._validateStr(n.assetURL,"N/A"),e.viewerId=this._validateStr(t.userId,"N/A"),e.custom={accessType:this._validateStr(t.userStatus,"anon"),contentId:this._validateStr(n.cmsRefGuid,"N/A"),contentType:n.isLive?"Live":"VOD",isEpisode:n.episodeFlag?"true":"false",Partner_ID:this._validateStr(i.getSessionOption("partner"),"N/A"),Player_Version:uvpjs.Configuration.version,seriesTitle:this._validateStr(n.seriesTitle,"N/A"),winDimension:this._getWinDimension(),episodeTitle:this._getEpisodeTitle(n),appRegion:this._validateStr(i.sessionOptions.userCountry,"us"),app:uvpjs.Configuration.name,appVersion:uvpjs.Configuration.name+" "+uvpjs.Configuration.version,drm:n.drm.enabled.toString(),drmType:this.trackingMgr.mc.getDrmType(n.drm),showId:this.contextMetadata.showId&&this._validateStr(this.contextMetadata.showId.toString(),""),connectionType:this._validateStr(i.sessionOptions.userConnectionType,"unknown")}},_getEpisodeTitle:function(e){if(e.isLive)return e.videoTitle||e.episodeTitle;var t=this._validateStr(e.episodeTitle,e.videoTitle);return t.search(/\w+.*-.*\w+/)>-1&&(t=t.split("-")[1]),t.replace(/^\s+|\s+$/g,"")},_getWinDimension:function(){var e=this.cviModel.contentVideoState.sourceWidth,t=this.cviModel.contentVideoState.sourceHeight;return window&&window.screen&&(window.screen.width&&(e=window.screen.width),window.screen.height&&(t=window.screen.height)),e+"x"+t},_createConvivaClient:function(){var e=this._getConvivaClientSettings();return e?(this.convivaSystemFactory=this._createConvivaSystemFactory(),new Conviva.Client(e,this.convivaSystemFactory)):null},_getConvivaClientSettings:function(){var e,t=this.moduleParams;return this._isValidStr(t.customerKey)&&this._isValidStr(t.serviceUrl)?((e=new Conviva.ClientSettings(t.customerKey)).heartbeatInterval=t.heartbeatInterval||this.defaultHeartbeatInterval,e.gatewayUrl=t.serviceUrl,e):(this.debug&&uvpjs.warn(this.DEBUG_ID,"ConvivaAgent could not create client: key and/or service url invalid."),null)},_setConvivaSystemProps:function(e){var t="development"===uvpjs.Configuration.env,i=Conviva.SystemSettings.LogLevel;e.allowUncaughtExceptions=t,e.logLevel=t?i.WARNING:i.NONE},_createConvivaSystemFactory:function(){var e=new Conviva.SystemInterface(new uvpjs.ConvivaHtml5Time,new uvpjs.ConvivaHtml5Timer,new uvpjs.ConvivaHtml5Http,new uvpjs.ConvivaHtml5Storage,new uvpjs.ConvivaHtml5Metadata,new uvpjs.ConvivaHtml5Logging),t=new Conviva.SystemSettings;return this._setConvivaSystemProps(t),new Conviva.SystemFactory(e,t)},_buildAdPodInfo:function(e){var t,i,s,n={};uvpjs.ConvivaAgent.adPositions;return e?(void 0!==e.podDuration&&(n.podDuration=String(e.podDuration)),e.adPodId?(i=(t=e.adPodId.split("_")[0].toLowerCase()).charAt(0).toUpperCase()+t.slice(1),s=String(e.imaPodIndex+1),n.podPosition=i+"-roll",n.podIndex=this.podCount,n.absoluteIndex=s,n):n):null},_buildAdInfo:function(e){var t=new Conviva.ContentMetadata,i=e.adData,s=e.imaAdData||{},n=this.cviModel.getSessionOption("partner");if(!e)return null;t.adTitle="("+i.adVideoId+")"+i.adVideoTitle,t.assetName=t.adTitle,t.adClipId=this._validateStr(i.adClipID,"N/A"),t.Partner_ID=this._validateStr(n,"N/A"),t.adServerName=this._validateStr(i.adServerName,"N/A"),t.streamUrl=this._validateStr(i.adAssetUrl,"N/A"),t.duration=i.duration,t.streamType=Conviva.ContentMetadata.StreamType.VOD;var a=i.adType;return t.custom={"c3.ad.technology":"Client Side","c3.ad.id":s.adId||i.adVideoId,"c3.ad.system":s.adSystem||i.adServerName,"c3.ad.position":a.charAt(0).toUpperCase()+a.substr(1)+"roll","c3.ad.mediaFileApiFramework":s.apiFramework,"c3.ad.sequence":s.adPodInfo?s.adPodInfo.adPosition:i.adPosition,"c3.ad.creativeId":s.creativeId||i.creativeId,"c3.ad.advertiser":s.advertiserName},this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent _buildAdInfo",t),t},_isValidStr:function(e){return uvpjs.util.isDefinedString(e)},_validateStr:function(e,t){return this._isValidStr(e)?e:t},_isDynamicStreaming:function(e){var t=e.split("?");return"mp4"===t[0].substr(t[0].lastIndexOf(".")+1)?"false":"true"},_getMediaCapabilities:function(){return uvpjs.mediaCapabilities},_gatherModuleParams:function(){for(var e,t=this.cviModel.getModule(this.moduleName).params,i=t.length,s={};i--;)s[(e=t[i]).name]=e.value;this.moduleParams=s},_setupEventCallbacks:function(){var e=this.eventTypes,t={},i=this._onAdEvent.bind(this),s=this._onContentEvent.bind(this),n=this._onVideoEvent.bind(this),a=this._onError.bind(this);t[e.AD_POD_START]=i,t[e.AD_LOADED]=i,t[e.AD_START]=i,t[e.AD_END]=i,t[e.AD_POD_END]=i,t[e.AD_ERROR]=i,t[e.AD_BUFFERING]=i,t[e.CONTENT_DATA_LOADED]=s,t[e.CONTENT_START]=s,t[e.CONTENT_END]=s,t[e.VIDEO_STATE_CHANGE]=n,t[e.VIDEO_TRANSITION_COMPLETE]=n,t[e.VIDEO_DONE]=n,t[e.RESOURCE_END]=n,t[e.PLAYER_START_ERROR]=a,t[e.VIDEO_START_ERROR]=a,t[e.VIDEO_PLAYBACK_ERROR]=a,t[e.CDN_UPDATED]=this._onCdnUpdated.bind(this),t[e.VIDEO_TRANSITION_START]=this._onVideoTransition.bind(this),t[e.CONTROL_SEEK]=this._onControlSeek.bind(this),t[e.SEEK_DONE]=this._onSeekDone.bind(this),t[e.VIDEO_PROGRESS]=this._onVideoProgress.bind(this),t[e.CONTEXT_METADATA]=this._onContextMetadata.bind(this),this.trackingMgr.registerEventCallbacks(t),window.addEventListener("beforeunload",function(){this.hasConvivaAdSession&&this._killConvivaAdSession(),this._killConvivaSession()}.bind(this),!1)}}),e.ConvivaAgent.adPositions={PRE:"pre",MID:"mid",POST:"post"}}(uvpjs.register("uvpjs")),function(e){"use strict";e.NielsenAgent=uvpjs.Class.subClass({debug:uvpjs.DebugManager.isEnabled,NIELSEN_APID_PARAM_NAME:"apid",NIELSEN_CLIENTID_PARAM_NAME:"clientid",NIELSEN_SFCODE_PARAM_NAME:"sfcode",NIELSEN_VCID_PARAM_NAME:"vcid",NIELSEN_CHANNEL_INFO_PARAM_NAME:"channelInfo",NIELSEN_CHANNEL_NAME_PARAM_NAME:"channelName",NIELSEN_IAG_SID_PARAM_NAME:"iag_sid",NIELSEN_IAG_TFID_PARAM_NAME:"iag_tfid",NIELSEN_NOL_DEV_DEBUG_PARAM_NAME:"nol_devDebug",NIELSEN_APN:"cbsdesktop",NIELSEN_DEFAULT_APID:"PF7B87067-BF4D-F80F-E040-070AAD316CE6",NIELSEN_LIVE_VIDEO_DURATION:86400,NIELSEN_VIDEO_CUEPOINT_NAME:"www.nielsen.com",events:{PLAY:5,STOP:7,END:57,LOAD_METADATA:15,SET_PLAYHEAD_POSITION:49,SEND_ID3:55},adType:{LINEAR:"1",DYNAMIC:"2"},init:function(e){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,"development"===uvpjs.Configuration.env&&this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent init",e),this.trackingMgr=e.trackingMgr,this.cviModel=e.cviModel,this.eventsMgr=e.eventsMgr,this._moduleName=e.moduleName,this._playerName=e.playerName,this.pluginLoadedCB=Function.prototype,this._gg=null,this._nolggGlobalParams=null,this._metadata=null,this._lastAdSecond=null,this._lastContentSecond=null,this._numAdsInPod=null,this._adDisplayed=!1},destroy:function(){this.trackingMgr=null,this.cviModel=null,this.eventsMgr=null,this._moduleName=null,this._playerName=null,this.pluginLoadedCB=Function.prototype,this._gg=null,this._nolggGlobalParams=null,this._metadata=null,this._lastAdSecond=null,this._lastContentSecond=null,this._numAdsInPod=null,this._adDisplayed=!1},initialize:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent initialize"),this._metadata={},this._initializeParams(),this._initializePlugin()},_initializeParams:function(){var e,t,i,s=this.cviModel,n=this._metadata,a=s.sessionOptions.partner,r=s.getModule(this._moduleName).params,o=r.length,l={};for(this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _initializeParams");o--;)""!==(e=r[o]).value&&(l[e.name]=e.value);switch(this._nolggGlobalParams={nsdkv:"511",apn:this._playerName,sfcode:l[this.NIELSEN_SFCODE_PARAM_NAME],apid:l[this.NIELSEN_APID_PARAM_NAME]||this.NIELSEN_DEFAULT_APID,nol_sdkDebug:l[this.NIELSEN_NOL_DEV_DEBUG_PARAM_NAME]},a){case"chow":t="us-700144",i="c06";break;case"tvcom":t="us-200330",i="c03";break;case"cbs":case"can":t="us-700144",i="c01";break;case"cbssports":case"cbssports_test":t="us-201669",i="c02";break;case"news":t="us-700144",i="c03";break;case"gamespot":t="us-200330",i="c13";break;case"cnettv":t="us-200330",i="c05";break;default:t="us-700144",i="c01"}n.ci=l.clientid||t,n.c6=l.vcid||i,n.iag_sid=l.iag_sid,n.iag_tfid=l.iag_tfid,n.channelName=l.channelName,n.segB=l.segB||"",this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _initializeParams params, metadata",l,n)},_setupEventCallbacks:function(){var e=this.eventsMgr.eventTypes,t={};t[e.CONTENT_DATA_LOADED]=this._onContentDataLoaded.bind(this),t[e.AD_START]=this._onAdStart.bind(this),t[e.AD_POD_START]=this._onAdPodStart.bind(this),t[e.AD_END]=this._onAdEnd.bind(this),t[e.CONTENT_START]=this._onContentStart.bind(this),t[e.CONTENT_END]=this._onContentEnd.bind(this),t[e.CONTROL_PLAY]=this._onControlPlay.bind(this),t[e.VIDEO_PROGRESS]=this._onVideoProgress.bind(this),t[e.VIDEO_CUEPOINT]=this._onVideoCuepoint.bind(this),this.trackingMgr.registerEventCallbacks(t)},_initializePlugin:function(){t()?this.debug&&uvpjs.warn(this.DEBUG_ID,"NielsenAgent _initializePlugin Nielsen SDK not properly loaded."):(window.NOLBUNDLE&&"function"==typeof window.NOLBUNDLE.nlsQ?this._gg=window.NOLBUNDLE.nlsQ(this._nolggGlobalParams.apid,"_gg"+(new Date).getTime()):(this._gg=window.NOLCMB.getInstance(),this._gg.ggInitialize(this._nolggGlobalParams)),this._setupEventCallbacks())},_notifySDK:function(e,t){this._isDisabled()||(this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent ggPM",e,t),this._gg.ggPM(e,t))},_onContentDataLoaded:function(e){var t,i,s,n,a,r,o,l,d=uvpjs.mediaCapabilities.isMobile(),u=this._metadata;e.payload&&(s=(t=e.payload.vidState).chapterStartTimes.length>0?"lf":"sf",a=t.episodeNumber,r=t.seasonNumber,o=t.seriesTitle,l=t.videoTitle,i=t.duration,n=[l,r,a,s].join("|"),""===r&&(r="0"),""===a&&(a="0"),t.isAffiliateFeed&&(u.tv="true"),(t.isLive||-1===i)&&(i=this.NIELSEN_LIVE_VIDEO_DURATION),u.pc=u.ci+u.c6+u.cmsRefGuid,u.c10="plt,"+(d?"MBL":"DSK"),u.sd=i,u.dur=i,u.cg=o,u.tl=n,u.videotype="content",u.guid=t.cmsRefGuid,u.seriestitle=o,u.episodetitle=l,u.isfullepisode=t.episodeFlag?"y":"n",u.crossId1=t.mediaId,u.iag_pgm=l,u.iag_epi=n,u.iag_pd=location.hostname,u.iag_fp=s,u.iag_cte="na",u.iag_oad="na",u.iag_seg=1,this._metadata.adloadtype=t.isLive?this.adType.LINEAR:this.adType.DYNAMIC,this._isRcoTypeDai()&&(this._metadata.adloadtype=this.adType.DYNAMIC),this._metadata.adModel=this._metadata.adloadtype,this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onContentDataLoaded metadata",u))},_onAdStart:function(e){var t,i,s,n,a,r,o,l,d,u,c=this.cviModel.getContentVideoState(),h=e.payload;h&&(this._metadata.hasAds=1,this._adDisplayed=!0,u=uvpjs._.clone(this._metadata),n=(i=(t=h.adData).adClipID.split("_"))[0],l=this.cviModel.getNumberOfAdPods(),d="post"===n?l:++i[1],s=["dav0",c.videoTitle,c.seasonNumber,c.episodeNumber].join("-"),o=[l,d,this._numAdsInPod,i[2]].join("_"),a=t.adVatId,r=t.adVideoUrl,""!==a&&(r+="|"+a),u.videotype=n+"roll",u.iag_cte=r,u.iag_pod=o,u.iag_apt="na",u.tl=s,u.c3="st,a","pre"===n&&(this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onAdStart sending content metadata."),this._notifySDK(this.events.LOAD_METADATA,this._metadata)),this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onAdStart adMetadata",u),this._lastAdSecond=0,this._notifySDK(this.events.SET_PLAYHEAD_POSITION,this._lastAdSecond),this._notifySDK(this.events.LOAD_METADATA,u))},_onAdPodStart:function(e){var t=e.payload;t&&(this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onAdPodStart adCount",t.adPod.adCount),this._numAdsInPod=t.adPod.adCount)},_onAdEnd:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onAdEnd"),this._adDisplayed=!1,this._notifySDK(this.events.STOP,this._lastAdSecond)},_onContentStart:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onContentStart"),this._adDisplayed=!1,this._metadata.hasAds=this._hasAds(),this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onContentStart this._metadata",this._metadata),this._notifySDK(this.events.LOAD_METADATA,this._metadata)},_onContentEnd:function(e){var t,i=e.payload;this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onContentEnd"),i&&(this._metadata.iag_seg&&this._metadata.iag_seg++,(t=e.payload.contentData).duration>0&&Math.abs(t.duration-this._lastContentSecond)<=5?this._notifySDK(this.events.END,this._lastContentSecond):this._notifySDK(this.events.STOP,this._lastContentSecond))},_onControlPlay:function(e){this._adDisplayed||(this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onControlPlay"),this._notifySDK(this.events.PLAY,this._lastContentSecond))},_onVideoProgress:function(e){var t,i=e.payload;if(i&&!((t=Math.floor(i.currentTime))<0)){if(i.isAd){if(this._lastAdSecond===t)return;this._lastAdSecond=t}else{if(this._lastContentSecond===t)return;this._lastContentSecond=t}this._notifySDK(this.events.SET_PLAYHEAD_POSITION,t)}},_onVideoCuepoint:function(e){var t=e.payload,i=t.data;t.name===this.NIELSEN_VIDEO_CUEPOINT_NAME&&i&&"string"==typeof i&&this._notifySDK(this.events.SEND_ID3,i)},_hasAds:function(){var e=this.cviModel.getNumberOfAdPods();return-1===e?2:0===e?0:1},_isDisabled:function(){var e=this.cviModel.contentVideoState.excludeNielsenTracking;return"true"===e||!0===e},_isRcoTypeDai:function(){var t=this.cviModel.cviMgr.RPM.currRP;return!(null==t)&&t.rco.type===e.mediaCapabilities.RP_DAI}});var t=function(){return void 0===window.NOLCMB}}(uvpjs.register("uvpjs")),function(e){var t,i,s,n=e._;e.DWAgent=uvpjs.Class.subClass({debug:"prod"!==uvpjs.Configuration.env,LEGACY_DW_MODULE_NAME:"CNetTracking",DW_MODULE_NAME:"DWTracking",BASE_URL:"//dw.cbsi.com/levt/video/e.gif?",RESUME_BEACON_URL:"//dw.cbsi.com/levt/beacon/e.gif?",events:{INIT:"init",START:"start",END:"end",PLAY:"play",STOP:"stop",FORWARD:"forward",REWIND:"rewind",PAUSE:"pause",UNPAUSE:"unpause",FORCED_END:"forced_end",RESUME:"resume",BEACON:"beacon",PROMPT:"prompt",AD_BLOCK:"beam",AD_STUCK:"adstuck"},init:function(e){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent init"),this.trackingMgr=e.trackingMgr,this.cviModel=e.cviModel,this.eventsMgr=e.eventsMgr,this._moduleName=e.moduleName,this._playerName=e.playerName,this._gestval={},this._pauseStart=0,this._agentStartTime=0,this._onInitDone=!1,this._setStartTagsDone=!1,this._tags=this._getDefaultTagsObj(),this._pageParams=this._getDefaultPageParamsObj(),this.gestureInfoStr="",this.isPluginLoaded=!0},destroy:function(){this.trackingMgr=null,this.cviModel=null,this.eventsMgr=null,this._moduleName=null,this._playerName=null,this._tags=null,this._pageParams=null,this._onInitDone=!1,this._setStartTagsDone=!1,this.isPluginLoaded=!0,this.gestureInfoStr=null},initialize:function(){var e=this._tags.content;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent initialize"),e.componentid=this.trackingMgr.componentid,e.device=this._getDevice(),e.mapp=this._playerName,e.part=this.cviModel.getSessionOption("partner"),e.playertime=0,e.siteid=this.trackingMgr.DEFAULT_SITEID,e.ts=this.eventsMgr.sessionStartTime,this._loadConfigParams(),this._loadDWPageParams(),this._setupEventCallbacks(),this._registerProgressEvents(),this._onInit()},_setCMSDependentValues:function(){var e=this.cviModel,t=e.getSessionOption("cms"),i=e.getContentVideoState(),s=e.getCurrentPlaybackState(),n=uvpjs.mediaCapabilities,a=this._tags.content,r=this._tags.ad,o=this.trackingMgr;r.adastid=t===o.PLATFORM_CMS?"43":"0",(uvpjs.util.isEmpty(a.medastid)||0===a.medastid||"0"===a.medastid)&&(i.isLive?i.isAffiliateFeed?a.medastid="cbsnews"===e.getSessionOption("playerId")?"601":"600":s.isHDStreamLive||n.isChromecast()?a.medastid="601":a.medastid="0":a.medastid=t===o.PLATFORM_CMS?"595":"0",this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _setCMSDependentValues medastid, adastid",a.medastid,r.adastid))},_loadConfigParams:function(){for(var e,t,i,s=this.cviModel.getModuleParam.bind(this.cviModel,this._moduleName),a=["adastid","assetguid","edid","host","medastid","omnicookie","onid","pagetype","ptid","siteid","topic","topicbrcrm","viewguid"],r=a.length;r--;)t=a[r],e=this._getTagType(t),i=s(t),n.isUndefined(e)||n.isEmpty(i)||(this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _loadConfigParams key",t,i),this._tags[e][t]=i);this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _loadConfigParams this._tags updated",this._tags)},_loadDWPageParams:function(){var e,t,i,s=window.DW&&window.DW.pageParams||{};for(e in this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _loadDWPageParams"),s)s.hasOwnProperty(e)&&(i=s[e],n.isEmpty(i)||(this._pageParams[e]=i,t=this._getTagType(e),n.isUndefined(t)||(this._tags[t][e]=i)));this.debug&&(uvpjs.log(this.DEBUG_ID,"DWAgent _loadDWPageParams this._tags updated",this._tags),uvpjs.log(this.DEBUG_ID,"DWAgent _loadDWPageParams this._pageParams updated",this._pageParams))},_setupEventCallbacks:function(){var e=this.eventsMgr.eventTypes,t={};t[e.AD_BLOCKED]=this._onAdBlocked.bind(this),t[e.AD_START]=this._onAdStart.bind(this),t[e.AD_END]=this._onAdEnd.bind(this),t[e.AD_QUARTILE]=this._onAdQuartile.bind(this),t[e.AD_ERROR]=this._onAdError.bind(this),t[e.CONTENT_START]=this._onContentStart.bind(this),t[e.CONTENT_END]=this._onContentEnd.bind(this),t[e.CONTROL_PAUSE]=this._onControlPause.bind(this),t[e.CONTROL_PLAY]=this._onControlPlay.bind(this),t[e.SEEK_DONE]=this._onSeekDone.bind(this),t[e.USER_GESTURE]=this._onUserGesture.bind(this),t[e.VIDEO_PROGRESS]=this._onVideoProgress.bind(this),this.trackingMgr.registerEventCallbacks(t),window&&(window.onbeforeunload=this._onContentStop.bind(this))},_registerProgressEvents:function(){var e=this.trackingMgr.progressEvents,t={};t[e.FIRST_QUARTILE]=this._onProgressEvent.bind(this,e.FIRST_QUARTILE),t[e.MID_QUARTILE]=this._onProgressEvent.bind(this,e.MID_QUARTILE),t[e.THIRD_QUARTILE]=this._onProgressEvent.bind(this,e.THIRD_QUARTILE),t[e.TIMED]=this._onProgressEvent.bind(this,e.TIMED),this.trackingMgr.registerProgressEvents(t)},_sendDWEvent:function(e){var t=this._tags.content,n=t.event,a=n===this.events.BEACON?this.RESUME_BEACON_URL:this.BASE_URL;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _sendDWEvent"),t.gestval=uvpjs.util.isDefinedString(this.gestureInfoStr)?this.gestureInfoStr:s(this._gestval),n!==this.events.INIT&&(t.playertime=this._getPlayerTime()),t.ts=+new Date,a+=i(t),e&&(a+="&"+i(this._tags.ad)),this.trackingMgr.fireTrackingPixel(a),this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _sendDWEvent url = ",a),this._gestval={},t.gestval="",t.eventdur=0,this.gestureInfoStr=""},_onInit:function(){var e=window.location,t=uvpjs.mediaCapabilities,i=t.isMobile()?"mobile%20web":"desktop%20web",s=this.cviModel.getSessionOption("userStatus"),a=this.cviModel.getSessionOption("userId"),r=this._tags.content,o=this._pageParams;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onInit"),this._agentStartTime=new Date,r.event=this.events.INIT,r.mso=this.trackingMgr.mso,r.pageurl=e.href,r.srchost=e.host,r.ursuid=a,r.v16=o.viewguid,r.v17=o.topic,r.v18=o.topicbrcrm,r.v19=o.pagetype,r.v20=o.assetguid,r.v21=t.isChromecast()?"chromecast":i,r.v23=o.rsid,r.v25=n.isEmpty(s)?"anon":s,this._onInitDone=!0,this._sendDWEvent()},_onProgressEvent:function(e){var t=this.trackingMgr.progressEvents,i=this._tags.content,s=this._gestval;if(this._onInitDone&&this._setStartTagsDone){if(this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onProgressEvent progressEvt",e),e)switch(e){case t.FIRST_QUARTILE:s.pct=25;break;case t.MID_QUARTILE:s.pct=50;break;case t.THIRD_QUARTILE:s.pct=75}i.event=this.events.PLAY,this._sendDWEvent(),delete s.pct}},_onAdBlocked:function(e){this._tags.ad;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onAdBlocked",e),this._setCMSDependentValues(),this._setStartTags(e),this._updateTimeTags(),this._tags.content.event=this.events.AD_BLOCK,this._sendDWEvent(!0)},_onAdStart:function(e){var t=this._tags.ad,i=e.payload.adData,s=i.adClipID.split("_");this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onAdStart",e),this._setCMSDependentValues(),this._setStartTags(e),this._updateTimeTags(),t.adid=n.isEmpty(i.adVideoId)?"999":i.adVideoId,t.adnum=this.cviModel.adNum,t.adtime=0,t.adtitle=i.adVideoTitle,t.adtype=i.isLinear?1:2,t.adlength=Math.floor(this.trackingMgr.getAdLength()/1e3),t.adbreak="",t.adpos=s[0],t.adpod=s[1],t.adpodpos=s[2],this._sendDWEvent(!0)},_onAdQuartile:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onAdQuartile",e),this._tags.content.event=this.events.PLAY,this._tags.ad.adtime=this.cviModel.adPlaybackState.currentTime,this._sendDWEvent(!0)},_onAdEnd:function(e){var t=e.payload.adData;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onAdEnd",e),this._tags.content.event=this.events.END,this._tags.ad.adtime=t.duration,this._sendDWEvent(!0)},_onAdError:function(e){var t=e.payload.errorInfo.errorCode;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onAdError",e),t===uvpjs.ErrorInfo.errorCodes.STUCK_AD_ERROR&&(this._tags.content.event=this.events.AD_STUCK,this._sendDWEvent(!0))},_setStartTags:function(e){var t=this.cviModel,i=t.getContentVideoState(),s=this._tags.content,a=this._gestval;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _setStartTags",e),s.event=this.events.START,s.codec=i.fileType,s.distntwrk=t.getSessionOption("netwk"),s.playersz=this._getPlayerSize(),s.sdlvrytype=this._getStreamType(),s.v22=i.cmsRefGuid,s.medid=i.mediaId,s.medlength=this.trackingMgr.getContentLength()/1e3,s.mednum=t.medNum,s.medrls=i.pid,s.medtitle=i.videoTitle,s.contsessid=i.previousSessionId,n.isEmpty(i.contPlayState)||(a.autoplay=i.contPlayState),a.paywall=i.isPaidContent?"1":"0",a.caption_available=i.closedCaptionPath?"1":"0",this._setStartTagsDone=!0},_onContentStart:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onContentStart",e),this._setCMSDependentValues(),this._updateTimeTags(),this._setStartTags(e),this._sendDWEvent()},_onContentEnd:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onContentEnd"),this._tags.content.event=this.events.END,this._sendDWEvent()},_onContentStop:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onContentStop"),this._tags.content.event=this.events.STOP,this._sendDWEvent()},_onControlPause:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onControlPause"),this._tags.content.event=this.events.PAUSE,this._gestval.action="pause",this._pauseStart=(new Date).getTime(),this._sendDWEvent()},_onControlPlay:function(){var e=this._tags.content;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onControlPlay"),!this._onInitDone||!this._setStartTagsDone||this._pauseStart<=0||(e.eventdur=Math.floor(((new Date).getTime()-this._pauseStart)/1e3),e.event=this.events.UNPAUSE,this._gestval.action="resume",this._pauseStart=0,this._sendDWEvent())},_onSeekDone:function(e){var t=e&&e.payload,i=t&&t.seekFromTime,s=t&&t.seekToTime,n=s-i,a=this._tags.content;a.eventdur=Math.floor(Math.abs(n)),a.event=n>0?this.events.FORWARD:this.events.REWIND,this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onSeekDone "+JSON.stringify({seekFromTime:i,seekToTime:s,seekDuration:n,event:a.event,eventdur:a.eventdur},null,2)),this._updateTimeTags(),this._sendDWEvent()},_onVideoProgress:function(){this._updateTimeTags()},_onUserGesture:function(e){var t,i,s,a,r,o,l=this._tags.content,d=this._gestval,u=e.payload.gestureInfo,c=this.cviModel.contentVideoState,h=c.elapsedTime,p="",g=uvpjs.Type.Gesture;if(this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onUserGesture evtObj = ",e),"string"!=typeof u||-1!==u.indexOf("event=")){if(n.isArray(u)){if(u.length<1)return void uvpjs.log(this.DEBUG_ID,"DWAgent _onUserGesture gestureInfo is an empty Array, RETURN.");p=u[0]}if(c=this.cviModel.contentVideoState,"string"==typeof u)r=(a=/event=([^&]*)(?:&gestval=(.*))?/.exec(u))[1],o=a[2],l.event=r,l.medtime=this.cviModel.contentPlaybackState.currentTime,this.gestureInfoStr=void 0===o?"":o;else if(p===g.GLOBAL_RESUME||p===g.LOCAL_RESUME)d.prevcomponentid=c.previousSessionId,d.eventdur=h>0?Math.round(h/1e3):0,d.paywall=c.isPaidContent?"1":"0",l.event=this.events.RESUME,l.medtime=c.resumeContentTime;else if(p===g.CONT_CANCEL)d.action=this.events.PROMPT;else switch(l.medtime=this.cviModel.contentPlaybackState.currentTime,p){case g.RELATED_OVERLAY:l.event=g.RELATED_OVERLAY;break;case g.RELATED_CLICK_GESTURE:u.length>=2&&(d.related_pid=u[1]),l.event=g.RELATED_CLICK_GESTURE;break;case g.SHARE_OVERLAY:l.event=g.SHARE_OVERLAY;break;case g.SHARE_NETWORK_GESTURE:u.length>=2&&(d.network=u[1]),l.event=g.SHARE_NETWORK_GESTURE;break;case g.SEND_GESTURE:u.length>=2&&(i=(t=u[1].split(",")).shift(),s=t.join(","),d.sender=i,d.recipient=s),l.event=g.SEND_GESTURE;break;case g.EMBED_GESTURE:l.event=g.EMBED_GESTURE;break;case g.LINK_GESTURE:l.event=g.LINK_GESTURE;break;case g.REPLAY_GESTURE:l.event=g.REPLAY_GESTURE;break;case g.END_CARD_OVERLAY:l.event=g.END_CARD_OVERLAY;break;case g.ERROR_OVERLAY:l.event=g.ERROR_OVERLAY;break;case g.RECOMMEND_NOW:u.length>=3?(d.mediaid=u[1],d.pid=u[2]):(d.mediaid="",d.pid=""),l.event=g.RECOMMEND_NOW;break;case g.RECOMMEND_NEXT:u.length>=3?(d.mediaid=u[1],d.pid=u[2]):(d.mediaid="",d.pid=""),l.event=g.RECOMMEND_NEXT;break;case g.RECOMMEND_CLOSE:l.event=g.RECOMMEND_CLOSE;break;default:return void uvpjs.warn(this.DEBUG_ID,"DWAgent _onUserGesture untrapped GESTURE Type = ",p)}this.debug&&(uvpjs.log(this.DEBUG_ID,"DWAgent _onUserGesture ctag = ",l),uvpjs.log(this.DEBUG_ID,"DWAgent _onUserGesture gval = ",d)),this._sendDWEvent()}else uvpjs.log(this.DEBUG_ID,"DWAgent _onUserGesture gestureInfo is a String and missing event=, RETURN.")},_updateTimeTags:function(){this._tags.content.medtime=this.trackingMgr.getContentPlayhead()},_getTagType:function(e){return n.has(this._tags.ad,e)?"ad":n.has(this._tags.content,e)?"content":void 0},_getStreamType:function(){var e=this.cviModel.getContentVideoState(),t=uvpjs.mediaCapabilities,i=e.deliveryType,s=e.isLive;return i===t.STREAMING?s?5:4:i===t.PROGRESSIVE?3:void 0},_getPlayerTime:function(){var e=this._agentStartTime,t=n.isDate(e)&&parseInt((new Date-e)/1e3)||0;return this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _getPlayerTime nt",t),t},_getDefaultTagsObj:function(){return{ad:{adastid:0,adbreak:"",adid:0,adlength:0,adnum:0,adpod:0,adpodpos:0,adpos:"",adtime:0,adtitle:"",adtype:0},content:{bitrate:0,blockcntry:"",codec:"",componentid:"",contsessid:"",device:"",distntwrk:"",encodeprfl:"",event:"",eventdur:0,gestval:"",ip:"",mapp:"",medastid:0,medid:0,medlength:0,mednum:0,medrls:"",medtime:0,medtitle:"",medtype:0,mso:"",pageurl:"",part:"",playerembed:0,playersz:"",playertime:0,qosnum:0,recommend:"",relsessid:"",sdlvrytype:"",siteid:0,sponsored:"",srchost:"",subj:"",ts:"",ua:"",ursuid:0,usrbndwdth:0,v16:"",v17:"",v18:"",v19:"",v20:"",v21:"",v22:"",v23:"",v25:"",v26:"",videosz:"",volume:0}}},_getDefaultPageParamsObj:function(){return{asid:0,astid:0,cid:0,edid:0,onid:0,pguid:"",pid:0,ptid:0,siteid:0,testgroup:"",testname:"",testversion:"",ursuid:0,assetguid:0,omnicookie:"",pagetype:"",rsid:0,topicbrcrm:"",topicguid:"",viewguid:0}},_getDevice:function(){var e=uvpjs.mediaCapabilities,t=window.screen,i={type:(e.getDevice()||"").toLowerCase(),os:(e.getOS()||"").toLowerCase(),ver:e.getOSVersion(),screensz:[t.width,t.height].join("x")};return s(i)},_getPlayerSize:function(){var e=this.cviModel.getContentVideoState();return[e.sourceWidth,e.sourceHeight].join("x")}}),t=function(e,t,i){var s,a,r=[];for(s in e)e.hasOwnProperty(s)&&(a=n.isUndefined(e[s])?"":encodeURIComponent(e[s]),r.push([s,a].join(t)));return r.join(i)},i=function(e){return t(e,"=","&")},s=function(e){return t(e,":",";")}}(uvpjs.register("uvpjs")),function(e){var t;e._,e.AkamaiAnalyticsAgent=uvpjs.Class.subClass({debug:"prod"!==uvpjs.Configuration.env,CONFIG_FILE_PATH:"//ma61-r.analytics.edgekey.net/config/beacon-16339.xml?enableGenericAPI=1",AKAMAI_ANALYTICS_MODULE_NAME:"AkamaiQOSPluginJS",init:function(e){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent init"),this.trackingMgr=e.trackingMgr,this.cviModel=e.cviModel,this.eventsMgr=e.eventsMgr,this._moduleName=e.moduleName,this.buffering=!1,this.akamaiPlugin=null},destroy:function(){this.trackingMgr=null,this.eventsMgr=null,this.cviModel=null,this._moduleName=null,this.buffering=!1,this.akamaiPlugin=null},initialize:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent initialize"),this.buffering=!1,this._initializePlugin()},_setupEventCallbacks:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _setupEventCallbacks");var e=this.eventsMgr.eventTypes,t={};t[e.CONTENT_DATA_LOADED]=this._onContentDataLoaded.bind(this),t[e.AD_START]=this._onAdStart.bind(this),t[e.AD_END]=this._onAdEnd.bind(this),t[e.CONTENT_START]=this._onContentStart.bind(this),t[e.AD_QUARTILE]=this._onAdQuartile.bind(this),t[e.CONTENT_END]=this._onContentEnd.bind(this),t[e.CONTROL_PLAY]=this._onControlPlay.bind(this),t[e.CONTROL_PAUSE]=this._onControlPause.bind(this),t[e.VIDEO_STATE_CHANGE]=this._onVideoStateChange.bind(this),t[e.RESOURCE_END]=this._onResourceEnd.bind(this),t[e.QOS_METADATA]=this._onQosMetadata.bind(this),this.trackingMgr.registerEventCallbacks(t)},_initializePlugin:function(){var e={};this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _initializePlugin loadPlugin callback"),t()?this.debug&&uvpjs.warn(this.DEBUG_ID,"AkamaiAnalyticsAgent SDK not properly loaded."):(e.configPath=this.cviModel.getModuleParam(this._moduleName,"configpath")||this.CONFIG_FILE_PATH,e.streamHeadPosition=this.getStreamHeadPosition.bind(this),e.streamLength=this.getStreamLength.bind(this),e.streamURL=this.getStreamURL.bind(this),this.akamaiPlugin=new AkaHTML5MediaAnalytics(e),this._setupEventCallbacks())},setAdMetaData:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent setAdMetaData");var e=this.cviModel.adVideoState,t={};t.adTitle=e.adVideoTitle,t.adDuration=e.duration,t.id=e.adVideoId,t.adPartnerId=this.cviModel.sessionOptions.partner,t.adServer=e.adServerName,this.akamaiPlugin.handleAdLoaded(t)},setContentMetaData:function(){var e=this.cviModel,t=e.sessionOptions,i=this.akamaiPlugin,s=e.getContentVideoState(),n=e.getContentPlaybackState();this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent setContentMetaData"),i.setData("viewerId",e.getModuleParam(this._moduleName,"viewerID")),i.setData("partnerId",t.partner),i.setData("playerId",this.trackingMgr.getPlayerName("|")),i.setData("Host",t.host),i.setData("Referrer",t.referrer),i.setData("title",s.title),i.setData("category",s.category),i.setData("subCategory",s.sourceOwner),i.setData("show",s.title),i.setData("contentLength",1e3*n.duration)},getStreamHeadPosition:function(){return this.cviModel.contentPlaybackState.currentTime},getStreamLength:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent getStreamLength this.cviModel.contentPlaybackState.duration ",this.cviModel.contentPlaybackState.duration),this.cviModel.contentPlaybackState.duration},getStreamURL:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent getStreamURL this.cviModel.contentVideoState.assetURL ",this.cviModel.contentVideoState.assetURL),this.cviModel.contentVideoState.assetURL},_onContentDataLoaded:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onContentDataLoaded evtObj = ",e),this.akamaiPlugin&&(this.akamaiPlugin.handleSessionInit(),this.setContentMetaData())},_onAdStart:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onAdStart"),this.akamaiPlugin&&(this.setAdMetaData(),this.akamaiPlugin.handlePlaying(),this.akamaiPlugin.handleAdStarted())},_onAdQuartile:function(e){if(this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onAdQuartile this.akamaiPlugin.handleAdFirstQuartile() evtObj.payload ",e.payload),this.akamaiPlugin&&e.payload)switch(e.payload.percent){case 25:this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent this.akamaiPlugin.handleAdFirstQuartile()"),this.akamaiPlugin.handleAdFirstQuartile();break;case 50:this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent this.akamaiPlugin.handleAdMidPoint()"),this.akamaiPlugin.handleAdMidPoint();break;case 75:this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent this.akamaiPlugin.handleAdThirdQuartile()"),this.akamaiPlugin.handleAdThirdQuartile()}},_onAdEnd:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onAdEnd this.akamaiPlugin.handleAdCompleted()  this.akamaiPlugin.handleAdStopped();"),this.akamaiPlugin&&(this.akamaiPlugin.handleAdCompleted(),this.akamaiPlugin.handleAdStopped())},_onAdError:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onAdError this.akamaiPlugin.handleAdError() this.akamaiPlugin.handleAdStopped();"),this.akamaiPlugin&&(this.akamaiPlugin.handleAdError(),this.akamaiPlugin.handleAdStopped())},_onContentStart:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onContentStart"),this.akamaiPlugin&&this.akamaiPlugin.handlePlaying()},_onContentEnd:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onContentEnd")},_onControlPlay:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onControlPlay this.akamaiPlugin.handleResume()"),this.akamaiPlugin&&this.akamaiPlugin.handleResume()},_onControlPause:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onControlPause  this.akamaiPlugin.handlePause()"),this.akamaiPlugin&&this.akamaiPlugin.handlePause()},_onVideoStateChange:function(e){if(this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onVideoStateChange evtObj = ",e),this.akamaiPlugin){var t=e.payload.newState;t!==uvpjs.mediaCapabilities.BUFFERING||this.buffering||(this.buffering=!0,this.akamaiPlugin.handleBufferStart()),t===uvpjs.mediaCapabilities.PLAYING&&this.buffering&&(this.buffering=!1,this.akamaiPlugin.handleBufferEnd())}},_onResourceEnd:function(e){if(this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onResourceEnd evtObj = ",e),this.akamaiPlugin){this.akamaiPlugin.handlePlayEnd("Play.End.Detected")}},_onQosMetadata:function(e){var t,i;if(this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onQosMetadata evtObj = ",e),this.akamaiPlugin&&-1!==e.payload.vendorArray.indexOf(uvpjs.Type.QOSVendor.AKAMAI))for(t in i=e.payload.paramsObj)this.akamaiPlugin.setData(t,i[t])}}),t=function(){return"undefined"==typeof AkaHTML5MediaAnalytics}}(uvpjs.register("uvpjs")),function(e){"use strict";var t=e._;e.MuxAgent=uvpjs.Class.subClass({MUX_AD_EVENTS:{AD_BREAK_START:"adbreakstart",AD_BREAK_END:"adbreakend",AD_PLAY:"adplay",AD_PLAYING:"adplaying",AD_PAUSE:"adpause",AD_ENDED:"adended",AD_ERROR:"aderror",AD_REQUEST:"adrequest",AD_RESPONSE:"adresponse",AD_FIRST_QUARTILE:"adfirstquartile",AD_MIDPOINT:"admidpoint",AD_THIRD_QUARTILE:"adthirdquartile"},MUX_EVENTS:{PAUSE:"pause",PLAY:"play",PLAYING:"playing"},MUX_DEFAULT_PROPERTY_KEY:"ec83cce4c209447a2af3d62f2",init:function(e){this.cviModel=e.cviModel,this.debug=this._isDebugEnabled(),this.DEBUG_ID=uvpjs.DebugManager.configParams.MUX_DEBUG,this.debug&&uvpjs.log(this.DEBUG_ID,"MuxAgent: construct",e),this.trackingMgr=e.trackingMgr,this.eventTypes=e.eventsMgr&&e.eventsMgr.eventTypes||null,this.moduleName=e.moduleName,this.playerName=e.playerName,this.playerVersion=e.playerVersion,this.useDefaultProperty=e.useDefaultProperty,this.moduleParams=null,this.vidContId=this.trackingMgr.vidContId,this.videoElement=null,this.muxMonitor=null,this.muxHLSJSMonitoring=!1,this.muxDashJSMonitoring=!1,this.muxShakaMonitoring=!1,this.mc=uvpjs.mediaCapabilities},destroy:function(){this.muxMonitor&&(this.muxHLSJSMonitoring?(this.muxHLSJSMonitoring=!1,this.muxMonitor.removeHLSJS()):this.muxDashJSMonitoring?(this.muxDashJSMonitoring=!1,this.muxMonitor.removeDashJS()):this.muxShakaMonitoring,this.muxMonitor.destroy()),this.trackingMgr=null,this.cviModel=null,this.eventTypes=null,this.moduleParams=null},initialize:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"MuxAgent initialize()"),this.moduleParams=this._gatherModuleParams(this.moduleName),this._initializePlugin()},_isDebugEnabled:function(){if(!this.cviModel)return uvpjs.debug;var e=this._gatherModuleParams(uvpjs.DebugManager.CONFIG_MODULE_NAME);return!!e&&!0===e[uvpjs.DebugManager.configParams.MUX_DEBUG]},_initializePlugin:function(){console.log("[MUX] _initializePlugin"),void 0!==window.mux?this.cviModel&&this._setupEventCallbacks():this.debug&&uvpjs.warn(this.DEBUG_ID,"MuxAgent _initializePlugin Mux SDK not properly loaded.")},_createMuxMonitor:function(){this.videoElement=document.getElementById("video_"+this.vidContId);var e=this.cviModel,i=this.moduleParams,s=t.assign({page_type:"",viewer_user_id:e.getSessionOption("userId"),experiment_name:i&&!uvpjs.util.isEmpty(i.experimentName)?i.experimentName:"",sub_property_id:!1!==this.useDefaultProperty||uvpjs.util.isEmpty(i.subPropertyId)?e.getSessionOption("partner"):i.subPropertyId,player_name:this.playerName,player_version:this.playerVersion,player_init_time:e.initTime},this._getMuxVideoData());return this.useDefaultProperty?s.property_key=this.MUX_DEFAULT_PROPERTY_KEY:s.property_key=i.propertyKey,window.mux.monitor(this.videoElement,{debug:this.debug,data:s}),this.videoElement.mux},_getMuxVideoData:function(){var e=this.cviModel.contentVideoState;return{video_id:this._validateStr(e.cmsRefGuid,""),video_title:this._validateStr(e.videoTitle,""),video_series:this._validateStr(e.seriesTitle,""),video_producer:"",video_content_type:e.episodeFlag?"episode":"clip",video_language_code:"",video_variant_name:"",video_variant_id:"",video_duration:e.duration,video_stream_type:e.isLive?"live":"on-demand",video_encoding_variant:"",video_cdn:this._validateStr(e.cdn,""),video_source_url:this._validateStr(e.assetURL,"")}},_emitMuxVideoChange:function(){window.mux.emit(this.videoElement,"videochange",this._getMuxVideoData())},_isValidStr:function(e){return uvpjs.util.isDefinedString(e)},_validateStr:function(e,t){return this._isValidStr(e)?e:t},_onContentEvent:function(e){e.type===this.eventTypes.CONTENT_DATA_LOADED&&(null===this.muxMonitor?(this.muxMonitor=this._createMuxMonitor(),null!==this.muxMonitor&&this.debug&&uvpjs.log(this.DEBUG_ID,"MuxAgent: created Mux monitor.")):this._emitMuxVideoChange())},_onPlaybackLibraryLoaded:function(e){if(this.muxMonitor)switch(e.payload.facadeType){case this.mc.HLSJS:this.muxHLSJSMonitoring||(this.muxHLSJSMonitoring=!0,this.muxMonitor.addHLSJS({hlsjs:e.payload.player,Hls:window.Hls}));break;case this.mc.DASHJS:this.muxDashJSMonitoring||(this.muxDashJSMonitoring=!0,this.muxMonitor.addDashJS({dashjs:e.payload.player}));break;case this.mc.SHAKA:this.muxShakaMonitoring}},_onError:function(e){var t=e.payload.errorInfo;t&&t.isFatal&&(null===this.muxMonitor&&(this.muxMonitor=this._createMuxMonitor()),window.mux.emit(this.videoElement,"error",{player_error_code:t.errorCode,player_error_message:t.message}))},_gatherModuleParams:function(e){var t,i=this.cviModel.getModule(e).params,s={};if(!i)return null;for(var n=i.length;n--;)s[(t=i[n]).name]=t.value;return s},_setupEventCallbacks:function(){var e=this.eventTypes,t={},i=this._onContentEvent.bind(this),s=this._onPlaybackLibraryLoaded.bind(this),n=this._onError.bind(this),a=this._onAdEvent.bind(this);t[e.CONTENT_DATA_LOADED]=i,t[e.PLAYBACK_LIBRARY_LOADED]=s,t[e.PLAYER_START_ERROR]=n,t[e.VIDEO_START_ERROR]=n,t[e.VIDEO_PLAYBACK_ERROR]=n,t[e.AD_ERROR]=n,t[e.AD_PLUGIN_CONTENT_PAUSE_REQUEST]=a,t[e.AD_PLUGIN_CONTENT_RESUME_REQUEST]=a,t[e.AD_LOADED]=a,t[e.AD_START]=a,t[e.VIDEO_STATE_CHANGE]=a,t[e.AD_SKIPPED]=a,t[e.AD_END]=a,t[e.AD_ERROR]=a,t[e.AD_REQUEST]=a,t[e.AD_RESPONSE]=a,t[e.AD_QUARTILE]=a,this.trackingMgr.registerEventCallbacks(t)},_getMuxAdData:function(e){var t=e.payload.adData?e.payload.adData.adAssetUrl:e.payload.adAssetUrl;return{ad_tag_url:e.payload.adCallUrl,ad_asset_url:t}},_dispatchMuxAdEvent:function(e,t){e&&(null===this.muxMonitor&&(this.muxMonitor=this._createMuxMonitor()),t||(t={ad_tag_url:"",ad_asset_url:""}),t.ad_tag_url||(t.ad_tag_url=""),t.ad_asset_url||(t.ad_asset_url=""),window.mux.emit(this.videoElement,e,t))},_dispatchMuxEvent:function(e){window.mux.emit(this.videoElement,e)},_onAdEvent:function(e){var t=this.eventTypes,i=this.MUX_AD_EVENTS,s=this.MUX_EVENTS;switch(e.type){case t.AD_PLUGIN_CONTENT_PAUSE_REQUEST:this.cviModel.contentPlaybackState.playbackState===uvpjs.mediaCapabilities.PLAYING&&this._dispatchMuxEvent(s.PAUSE),this._dispatchMuxAdEvent(i.AD_BREAK_START);break;case t.AD_PLUGIN_CONTENT_RESUME_REQUEST:this._dispatchMuxAdEvent(i.AD_BREAK_END),this.cviModel.contentPlaybackState.playbackState===uvpjs.mediaCapabilities.PLAYING&&(this._dispatchMuxEvent(s.PLAY),this._dispatchMuxEvent(s.PLAYING));break;case t.AD_LOADED:this._dispatchMuxAdEvent(i.AD_PLAY,this._getMuxAdData(e));break;case t.AD_START:this._dispatchMuxAdEvent(i.AD_PLAYING,this._getMuxAdData(e));break;case t.VIDEO_STATE_CHANGE:if(!e.payload.isAd)return;var n=e.payload.newState,a=e.payload.currentState;n===this.mc.PAUSED?this._dispatchMuxAdEvent(i.AD_PAUSE,this._getMuxAdData(e)):a==this.mc.PAUSED&&n===this.mc.PLAYING&&(this._dispatchMuxAdEvent(i.AD_PLAY,this._getMuxAdData(e)),this._dispatchMuxAdEvent(i.AD_PLAYING,this._getMuxAdData(e)));break;case t.AD_SKIPPED:case t.AD_END:this._dispatchMuxAdEvent(i.AD_ENDED,this._getMuxAdData(e));break;case t.AD_ERROR:this._dispatchMuxAdEvent(i.AD_ERROR,this._getMuxAdData(e));break;case t.AD_REQUEST:this._dispatchMuxAdEvent(i.AD_REQUEST,this._getMuxAdData(e));break;case t.AD_RESPONSE:this._dispatchMuxAdEvent(i.AD_RESPONSE,this._getMuxAdData(e));break;case t.AD_QUARTILE:switch(e.payload.percent){case 25:this._dispatchMuxAdEvent(i.AD_FIRST_QUARTILE,this._getMuxAdData(e));break;case 50:this._dispatchMuxAdEvent(i.AD_MIDPOINT,this._getMuxAdData(e));break;case 75:this._dispatchMuxAdEvent(i.AD_THIRD_QUARTILE,this._getMuxAdData(e))}}}})}(uvpjs.register("uvpjs")),uvpjs.register("uvpjs").OzTamAgent=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.TRACKING_MANAGER,debug:"prod"!==uvpjs.Configuration.env,options:null,ozTamService:null,ozTamVo:null,mediaInfo:null,isStopped:!1,resumeTime:-1,init:function(e){this.options=e,this.ozTamVo=new uvpjs.OzTamVo(this);var t=this.ozTamVo.getConfig();this.ozTamService=new OzTAMService(t.publisherId,t.vendorVersion,t.productionMode,t.verboseLogging,t.useHTTPS),this.debug&&uvpjs.log(this.DEBUG_ID,"ozTamService",t,this.ozTamService)},initialize:function(){var e=this.options.eventsMgr.eventTypes,t=this.onVideoEvent.bind(this),i={};i[e.RESOURCE_START]=t,i[e.CONTENT_START]=t,i[e.CONTROL_SEEK]=t,i[e.SEEK_DONE]=t,i[e.CONTENT_END]=t,i[e.VIDEO_STATE_CHANGE]=t,i[e.VIDEO_PROGRESS]=t,i[e.USER_GESTURE]=t,this.options.trackingMgr.registerEventCallbacks(i)},onVideoEvent:function(e){var t=this.options.eventsMgr.eventTypes;if(this.ozTamVo.isOzTamOptOut())this.debug&&uvpjs.log(this.DEBUG_ID,"ozTamService Opt-out");else switch(e.type){case t.RESOURCE_START:this.onResourceStart(e);break;case t.CONTENT_START:this.onContentStart(e);break;case t.CONTROL_SEEK:this.onSeekStart(e);break;case t.SEEK_DONE:this.onSeekDone(e);break;case t.CONTENT_END:this.onContentEnd(e);break;case t.VIDEO_STATE_CHANGE:this.onVideoStateChange(e);break;case t.VIDEO_PROGRESS:this.onVideoProgress(e);break;case t.USER_GESTURE:this.onUserGesture(e)}},onResourceStart:function(e){this.mediaInfo=this.ozTamVo.getMediaInfo(),this.debug&&uvpjs.log(this.DEBUG_ID,"ozTamService.startSession",this.mediaInfo),this.ozTamService.startSession(this.mediaInfo.mediaId,this.mediaInfo.url,this.mediaInfo.mediaDuration,this.mediaInfo.mediaType)},onContentStart:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"ozTamService.beginPlayback"),this.mediaInfo.properties=this.ozTamVo.getPropertyDictionary(),this.ozTamService.beginPlayback(this.mediaInfo.mediaId,this.mediaInfo.url,this.mediaInfo.mediaDuration,this.mediaInfo.mediaPositionFunction,this.mediaInfo.properties,this.mediaInfo.mediaType)},onSeekStart:function(e){this.ozTamService.seekBegin()},onSeekDone:function(e){this.ozTamService.seekComplete(),this.isStopped=!0},onContentEnd:function(e){this.ozTamService.complete()},onVideoStateChange:function(e){if(this.options.cviModel.getCurrentPlaybackState().playbackStarted)switch(e.payload.newState){case uvpjs.mediaCapabilities.PAUSED:case uvpjs.mediaCapabilities.BUFFERING:this.isStopped||(this.isStopped=!0,this.ozTamService.haltProgress())}},onVideoProgress:function(e){this.isStopped&&(this.isStopped=!1,this.ozTamService.resumeProgress())},onUserGesture:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"startTime",e.payload.startTime),e.payload.startTime>0&&(this.resumeTime=e.payload.startTime)},destroy:function(){this.ozTamVo.destroy(),this.DEBUG_ID=null,this.options=null,this.ozTamService=null,this.ozTamVo=null,this.mediaInfo=null}}),uvpjs.register("uvpjs").DatazoomAgent=uvpjs.TrackingAgent.subClass({metadata:{},init:function(e){this._super(e),this.vo=new uvpjs.DatazoomVo(this),this.sdkEvent=this.vo.Event,this.metadata={},(new uvpjs.CodeLoader).loadScript(this.vo.sdkUrl,this.onSdkReady.bind(this))},onSdkReady:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"DatazoomAgent SDK Ready"),this.hasSdk="function"==typeof window.setDatazoomMetadata},sendTrackEvent:function(e,t){if(this.hasSdk){for(var i in this.debug&&uvpjs.log(this.DEBUG_ID,"DatazoomAgent "+e),t=t||{})this.metadata[i]=t[i];switch(e){case"content_start":window.setDatazoomMetadata(this.format(this.metadata));break;case"cdn_updated":window.generateDatazoomEvent("CDNChange",this.format(t));break;case"content_complete":this.metadata={}}}},format:function(e){var t=[];for(var i in e)if(e.hasOwnProperty(i)&&e[i]&&"object"!=typeof e[i]){var s={};s[i]=e[i],t.push(s)}return this.debug&&uvpjs.log(this.DEBUG_ID,"DatazoomAgent",t),t}}),uvpjs.register("uvpjs").DataModelVo=uvpjs.Class.subClass({agent:null,channelName:null,apiKey:null,contentInfo:{},getApiKey:function(){return this.apiKey},getPersistentData:function(e){var t=this.agent.options.cviModel,i=t&&t.getContentVideoState(),s=this.agent.contextMetadata;for(var n in(e=e||{}).sessionId=t&&t.sessionId,e.contentAssetId=i&&(i.cmsRefGuid||i.mediaId)||"",e.playheadTime=e.playheadTime||this.getPlayhead(),e.playerTime=this.getPlayerElapsedTime(),s)s.hasOwnProperty(n)&&(e[n]=s[n]);return e},getSessionStartInfo:function(){var e=this.agent.options.cviModel,t=e.getContentVideoState(),i=t.duration,s=e.contentPlaybackState.facadeState,n=t.isLive?-1:isNaN(i)?0:i,a=this.getDrmInfo(t.drm);return this.getPersistentData({adAssetId:e.adVideoState.adClipID,adPodId:e.adVideoState.adVideoId||e.adVideoState.adVatId,adType:e.adVideoState.adType,allowConcurrentPlayback:e.sessionOptions.allowConcurrentPlayback,bitrate:s.currentBitrate,channel:this.channelName,cdn:t.cdn,cms:e.sessionOptions.cms,currentIndex:1,"drm.dash.playreadyURL":a.playreadyURL,"drm.dash.widevineURL":a.widevineURL,"drm.enabled":a.enabled,"drm.fairplay.appCertURL":a.appCertURL,"drm.ticket":a.ticket,drmType:this.agent.options.trackingMgr.mc.getDrmType(t.drm),enableMutedAutoplay:e.sessionOptions.enableMutedAutoplay,enableNativeMobileAutoplay:e.sessionOptions.enableNativeMobileAutoplay,enableReplay:e.sessionOptions.enableReplay,enableUnmutedAutoplay:e.sessionOptions.enableUnmutedAutoplay,framerate:s.playbackFramerate,fullScreen:e.isFullscreen,isAutoplay:e.isAutoplay,isMultiCDN:e.cviMgr.RPM.currRP.facade.multiCDNEnabled,isMuteAtPlayStart:e.isMuteAtPlayStart,isMuted:t.isMuted,isSslRequired:window.location.href.search(/^https/)>-1,length:n,livestream:t.isLive,liveSyncDurationCount:e.sessionOptions.liveSyncDurationCount,maxBitrate:e.maxBitrate,method:"",minBitrate:e.minBitrate,pageProvidesTealium:e.sessionOptions.usesTealium,pagetype:e.dwPageParams.pagetype,partner:e.sessionOptions.partner,pguid:e.dwPageParams.pguid,playerName:this.agent.options.playerName,quality:"",sound:e.volume,startTime:t.startTime,streamType:t.isLive?"Live":"VOD",title:t.videoTitle,totalLength:n,usesIMA:e.sessionOptions.usesIMA,userConnectionType:e.sessionOptions.userConnectionType,userCountry:e.sessionOptions.userCountry,userIsp:e.sessionOptions.userISP,userPpid:e.sessionOptions.userPPID,userStatus:e.sessionOptions.userStatus,videoPlayer:this.agent.options.playerName})},getContentStartInfo:function(){var e=this.agent.options.cviModel,t=e.getContentVideoState(),i=t.duration,s=e.contentPlaybackState.facadeState,n=t.isLive?-1:isNaN(i)?0:i;return this.contentInfo={assetUrl:t.assetURL,assetId:t.cmsRefGuid||t.mediaId,category:t.category,channel:this.channelName,chapterStartTimes:t.chapterStartTimes.join(","),closedCaptionPath:t.closedCaptionPath,cms:e.sessionOptions.cms,cmsRefGuid:t.cmsRefGuid,dfpMediaId:t.dfpMediaId,duration:n,episodeAbstract:t.episodeAbstract,episodeFlag:t.episodeFlag,episode:t.episodeNumber,excludeNielsenTracking:t.excludeNielsenTracking,fileType:t.fileType,genre:t.category,indexPosition:e.contentPlaybackState.currentContentSegment,is360:t.is360,isAffiliateFeed:t.isAffiliateFeed,isEmbedable:t.isEmbedable,isPaidContent:t.isPaidContent,mediaId:t.mediaId,overrideAssetURL:t.overrideAssetURL,program:t.videoTitle.split("-")[0],pguid:e.dwPageParams.pguid,playbackBitrate:s.currentBitrate,playheadTime:this.getContentStartPlayhead(),season:t.seasonNumber,seriesTitle:t.seriesTitle,showPreroll:t.showPreroll,startTime:t.startTime,useWatermark:t.useWatermark,title:t.videoTitle,totalLength:n},this.getPersistentData(this.contentInfo)},getContentCompleteInfo:function(){var e=this.agent.options.cviModel;return this.contentInfo.playbackBitrate=e.contentPlaybackState.facadeState.currentBitrate,this.getPersistentData(this.contentInfo)},getQuartileInfo:function(){return this.agent.options.cviModel.getContentVideoState(),this.getPersistentData()},getQosInfo:function(){var e=this.agent.options.cviModel,t=e.contentPlaybackState,i=e.contentPlaybackState.facadeState;return this.getPersistentData({averageDroppedFPS:t.averageDroppedFPS,bufferLength:t.bufferLength,currentContentSegment:t.currentContentSegment,currentMaxBandwidth:t.currentMaxBandwidth,currentTime:this.getPlayhead(),currentBitrate:i.currentBitrate,droppedFPS:i.droppedFPS,droppedFrames:i.droppedFrames,playbackFramerate:i.playbackFramerate})},getAdBreakInfo:function(){var e=this.agent.options.cviModel,t=e.adVideoState,i=t.adClipID.split("_"),s=1;return"post"===t.adType?s=e.getNumberOfAdPods():"mid"===t.adType&&(s=parseInt(i[1])+1),this.getPersistentData({indexPosition:s,startTime:this.getPlayhead(),title:t.adVideoTitle})},getAdItemInfo:function(){var e=this.agent.options.cviModel.adVideoState;return this.getPersistentData({adCallUrl:e.assetURL||e.adAssetUrl||e.adVideoUrl,adParams:e.adParameters,assetId:e.adVideoId||e.adVatId,indexPosition:e.adPosition,isCustomClickTrackingUsed:e.isCustomClickTrackingUsed,title:e.adVideoTitle,totalLength:e.duration})},getSeekInfo:function(){return this.getPersistentData({seekPosition:this.getPlayhead()})},getPlayhead:function(){return Math.floor(this.agent.options.cviModel.getCurrentPlaybackState().currentTime)},getContentStartPlayhead:function(){var e=this.getPlayhead();return this.agent.options.resumeTime&&this.agent.options.resumeTime>0&&(e=this.agent.options.resumeTime,this.agent.options.resumeTime=-1),e},getPlayerElapsedTime:function(){return parseInt((new Date-this.agent.initTime)/1e3)},getDrmInfo:function(e){return{playreadyURL:e.dash&&e.dash.playreadyURL?e.dash.playreadyURL:"",widevineURL:e.dash&&e.dash.widevineURL?e.dash.widevineURL:"",appCertURL:e.fairplay&&e.fairplay.appCertURL?e.fairplay.appCertURL:"",enabled:e.enabled||!1,ticket:e.ticket||""}},isCompletedMarker:function(){var e=this.agent.options.cviModel.getContentVideoState();return!e.isLive&&this.getPlayhead()>=.95*e.duration},destroy:function(){this.Event=null,this.agent=null,this.channelName=null,this.apiKey=null}}),uvpjs.register("uvpjs").DatazoomVo=uvpjs.DataModelVo.subClass({Event:{SESSION_START:"session_start",CONTENT_START:"content_start",CONTENT_COMPLETE:"content_complete",CDN_UPDATED:"cdn_updated",PAUSE:"pause",STOP:"stop",BUFFER_START:"buffer_start",BUFFER_COMPLETE:"buffer_complete",SEEK_START:"seek_start",SEEK_COMPLETE:"seek_complete",PLAY_RESUME:"resume",SESSION_END:"session_end",AD_BREAK_START:"ad_break_start",AD_BREAK_COMPLETE:"ad_break_end",AD_START:"ad_start",AD_COMPLETE:"ad_end",AD_CLICK:"ad_click",QOS:"qos",FIRST_QUARTILE:"first_quartile",MID_QUARTILE:"mid_quartile",THIRD_QUARTILE:"third_quartile"},sdkUrl:"//platform.datazoom.io/beacon/v1/config?configuration_id=",init:function(e){this.agent=e;var t=this.agent.options;this.getModuleParam=t.cviModel.getModuleParam.bind(t.cviModel,t.trackingMgr.DATAZOOM_MODULE_NAME),this.sdkUrl+=this.getModuleParam("configId")}}),uvpjs.register("uvpjs").OzTamVo=uvpjs.Class.subClass({agent:null,init:function(e){this.agent=e;var t=this.agent.options;this.getModuleParam=t.cviModel.getModuleParam.bind(t.cviModel,t.trackingMgr.OZTAM_MODULE_NAME)},getConfig:function(){return{publisherId:this.getModuleParam("publisherId"),vendorVersion:this.getVendorVersion(),productionMode:!this.agent.debug,verboseLogging:this.agent.debug,useHTTPS:top.location.href.search(/^https/)>-1}},getVendorVersion:function(){return[this.getModuleParam("platform"),uvpjs.mediaCapabilities.isMobile()?"Mobile-Web":"Desktop-Web",this.agent.options.playerVersion].join("_")},getMediaInfo:function(){var e=this.agent.options.cviModel,t=e.getContentVideoState(),i=t.duration,s=function(){var t=e.getCurrentPlaybackState().currentTime;return this.agent.resumeTime>0&&(t=this.agent.resumeTime,this.agent.resumeTime=-1),t}.bind(this);return{mediaId:t.ozTamMediaId||t.cmsRefGuid||t.mediaId,url:t.assetURL,mediaDuration:t.isLive?-1:isNaN(i)?0:i,mediaType:t.isLive?"live":"vod",mediaPositionFunction:function(){return s()}}},getPropertyDictionary:function(){var e=this.agent.options.cviModel,t=e.getContentVideoState(),i=e.getSessionOption("userId"),s=this.agent.ozTamService,n={};return t.ozTamMediaId&&(n[s.PROP_ALT_MEDIA_ID]=t.cmsRefGuid||t.mediaId),i&&(n[s.PROP_DEMO1]=i),n},isOzTamOptOut:function(){var e=this.agent.options.cviModel.getContentVideoState();return e.hasOwnProperty("ozTamOptOut")&&e.ozTamOptOut},getValue:function(e){return e.toString().replace(/^\s|\s$/gm,"")||""},destroy:function(){this.agent=null}}),function(e){var t={prodUrl:"//sparrow.cbs.com",stageUrl:"//stage-sparrow.cbs.com",path:"/streamer/v1.0/ingest/beacon.json"},i=!1,s=null,n=null,a=function(e){return(e=e.replace(/\s/g,"")).search(/^\/\//)>-1?e:"//"+e};e.BeaconBuilder=uvpjs.Class.subClass({concurrencyBeacon:function(e){return n=t,e&&e.prodUrl&&e.stageUrl&&(n.prodUrl=a(e.prodUrl),n.stageUrl=a(e.stageUrl)),this},queryParams:function(t){return s=e.util.queryStrFromObj(t,!1),this},devMode:function(e){return i=e,this},buildUrl:function(){return null===n?"Unable to build url.":(i?n.stageUrl:n.prodUrl)+n.path+(null===s?"":"?"+s)}})}(uvpjs.register("uvpjs")),function(e){var t=e._;e.FairPlayDRM=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.FAIRPLAY_DRM,DRM_VENDORS:{IRDETO:"irdeto",DRMTODAY:"drmtoday"},KEY_SYSTEMS:{FPS_1_0:"com.apple.fps.1_0"},init:function(e){this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"FairPlayDRM Init"),this.drm=e.drm,this.videoTagRef=e.videoTagRef,this.eventTypes=e.eventTypes,this.errorCallback=e.errorCallback,this.drmVendor=null,this.appCertData=null,this.appCertLoaded=!1,this.webKitNeedKeyCalled=!1,this.initData=null,this.loadAppCert(),this.addEvents()},destroy:function(){this.removeEvents(),this.drm=null,this.videoTagRef=null,this.eventTypes=null,this.errorCallback=null,this.appCertData=null,this.initData=null},addEvents:function(){this.onWebKitNeedKeyBound=this.onWebKitNeedKey.bind(this),this.videoTagRef.addEventListener(this.eventTypes.HTML5.WEBKIT_NEED_KEY,this.onWebKitNeedKeyBound,!1)},removeEvents:function(){this.videoTagRef.removeEventListener(this.eventTypes.HTML5.WEBKIT_NEED_KEY,this.onWebKitNeedKeyBound,!1),this.onWebKitNeedKeyBound=null},initializeFairPlayCDM:function(){var e=this.getLicenseServerUrl(this.initData),t=this.getId(e);if(this.drmVendor=this.getDRMVendor(e),t){if(!this.videoTagRef.webkitKeys){var i=this.KEY_SYSTEMS.FPS_1_0;if(!WebKitMediaKeys.isTypeSupported(i,"video/mp4"))return void this.onError(uvpjs.ErrorInfo.messages.FAIRPLAY_KEYSYSTEM_NOT_SUPPORTED,null);this.videoTagRef.webkitSetMediaKeys(new WebKitMediaKeys(i))}if(this.videoTagRef.webkitKeys){var s=this.concatInitDataIdAndCertificate(this.initData,t,this.appCertData),n=this.videoTagRef.webkitKeys.createSession("video/mp4",s);n?(n.contentId=t,n.addEventListener("webkitkeymessage",this.onLicenseRequestReady.bind(this,e),!1),n.addEventListener("webkitkeyadded",this.onKeyAdded.bind(this),!1),n.addEventListener("webkitkeyerror",this.onError.bind(this,uvpjs.ErrorInfo.messages.FAIRPLAY_KEY_ERROR),!1)):this.onError(uvpjs.ErrorInfo.messages.FAIRPLAY_CREATE_SESSION,null)}else this.onError(uvpjs.ErrorInfo.messages.FAIRPLAY_CREATE_MEDIAKEYS,null)}else this.onError(uvpjs.ErrorInfo.messages.FAIRPLAY_NO_CONTENTID,null)},loadAppCert:function(){t.isEmpty(this.drm.fairplay.appCertURL)||(new uvpjs.CodeLoader).loadArrayBuffer(this.drm.fairplay.appCertURL,this.onAppCertLoaded.bind(this),this.onError.bind(this,uvpjs.ErrorInfo.messages.FAIRPLAY_APP_CERT_LOAD))},onAppCertLoaded:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"FairPlayDRM Application certificate has loaded successfully!",e),this.appCertData=new Uint8Array(e.response),this.appCertLoaded=!0,this.webKitNeedKeyCalled&&this.initializeFairPlayCDM()},onWebKitNeedKey:function(e){this.webKitNeedKeyCalled=!0,this.initData=e.initData,this.appCertLoaded&&this.initializeFairPlayCDM()},concatInitDataIdAndCertificate:function(e,t,i){"string"==typeof t&&(t=this.stringToArray(t));var s=0,n=new ArrayBuffer(e.byteLength+4+t.byteLength+4+i.byteLength),a=new DataView(n);new Uint8Array(n,s,e.byteLength).set(e),s+=e.byteLength,a.setUint32(s,t.byteLength,!0),s+=4;var r=new Uint8Array(n,s,t.byteLength);return r.set(t),s+=r.byteLength,a.setUint32(s,i.byteLength,!0),s+=4,new Uint8Array(n,s,i.byteLength).set(i),new Uint8Array(n,0,n.byteLength)},onLicenseRequestReady:function(e,t){this.debug&&uvpjs.log(this.DEBUG_ID,"FairPlayDRM ready to load license request - url: "+e,t);var i=new XMLHttpRequest;i.session=t.target,i.addEventListener("load",this.onLicenseRequestLoaded.bind(this),!1),i.addEventListener("error",this.onError.bind(this,uvpjs.ErrorInfo.messages.FAIRPLAY_LIC_REQUEST),!1),i.open("POST",e,!0),this.drmVendor===this.DRM_VENDORS.IRDETO?i.responseType="arraybuffer":this.drmVendor===this.DRM_VENDORS.DRMTODAY&&(i.responseType="text");var s="spc="+encodeURIComponent(this.base64EncodeUint8Array(t.message))+"&"+i.session.contentId;(i=this.setRequestHeaders(i)).send(s)},onLicenseRequestLoaded:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"FairPlayDRM license request has loaded!",e);var i=e.target,s=i.session,n=null;t.inRange(i.status,200,400)||this.onError(uvpjs.ErrorInfo.messages.FAIRPLAY_LIC_RESPONSE_CODE,e),this.drmVendor===this.DRM_VENDORS.DRMTODAY?n=this.base64DecodeUint8Array(i.responseText):this.drmVendor===this.DRM_VENDORS.IRDETO&&(n=new Uint8Array(i.response)),s.update(n)},onError:function(e,t){this.debug&&uvpjs.error(this.DEBUG_ID,e,t),this.errorCallback&&this.errorCallback(uvpjs.ErrorInfo.errorCodes.FAIRPLAY_LIC_ERROR,e)},onKeyAdded:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"FairPlayDRM key was added successfully!",e)},getLicenseServerUrl:function(e){var i=null;t.isEmpty(this.drm.fairplay.licenseURL)?i="https://"+String.fromCharCode.apply(null,new Uint16Array(e.buffer)).split("://")[1]:i=this.drm.fairplay.licenseURL;return this.appendDRMQueryParams(i)},appendDRMQueryParams:function(e){var t=-1===e.indexOf("?")?"?":"&";return this.drm.sessionId&&(e+=t+"SessionId="+this.drm.sessionId),this.drm.ticket&&(e+="&Ticket="+this.drm.ticket),e},getDRMVendor:function(e){var t=null;return-1!==e.indexOf(this.DRM_VENDORS.DRMTODAY)?t=this.DRM_VENDORS.DRMTODAY:-1!==e.indexOf(this.DRM_VENDORS.IRDETO)&&(t=this.DRM_VENDORS.IRDETO),t},setRequestHeaders:function(e){if(e.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),!t.isEmpty(this.drm.fairplay.header)){var i=this.drm.fairplay.header;for(var s in i)e.setRequestHeader(s,i[s])}return e},getId:function(e){var t=uvpjs.util.objFromQueryStr(e);return t.ContentId||t.contentId||t.assetId||null},base64EncodeUint8Array:function(e){var t=String.fromCharCode.apply(null,e);return btoa(t)},base64DecodeUint8Array:function(e){var t=window.atob(e),s=t.length,n=new Uint8Array(new ArrayBuffer(s));for(i=0;i<s;i++)n[i]=t.charCodeAt(i);return n},stringToArray:function(e){for(var t=new ArrayBuffer(2*e.length),i=new Uint16Array(t),s=0,n=e.length;s<n;s++)i[s]=e.charCodeAt(s);return i}})}(uvpjs.register("uvpjs"))}(),define("libs/cbsi-player/uvpjs-3.0.0",function(){}),function(e){if(!e.fn.dotdotdot){e.fn.dotdotdot=function(i){if(0==this.length)return i&&!1===i.debug||function(e,t){if(!e)return!1;t="string"==typeof t?"dotdotdot: "+t:["dotdotdot:",t];void 0!==window.console&&void 0!==window.console.log&&window.console.log(t)}(!0,'No element found for "'+this.selector+'".'),this;if(this.length>1)return this.each(function(){e(this).dotdotdot(i)});var s=this;s.data("dotdotdot")&&s.trigger("destroy.dot"),s.data("dotdotdot-style",s.attr("style")),s.css("word-wrap","break-word"),"nowrap"===s.css("white-space")&&s.css("white-space","normal"),s.bind_events=function(){return s.bind("update.dot",function(t,i){t.preventDefault(),t.stopPropagation(),l.maxHeight="number"==typeof l.height?l.height:function(e){for(var t=e.innerHeight(),i=["paddingTop","paddingBottom"],s=0,n=i.length;s<n;s++){var a=parseInt(e.css(i[s]),10);isNaN(a)&&(a=0),t-=a}return t}(s),l.maxHeight+=l.tolerance,void 0!==i&&(("string"==typeof i||i instanceof HTMLElement)&&(i=e("<div />").append(i).contents()),i instanceof e&&(r=i)),(h=s.wrapInner('<div class="dotdotdot" />').children()).empty().append(r.clone(!0)).css({height:"auto",width:"auto",border:"none",padding:0,margin:0});var o=!1,u=!1;return d.afterElement&&(o=d.afterElement.clone(!0),d.afterElement.remove()),a(h,l)&&(u="children"==l.wrap?function(e,t,i){var s=e.children(),n=!1;e.empty();for(var r=0,o=s.length;r<o;r++){var l=s.eq(r);if(e.append(l),i&&e.append(i),a(e,t)){l.remove(),n=!0;break}i&&i.detach()}return n}(h,l,o):function t(i,s,r,o,l){var d=i.contents(),u=!1;i.empty();for(var c=0,h=d.length;c<h&&!u;c++){var p=d[c],g=e(p);void 0!==p&&(i.append(g),l&&i[i.is("table, thead, tbody, tfoot, tr, col, colgroup, object, embed, param, ol, ul, dl, blockquote, select, optgroup, option, textarea, script, style")?"after":"append"](l),3==p.nodeType?a(r,o)&&(u=n(g,s,r,o,l)):u=t(g,s,r,o,l),u||l&&l.detach())}return u}(h,s,h,l,o)),h.replaceWith(h.contents()),h=null,e.isFunction(l.callback)&&l.callback.call(s[0],u,r),d.isTruncated=u,u}).bind("isTruncated.dot",function(e,t){return e.preventDefault(),e.stopPropagation(),"function"==typeof t&&t.call(s[0],d.isTruncated),d.isTruncated}).bind("originalContent.dot",function(e,t){return e.preventDefault(),e.stopPropagation(),"function"==typeof t&&t.call(s[0],r),r}).bind("destroy.dot",function(e){e.preventDefault(),e.stopPropagation(),s.unwatch().unbind_events().empty().append(r).attr("style",s.data("dotdotdot-style")).data("dotdotdot",!1)}),s},s.unbind_events=function(){return s.unbind(".dot"),s},s.watch=function(){if(s.unwatch(),"window"==l.watch){var t=e(window),i=t.width(),n=t.height();t.bind("resize.dot"+d.dotId,function(){i==t.width()&&n==t.height()&&l.windowResizeFix||(i=t.width(),n=t.height(),c&&clearInterval(c),c=setTimeout(function(){s.trigger("update.dot")},10))})}else u=o(s),c=setInterval(function(){var e=o(s);u.width==e.width&&u.height==e.height||(s.trigger("update.dot"),u=o(s))},100);return s},s.unwatch=function(){return e(window).unbind("resize.dot"+d.dotId),c&&clearInterval(c),s};var r=s.contents(),l=e.extend(!0,{},e.fn.dotdotdot.defaults,i),d={},u={},c=null,h=null;return l.lastCharacter.remove instanceof Array||(l.lastCharacter.remove=e.fn.dotdotdot.defaultArrays.lastCharacter.remove),l.lastCharacter.noEllipsis instanceof Array||(l.lastCharacter.noEllipsis=e.fn.dotdotdot.defaultArrays.lastCharacter.noEllipsis),d.afterElement=function(t,i){if(void 0===t)return!1;if(!t)return!1;if("string"==typeof t)return!!(t=e(t,i)).length&&t;if("object"==typeof t)return void 0!==t.jquery&&t;return!1}(l.after,s),d.isTruncated=!1,d.dotId=t++,s.data("dotdotdot",!0).bind_events().trigger("update.dot"),l.watch&&s.watch(),s},e.fn.dotdotdot.defaults={ellipsis:"... ",wrap:"word",fallbackToLetter:!0,lastCharacter:{},tolerance:0,callback:null,after:null,height:null,watch:!1,windowResizeFix:!0,debug:!1},e.fn.dotdotdot.defaultArrays={lastCharacter:{remove:[" ","　",",",";",".","!","?"],noEllipsis:[]}};var t=1,i=e.fn.html;e.fn.html=function(e){return void 0!==e?this.data("dotdotdot")&&"function"!=typeof e?this.trigger("update",[e]):i.call(this,e):i.call(this)};var s=e.fn.text;e.fn.text=function(t){if(void 0!==t){if(this.data("dotdotdot")){var i=e("<div />");return i.text(t),t=i.html(),i.remove(),this.trigger("update",[t])}return s.call(this,t)}return s.call(this)}}function n(e,t,i,s,o){var u=!1;if(void 0===(y=e[0]))return!1;for(var c=-1!==(S=d(y)).indexOf(" ")?" ":"　",h="letter"==s.wrap?"":c,p=S.split(h),g=-1,f=-1,v=0,m=p.length-1;v<=m&&(0!=v||0!=m);){var _=Math.floor((v+m)/2);if(_==f)break;f=_,l(y,p.slice(0,f+1).join(h)+s.ellipsis),a(i,s)?m=f:(g=f,v=f),m==v&&0==m&&s.fallbackToLetter&&(h="",g=-1,f=-1,v=0,m=(p=p[0].split(h)).length-1)}if(-1==g||1==p.length&&0==p[0].length){var E=e.parent();e.remove();var A=o?o.length:0;if(E.contents().size()>A){u=n(E.contents().eq(-1-A),t,i,s,o)}else{var y,S,b=E.prev();if(void 0!==(y=b.contents().eq(-1)[0]))l(y,S=r(d(y),s)),o&&b.append(o),E.remove(),u=!0}}else u=!0,l(y,S=r(p.slice(0,g+1).join(h),s));return u}function a(e,t){return e.innerHeight()>t.maxHeight}function r(t,i){for(;e.inArray(t.slice(-1),i.lastCharacter.remove)>-1;)t=t.slice(0,-1);return e.inArray(t.slice(-1),i.lastCharacter.noEllipsis)<0&&(t+=i.ellipsis),t}function o(e){return{width:e.innerWidth(),height:e.innerHeight()}}function l(e,t){e.innerText?e.innerText=t:e.nodeValue?e.nodeValue=t:e.textContent&&(e.textContent=t)}function d(e){return e.innerText?e.innerText:e.nodeValue?e.nodeValue:e.textContent?e.textContent:""}}(jQuery),define("libs/jquery/dotdotdot-1.6.1",function(){}),define("quantum/videoPlayer",["jquery","version!fly/managers/debug","managers/client-storage","translations/video","version!fly/managers/components","utils/cookie","managers/device","managers/edition","managers/events","version!fly/managers/history","managers/page-vars","managers/recommendation","managers/global-functions","managers/tealium","managers/mpulse","version!fly/utils/url-helper","utils/targeting-helper","managers/waypoints","version!fly/components/base","version!libs/cbsi-player/uvpjs","version!libs/waypoints/inview","version!libs/jquery/dotdotdot"],function(e,t,i,s,n,a,r,o,l,d,u,c,h,p,g,f,v,m){var _="videoPlayer";t=t.init(_),m.init();var E={cnetvideocreate:0,playerloaded:0,showplayoverlay:0,adstart:0,adend:0,contentstart:0},A=0,y=new window.uvpjs.VideoManager;e.widget("cnet.videoPlayer",e.fly.base,{options:{apeList:!1,autoplay:!1,classActive:"active",classCaptions:"captions",classCaptionsMissing:"captionsMissing",classDisabled:"disabled",classHidden:"hidden",classNoAutoplay:"pausedAtStartup",classPlaybackStarted:"playbackStarted",classPlaying:"playing",config:null,contentType:"vod-curated",customCSS:null,enableHistoryUpdates:!1,eventChannels:null,eventSubscriptions:null,getPlaylistSelector:null,getRelatedPlaylist:!1,getRecommendedPlaylist:!1,getShortcodeVideo:!1,idPrefix:"videoPlayer",loaderSelector:"#related-area",loop:!0,mainPlayer:!1,mutedVideoCountThreshold:10,playlist:[],preventCaptions:null,resizePlayer:!0,scrollIntoView:!1,selectorScrollingAutoplayDisabled:".inviewElement.exited",showAsModal:!1,showPreviewMetadata:!1,suppressAds:!1,suppressFirstAd:!0,tagTopicPlaylistRoute:"",titleTagPostText:"",upNextTriggerTime:30,uvpPartner:"cnet",videoShortcodeSelector:".video.shortcode"},adPodStartTimestamp:0,autoplayState:null,chapters:null,contentStartTimeStamp:null,contentVideoState:-2,errorDetails:{MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError"},haveFirstGesture:!1,id:null,initialized:!1,interrupted:!1,isAd:!1,isAmp:!1,isPlaying:!1,history:null,closePlayerRequested:!1,pauseRequested:!1,outOfViewPaused:!0,player:null,playlist:[],playlistPaused:!1,scrollingAutoplayWaypoint:null,startingNewPlaylist:!1,timelineRequests:null,suppressAds:!1,systemInfoObject:{},testGroup:null,testName:null,testVideoUrl:"data:video/mp4;base64,AAAAIGZ0eXBpc29tAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAAAuhtZGF0AUAigKN4SIUtLS0tLS0tLS0tLS0tLS0tLS0tLS0vAAACsAYF//+s3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0OCByMjc5NSBhYWE5YWE4IC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNyAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTE2IGRlYmxvY2s9MTowOjAgYW5hbHlzZT0weDM6MHgxMzMgbWU9dW1oIHN1Ym1lPTEwIHBzeT0xIHBzeV9yZD0xLjAwOjAuMDAgbWl4ZWRfcmVmPTEgbWVfcmFuZ2U9MjQgY2hyb21hX21lPTEgdHJlbGxpcz0yIDh4OGRjdD0xIGNxbT0wIGRlYWR6b25lPTIxLDExIGZhc3RfcHNraXA9MSBjaHJvbWFfcXBfb2Zmc2V0PS0yIHRocmVhZHM9MSBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTggYl9weXJhbWlkPTIgYl9hZGFwdD0yIGJfYmlhcz0wIGRpcmVjdD0zIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MiBrZXlpbnQ9MjUwIGtleWludF9taW49MjUgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD02MCByYz1jcmYgbWJ0cmVlPTEgY3JmPTUxLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IGlwX3JhdGlvPTEuNDAgYXE9MToxLjAwAIAAAAAKZYiBAAn/Ix39GwAABOltb292AAAAbG12aGQAAAAAAAAAAAAAAAAAAAPoAAAALwABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAACL3RyYWsAAABcdGtoZAAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAIgAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAA445AAIAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAACIAAAAAAAEAAAAAAadtZGlhAAAAIG1kaGQAAAAAAAAAAAAAAAAAAC7UAAABkBXHAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAFSbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAABEnN0YmwAAACuc3RzZAAAAAAAAAABAAAAnmF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAgACAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAA4YXZjQwFkAAr/4QAeZ2QACqxyBF+IiP/ABAACRAAAAwGQAABdqDxIlhGAAQAHaOhDgZSyLAAAABBwYXNwAAAAEAAAAAkAAAAYc3R0cwAAAAAAAAABAAAAAQAAAZAAAAAcc3RzYwAAAAAAAAABAAAAAQAAAAEAAAABAAAAFHN0c3oAAAAAAAACwgAAAAEAAAAUc3RjbwAAAAAAAAABAAAATgAAAeR0cmFrAAAAXHRraGQAAAADAAAAAAAAAAAAAAACAAAAAAAAAC8AAAAAAAAAAAAAAAEBAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAkZWR0cwAAABxlbHN0AAAAAAAAAAEAAAAAAAAEAAABAAAAAAFcbWRpYQAAACBtZGhkAAAAAAAAAAAAAAAAAABWIgAABAAVxwAAAAAALWhkbHIAAAAAAAAAAHNvdW4AAAAAAAAAAAAAAABTb3VuZEhhbmRsZXIAAAABB21pbmYAAAAQc21oZAAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAAy3N0YmwAAABnc3RzZAAAAAAAAAABAAAAV21wNGEAAAAAAAAAAQAAAAAAAAAAAAIAEAAAAABWIgAAAAAAM2VzZHMAAAAAA4CAgCIAAgAEgICAFEAVAAAAAAAULwAAFC8FgICAAhOIBoCAgAECAAAAGHN0dHMAAAAAAAAAAQAAAAEAAAQAAAAAHHN0c2MAAAAAAAAAAQAAAAEAAAABAAAAAQAAABRzdHN6AAAAAAAAAB4AAAABAAAAFHN0Y28AAAAAAAAAAQAAADAAAABidWR0YQAAAFptZXRhAAAAAAAAACFoZGxyAAAAAAAAAABtZGlyYXBwbAAAAAAAAAAAAAAAAC1pbHN0AAAAJal0b28AAAAdZGF0YQAAAAEAAAAATGF2ZjU3LjcxLjEwMA==",uvpPayload:{},video:null,watchedVideoCount:0,initialPlay:!0,autoplayScrollDisabled:!1,uvpEvents:{adError:function(e){this._trackEvent("logError","trackVideoAdError",e),this.suppressAds?t.error("UVPJS encountered a potentially fatal ad creative exception:",e):t.info("Ad failed to load because ads are being suppressed.",e)},controlMute:function(e){this._trackEvent("trackClick","mute",{})},controlUnmute:function(e){this.$element.find("[data-overlay=mute]").addClass("hide"),this.$element.removeClass(this.options.classCaptions+" "+this.options.classCaptionsMissing),setTimeout(function(){this.$element.find("[data-overlay=mute]").removeClass("visible")}.bind(this),2e3),this._trackEvent("trackClick","unmute",{})},firstGesture:function(e){if(!this.haveFirstGesture){this.haveFirstGesture=!0;var i=this,s=this.$element.find("#content_"+this.id+" video")[0];if(this.playlistPaused&&s){s.src=i.testVideoUrl;var n=s.play();n?n.then(function(){t.log("Promise fulfilled..."),i.player.getPlayerMuted()&&i.unmute(),i._resumePlaylist()}).catch(function(e){t.error("Promise not met...",e)}):t.log("no Promise")}else i.player.getPlayerMuted()&&(i.unmute(),i.$element.removeClass(i.options.classCaptions+" "+i.options.classCaptionsMissing))}},onAdBlocked:function(e){this._trackEvent("logError","trackVideoAdBlocked",e),this.suppressAds?t.error("UVPJS encountered a potentially fatal ad creative blockage:",e):t.info("Ad failed to load because ads are being suppressed.",e)},onAdEnd:function(e){this.isAd=!1,this._trackPerformanceEvent("adend")},onAdPodStart:function(e){this.adPodStartTimestamp=Date.now()},onAdStart:function(e){this.isAd=!0,this.options.eventChannels&&l.publish(this.options.eventChannels,"onAdStart"),setTimeout(function(){this.options.eventChannels&&l.publish(this.options.eventChannels,"onDelayedAdStart")}.bind(this),250),this._trackPerformanceEvent("adstart");var t=Date.now()-this.adPodStartTimestamp;t=t<1001?"0 - 1000 ms":t<1501?"1001 - 1500 ms":t<2001?"1501 - 2000 ms":t<2501?"2001 - 2500 ms":t<3001?"2501 - 3000 ms":"3001 and more",this._setAspectRatio(!0)},onCaptionsReady:function(e){this.$element.find("[data-control=captions]").removeClass(this.options.classDisabled)},onCaptionsUnavailable:function(e){t.warn("Unable to fetch captions."),this._trackEvent("logError","trackVideoCaptionsUnavailable",e)},onContentEnd:function(e){this._trackPerformanceEvent("contentend"),this.watchedVideoCount++,this.$element.find(".chapters").empty(),this.$element.find("[data-control=captions]").addClass(this.options.classDisabled),0===Math.floor(this.player.getCurrentPlaybackState().duration-this.player.getCurrentPlaybackState().currentTime)&&c.onVideoComplete()},onContentStart:function(e){this.options.eventChannels&&l.publish(this.options.eventChannels,"onContentStart"),this.contentStartTimeStamp=(new Date).getTime(),this._trackPerformanceEvent("contentstart"),this._showChapterStarts(),this._setAspectRatio()},onResourceEnd:function(e){if(this.player.getPlayerMuted()&&!this.haveFirstGesture)this.watchedVideoCount===this.options.mutedVideoCountThreshold&&this._pausePlaylist();else if(0===e.payload.playlistLength&&this.options.loop&&!this.startingNewPlaylist){var t=this.playlist[this.playlist.length-1];e.payload.rco&&e.payload.rco.cmsRefGuid===t.id&&(this.playlist=this.options.playlist,this._setPlaylist(this.playlist))}},onResourceStart:function(t){if(this.uvpPayload=t.payload,this.$element.find("[data-video-still]").addClass(this.options.classHidden),this.startingNewPlaylist=!1,this.video=this._getVideoFromPlaylist(t.payload.rco.index)||t.payload.rco,this.options.getRelatedPlaylist&&this._getRelatedPlaylist(),this._setPageContextMetadata(),this.player.getPlayerMuted()&&this.$element.find("[data-overlay=mute]").addClass("visible").addClass("muted"),this.chapters={},this.video.chapters&&this.video.chapters.data)for(var i=0;i<this.video.chapters.data.length;i++)this.chapters["time"+this.video.chapters.data[i].time]=e.extend(!0,{hasSeen:!1},this.video.chapters.data[i]);if(this.options.apeList){var s=a.read("apeList"),n=s?s.split(","):[];n.indexOf(this.video.id)<0&&(n.unshift(this.video.id),a.write("apeList",n.slice(0,10),{expires:1}))}this._showVideoInfo(),this._showCloseButton(),this.options.enableHistoryUpdates&&(this.updateHistory(),-1===document.title.indexOf(this.video.title)&&""!==this.options.titleTagPostText&&(document.title=this.video.title+this.options.titleTagPostText))},onStateChange:function(e){switch(this.contentVideoState=e.payload.isAd?-2:e.payload.newState,e.payload.newState){case 0:t.info("onStateChange: stop"),this.isPlaying=!1,this.$element.removeClass(this.options.classPlaying),this._setEmbeddedVideoState(!1);break;case 1:t.info("onStateChange: play"),this.isPlaying=!0,this.$element.addClass(this.options.classPlaying),(this.pauseRequested||!this._isInView()&&"scroll"===this.options.autoplay&&!this.$element.hasClass(this.options.classPlaybackStarted))&&this.pause(),this.$element.addClass(this.options.classPlaybackStarted),this._setEmbeddedVideoState(!0),this.closePlayerRequested&&(this.pause(),this._closePlayerComplete()),"none"===this.$element.css("display")&&this.pause(),this.options.eventChannels&&!this.pauseRequested&&l.publish(this.options.eventChannels,"playVideo"),this.pauseRequested=!1,this.initialPlay=!1;break;case 2:t.info("onStateChange: pause"),this.closePlayerRequested&&this._closePlayerComplete(),this.isPlaying=!1,this.outOfViewPaused=!1,this.$element.removeClass(this.options.classPlaying),this._setEmbeddedVideoState(!1)}},onVideoProgress:function(t){var i=this;if(!t.payload.isAd){i.uvpPayload=t.payload;var n=t.payload.currentTime,a=t.payload.duration,o="time"+Math.round(n);if(this.chapters[o]&&!this.chapters[o].hasSeen){this.chapters[o].hasSeen=!0;var l=this.$element.find("#"+o);l.addClass("highlight"),setTimeout(function(){l.removeClass("highlight")}.bind(this),3e3),this.$element.trigger("timelineEvent",this.chapters[o])}var d=i.$element.parent().find("[data-video-info=upnext]");if(Math.floor(a-n)<=i.options.upNextTriggerTime&&d.hasClass(i.options.classHidden)&&!d.hasClass(i.options.classDisabled)&&r.isDesktopUserAgent()){var u=this._getNextVideo(this.video.id);u.title&&this.playlist.length>1&&(d.html("<div class='slate'><div><b>"+s.upnext+":</b> "+u.title+"</div><button class='closeButton' data-item='closeButton' aria-label='Close player'><svg class='close'><use xlink:href='#close'></use></svg></button></div>"),d.off("click."+_),d.on("click."+_,".slate",function(t){e(this).addClass(i.options.classHidden),i._trackEvent("trackClick","video-nudge-click",t),i.player.advancePlayList()}),d.on("click."+_,"[data-item=closeButton]",function(e){e.stopPropagation(),d.addClass(i.options.classHidden),d.addClass(i.options.classDisabled)}),setTimeout(function(){d.removeClass(i.options.classHidden),d.dotdotdot({watch:"window"}),d.css("background-image","url("+u.thumbnail+")")},100))}}},playerStartError:function(e){t.error("UVPJS encountered a fatal exception starting the player: ",e),this._trackEvent("logError","trackPlayerStartError",e)},videoPlaybackError:function(i){(t.error("UVPJS encountered a fatal exception while playing the video: ",i),i.payload&&i.payload.errorInfo)&&((i.payload.errorInfo.message||"").indexOf(this.errorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR)>-1&&(e("[data-video-info]").empty(),this.player.destroyPlaylist()));this._trackEvent("logError","trackVideoPlaybackError",i)},videoStartError:function(e){e&&e.payload&&e.payload.errorInfo&&1001===e.payload.errorInfo.errorCode&&!this.suppressAds?(t.warn("IMA failed to load; attempting to play video without ads due to UVPJS exception:",e),this._trackEvent("logError","trackVideoStartImaError",e)):(t.error("UVPJS encountered a fatal error starting the video: ",e),this._trackEvent("logError","trackVideoStartError",e))}},_create:function(){var i=this;this._setup(),h.gdprConsentCallback("video_player",function(){i.isAmp=-1!==window.location.hash.indexOf("amp=1")||-1!==window.location.hash.indexOf("ampreview=1")||-1!==window.location.hash.indexOf("ampvideo=1");var s=!1;try{var n=i.options.playlist[0];s=n.liveState&&n.m3u8.indexOf("dai.google.com")>-1}catch(e){}require(["comscore-video","optional!"+(window.CnetPageVars.services.googleima&&window.CnetPageVars.services.googleima.enabled?"google-ima":"feature-disabled"),"optional!"+(i.isAmp?"video-iframe-integration":"feature-disabled"),"optional!"+(s&&(window.CnetPageVars.services.googleima||window.CnetPageVars.services.googleima.enabled)?"google-ima-dai":"feature-disabled")],function(){var s=window.uvpjs.mediaCapabilities;if(!(s.canPlayType("video/mp4")||s.canPlayNativeHLS()||s.canPlayHLSJS()))return t.error("This device is unable to play supported video types."),i.$element.addClass(i.options.classPlaybackStarted),void i._showCloseButton();if(i.testGroup=u.tracking.data.testGroup,i.testName=u.tracking.data.testName,i.options.eventSubscriptions&&l.subscribe(i,i.options.eventSubscriptions),A++,i.id=i.options.idPrefix+A,i.$element.attr("id",i.id),i.options.apeList&&i._setupApeList(),i.options.getShortcodeVideo){var n=[];e(i.options.videoShortcodeSelector).each(function(){n.push(e(this).data("videoPlaylist")[0])});var a=[];e.each(i.options.playlist,function(t){var s=!0;e.each(n,function(){i.options.playlist[t].id===this.id&&(s=!1)}),s&&a.push(i.options.playlist[t])}),i.options.playlist=n.concat(a),i.options.getRelatedPlaylist&&(i.playlist=i.options.playlist,i._getRelatedPlaylist())}if(e.each(i.options.playlist,function(e){i.options.playlist[e].index=e}),i.options.getPlaylistSelector&&i._getExternalPlaylist(),e(window).on("appendPlaylist",function(e,t){i.appendPlaylist(t.data)}),window.CnetPageVars.services.one_trust&&window.CnetPageVars.services.one_trust.enabled)window.cbsoptanon.onScriptsReady(function(e){e.ot.awaitInitialConsent(function(){e.ot.getState(function(e,t,s,n){var a={targeting:e,performance:t,functional:s,social:n},r=i._getUvpConfigs(a);i._initializeUvp(r)})})});else{var r=i._getUvpConfigs();i._initializeUvp(r)}})},{},"targeting")},_destroy:function(){this.$document.off("."+_),this.$element.off("."+_),this.$element.find("[data-control=share]").off("."+_),this.$element.find("[data-control=playlist]").off("."+_),y.destroyVideoPlayer(this.id),this.$element.removeAttr("id").html(""),e("[data-load-video]").removeClass(this.options.classPlaying)},_closeOverlays:function(e,t){e.find("[data-item=close]").off("."+_),e.removeClass(this.options.classActive).html(""),t&&(this.interrupted=!1,this.play())},closePlayer:function(){if(this.player){var e=this.player.getCurrentPlaybackState().playbackState,t=window.uvpjs.mediaCapabilities;e!==t.PAUSED&&(this.closePlayerRequested=!0),e!==t.EMPTY&&this.pause(),this.$element.closest('[data-video-player="container"]').length>0?this.$element.closest('[data-video-player="container"]').addClass(this.options.classHidden):this.$element.addClass(this.options.classHidden),this.$window.trigger("closePlayer")}},_closePlayerComplete:function(){this.closePlayerRequested=!1},_formatTime:function(e){e=isNaN(parseInt(e))?0:e;var t=new Date(null);return t.setSeconds(e),t.toISOString().substr(14,5)},_getRecommendedVideos:function(){var i=this,s=u.tracking.data.contentId,n=("roadshow"===u.tracking.data.brand?"/roadshow":"")+"/videos/video-recs/"+s+"/xhr/";t.log("video recs request",n),e.ajax({dataType:"json",type:"GET",url:n}).done(function(s){s&&s.length>0?(t.log("video recs response",s),i.options.getShortcodeVideo&&e.each(i.options.playlist,function(t){e.each(s,function(e){i.options.playlist[t].id===this.id&&s.splice(e,1)})}),i.playlist=i.options.playlist.concat(s),e.each(i.playlist,function(e){i.playlist[e].index=e}),t.log("video recs new playlist",i.playlist),i.options.playlist=i.playlist,i.$element.on("onVideoPlayerReady",function(){i.$element.find('[data-video-info="title"]').text(i.playlist[0].title),i.$element.find(".uvpjs__time-duration").text(i._formatTime(i.playlist[0].duration))})):(t.log("video recs - none available",s),i.playlist=i.options.playlist,i.options.getShortcodeVideo&&(i.options.getRelatedPlaylist=!0))}).fail(function(e,i,s){t.log("video recs failed to load",e,i,s)}).always(function(){t.log("video recs complete"),i.autoPlayState||1!=i.options.scrollIntoView?i._setupPlayer():i._setupScrollingVideoPlayer()})},_getAdUrl:function(t,i){var s=u.ads.data.gpt.targeting,n="sz={param:sz}&iu=/8264/{param:region}-cnet/{param:device}/{param:partner}&ciu_szs={param:ciu_szs}&impl=s&gdfp_req=1&env=vp&output={param:output}&unviewed_position_start=1&url={param:referrer_url}&description_url={param:referrer_url}&correlator={param:timestamp}&cmsid=2289&vid={param:mpxRefId}&pp={param:pp}&cust_params=",a="vid={param:mpxRefId}&ptype={param:ptype}&contentType={param:contentType}&vguid={param:vguid}&partner={param:partner_cust}&session={param:session}&subses={param:sub_session}&microsite={param:microsite}&campaign={param:campaign}&cid={param:cid}&collection={param:collection}&mfr={param:mfr}&carrier={param:carrier}&section={param:section}&userGroup={param:userGroup}&tag={param:tag}&edition={param:edition}&test={param:test}&score={param:score}&subcollection={param:subcollection}&topic={param:topic}&sectopic={param:sectopic}&pid={param:pid}&pv={param:pv}&show={param:show}&feat={param:feat}",o=r.isMobileUserAgent()||r.isIPhone()||r.isIPad(),l="cnet",d="";"es"===u.tracking.data.siteEdition?l="es-cnet":"roadshow"===u.tracking.data.brand&&(l="roadshow"),o&&(l+="_mobile"),this.isAmp&&(d="amp");var c={};try{c=JSON.parse(e.cookie("cnet_ad"))||{}}catch(e){}var h={sz:this.autoplayState&&this.player.getPlayerMuted()&&0===i?"640x483":"640x480",device:o?"mobile_web":"desktop",partner:l,partner_cust:d,ciu_szs:"300x60",output:r.isDesktopUserAgent()?"xml_vmap1":"xml_vast2",microsite:"string"==typeof s.microsite?s.microsite:"",campaign:"",referrer_url:location.protocol+"//"+location.host+location.pathname,timestamp:(new Date).getTime(),ptype:"string"==typeof s.ptype?s.ptype:u.tracking.data.pageType,contentType:s.contentType,vguid:u.guid,session:c.session,sub_session:c.subses||c.subSession,cid:s.cid,collection:s.collection,subcollection:s.subcollection,mfr:s.mfr,carrier:s.carrier,section:s.section,userGroup:v.getAdUserGroups(),tag:s.tag,edition:s.edition,region:{au:"vau",uk:"vuk"}[c.region]||"vaw",test:s.test,score:s.score,topic:s.topic&&s.topic.constructor===Array?s.topic.join():s.topic,sectopic:s.sectopic&&s.sectopic.constructor===Array?s.sectopic.join():s.sectopic,mpxRefId:t.liveState?"2kpq923WGV31B9WIu_rtHNC7LK354Xhb":t.mpxRefId,pp:"vpaid_js",pid:s.pid,pv:parseInt(e.cookie("pv"))||0,show:t.liveState?encodeURIComponent(t.title):null,feat:t.liveState?"live":null};return e.each(f.getAllParams(),function(e,t){var i=e.match(/adTargeting_(.+)/);i&&i[1]?h[i[1]]=t:"adNetwork"===e&&(h.network=t)}),e.each(h,function(e,t){var i=new RegExp("{param:"+e+"}","g"),s=t&&"||"!==t?t:"";n=n.replace(i,s),a=a.replace(i,s)}),n+encodeURIComponent(a)},_getExternalPlaylist:function(){var t=e(this.options.getPlaylistSelector).data("videoPlaylist");t&&this.appendPlaylist(t)},_getMediaUrl:function(e){var t=window.uvpjs.mediaCapabilities,i=!(t.isAndroid()&&parseInt(t.getOSVersion())<7)&&(window.MediaSource||window.WebKitMediaSource||!0===t.canPlayNativeHLS()),s=e.mp4;if(i&&e.m3u8){var n="ott";r.isMobileUserAgent()||r.isIPhone()?n="mobile":(r.isIPad()||window.uvpjs.mediaCapabilities.isChromeOS())&&(n="tablet"),s=e.m3u8,s+=-1==s.indexOf("?")?"?":"&",s+="device="+n,s+="&change-to-host=cnetmedia-a.akamaihd.net"}return s},_getPlaylistConfigs:function(i,s){var n=this,a={},o=r.isMobileUserAgent()||r.isIPhone()||r.isIPad();if((a=i.map(function(t,i){var a=0,r=null!=t.liveState;if(!n.player.getCurrentPlaybackState().playbackStarted&&0===i&&e.inArray(u.tracking.data.pageType,["video_page","video_share"])>-1){var l=parseInt(f.getParam("t"),10);a=!isNaN(l)&&l>0&&l<t.duration?l:0}var d={cmsRefGuid:t.id,duration:r?-1:t.duration,index:t.index,isLive:!1,adCall:"//pubads.g.doubleclick.net/gampad/ads?"+n._getAdUrl(t,i),assetURL:n._getMediaUrl(t),seriesTitle:n.isAmp?"CNET AMP Video":"CNET Video",type:n.suppressAds||o&&0===i&&s?window.uvpjs.mediaCapabilities.RP_URL:window.uvpjs.mediaCapabilities.RP_IMA,vidContId:n.id,videoTitle:t.title,closedCaptionPath:t.closedCaptionPath};if(r||(d.startTime=a),r&&n._getMediaUrl(t).indexOf("dai.google.com")>-1){var c={au:"vau",uk:"vuk"}[(JSON.parse(e.cookie("cnet_ad"))||{}).region]||"vaw",h=o?"mobile_web":"desktop",p=n._getAdUrl(t,i),g=n._getMediaUrl(t),v={iu:"/8264/"+c+"-cnet/"+h+"/cnet",cust_params:decodeURIComponent(p.slice(p.indexOf("cust_params=")+"cust_params=".length)),sz:"640x480",description_url:"CNET Live Stream"};d.assetKey=g.slice(g.indexOf("/hls/event/")+"/hls/event/".length,g.lastIndexOf("/")),d.assetURL=null,d.adTagParameters=v,d.isLive=!0,d.type=window.uvpjs.mediaCapabilities.RP_DAI}return d}))&&a[0]&&a[0].type===window.uvpjs.mediaCapabilities.RP_DAI)try{a.unshift({adCall:"//pubads.g.doubleclick.net/gampad/ads?"+n._getAdUrl(i[0],0),assetURL:"//vidtech.cbsinteractive.com/h5/blanks/uvp_blank.mp4",type:uvpjs.mediaCapabilities.RP_IMA})}catch(e){t.warn("Couldn't add IMA preroll to DAI live stream")}return t.log("playlistConfigs",a),a},_getRelatedPlaylist:function(){var i,s=this;i=s.playlist[s.playlist.length-1].slug;var n=o.getEdition(),a=("us"===n?"":"/"+n)+"/videos/related-playlist/"+i+"/xhr/";i&&e.ajax({dataType:"json",type:"GET",url:a}).done(function(i){i&&i.length>0&&(s.playlist=s.playlist.concat(i),e.each(s.playlist,function(e){s.playlist[e].index=e}),s.options.playlist=s.playlist,s.player&&"load"===s.autoplayState&&s.player.addResourcesToPlaylist(s._getPlaylistConfigs(i,!1)),s.options.getRelatedPlaylist=!1,t.log("_getRelatedPlaylist new playlist",s.playlist))}).fail(function(e,i,s){t.log("_getRelatedPlaylist failed to load",e,i,s)})},_getUvpConfigs:function(t){var i=window.document.location.search.indexOf(_)>0,s="object"!=typeof t||"boolean"!=typeof t.performance||t.performance,n=u.tracking.data.siteSection,a=e.inArray(n,["home","how_to","news","reviews","videos"])?n:"id",r=this.options.config&&this.options.config.tracking?escape(this.options.config.tracking["comscore_sense_"+a]):"",o={news:"P50B755CF-7443-484D-80EB-15D0499ACEB9",reviews:"P051D033D-BD8F-4F2B-93B7-A1F9F1402AB1",videos:"PB2485A3C-22F7-433C-B50B-332EF2270710"}[u.tracking.data.siteSection]||"P0EA7CD2E-455C-4925-95F9-FC8A7E69BB99";return{allowConcurrentPlayback:!1,capLevelToPlayerSize:!0,cms:"platform",controls:[{el:"PREVIEW_BTN",type:"buttonContainer",label:"Start video",children:[{el:"duration",type:"previewTitle",name:"title"},{el:"title",type:"previewDuration",name:"duration"}]},{el:"REPLAY_BTN",type:"button",label:"Replay video"},{el:"LARGE_PLAY_BTN",type:"button",label:"Large play-pause toggle"},{el:"CONTROL_BAR",type:"div",children:[{el:"title",type:"videoInfo",videoInfo:"title"},{el:"PLAYSTATE_BTN",type:"svgToggle",label:"Play pause",svgOn:"pause",svgOff:"play"},{el:"VOLUME_BTN",type:"svgToggle",label:"Volume",svgOn:"speaker-on",svgOff:"speaker-off"},{el:"TIME_CURRENT",type:"span",text:"00:00"},{el:"TIME_DURATION",type:"span",text:this.options.playlist[0]&&this.options.playlist[0].duration?this._formatTime(this.options.playlist[0].duration):"00:00"},{el:"is-live",type:"span",text:"Live"},{el:"btn-share",type:"svg",label:"Share",svg:"share",control:"share"},{el:"CLOSED_CAPTION_BTN",type:"svg",control:"captions",label:"Closed captions",svg:"captions"},{el:"SETTINGS_BTN",type:"button",label:"Settings"},{el:"FULLSCREEN_BTN",type:"svg",label:"Fullscreen",svg:"fullscreen"}]},{el:"PROGRESS",type:"div",children:[{el:"PROGRESS_SLIDER",type:"range",label:"Progress",value:0,step:1e-4},{el:"PROGRESS_LOADED",type:"progress",value:0,step:1e-4}]},{el:"VOLUME_SLIDER",type:"range",value:1,step:.05},{el:"SETTINGS_MENU",type:"div",children:[]},{el:"overlays",type:"wrapper",name:"overlays",children:[{el:"share",type:"overlay",name:"share"},{el:"mute",type:"overlay",name:"mute"}]}],customCSS:this.options.customCSS,netwk:"cnet",partner:this.options.uvpPartner,playsInline:!0,preventFlashPlayback:!0,skin:!0,template:{button:'<button class="${ o.cls }" data-target="${ o.target }" aria-label="${ o.label }">${ o.label }</button>\n',buttonContainer:'<button class="${ o.cls }" aria-label="${ o.label }">${ o.children }</button>\n',div:'<div class="${ o.cls }">${ o.children }</div>\n',menu:'<button class="${ o.cls }" data-property="${ o.property }" data-value="${ o.value }" data-selected="${ o.selected }">${ o.label }</button>\n',overlay:'<div class="overlay ${ o.name }" data-overlay="${ o.name }"></div>\n',previewDuration:'<div class="videoMeta ${ o.name }"><div data-video-info="${ o.type }" class="${ o.type }"></div></div>',previewTitle:'<div class="videoMeta ${ o.name }"><div data-video-info="${ o.type }" class="${ o.type }"></div><div data-video-info="previewAuthor" class="previewAuthor"></div></div>',progress:'<progress class="${ o.cls }" value="${ o.value }" max="1" step="${ o.step }"></progress>\n',range:'<input type="range" value="${ o.value }" min="0" max="1" step="${ o.step }" class="${ o.cls }"  aria-label="${ o.label }" />\n',span:'<span class="${ o.cls }">${ o.text }</span>\n',svg:'<button class="${ o.cls }" data-control="${ o.control }" data-target="${ o.target }" aria-label="${ o.label }"><svg class="${ o.svg }"><use xlink:href="#${ o.svg }"/></svg></button>\n',svgToggle:'<button class="${ o.cls }" data-target="${ o.target }" aria-label="${ o.label }"><svg class="${ o.svgOn }"><use xlink:href="#${ o.svgOn }"/></svg><svg class="${ o.svgOff }"><use xlink:href="#${ o.svgOff }"/></svg></button>\n',toggle:'<span class="${ o.cls }" data-control="${ o.control }">${ o.text }<button class="on" aria-label="${ o.text } ${ o.textOff }">${ o.textOn }</button><button class="off" aria-label="${ o.text } ${ o.textOn }">${ o.textOff }</button></span>\n',videoInfo:'<span class="${ o.cls }" data-video-info="${ o.videoInfo }">'+(this.options.playlist.length>0&&this.options.playlist[0].title?this.options.playlist[0].title:"")+"</span>\n",wrapper:'<div class="${ o.name }">${ o.children }</div>\n'},usesIMA:!0,uvpc:{modules:[{name:"UVPJSDebug",category:"internal",enabled:i,params:[{name:"showAll",value:!0}]},{name:"ComScore_ss",category:"tracking",enabled:s,params:[{name:"partnerID",value:"cnet"},{name:"c1",value:"19"},{name:"c2",value:"31824268"},{name:"publishersSecret",value:"2cb08ca4d095dd734a374dff8422c2e5"},{name:"c3",value:""},{name:"c4",value:r}]},{category:"qos",enabled:s,name:"MuxQOSPluginJS",params:[{name:"propertyKey",value:"prod"===u.environment?"f13b9be8b7851594e8da77ea2":"930577dfc824ba10a4d593063"},{name:"experimentName",value:"||"===u.ads.data.gpt.targeting.test?"":u.ads.data.gpt.targeting.test}]},{name:"SiteCatalyst",category:"qos",enabled:s,params:[{name:"account",value:""},{name:"brand",value:"cnet"},{name:"edition",value:"us"},{name:"charSet",value:"UTF-8"},{name:"currencyCode",value:"USD"},{name:"visitorNamespace",value:"cbsinteractive"},{name:"TrackLiveStreams",value:"y"},{name:"trackingServer",value:"saa.cnet.com"},{name:"heartbeatTrackingServer",value:"cbsinteractive.hb.omtrdc.net"},{name:"heartbeatAdobePublisherId",value:"10D31225525FF5790A490D4D@AdobeOrg"},{name:"heartbeatVisitorMarketingCloudOrgId",value:"10D31225525FF5790A490D4D@AdobeOrg"}]},{category:"tracking",name:"NielsenTracking_SDK",enabled:s,params:[{name:"apid",value:o},{name:"clientid",value:"us-200330"},{name:"sfcode",value:"prod"===u.environment?"us":"dcr-cert"},{name:"vcid",value:"c07"},{name:"channelInfo",value:""},{name:"iag_sid",value:"1000011"},{name:"iag_tfid",value:"902"},{name:"channelName",value:"cbs"},{name:"segB",value:"CNET.com"},{name:"nol_devDebug",value:i?"console":""}]},{category:"internal",name:"VideoPlaybackSettings",enabled:window.uvpjs.mediaCapabilities.isAndroid(),params:[{name:"forceHlsjs",value:!0}]}]}}},_getNextVideo:function(t){var i=this,s={};return e.each(this.playlist,function(e){if(t===this.id)return s=i.playlist[e+1]||i.playlist[0],!1}),s},getVideo:function(){if(!this.video||!this.video.id)return null;var t,i="MANUAL";switch(("load"===this.autoplayState||"first"===this.autoplayState&&this.$element.is(e("[data-component*=videoPlayer]").first()))&&(this.playlist.length>1||this.options.getRelatedPlaylist?i="CONTINUOUS":this.autoplayState&&(i="AUTOPLAY")),this.contentVideoState){case-2:t="UNPLAYED";break;case-1:case 1:case 2:t="PLAYED";break;case 0:t="STOPPED";break;default:t="COMPLETED"}return e.extend(!0,{},this.video,{autoplayType:i,currentPlaybackState:this.player.getCurrentPlaybackState(),contentStartTimeStamp:this.contentStartTimeStamp,mediaUrl:this._getMediaUrl(this.video).split("?")[0],videoState:t})},_getVideoFromPlaylist:function(e){return this.playlist.filter(function(t){return t.index===e})[0]||null},_hideContainer:function(){this.$element.closest('[data-video-player="container"]').length>0&&!this.isPlaying&&1===e(".videoPlayer.playing").length&&this.$element.closest('[data-video-player="container"]').addClass(this.options.classHidden)},_initializeUvp:function(i){var n=this;y.initialize(i,function(i){n.systemInfoObject=i,n.options.showAsModal&&n.$element.addClass(n.options.classHidden),y.addEventListener(uvpjs.EventType.PLAYER_INIT+"."+n.id,function(i){if(n.id===i.target){if(n.player=i.payload.player,n.$element.trigger("onVideoPlayerReady",n.video),t.log("onVideoPlayerReady"),n.options.showPreviewMetadata&&n.options.playlist.length>0){n.$element.find("[data-video-info=previewDuration]").html('<svg class=" video"><use aria-hidden="false" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#video"></use></svg>'+n._formatTime(n.options.playlist[0].duration)),n.$element.find("[data-video-info=previewTitle]").text(n.options.playlist[0].title?n.options.playlist[0].title:"");var a=n.options.playlist[0].author;a&&a.firstName.length>0&&n.$element.find("[data-video-info=previewAuthor]").html('<div><span class="by">'+s.by+"</span> "+a.firstName+" "+a.lastName+"</div>")}e("[data-video-info]").dotdotdot({watch:"window"})}}),n._setupData(),n.options.showAsModal&&n.$element.addClass(n.options.classHidden),n._setupExternalEvents(),n.isAmp&&(n.options.suppressFirstAd=!1,n._setupAmpIntegration()),n._setDwPageTypeFallback(),"scroll"===n.autoplayState?n._setupScrollingAutoplay():n.options.getRecommendedPlaylist?n._getRecommendedVideos():n._setupPlayer()}),n._trackPerformanceEvent("cnetvideocreate")},_isInView:function(){var t=this.$element.offset().top,i=t+this.$element.outerHeight(),s=e(window).scrollTop(),n=s+e(window).height();return i>s&&t<n},_isFilteredShowPage:function(){try{return 1===e(window.location.hash).length}catch(e){return!1}},isAdPlaying:function(){return this.isAd},_setupAmpIntegration:function(){var e=this,i=u.ads.data.gpt.targeting;try{if(window.DW=window.DW||{},window.DW.pageParams=window.DW.pageParams||{},-1!==window.location.hash.indexOf("amp=1")?window.DW.pageParams.pagetype="article_amp":-1!==window.location.hash.indexOf("ampreview=1")?window.DW.pageParams.pagetype="product_main_amp":-1!==window.location.hash.indexOf("ampvideo=1")&&(window.DW.pageParams.pagetype="video_page_amp"),-1!==["article_amp","product_main_amp"].indexOf(window.DW.pageParams.pagetype)){var s=f.getHashParam("pageType"),n=f.getHashParam("contentType"),a=f.getHashParam("collection"),r=f.getHashParam("topic");i.ptype=s||window.DW.pageParams.pagetype,i.contentType=n||"",i.collection=a||"",i.topic=r||""}}catch(e){t.log("Couldn't update page params",e)}(window.AmpVideoIframe=window.AmpVideoIframe||[]).push(function(t){!1!==e.options.autoplay&&(t.method("play",function(){e.play()}),t.method("pause",function(){e.pause()}),t.method("mute",function(){e.mute()}),t.method("unmute",function(){e.unmute()})),t.postEvent("canplay")})},_setDwPageTypeFallback:function(){var e=u.ads.data.gpt.targeting,t="string"==typeof e.ptype?e.ptype:u.tracking.data.pageType;window.DW=window.DW||{},window.DW.pageParams=window.DW.pageParams||{},window.DW.pageParams.pagetype=window.DW.pageParams.pagetype||t},_loadChapter:function(t){var i=this;this.timelineRequests=this.timelineRequests||[],t.slug&&this.timelineRequests.push(e.ajax({dataType:"html",type:"POST",url:"/videos/video-timeline/"+t.slug+"/",data:{id:t.objectId,image:t.image?t.image:null,link:t.link,rating:t.metaData&&t.metaData.starRating?t.metaData.starRating:null,slug:t.slug,text:t.text,title:t.title,typeLabel:t.typeLabel,typeName:t.typeName},success:function(s){var n=100*t.time/i.video.duration,a=e('<div class="chapterDot" style="left:'+n+'%" id="time'+t.time+'"></div>'),r=e(s);r.on("click",function(e){i.pause()}),a.append(r),i.$element.find(".chapters").append(a)}}))},mute:function(){this.player&&this.player.mute()},_openOverlay:function(e,t){var i=this;this.isPlaying&&(this.pause(),this.interrupted=!0),this._closeOverlays(this.$element.find("[data-overlay]"),!1),e.addClass(this.options.classActive).html(t),n.process(e),e.find("[data-item=close]").on("click."+_,function(t){i._closeOverlays(e,i.interrupted)})},pause:function(){this.player&&this.player.pauseVideo()},_pausePlaylist:function(){if(this.player.pausePlaylist(),this.playlistPaused=!0,this.$element.find("[data-overlay=mute]").removeClass("visible"),this.$element.find(".uvpjs__controlbar").css("pointer-events","none"),r.isDesktop())if(this.haveFirstGesture){var e=this;this.$element.find("button.uvpjs__btn-large-play").one("click",function(t){t.stopPropagation(),e._resumePlaylist()})}else this.$element.find("button.uvpjs__btn-large-play").addClass(this.options.classDisabled),this.$element.find(".uvpjs__controls").addClass(this.options.classActive);try{this.$element.find("button.uvpjs__btn-large-play").css("background-image","url("+this.playlist[this.watchedVideoCount].image.path+")"),this.$element.find('[data-video-info="title"]').text(this.playlist[this.watchedVideoCount].title)}catch(e){}this.$element.parent().find("[data-video-info=upnext]").addClass(this.options.classHidden).removeClass(this.options.classDisabled)},play:function(){var e=this.$element.find(".uvpjs__btn-preview");this.player&&e.hasClass("uvpjs__btn-preview--hidden")?this.player.playVideo():e[0]&&(e[0].dispatchEvent(new Event("touchstart")),e[0].dispatchEvent(new Event("touchend")))},playVideoClip:function(e,t){e&&(t&&t.type&&t.type===window.uvpjs.EventType.RESOURCE_END&&this.playlist.length>1?this.play():(this.unmute(),this._setPlaylist(e)))},_processEvent:function(e){if(e&&e.target===this.id){["onVideoProgress"].indexOf(e.type)<0&&t.log(e.type,e),this.uvpEvents[e.type].call(this,e),this.$element.trigger(e.type,this.video)}},_resumePlaylist:function(){this.player.resumePlaylist(),this.playlistPaused=!1,this.$element.find(".uvpjs__controlbar").css("pointer-events",""),this.$element.find("button.uvpjs__btn-large-play").css("background-image",""),r.isDesktop()&&(this.$element.find("button.uvpjs__btn-large-play").removeClass(this.options.classDisabled),this.$element.find(".uvpjs__controls").removeClass(this.options.classActive))},_setAspectRatio:function(t){if(this.options.resizePlayer)if(!0===t)this.$element.css("height","");else if(this.video.isVertical){var i=e(window).height()-this.$element.find(".uvpjs__controlbar").height();this.$element.css("height",i+"px")}},_setEmbeddedVideoState:function(t){var i=this;i.options.mainPlayer?e("[data-load-video]").each(function(){var s=e(this).closest("[data-video-playlist]").data("videoPlaylist"),n=e(this).data("loadVideo"),a=!1;s&&s[n]&&s[n].id==i.video.id?a=!0:e(this).data("videoId")==i.video.id&&(a=!0),a?e(this).addClass(i.options.classActive):e(this).removeClass(i.options.classActive),a&&t?e(this).addClass(i.options.classPlaying):e(this).removeClass(i.options.classPlaying)}):t&&i.options.eventChannels&&l.publish(i.options.eventChannels,"heroVideoPlaying")},_setPageContextMetadata:function(){var t=null!=this.video.primaryCollection?this.video.primaryCollection.id:"",i=this.video.datePublished?this.video.datePublished.slice(0,10):"";this.player.setPageContextMetadata(e.extend(!0,{},p.getHbParams(),{collectionId:t,contentType:this.options.contentType,"a.media.originator":[null!=this.video.author?this.video.author.firstName+" "+this.video.author.lastName:null],"a.media.airDate":i,siteType:this.isAmp?"google_amp|||mobile":u.tracking.data.siteType}))},_setPlaylist:function(e){e.length>0?(this.startingNewPlaylist=!0,this.playlist=e,this.player.destroyPlaylist(),this.player.addResourcesToPlaylist(this._getPlaylistConfigs(e,this.options.suppressFirstAd)),this.$element.addClass(this.options.classPlaying)):t.error("No videos found in the playlist.")},_setupApeList:function(){u.video.prepend&&!a.read("viewedPrepend")&&(this.options.playlist.unshift(u.video.prepend),a.write("viewedPrepend","1",{expires:1}));var e=a.read("apeList");if(e)for(var t=0,i=e.split(",");t<this.options.playlist.length&&i.indexOf(this.options.playlist[0].id)>=0;)this.options.playlist.push(this.options.playlist.shift()),t++},_setupData:function(){this.video=this.options.playlist.length>0?this.options.playlist[0]:{};var e=f.getParam("adSuppress")||a.read("adSuppress")||"";this.suppressAds=this.options.suppressAds||"all"===e||e.split(",").indexOf(_)>=0||u.services.googleima&&!u.services.googleima.enabled||!(window.google&&window.google.ima),this.history=d.init(),this.video.ratingVChip&&"TV-MA"==this.video.ratingVChip||this._isFilteredShowPage()?this.autoplayState=!1:this.autoplayState=this.options.autoplay},_setupExternalEvents:function(){var t=this;this.$document.on("keyup."+t.id,"[data-load-video]",function(e){13===e.which&&t._videoExternalInteractionEvent(e,this)}),this.$document.on("click."+t.id,"[data-load-video]",function(e){t._videoExternalInteractionEvent(e,this)}),this.$document.on("click","[data-replace-video-playlist]:not([data-active-video-playlist])",function(i){var s=i.target.getAttribute("data-replace-video-playlist"),a=i.target.getAttribute("data-video-tag-type"),r=t.options.tagTopicPlaylistRoute.replace("replace-me",s),o=e("[data-tag-playlist-container]").first();r+="?currentVideo="+t.video.id,t.loader=e.cnet.loading({disabled:!1}),t.loader.$element.appendTo(e(t.options.loaderSelector)),t.loader.add(),t._trackEvent("trackClick","video-playlist|"+a+"|"+s,{}),o.hasClass("loaded")&&(o.removeClass("loaded fullLoad"),o.addClass("reset"),setTimeout(function(){e("[data-tag-playlist]").first().empty()},500)),e.ajax({dataType:"json",type:"GET",url:r}).done(function(s){s&&void 0!==s.template&&void 0!==s.playlist&&(t.playlist=s.playlist,t.loader.remove(),t._setPlaylist(t.playlist),e("[data-tag-playlist]").first().append(s.template),o.addClass("loaded"),o.removeClass("reset"),e("[data-replace-video-playlist]").removeAttr("data-active-video-playlist"),e(i.target).attr("data-active-video-playlist","true"),setTimeout(function(){o.addClass("fullLoad")},500),n.process(o))})}),this.$document.on("click","[data-active-video-playlist]",function(i){var s=e("[data-tag-playlist-container]").first();s.removeClass("loaded fullLoad"),s.addClass("reset"),e(i.target).removeAttr("data-active-video-playlist"),t.playlist=t.options.playlist,t._setPlaylist(t.playlist),setTimeout(function(){e("[data-tag-playlist]").first().empty()},500)}),this.$element.on("onVideoPlayerReady",function(){e("body").addClass("videoPlayerReady"),t.player.setVolume(.5),t.options.eventChannels&&l.publish(t.options.eventChannels,"videoReady")})},_setupInternalEvents:function(){var t=this;e.each(this.uvpEvents,function(e){t.player.addEventListener(e+"."+t.id,t._processEvent.bind(t))}),this.$element.find("[data-control=share]").on("click."+_,function(i){var s=t.$element.find("[data-overlay=share]");if(s.hasClass(t.options.classActive))t._closeOverlays(s,t.interrupted);else{var n=o.getEdition();e.ajax({url:("us"===n?"":"/"+n)+"/videos/video-share-xhr/"+t.video.slug+"/"}).done(function(e){t._openOverlay(s,e)})}}),this.$element.on("click."+_,function(e){if(!t.$element.hasClass(t.options.classActive)){var i=function(e){t.$element.removeClass(t.options.classActive),t.$document.off("tap",i)};t.$element.addClass(t.options.classActive),t.$document.on("tap."+_,i)}}),this.$element.find(".uvpjs__progress").append('<div class="chapters"></div>'),this.options.enableHistoryUpdates&&this.history.stateChange(function(t){var i=-1;if(e.each(this.playlist,function(e){if(t.data.id===this.id)return i=e,!1}),i>-1){var s=this.playlist.slice(i),n=this.playlist.slice(0,i);this.playlist=s.concat(n)}else this.playlist=[t.data].concat(this.playlist);this._setPlaylist(this.playlist)}.bind(this));var i=this.$element.find("[data-overlay=mute]");i.html('<div class="speaker-off"><svg><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#speaker-on"></use></svg><span class="label">'+s.playSound+"</span></div>"),i.one("click",function(i){e(this).removeClass("muted"),t.unmute(),t.$element.removeClass(t.options.classCaptions+" "+t.options.classCaptionsMissing)})},_videoExternalInteractionEvent:function(i,s){i.preventDefault();var n=e(s),a=n.data("loadVideo")||0,r=n.closest("[data-video-playlist]").data("videoPlaylist");if(this._closePlayerComplete(),n.data("videoId")){var o=null;e.each(this.options.playlist,function(e,t){if(t.id===n.data("videoId"))return o=e,!1}),null!=o&&(a=o,r=this.options.playlist)}var l=r.slice(a),d=r.slice(0,a),u=(r=l.concat(d))&&r.length>0?r[0].id:null,c=n.hasClass(this.options.classPlaying),h=parseInt(this.id.replace(this.options.idPrefix,""))===n.closest("[data-playlist-target]").data("playlistTarget"),p=e(s).is(this.options.videoShortcodeSelector);if(this.options.mainPlayer||h)if(this.options.showAsModal&&(this.$element.removeClass(this.options.classHidden),this._showCloseButton()),c)this.pause(),p&&this._trackEvent("trackClick","inbody|videopause",i),n.data("trackPlaylist")&&this._trackEvent("trackClick","playlist_pause",i);else{if(this.$element.closest('[data-video-player="container"]').removeClass(this.options.classHidden),e(window).trigger("playerShowing"),this.unmute(),r&&r.length>0&&(!this.video||this.video&&this.video.id!=u))this.player.getCurrentPlaybackState().playbackStarted?this._setPlaylist(r):(this.options.playlist=r,this.player.overrideUserGesture(!0));else if(this.player.getCurrentPlaybackState().playbackStarted)if(this.player.getCurrentPlaybackState().playbackStarted)this.play();else{var g=this.$element.find("#content_"+this.id+" video")[0];if(g){g.src=this.testVideoUrl;var f=g.play();f?f.then(function(){t.log("Promise fulfilled..."),e(".uvpjs__btn-preview").trigger("click")}).catch(function(e){t.error("Promise not met...",e)}):t.error("no Promise")}}else this.player.overrideUserGesture(!0);n.data("scrollToTop")&&e("html, body").animate({scrollTop:this.$element.offset().top},1e3),e("[data-load-video]").removeClass(this.options.classActive),e("[data-load-video]").removeClass(this.options.classPlaying),n.addClass(this.options.classActive),n.addClass(this.options.classPlaying),p&&this._trackEvent("trackClick","inbody|videoplay",i),n.data("trackPlaylist")&&this._trackEvent("trackClick","playlist_play",i),n.data("trackPlaylistRedesign")&&this._trackEvent("trackClick","video-playlist|playlist-item|"+n.data("trackPlaylistRedesign"),i)}},_setupPlayer:function(){var e=this;t.log("_setupPlayer"),this.initialized||(this.initialized=!0,this.autoplayState||(this.$element.addClass(this.options.classNoAutoplay),this.$window.trigger(this.options.classNoAutoplay),this._showCloseButton()),null===e.options.preventCaptions&&("es"===o.getEdition()?e.options.preventCaptions=!0:e.options.preventCaptions=!1),y.createVideoPlayer(e.id,function(t){(e.player=t,e._setPageContextMetadata(),e._trackPerformanceEvent("playerloaded"),e._setupInternalEvents(),e._setPlaylist(e.options.playlist),e.options.apeList)||(window._cbv||(window._cbv=[])).push(e.player.DOMMgr.dom.video.el);e.$element.trigger("onVideoPlayerReady",e.video)},{enableMutedAutoplay:"load"===e.autoplayState&&e.systemInfoObject.supportsMutedAutoplay,enableUnmutedAutoplay:!1,previewImage:e.options.playlist.length>0&&e.options.playlist[0].image&&e.options.playlist[0].image.path?e.options.playlist[0].image.path:"",deferLoadingCaptions:e.options.preventCaptions}))},_showCloseButton:function(){if(0==this.$element.find("[data-item=closeButton]").length){this.$element.prepend("<button class='closeButton' data-item='closeButton' aria-label='Close player'><svg class='close'><use xlink:href='#close'></use></svg></button>");var e=this;this.$element.find("[data-item=closeButton]").click(function(t){t.stopPropagation(),e.closePlayer(),e._trackEvent("trackClick","close-scroll-video",t)})}},_showVideoInfo:function(){var t=this;t.$element.parent().find("[data-video-info]").each(function(){var i=e(this),s=i.data("videoInfo"),n=t.video[s]||"";0===t.watchedVideoCount&&"title"===s&&t.video.primaryCollection&&"0d8f9ac8-61cb-4e36-9263-552d5468e04b"===t.video.primaryCollection.id?n=t.video.primaryCollection.title||"":"author"===s&&t.video.author?n=(t.video.author.firstName||"")+" "+(t.video.author.lastName||""):"collection"===s&&t.video.primaryCollection?n=t.video.primaryCollection.title||"":"upnext"===s&&(n="",i.addClass(t.options.classHidden).removeClass(t.options.classDisabled)),i.text(n)}),setTimeout(function(){e("[data-video-info]").dotdotdot({watch:"window"})},100)},_setupScrollingAutoplay:function(){var e=this,t=function(t){e.player?(e.options.eventChannels&&l.publish(e.options.eventChannels,"videoReady"),e.outOfViewPaused&&!e.autoplayScrollDisabled&&e.play()):e._setupPlayer()};this.scrollingAutoplayWaypoint=new Waypoint.Inview({element:this.$element,entered:t,enter:t,exited:function(t){if(e.player&&e.player.getPlayerMuted()&&0===e.$element.closest(e.options.selectorScrollingAutoplayDisabled).length){var i=e.player.getCurrentPlaybackState();e.outOfViewPaused=2!=i.playbackState,i.playbackStarted?e.pause():e.pauseRequested=!0}}})},_setupScrollingVideoPlayer:function(){var e=this;t.log("setting up scrolling video player"),e.player?e.options.eventChannels&&l.publish(e.options.eventChannels,"videoReady"):e._setupPlayer();this.scrollingAutoplayWaypoint=new Waypoint.Inview({element:this.$element,exited:function(t){if(e.player&&e.player.getPlayerMuted()&&0===e.$element.closest(e.options.selectorScrollingAutoplayDisabled).length){var i=e.player.getCurrentPlaybackState();e.outOfViewPaused=2!=i.playbackState,i.playbackStarted?e.pause():e.pauseRequested=!0}}})},_showChapterStarts:function(){if(this.timelineRequests)for(var e=0;e<this.timelineRequests.length;e++)this.timelineRequests[e].abort();if(this.$element.find(".chapters").empty(),this.video&&this.video.chapters)for(var t in this.video.chapters.data)this._loadChapter(this.video.chapters.data[t])},_trackEvent:function(t,i,s,n){if("logError"!==t){n=n||{};var a="";if(s.errorInfo){var r=s.errorInfo.errorCode||"null",o=s.errorInfo.serverCode||"null";if(3005===r&&"string"==typeof s.errorInfo.message){var l=s.errorInfo.message.split(" ");o+="_"+l[l.length-1]}a=r+"_"+o}var d=-1<a.indexOf("3005_null_buffer"),c=-1<a.indexOf("3005_null_levelLoad");!(d||c)&&this.video&&p.trackCustomEvent(t,e.extend(!0,{articleAuthorId:this.video.author?[this.video.author.id]:null,articleAuthorName:this.video.author?[this.video.author.firstName+" "+this.video.author.lastName]:null,articleId:u.tracking.data.articleId,articleTitle:u.tracking.data.articleTitle,articleType:u.tracking.data.articleType,brand:u.tracking.data.brand,channel:"video",clickGenericText:i,collectionId:this.video.primaryCollection?[this.video.primaryCollection.id]:null,deviceType:u.tracking.data.deviceType,error:a,pageType:u.tracking.data.pageType,siteEdition:u.tracking.data.siteEdition,siteHier:u.tracking.data.siteHier,siteSection:u.tracking.data.siteSection,siteType:u.tracking.data.siteType,videoAdIds:s.adData?s.adData.adVideoId:null,videoAdTitle:s.adData?s.adData.adVideoTitle:null,videoContentType:"video",videoId:this.video.id,videoTitle:this.video.title||this.video.headline,_pageChannelType:u.tracking.data._pageChannelType,_pageTitle:u.tracking.data._pageTitle,_pageViewGuid:u.tracking.data._pageViewGuid},n))}},_trackPerformanceEvent:function(i){t.info("Firing event: cnet_video."+i),u.video=u.video||{},u.video.performance=u.video.performance||{},u.video.performance[i]=!0;try{window.dispatchEvent(new Event("cnet_video."+i)),e(window).trigger("cnet_video."+i)}catch(e){t.error("Unable to trigger event cnet_video."+i)}try{void 0===performance.getEntriesByName(i)[0]&&performance.mark("cnet_video_"+i)}catch(e){t.error("Unable to set performance mark cnet_video_"+i)}try{var s=void 0===E[i]||0===E[i],n=["video_page","article","product_main"].indexOf(u.tracking.data.pageType)>-1;if(s&&n){E[i]=performance.now();var a=E[i],r={cnetvideocreate:["create"],playerloaded:["ploaded","cnetvideocreate"],adstart:["adStart","playerloaded"],showplayoverlay:["showoverl","playerloaded"]}[i];if(e.isArray(r)){var o=E[r[1]]||0;a=E[i+"_from_"+r[1]]=E[i]-o}var l=e.isArray(r)?r[0]:"";-1===["adstart","cnetvideocreate"].indexOf(i)&&l&&g.sendBeacon("video_"+l,a),"adstart"===i&&g.sendBeacon("video_adStart_c",E[i])}}catch(e){t.error("mpulse error tracking "+i+": "+e)}},unmute:function(){this.player&&this.player.getPlayerMuted()&&(this.player.unMute(),this.player.hideCaptions())},updateHistory:function(){-1===document.location.pathname.indexOf(this.video.urlPath)&&this.video.urlPath&&(this.history.navigate({title:this.video.title,data:this.video},{replace:!1,url:this.video.urlPath}),e(window).trigger("historystatechange"))},appendPlaylist:function(i){var s=this;i.length>0?this.playlist.length>0?(this.options.playlist=this.options.playlist.concat(i),e.each(s.options.playlist,function(e){s.options.playlist[e].index=e}),this.playlist=this.options.playlist,this.player&&this.player.addResourcesToPlaylist(this._getPlaylistConfigs(i))):(this.options.playlist=this.options.playlist.concat(i),e.each(s.options.playlist,function(e){s.options.playlist[e].index=e})):t.error("No videos found in the playlist."),t.log("appendPlaylist: new videos",i),t.log("appendPlaylist: new playlist",this.options.playlist)},setAutoplayToPause:function(){!1!==this.options.autoplay&&(this.initialPlay&&(this.pauseRequested=!0),this.autoplayScrollDisabled=!0)}})}),define("quantum/inviewElement",["jquery","managers/page-vars","managers/client-storage","version!fly/managers/debug","managers/events","version!fly/components/base","version!libs/waypoints/inview"],function(e,t,i,s,n){s=s.init("inviewElement"),e.widget("cnet.inviewElement",e.fly.base,{options:{containerAwareClassPrefix:null,containerAwareSelector:null,contentsClass:null,contentsSelector:null,customEventPercentage:"",events:["enter","entered","exit","exited"],eventChannels:null,eventSubscriptions:null,exitDirection:"both",repeat:!0,setStateOnLoad:!1,waypointParentOffsetSelector:"",mainPlayer:!1},enabled:!0,inviewWaypoint:null,_create:function(){this._setup(),this._setupWaypoints(),this._setupEvents(),this.options.setStateOnLoad&&this._setState()},_destroy:function(){this.inviewWaypoint.destroy(),this.$element.removeClass(this.options.events.join(" ")),this.options.contentsSelector&&this.$element.find(this.options.contentsSelector).removeClass(this.options.contentsClass)},disable:function(){for(var e=0;e<this.inviewWaypoint.waypoints.length;e++)this.inviewWaypoint.waypoints[e].disable();this.$element.removeClass(this.options.events.join(" "))},enable:function(){e("[data-component*=inviewElement]").not(this.$element).each(function(t,i){try{e(i).inviewElement("disable")}catch(e){s.log("Inview element not ready to be disabled.",e)}});for(var t=0;t<this.inviewWaypoint.waypoints.length;t++)this.inviewWaypoint.waypoints[t].enable()},_setState:function(){if("off"!==i.read("autoplayEnabled")&&this.$element.is(e("[data-component*=inviewElement]").first())){var t=this.$element.offset().top,s=t+this.$element.outerHeight(),n=e(window).scrollTop(),a=n+e(window).height();s>n&&t<a||(this.$element.addClass("exit exited"),this.options.contentsSelector&&this.$element.find(this.options.contentsSelector).addClass(this.options.contentsClass))}},_setupEvents:function(){var t=this;e(window).on("closePlayer",function(){t.$element.find(t.options.contentsSelector).removeClass(t.options.contentsClass)}),this.options.eventSubscriptions&&n.subscribe(this,this.options.eventSubscriptions)},_setupWaypoints:function(){var t=this;if(""!==this.options.customEventPercentage&&this.options.contentsSelector)this.customWaypoint=new Waypoint({element:this.$element,handler:function(e){if("up"===e)t.$element.find(t.options.contentsSelector).removeClass(t.options.contentsClass);else if(t.options.customChildSelector){var i=t.$element.find(t.options.customChildSelector);(0===i.length||i.length>0)&&t.$element.find(t.options.contentsSelector).addClass(t.options.contentsClass)}else t.$element.find(t.options.contentsSelector).addClass(t.options.contentsClass)},offset:function(){return-(""===t.options.waypointParentOffsetSelector?this.element.height():e(this.element).closest(t.options.waypointParentOffsetSelector).height())*parseFloat(t.options.customEventPercentage)}});else{var i=this.options.events.reduce(function(e,i){return e[i]=function(e){if(s.log("Waypoint "+i+" "+e+" triggered."),t.options.eventChannels&&n.publish(t.options.eventChannels,i),(i.indexOf("exit")<0||"both"===t.options.exitDirection||t.options.exitDirection===e)&&(t.$element.removeClass(t.options.events.join(" ")).addClass(i),t.options.containerAwareClassPrefix&&t.options.containerAwareSelector&&t.$element.parents(t.options.containerAwareSelector).removeClass(t.options.events.map(function(e){return t.options.containerAwareClassPrefix+e}).join(" ")).addClass(t.options.containerAwareClassPrefix+i)),t.options.contentsSelector)if(0===i.indexOf("enter"))t.$element.find(t.options.contentsSelector).removeClass(t.options.contentsClass);else if("both"===t.options.exitDirection||t.options.exitDirection===e){var a=t.$element.find("[data-component=videoPlayer]");(0===a.length||a.length>0)&&t.$element.find(t.options.contentsSelector).addClass(t.options.contentsClass)}!t.options.repeat&&t.inviewWaypoint&&t.inviewWaypoint.destroy()},e},{});this.inviewWaypoint=new Waypoint.Inview(e.extend(!0,{element:this.$element},i))}}})}),define("components/ellipsis",["jquery","version!fly/managers/debug","version!libs/jquery/dotdotdot","version!fly/components/base"],function(e,t){t=t.init("ellipsis"),e.widget("cnet.ellipsis",e.fly.base,{options:{selectors:{target:"[data-ellipsis]"}},_create:function(){var t=this.options;this._super(),e.each(this.$element.find(t.selectors.target),function(t,i){var s=e(i),n=s.data("ellipsis")||{};s.dotdotdot(n)})}})}),define("translations/image-gallery",["managers/edition"],function(e){return e.getTranslation({en:{page:"Page",pictures:"pictures"},es:{page:"Página",pictures:"imagenes"}})}),define("translations/social-links",["managers/edition"],function(e){return e.getTranslation({en:{cnet:"CNET",roadshow:"Roadshow",copied:"URL copied to clipboard"},es:{cnet:"CNET_Es",copied:"URL copiado al portapapeles"}})}),define("fly/components/social-links-1.0",["jquery","version!fly/managers/debug","version!fly/utils/string-vars","version!fly/components/base"],function(e,t,i){var s=e.support.touch?"vclick":"click",n=t.init("socialLinks");e.widget("fly.socialLinks",e.fly.base,{options:{title:"",url:"",description:"",shortUrl:"",via:"",data:{},popupWidth:620,popupHeight:440,location:null},isLoading:!1,popupId:"popup",linkId:"link",links:{facebook:"http://www.facebook.com/sharer.php?u={url}&t={title}",reddit:"http://reddit.com/submit?url={url}&title={title}",digg:"http://digg.com/submit?url={url}&title={title}",stumbleupon:"http://www.stumbleupon.com/submit?url={url}",twitter:function(e){var t="https://twitter.com/intent/tweet?text={title}&related={related}";return t+=e.shortUrl?"&url={shortUrl}&counturl={url}":"&url={url}",t+=e.via?"&via={via}":""},delicious:"http://del.icio.us/post?url={url}&title={title}",googleplus:"https://plus.google.com/share?url={url}&utm_content={title}&utm_campaign=&utm_medium=share%2Bbutton",linkedin:"http://www.linkedin.com/shareArticle?mini=true&url={url}&title={title}&summary={description}",pinterest:"http://pinterest.com/pin/create/button/?url={url}&media={media}&description={description}",tumblr:"http://www.tumblr.com/share/link?url={url}&description={description}",whatsapp:function(t){var s={ios:{match:/(ipad|iphone|ipod)/,store:"https://itunes.apple.com/app/whatsapp-messenger/id310633997",url:"whatsapp://send?text={title}%20{url}"},androidChrome:{match:"androidChrome",store:"market://details?id=com.whatsapp",url:"intent://send?text={title}%20{url}#Intent;package=com.whatsapp;scheme=whatsapp;end;"},android:{match:"android",store:"market://details?id=com.whatsapp",url:"whatsapp://send?text={title}%20{url}"}},n=window.navigator.userAgent.toLowerCase();for(var a in s)if(a=s[a],n.match(a.match)){a.url=i.compile(a.url,t,["urlencode"]);var r=e("<iframe />").css("display","none").attr("src",a.url).appendTo("body");return setTimeout(function(){window.open(a.store,"_blank"),r.remove()},300),!1}},print:function(){return window.print(),!1},email:"mailto:?subject={title}&body={url}%0D%0D{description}"},_create:function(){this.options;var e={};this._setup(),e[s+" [data-"+this.popupId+"]"]="_handlePopup",e[s+" [data-"+this.linkId+"]"]="_handleLink",this._on(this.$element,e)},_handlePopup:function(t){var i=e(t.currentTarget),s=i.data(this.popupId);t.preventDefault(),this.$el=i,this._setupClickEvent(t,{el:i,name:s}),this.popup(t,s)},_handleLink:function(t){var i=e(t.currentTarget),s=i.data(this.linkId);t.preventDefault(),this.$el=i,this._setupClickEvent(t,{el:i,name:s}),this.link(t,s)},_getLink:function(t){var s=this.links[t.toLowerCase()],n=this._getLinkData();return e.isFunction(s)&&(s=s(n)),s=i.compile(s,n,["urlencode"])},setLink:function(e,t){this.links[e]=t},_getLinkData:function(){var t=this.options;return e.extend({title:t.title,description:t.description,url:t.url,shortUrl:t.shortUrl,via:t.via},t.data)},popup:function(e,t){var i=this._getLink(t),s=this._getPopUpCoords(),n=this.$el;i&&(window.open(i,"button_share","width="+s.width+", height="+s.height+", left="+s.left+", top="+s.top+", personalbar=0, toolbar=0, scrollbars=1, resizable=1"),this._setupLoadEvent(e,{el:n,name:t,type:this.popupId}))},link:function(e,t){var i=this._getLink(t),s=this.$el;i&&(this._setupLoadEvent(e,{el:s,name:t,type:this.linkId}),window.location=i)},_getPopUpCoords:function(e,t){var i=this.options,s=e||i.popupWidth,n=t||i.popupHeight,a=screen.width,r=screen.height;return{left:Math.round(a/2-s/2),top:r>n?Math.round(r/2-n/2):0,width:a>s?s:a,height:r>n?n:r}},_setupClickEvent:function(t,i){t=t||null;var s=this.options.location;s&&e.extend(i,{location:s}),n.log("clicked"),this._trigger("clicked",null,i)},_setupLoadEvent:function(t,i){t=t||null;var s=this.options.location;s&&e.extend(i,{location:s}),this._trigger("loaded",t,i)}})}),define("fly/components/social-counts-1.0",["jquery","version!fly/managers/debug","version!fly/utils/string-helper","version!fly/utils/string-vars","version!fly/utils/object-helper","version!fly/components/social-links"],function(e,t,i,s,n){e.support.touch;var a=t.init("socialCounts");e.widget("fly.socialCounts",e.fly.socialLinks,{options:{url:null,facebookKey:null,showZeros:!1,countType:"human",containerClass:"social-count",containerTemplate:"<span></span>",loadingClass:"loading",loadedClass:"loaded",googleButtonType:"small",showTotal:!1,totalContainerSelector:".social-count-total",location:null,timeout:1e3},selectorId:"counts",total:0,countTotals:0,services:{facebook:"http://api.facebook.com/restserver.php?v=1.0&method=links.getStats&urls={url}&format=json",twitter:"http://cdn.api.twitter.com/1/urls/count.json?url={url}",linkedin:"http://www.linkedin.com/countserv/count/share?url={url}",delicious:"http://feeds.delicious.com/v2/json/urlinfo/data?url={url}",pinterest:"http://api.pinterest.com/v1/urls/count.json?url={url}"},responseKeys:{facebook:"like_count",twitter:null,reddit:"score",linkedin:null,delicious:"total_posts",stumbleupon:"views",pinterest:null,googleplus:null},responseObj:{facebook:function(e){return e[0]},delicious:function(e){return e[0]},reddit:function(e){return e.children.length>0?e.children[0]:null}},requestDataType:{},requestData:{},_create:function(){var e=this.options;this._super("_create"),this.url=e.url||window.location.href,this.$links=this.$element.find("[data-"+this.selectorId+"]"),this._setupRequests()},_setupRequests:function(){if(this.$links.length<=0)return a.log("Error: No links found in element.",this.$element),!1;var t,s=this,n=this.$links.length;this.$links.each(function(r,o){var l=e(o),d=l.data(s.popupId).toLowerCase(),u=s._getService(d),c="_load"+i.capitalize(d),h=0;s._loader("add",l),u?(s.load(d,u),t="socialcountsloaded"):e.isFunction(s[c])?s[c]():(a.log("Error: No service or custom function found for "+d,s.$element),s._loader("remove",l)),s.$element.on(t,function(e,t){h=t.count||0,s.total+=h,s._setTotal(n)})})},load:function(t,i){if(t.length<=0||i.length<=0)return a.log("Error: Service url or name not defined"),!1;var s=this,r=this.responseKeys[t]||"count",o=this.requestDataType[t]||"jsonp",l=this.requestData[t]||{};a.log("Requesting: "+t+"("+i+")"),e.ajax({dataType:o,url:i,data:l,timeout:s.options.timeout}).done(function(i,a,o){i=e.isFunction(s.responseObj[t])?s.responseObj[t](i):i;var l=n.deepFind(i,r)||{};s.setContent(t,l)}).fail(function(e,n,r){a.log("Error: "+t+"("+i+") response failed",e,n),s.setContent(t,{})})},_getService:function(e){var t=this.services[e],i=this._getServiceData();return t=s.compile(t,i,["urlencode"])},_getServiceData:function(){var t=this.options;return e.extend({url:this.url,googleplusKey:t.googleplusKey,facebookKey:t.facebookKey},t.data)},_loadGoogleplus:function(){var e='<div class="g-plusone" data-size="'+this.options.googleButtonType+'" data-href="'+this.url+'" data-count="true" data-callback="handleGooglePlusCallback"></div>',t=this._getLinkEl("googleplus"),i=this;t.html(e),window.handleGooglePlusCallback=function(e){e.state},require(["https://apis.google.com/js/plusone.js"],function(){window.handleGooglePlusCallback=function(e){var t="on"==e.state?"plusone":"rmvplusone";i._trigger(null,{button:"googleplus",type:t})}.bind(this),i._setupLoadEvent({el:t,name:"googleplus"})})},setContent:function(t,i){var s,n,a=this.options,r="[class="+a.containerClass+"]",o=0;return n=(n=(s=this._getLinkEl(t)).find(r)).length?n:e(a.containerTemplate).addClass(a.containerClass).addClass(a.containerClass+"-"+t).insertAfter(s).before(" "),a.showZeros&&"object"==typeof i&&(i="0"),"object"!=typeof i&&(o=parseInt(i,10),"human"===a.countType&&(i=this._getNormalizedCount(o)),n.text(i),s.addClass(a.loadedClass)),this._loader("remove",s),this._setupLoadEvent({el:s,name:t,count:o,type:"countSet"}),!0},_setTotal:function(e){var t=this.options,i=this.$element.find(t.totalContainerSelector),s="human"===t.countType?this._getNormalizedCount(this.total):this.total;if(this.countTotals++,i.length<0)return a.log("Error: total container not found. Selector: "+t.totalContainerSelector),!1;i.text(s),this.countTotals===e&&(this._setupLoadEvent({el:this.$element,type:"totalSet"}),this.$element.addClass(t.loadedClass))},_setupLoadEvent:function(t){t=t||{};var i=this.options.location;i&&e.extend(t,{location:i}),this._trigger("loaded",null,t)},_getLinkEl:function(t){var i=this;return this.$links.filter(function(s){var n=e(this).attr("data-"+i.popupId).toLowerCase();return n===t&&e(this)})},_getNormalizedCount:function(e){return e>=1e9?e=(e/1e9).toFixed(2)+"B":e>=1e6?e=(e/1e6).toFixed(2)+"M":e>=1e3&&(e=(e/1e3).toFixed(1)+"K"),e},_loader:function(e,t){var i=this.options;t=t||this.$element,"add"===e?t.addClass(i.loadingClass):t.removeClass(i.loadingClass)}})}),define("components/social-counts",["jquery","version!fly/managers/debug","translations/social-links","managers/page-vars","managers/tealium","managers/device","version!fly/utils/string-vars","version!fly/utils/object-helper","managers/edition","version!fly/components/social-counts","components/modal-email"],function(e,t,i,s,n,a,r,o,l){t=t.init("socialCounts");var d=e.support.touch?"vclick":"click";e.widget("cnet.socialCounts",e.fly.socialCounts,{options:{data:{media:e('meta[property="og:image"]').first().attr("content")}},$emailModal:null,totalCount:0,services:{facebook:"https://api.facebook.com/restserver.php?v=1.0&method=links.getStats&urls={url}&format=json",twitter:"",linkedin:"https://www.linkedin.com/countserv/count/share?url={url}",delicious:"http://feeds.delicious.com/v2/json/urlinfo/data?url={url}",pinterest:"https://api.pinterest.com/v1/urls/count.json?url={url}"},ftags:{copy:"#ftag=COS-05-10aaa2d",email:"#ftag=COS-04-10aaa1a",facebook:"#ftag=COS-05-10aaa0i",googleplus:"#ftag=COS-05-10aaa1c",linkedin:"#ftag=COS-05-10aaa1h",pinterest:"#ftag=COS-05-10aaa1d",reddit:"?ftag=COS-05-10aaa1e",tumblr:"#ftag=COS-05-10aaa1g",twitter:"#ftag=COS-05-10aaa0j",sms:"#ftag=CAD-05-10aai5g",flipboard:"#ftag=COS-05-10aaa2f"},links:{email:function(t){if(a.isMobile())window.location=r.compile("mailto:?subject={title}&body={url}%0D%0A%0D%0A{description}",t,["urlencode"]);else if(this.$emailModal)this.$emailModal.modalEmail("open");else{var i={openOnInit:!0,pageTitle:t.title,pageUrl:t.url};this.options.isAuto&&(i.emailType="friendRoadshow"),this.$emailModal=e.cnet.modalEmail(i).$element}},googleshare:"https://plus.google.com/share?url={url}&utm_content={title}&utm_campaign=&utm_medium=share%2Bbutton",twitter:function(e){var t="https://twitter.com/intent/tweet?text={title}&related={related}"+(e.shortUrl?"&url={shortUrl}&counturl={url}":"&url={url}");"none"!=e.via&&(t+="&via="+(null!==e.url.match(/\/roadshow\//)?i.roadshow:i.cnet));return t},tumblr:"http://www.tumblr.com/share/link?url={url}",flipboard:"https://share.flipboard.com/bookmarklet/popout?v=2&title={title}&url={url}&utm_source=cnet&utm_medium=article-share&utm_campaign=publisher",sms:function(){var e=navigator.userAgent||navigator.vendor||window.opera;return/iPad|iPhone|iPod/.test(e)&&!window.MSStream?"sms:&body={title}%20{url}":"sms:?body={title}%20{url}"},copy:function(s){element=this.$el;var n=function(){e(element).children(".copy").append('<div class="copyNotice">'+i.copied+"</div>"),setTimeout(function(){e(".copyNotice").detach()},3e3);var t=null;return document.addEventListener("copy",function(e){if(null!==t)try{e.clipboardData.setData("text/plain",t),e.preventDefault()}finally{t=null}}),function(e){t=e,document.execCommand("copy")}}();return t.log("copied:",s.url),n(s.url)}},getTotal:function(){return this.totalCount},_create:function(){var i=this;this._super(),this._setupTracking(),e.each(this.links,function(e,t){"function"==typeof t&&(i.links[e]=t.bind(i))}),this._on(this.$element,{}),"counts"===this.options.type&&this.options.noLinks&&(i._handlePopup=function(e){t.log("Blocked _handlePopup event")},i._handleLink=function(e){t.log("Blocked _handleLink event")})},_getLink:function(t,i,s){this._setupUrl(t);var n=this,a="json";if(!this.options.data.shortUrl&&"twitter"==t){var r=(l.isEspanol()?"/es":"")+"/ShareBarUrlShortener/";null!==this.options.url.match(/\/roadshow\//)&&(r="/roadshowurlshortener/"),"www.cnet.com"!==window.location.host&&(a="jsonp",r=window.location.protocol+"//www.cnet.com"+r);var o=n._super;e.ajax({url:r,data:{longUrl:this.options.url},dataType:a,callback:"callback",jsonpCallback:"handle_callback",async:!1,cache:!0,success:function(e){n.options.data.shortUrl=void 0!==e.short_url?e.short_url:e.data.url,s(o.call(n,t),i)}})}if("json"==a)return this._super(t)},popup:function(e,t){var i=this._getPopUpCoords(),s=this._getLink(t,i,a),n=this.$el;function a(e,i){e&&(window.open(e,"button_share_"+t,"width="+i.width+", height="+i.height+", left="+i.left+", top="+i.top+", personalbar=0, toolbar=0, scrollbars=1, resizable=1")||(window.location=e))}s&&(a(s,i),this._setupLoadEvent(e,{el:n,name:t,type:this.popupId}))},link:function(e,t){var i=this._getLink(t,{},n),s=this.$el;function n(e,t){e&&(window.location=e)}i?(n(i),this._setupLoadEvent(e,{el:s,name:t,type:this.linkId})):this.options.url&&"link"==t&&(n(i=this.options.url),this._setupLoadEvent(e,{el:s,name:t,type:this.linkId}))},_setupTracking:function(){e("[data-popup]",this.$element).on("click vclick ",function(t){var i=e(this).data("tracking");n.trackSocial({socialService:i,event:"share",eventt:"socialsite",socialId:{facebooksend:1,facebook:2,googlePlus:3,linkedin:4,pinterest:5,reddit:6,stumbleupon:7,twitter:8,twitterfollow:9,delicious:12,tumblr:14,sms:27,flipboard:28}[i],wd:"sharelink",sharebarSection:e(this).closest("[section]").attr("section")}),e(this).off("click vclick")}),"counts"===this.options.type&&this._bindCountsEvents()},_bindCountsEvents:function(){e("[data-link]",this.$element).on(d,function(t){var i=e(this).data("link");n.trackSocial({socialService:i,event:"share",eventt:"socialsite",socialId:{email:10}[i],wd:"sharelink",sharebarSection:e(this).closest("[section]").attr("section")}),e(this).off(d)}),e(".comment-count, .comment-countab",this.$element).on("click vclick",function(t){"object"==typeof s.tracking.data.collectionId?sharebarCollectionId=s.tracking.data.collectionId[0]:"string"==typeof s.tracking.data.collectionId?sharebarCollectionId=s.tracking.data.collectionId:sharebarCollectionId="",n.trackCustomEvent("trackShareBarComments",{_articleType:s.tracking.data.articleType,_pageType:s.tracking.data.pageType,brand:s.tracking.data.brand,siteEdition:s.tracking.data._siteEdition,_siteTypeDevice:s.tracking.data._siteTypeDevice,clickGenericText:"show_comments",dwLinkTag:n.getDwTag(e(this)),_collectionPrimaryId:sharebarCollectionId},"trackClick")})},_loadGoogleplus:function(){var e='<div class="g-plusone" data-size="'+this.options.googleButtonType+'" data-href="'+this.url+'" data-count="true" data-callback="$.cnet.google.trackPlusOne"></div>',t=this._getLinkEl("googleplus");t.html(e),google.isInitialized()?google.parse(t[0]):google.init()},_loadGooglepluscounts:function(){var i=[{method:"pos.plusones.get",id:"p",params:{nolog:!0,id:this.url,source:"widget",userId:"@viewer",groupId:"@self"},jsonrpc:"2.0",key:"p",apiVersion:"v1"}];e.ajax({url:"https://clients6.google.com/rpc",type:"POST",contentType:"application/json",data:JSON.stringify(i),dataType:"json",success:function(e){if("object"==typeof e&&e.length){var i=e[0].result.metadata.globalCounts.count;self.setContent("googlepluscounts",i),t.log("G+ Count:",i)}else t.log("Failed to get Google+ count")},error:function(){t.log("Failed to get Google+ count")}})},load:function(i,s){if(i.length<=0||s.length<=0)return t.log("Error: Service url or name not defined"),!1;var n=this,a=this.responseKeys[i]||"count",r=this.requestDataType[i]||"jsonp",l=this.requestData[i]||{};e.ajax({dataType:r,url:s,data:l,timeout:5e3}).done(function(t,s,r){t=e.isFunction(n.responseObj[i])?n.responseObj[i](t):t;var l=o.deepFind(t,a)||{};n.setContent(i,l),l===parseInt(l,10)&&(n.totalCount+=l,n.$element.trigger("socialCountTotalUpdate",n.totalCount))}).fail(function(e,s,a){t.log("Error: "+i+" response failed",e,s),n.setContent(i,{})})},_setupUrl:function(e){this.options.url=this.options.url.split("#")[0],e in this.ftags&&(this.options.url+=this.ftags[e],this.options.data.shortUrl=null)},setData:function(e,t){this.options.data[e]=t}})}),define("components/sharebar",["jquery","managers/tealium","managers/page-vars","managers/global-functions","version!fly/managers/debug","version!fly/utils/url-helper","components/social-counts","version!fly/components/base","version!libs/modernizr.custom","version!fly/libs/jquery.throttle-debounce","version!libs/waypoints/jquery.waypoints"],function(e,t,i,s,n,a){n=n.init("sharebar");var r=e.support.touch?"vclick":"click",o=!0;e.widget("cnet.sharebar",e.fly.base,{options:{viewClasses:{inline:"inline-view",side:"side-view"},enableViewToggling:!1,selectorContainer:null,containerClass:"count",showZeros:!0,throttle:!1,longform:!1,data:{media:e('meta[property="og:image"]').first().attr("content")},type:"counts",offsetElements:["#primary",".pageHeader","#specialHeader .fixation"],scrollToComments:!0,isSelectedClass:"-isSelected"},$buttons:null,$links:null,previousPath:null,lastScrollPosition:0,maxInnerHeight:0,isPastScrollTopZero:!1,disableScrollShowLogic:!1,_create:function(){this._setup(),this.options.title||(this.options.title=e("meta[property='og:title']").attr("content")),this.options.description||(this.options.description=e("meta[property='og:description']").attr("content")),this.options.url||(this.options.url=e("meta[property='og:url']").attr("content")),this.options.selectorContainer&&this.$element.appendTo(this.options.selectorContainer),this.options.enableViewToggling&&(this.updateView(null),this.$element.fixate&&this.$element.fixate("checkPosition")),this.$links=this.$element.socialCounts(this.options),this._setupEvents(),o&&(window.location.hash.indexOf("#comment")>=0||window.location.hash.indexOf("#comentarios")>=0)&&!e(".commentsContainer").parent().hasClass("selected")&&(o=!1,this.$element.find('a[href="#comments"], a[href="#comentarios"]').trigger("click"))},_setupEvents:function(){var n=this;this.options.enableViewToggling&&this.$window.on("resize.sharebar",function(){this.updateView()}.bind(this)),e("div[data-close='comments']").on("click",function(){var e=null!=n.previousPath?n.previousPath+"#":"#";history.replaceState(null,null,e),n.previousPath=null}),this.$element.on("click",".comment-count-redesign a, a[href='#comments'], a[href='#comentarios']",function(r){r.preventDefault();var o,l,d,u=e(".commentsContainer"),c=e(this).parent().attr("data-conversation-id"),h=e("#disqusContainer-"+c);e(this.firstElementChild).hasClass("social-button-small-redesign")?o="left-social":e(this.firstElementChild).hasClass("wrapper")&&(o="bottom");var p=e(this).closest("div:data(sharebar-options)").first().data("sharebar-options");d=o+"-"+(l=h.parent().hasClass("selected")?"hide":"show")+"-comments";var g=e.extend({},i.tracking.data,{clickGenericText:d});if(t.trackCustomEvent("impression",g,"trackClick"),"hide"===l){var f=null!=n.previousPath?n.previousPath+"#":"#";return h.parent().removeClass("selected"),history.replaceState(null,null,f),void(n.previousPath=null)}n.previousPath=window.location.pathname+window.location.search,n.$window.trigger("beginSharebarCommentClick");var v=0;e.each(n.options.offsetElements,function(t,i){v+=e(i).outerHeight(!0)}),n.options.scrollToComments&&u.offset()&&e("html, body").animate({scrollTop:(0===u.length?h:u).offset().top-v},0);var m=window.location.hash,_=a.getPath(p.url)+window.location.search;if("#comment"!==m.substring(0,"#comment".length)?_+="es"==i.tracking.data.siteEdition?"#comentarios":"#comments":_+=m,history.replaceState(null,null,_),h.parent().addClass("selected").removeClass("hidden"),u.parent().removeClass("selected").addClass("hidden"),h.parent().addClass("selected").removeClass("hidden"),i.services.disqus.enabled){var E=i.services.vertical_galleries&&i.services.vertical_galleries.enabled;s.gdprConsentCallback("script_disqus",function(){require(["managers/third-party/disqus"],function(e){"article"==i.pageType||"product_main"==i.pageType||"buy_guide"==i.pageType||E?e.init({enabled:!0,disqusSelector:"#disqusContainer-"+c+' [data-social="disqus"]'}):e.parse(h)})},{},"functional")}});var o=this.$element.find('[data-item="moreTrigger"]'),l=this.$element.find('[data-item="moreDropdown"]'),d=this.$element.find('[data-item="esTrigger"]'),u=this.$element.find('[data-item="esDropdown"]');o.length&&l.length&&o.on(r,function(){l.toggleClass(n.options.isSelectedClass),u.length&&u.removeClass(n.options.isSelectedClass)}),d.length&&u.length&&d.on(r,function(){u.toggleClass(n.options.isSelectedClass),l.length&&l.removeClass(n.options.isSelectedClass)}),this.options.throttle&&(this._on(this.$document,{scroll:e.throttle(200,this._checkShowSharebar)}),e("[data-sharebar-waypoint]").length&&(e("img[data-original]").each(function(){e(this).one("load",function(){Waypoint.refreshAll()})}),this._setupWaypoint()))},updateView:function(t){t?(e.each(this.options.viewClasses,function(e,t){this.$element.removeClass(t)}.bind(this)),this.$element.addClass(t)):this.$window.width()<1430?this.updateView(this.options.viewClasses.inline):this.updateView(this.options.viewClasses.side)},_checkShowSharebar:function(){var t=this.$window.scrollTop(),i=this;1==this.options.longform&&t<e(window).height()?e(this.element).removeClass("show"):this.lastScrollPosition>=t&&e(window).scrollTop()+e(window).height()<e("body").height()&&!e(this.element).hasClass("show")&&!this.disableScrollShowLogic?(1==this.options.longform&&t>e(window).height()||1!=this.options.longform)&&e(this.element).addClass("show"):this.lastScrollPosition<=t&&e(window).scrollTop()>0&&e(this.element).hasClass("show")&&this.maxInnerHeight==window.innerHeight&&!this.disableScrollShowLogic&&e(this.element).removeClass("show"),e(this.element).hasClass("show")&&e(window).scrollTop()<=0&&this.isPastScrollTopZero&&window.setTimeout(function(){e(i.element).removeClass("show")},2e3),this.lastScrollPosition=t,!this.isPastScrollTopZero&&t>0&&(this.isPastScrollTopZero=!0),this.maxInnerHeight<window.innerHeight&&(this.maxInnerHeight=window.innerHeight)},_setupWaypoint:function(){var t=this;new Waypoint({element:e("[data-sharebar-waypoint]"),handler:function(i){t.disableScrollShowLogic=!0,e(t.element).addClass("show"),window.setTimeout(function(){t.disableScrollShowLogic=!1},4e3),this.destroy()},offset:"bottom-in-view"})},_trackAction:function(s,n){t.trackCustomEvent("socialShareBarPosition",e.extend(!0,{},{pageType:i.tracking.data.pageType,siteEdition:i.tracking.data.siteEdition,siteType:i.tracking.data.siteType,brand:i.tracking.data.brand,deviceType:i.tracking.data.deviceType,siteSection:i.tracking.data.siteSection,_pageChannelType:i.tracking.data._pageChannelType,articleId:i.tracking.data.articleId,articleTitle:i.tracking.data.articleTitle,articleType:i.tracking.data.articleType,_collectionPrimaryId:i.tracking.data._collectionPrimaryId,siteHier:i.tracking.data.siteHier,_pageTitle:i.tracking.data._pageTitle},n),"trackClick")}})}),define("fly/components/image-gallery-1.0",["jquery","version!fly/managers/debug","version!fly/utils/string-vars","version!fly/managers/history","version!fly/components/base"],function(e,t,i,s){var n=e.mobile?"vclick":"click";t.init("imageGallery");e.widget("fly.imageGallery",e.fly.base,{options:{index:0,count:0,preloadThreshold:2,selectors:{image:'[data-item="image"]',count:'[data-item="image-count"]'},classes:{selected:"selected",disabled:"disabled"},countTemplate:'<span class="index">{index}</span> / <span class="count">{count}</span>',pushState:{enabled:!1,route:function(e){return e.index>1?"./{index}":"./"},title:function(e){return"{title}"+(e.index>1?"- {index}":"")}}},index:1,indexPrevious:null,count:0,selectors:{control:"[data-to-image]",next:'[data-to-image="next"]',previous:'[data-to-image="previous"]',jump:'[data-to-image="{index}"]'},_create:function(){var e=this.options;this._setup(),this.index=parseInt(e.index,10),this.count=parseInt(e.count,10),this.$images=this.$element.find(e.selectors.image),this.$count=this.$element.find(e.selectors.count),this._setupEvents(),this._updateControls(),this._preloadImages(),e.pushState.enabled&&this._setupPushState()},_setupEvents:function(){var e={};e[n+" "+this.selectors.control]="_handleControlClick",this._on(this.$element,e)},_setupPushState:function(){var e=this.options,t=this;this.history=s.init(e.pushState,{index:this.index}),this._on({imagegalleryshown:function(e,i){var s={index:i.index};"stateChange"!==i.action&&t.history.navigate(s,{title:i.title,url:i.url})}}),this.history.stateChange(function(e){t.show(e.index,"stateChange")})},_handleControlClick:function(t){var i=e(t.target).closest(this.selectors.control).data("toImage");switch(t.preventDefault(),t.stopPropagation(),i){case"next":this.next();break;case"previous":this.previous();break;default:this.show(parseInt(i,10),"to")}},_updateControls:function(){var e=this.options,t=this.$element.find(this.selectors.previous),s=this.$element.find(this.selectors.next),n=this.$element.find(i.compile(this.selectors.jump,{index:this.indexPrevious})),a=this.$element.find(i.compile(this.selectors.jump,{index:this.index}));s[this.index===this.count?"addClass":"removeClass"](e.classes.disabled),t[1===this.index?"addClass":"removeClass"](e.classes.disabled),a.addClass(e.classes.selected),n.removeClass(e.classes.selected)},_updateCount:function(){var e,t=this.options;this.$count.length&&(e={index:this.index,count:this.count},this.$count.html(i.compile(t.countTemplate,e)))},show:function(e,t){var i,s,n=this.options;e!==this.index&&(i=this.$images.eq(this.index-1),s=this.$images.eq(e-1),this._loadImage(s),i.removeClass(n.classes.selected),s.addClass(n.classes.selected),this.indexPrevious=this.index,this.index=e,this._updateControls(),this._updateCount(),this._trigger("shown",null,{$current:s,$previous:i,index:this.index,action:t}),this._preloadImages())},next:function(){this.options;var e=this.index+1;e>this.count||(this.show(e,"next"),this._trigger("next"))},previous:function(){this.options;var e=this.index-1;0!==e&&(this.show(e,"previous"),this._trigger("previous"))},_preloadImages:function(){var t,i,s=this.options,n=this;0!==s.preloadThreshold&&(t=Math.max(1,this.index-s.preloadThreshold),i=Math.min(this.count,this.index+s.preloadThreshold),this.$images.slice(t-1,i).each(function(t,i){n._loadImage(e(i))}))},_loadImage:function(e){var t,i;e.data("isLoaded")||!1||(i=(t=e.find("img")).data("src"),t.length&&i&&(t.attr("src",i),t.removeData("src"),e.data("isLoaded",!0)))}})}),define("components/image-gallery",["jquery","version!fly/managers/debug","managers/page-vars","fly/utils/string-vars-1.0","managers/tealium","translations/image-gallery","managers/guid","managers/device","version!fly/managers/history","managers/ad","components/sharebar","version!fly/components/base","version!fly/components/image-gallery"],function(e,t,i,s,n,a,r,o,l,d){var u=t.get("imageGallery");e.widget("cnet.imageGallery",e.fly.imageGallery,{options:{selectors:{gridControl:'[data-item="grid-control"]',meta:'[data-item="meta"]',control:"[data-to-image]",next:'[data-to-image="next"]',previous:'[data-to-image="previous"]',jump:'[data-to-image="{index}"]',container:"#galleryPage",modalContainer:"#bodyWrapper #galleryPage",count:'[data-item="image-count"] [data-item="index"]'},pushState:{enabled:!0,title:function(t){return e("#galleryPage .gallery-header h1").text()+(t.index>1?" - "+("roadshow"==i.tracking.data.brand?"Roadshow":"CNET")+" - "+a.page+" {index}":"")}},nextOverride:"/"+a.pictures+"/",nextOverrideSection:null,defaultDek:"",edition:"",preloadThreshold:1},$container:null,$gallery:null,firstPageView:!0,isModal:!1,_create:function(){if("image_gallery"===i.tracking.data.pageType){var t=this.options;0!==e(".galleryModal").length&&(this.isModal=!0),this.isModal?this.$container=e(t.selectors.modalContainer):(window.scrollTo(0,0),this.$container=e(t.selectors.container)),this._setup(),this._super("_create"),this.$meta=this.$container.find(t.selectors.meta),this.defaultDek=e("meta[property='og:description']").attr("content"),this.edition=this.options.edition,this.$gallery=this.$container.find(".image-gallery"),this.$video=this.$container.find('[data-component="videoPlayer"]'),this._updateMetadata()}else u.log("pageType !== image_gallery -- abort")},_setupEvents:function(){var e={},t={};e["click "+this.options.selectors.control]="_handleControlClick",t.keydown="_handleKeyboardControl",this._on(this.$container,e),this._on(document,t)},_setupPushState:function(){var t=this.options,i=this,s=document.createElement("a");s.href=t.pushState.route;var n=s.pathname;-1===e.inArray(n[0],[void 0,"/"])&&(n="/"+n),t.pushState.route=function(e){return(e.index>1?n+"{index}/":n)+window.location.search},this.history=l.init(t.pushState),this._on({imagegalleryshown:function(e,t){var s={index:t.index};"stateChange"!==t.action&&i.history.navigate(s,{title:t.title,url:t.url})}}),this.history.stateChange(function(t){u.log("stateChange",t.index),void 0!==t.index?i.show(t.index,"stateChange"):e("#bodyWrapper .closeModal").trigger("click")}),this.isModal?(this.history.navigate({},{replace:!0,url:document.location}),this.history.navigate({index:this.index})):this.history.navigate({index:this.index},{replace:!0,url:document.location})},_updateControls:function(){u.log("updateControls");var e=this.options,t=this.$container.find(e.selectors.previous),i=this.$container.find(e.selectors.next),n=this.$container.find(s.compile(e.selectors.jump,{index:this.indexPrevious})),a=this.$container.find(s.compile(e.selectors.jump,{index:this.index}));this.isModal?i.removeAttr("href"):this.index===this.count&&e.nextOverride?(i.attr("href",e.nextOverride),i.removeAttr("data-to-image"),e.nextOverrideSection&&i.attr("section",e.nextOverrideSection)):i.attr("data-to-image","next"),t[1===this.index?"addClass":"removeClass"](e.classes.disabled),a.addClass(e.classes.selected),n.removeClass(e.classes.selected),a.attr("aria-selected",!0),n.attr("aria-selected",!1),this._updateCount()},_handleKeyboardControl:function(t){switch(t.keyCode){case 37:u.log("Left arrow key is down"),this.previous("keyboard");break;case 39:u.log("Right arrow key is down");var i=this.options;this.index===this.count?i.nextOverride?window.location.href=i.nextOverride:this.isModal&&e('[data-item="modal-close"]').trigger("click"):this.next("keyboard");break;case 27:u.log("Escape button is down"),e('[data-item="modal-close"]').trigger("click")}},_handleControlClick:function(t){var i=this.options,s=e(t.target).closest(i.selectors.control).data("toImage"),n=e(t.target).closest(i.selectors.control).data("controlName");switch(t.preventDefault(),t.stopPropagation(),s){case"next":this.next(n);break;case"previous":this.previous(n);break;default:this.show(parseInt(s,10),"to",n)}},_updateCount:function(){var e=this.options;this.$container.find(e.selectors.count).text(this.index)},show:function(t,s,a){if(t!==this.index){u.log("Showing slide: ",t);var o=this.options;this.$video.videoPlayer&&this.$video.videoPlayer("pause");var l="next"==s?t-1:t+1;$previousMeta=this.$container.find("[data-item-meta="+l+"]"),$currentMeta=this.$container.find("[data-item-meta="+t+"]"),$previousMeta.removeClass(o.classes.selected),$currentMeta.addClass(o.classes.selected),this._superApply([t,s]),r.resetViewGuid();var c={event:"log",pageNum:t,mapp:"gallery",comptyp:"gallery",riaevent:"view",objtyp:"image",_pageUrl:window.location.pathname,pageUrl:window.location.pathname,_pageViewGuid:i.guid,dwLinkTag:a,photoGalleryTitle:i.tracking.data.articleTitle,photoGalleryId:i.tracking.data.articleId,photoGalleryType:i.tracking.data.articleType,_siteEdition:i.tracking.data.siteEdition,siteEdition:i.tracking.data.siteEdition,brand:i.tracking.data.brand,mfr:i.tracking.data.mfr,pageType:i.tracking.data.pageType};i.services.chartbeat_tracking.enabled=!1,u.log("Track as new pageview"),n.trackPageLoad(c),u.log("refresh ads");var h=e.extend({},i.ads.data);e.extend(h.gpt.targeting,$currentMeta.data("customAdVars")),d.loadAds(d.getAdUnits(i.ads.data.gpt.containerId,null,["mpu-top","mpu-bottom","mpu-middle","mpu-middle2","leader-top","leader-middle","leader-bottom"]),h,{incrementPageView:!0}),this._updateMetadata(),this._updateSharebar()}},next:function(t){u.log("next");this.options;var i=this.index+1;this.index===this.count?this.isModal&&(u.log("if modal, close it!"),e('[data-item="modal-close"]').trigger("click")):this.show(i,"next",t);var s=this.defaultDek,n=e(".image.selected .image-meta .caption p").text();1!==this.index&&""!==n?e("meta[name='description']").attr("content",n):e("meta[name='description']").attr("content",s),this._trigger("next")},previous:function(t){u.log("previous");this.options;var i=this.index-1;if(0!==i){if(1===this.index)u.log("first slide, go to last slide now."),u.log("index: ",this.count),this.show(this.count,"previous",t);else{this.show(i,"previous",t);var s=e(".image.selected .image-meta .caption p").text();""!==s&&1!==i?e("meta[name='description']").attr("content",s):e("meta[name='description']").attr("content",this.defaultDek)}this._trigger("previous")}},_updateMetadata:function(){var t=e(".image-gallery .images .selected");e("meta[property='og:url']").attr("content",window.location.href),e("meta[property='twitter:url']").attr("content",window.location.href),e("meta[property='twitter:title']").attr("content",e(e(t).children("div").children(".image-meta").children("h2")).html()),e('link[rel="canonical"]').attr("href",window.location.href),u.log("Done updating Meta Data!")},_updateSharebar:function(){var t=e(".image-gallery .images .selected"),i=e(":cnet-socialCounts");i.socialCounts("setUrl",window.location.href),i.socialCounts("setData","media",e(t.children("div").children("figure").children("img")).attr("src"))},_uiTracking:function(e,t){itemTracking=i.tracking.data,n.trackCustomEvent(e,{_articleTitle:itemTracking.photoGalleryTitle,_articleId:itemTracking.photoGalleryId,_authorPrimaryName:itemTracking.articleAuthorName,_articleType:itemTracking.articleType,_pageType:itemTracking.pageType,siteSection:itemTracking.siteSection,siteEdition:itemTracking.siteEdition,_siteEdition:itemTracking.siteEdition,_siteTypeDevice:itemTracking._siteTypeDevice,_siteHier:itemTracking.siteHier,_pageViewGuid:itemTracking._pageViewGuid,clickGenericText:t},"trackClick")}})}),define("components/image-gallery-modal",["jquery","managers/components.desktop","version!fly/managers/debug","managers/page-vars","managers/tracking","managers/tealium","managers/trackonomics","managers/guid","managers/ad","managers/recommendation","version!fly/components/base"],function(e,t,i,s,n,a,r,o,l,d){i=i.init("imageGalleryModal"),e.widget("cnet.imageGalleryModal",e.fly.base,{options:{cssPath:"",trackUrl:"",url:"",index:1},cssLoadPath:"",latestDwLinkTag:"",url:"",hostUrl:"",hostState:{},hostScrollTop:0,hostAdData:{},hostGuid:0,isHostGallery:!1,_create:function(){var t=this;this._setup(),this.$video=e(".videoPlayer"),"www.theroadshow.com"!==window.location.hostname&&this.$element.on("click",function(i){t.cssLoadPath=t.options.cssPath,i.preventDefault(),t._clickControl(),t.latestDwLinkTag=a.getDwTag(e(i.target))})},_storeHostPageData:function(){this.hostUrl=window.location.href,this.hostState=window.history.state,this.hostScrollTop=e(window).scrollTop(),this.hostAdData=e.extend(!0,{},s.ads.data),this.hostTracking=e.extend(!0,{},s.tracking),this.hostImage=e('meta[property="og:image"]').attr("content").trim(),this.hostGuid=o.getViewGuid(),this.url=""!==this.options.url?this.options.url:this.$element.attr("href")},_clickControl:function(){var u=this,c=e("body");if($htmlTag=e("html"),e("#bodyWrapper").length>0){i.log("IGM: replacing gallery modal"),e("#bodyWrapper").data("persist","true"),e("#bodyWrapper .closeModal").trigger("click"),$htmlTag.removeClass("overflow");var h=e("<div id='bodyWrapper' class='loadingArea'></div>");c.append(h)}else{i.log("IGM: setting up gallery modal");h=e("<div id='bodyWrapper' class='loadingArea'></div>");c.append(h),c.addClass("galleryModal image-gallery"),this._loadCss(this.cssLoadPath,"galleryCSS")}if(this.$video.length)if(i.log("video is present. pause it for the gallery modal"),"videoPlayer"==this.$video.attr("data-component"))try{this.$video.videoPlayer("pause")}catch(e){i.log("Failed to pause video player.")}else i.warn("Video not ready"),this.$video.on("onVideoPlayerReady",function(e){"videoPlayer"==this.$video.attr("data-component")&&this.$video.videoPlayer("pause")});"image_gallery"==s.tracking.data.pageType&&(u.isHostGallery=!0),u._storeHostPageData();var p=window.location.search,g=/ab=.*&/,f=/ab=.*/;g.test(p)?p=p.replace(g,""):f.test(p)&&(p=p.replace(f,"")),e.ajax({url:this.url+p,dataType:"json",context:document.body}).done(function(h){i.log("Gallery loaded");var p=document.createElement("a");p.href=u.options.trackUrl;var g=p.pathname;e("head title").text(e(e.parseHTML(h.template)).find("h1").text()),n.resetTrackingData(h.trackingData,g),o.resetViewGuid(),a.trackPageLoad(e.extend(!0,h.trackingData,{viewguid:o.getViewGuid(),title:h.trackingData.photoGalleryTitle,_pageViewGuid:o.getViewGuid(),_topicPrimaryId:h.trackingData.topicId[0],_pageUrl:u.options.trackUrl,pageUrl:u.options.trackUrl,photoGalleryTitle:h.trackingData.photoGalleryTitle,photoGalleryId:h.trackingData.photoGalleryId,photoGalleryType:h.trackingData.articleType,pageName:""!=u.options.trackUrl?u.options.trackUrl:s.tracking.data._pageName,dwLinkTag:u.latestDwLinkTag}));var f=e(h.template);e("#bodyWrapper").append(f),e("#bodyWrapper").removeClass("loadingArea"),t.process(e("#bodyWrapper")),s.ads.data=e.extend({},h.adData),l.loadAds(l.getAdUnits(s.ads.data.gpt.containerId),s.ads.data,{excludeDisabled:!0,incrementPageView:!0}),d.registerOnScroll("#bodyWrapper"),this.$close=e('[data-item="modal-close"]'),this.$close.on("click",function(){u._closeModal(c,h.trackingData)}),e("#bodyWrapper").on("click",function(e){e.target===this&&u._closeModal(c,h.trackingData)}),r.refreshTrackonomics()}).fail(function(){c.removeClass("galleryModal"),e("#bodyWrapper").remove(),window.location=u.$element.attr("href")})},_closeModal:function(t,i){a.trackCustomEvent("trackCloseGallery",e.extend({},s.tracking.data,{_articleTitle:i.photoGalleryTitle,_articleId:i.photoGalleryId,_authorPrimaryName:i.articleAuthorName,_articleType:i.articleType,_pageType:i.pageType,siteSection:i.siteSection,siteEdition:i._siteEdition,_siteTypeDevice:i._siteTypeDevice,_siteHier:i.siteHier,_pageViewGuid:i._pageViewGuid,clickGenericText:"close-gallery"}),"trackClick");var r=document.createElement("a");r.href=this.hostUrl;var l=r.pathname;n.resetTrackingData(this.hostTracking,l),s.ads.data=this.hostAdData,window.history.replaceState&&window.history.replaceState(this.hostState,"",this.hostUrl),e('meta[property="og:image"]').attr("content",this.hostImage),e("title").text(this.hostTracking.data._pageTitle),o.resetViewGuid(this.hostGuid),this.isHostGallery||$htmlTag.removeClass("overflow"),"true"===e("#bodyWrapper").data("persist")?(e("#bodyWrapper").remove(),e("#bodyWrapper").data("persist",null)):(e("#bodyWrapper").remove(),t.removeClass("galleryModal image-gallery"),e(window).resize(),e(window).scrollTop(this.hostScrollTop))},_loadCss:function(t,i){var s=document.createElement("link");s.setAttribute("rel","stylesheet"),s.setAttribute("type","text/css"),s.setAttribute("id",i),s.setAttribute("href",t),void 0!==s&&0==e("#"+i).length&&document.getElementsByTagName("head")[0].appendChild(s)},open:function(){this.cssLoadPath=this.options.cssPath,this._clickControl()}})}),define("components/shortcode-gallery",["jquery","version!fly/managers/debug","fly/utils/string-vars-1.0","version!fly/components/base","version!fly/components/image-gallery","version!libs/jquery/dotdotdot"],function(e,t,i){var s=t.init("shortcode-gallery"),n=e.support.touch?"vclick":"click";e.widget("cnet.shortcodeGallery",e.fly.imageGallery,{options:{index:1,preloadThreshold:3,countTemplate:'<span class="first">{first}</span> - <span class="last">{last}</span> of <span class="count">{count}</span>',selectors:{viewport:'[data-item="viewport"]',window:'[data-item="window"]'},visible:1},_create:function(){var t=this.options;this._super("_create"),this._setupViewports();var i=this.$element.find('[data-item="image-count"]').clone();i.find(".first").html("{first}"),i.find(".last").html("{last}"),i.find(".count").html("{count}"),t.countTemplate=i.html(),e.each(this.$element.find(".caption"),function(t,i){e(i).dotdotdot({watch:"window"})})},_setupEvents:function(){var t=this,i={};i[n+" "+this.selectors.control]="_handleControlClick",i.shortcodegalleryshown="_handleShown",this._on(this.$element,i),e(window).resize(function(e){t._handleResize(e)})},_setupViewports:function(){var t=this;this.$element.find(this.options.selectors.viewport).each(function(i,s){var n=e(s),a=n.find(t.options.selectors.image),r=0;a.each(function(t,i){r+=e(i).outerWidth(!0)}),n.width(r),t._updateWindowHeight(e(a[0]).height())})},_handleShown:function(e,t){var i=t.$current.position().left,s=parseInt(t.$current.css("marginLeft"),10)+i,n=t.$current.closest(this.options.selectors.viewport);e&&e.preventDefault(),-s!=parseInt(n.css("left"),10)&&t.$current.closest(this.options.selectors.viewport).css("left",-s)},_handleResize:function(e){var t=this.$element.find(this.options.selectors.viewport).find("."+this.options.classes.selected);this._handleShown(null,{$current:t}),this._updateWindowHeight(this.$element.find(this.options.selectors.image+":first").height())},_updateWindowHeight:function(e){if(!(e<=0)){var t=this.$element.find(this.options.selectors.window);e!=t.height()&&t.height(e)}},_updateCount:function(){var e,t=this.options;this.$count.length&&(e={first:this.index,last:Math.min(this.index+this.options.visible-1,this.count),count:this.count},this.$count.html(i.compile(t.countTemplate,e)))},_updatePushState:function(e,t){this.options.enablePushState&&history.pushState&&(s.log("pushState: "+e+": "+t),history.pushState({},"",t))},next:function(){var e=Math.min(this.index+this.options.visible,this.count-this.options.visible+1);e<0||e!==this.count&&(this.show(e),this._trigger("next"),this._updatePushState("next",e))},previous:function(){var e=Math.max(1,this.index-this.options.visible);1!==this.index&&(this.show(e),this._trigger("previous"),this._updatePushState("previous",e))},show:function(e){(e=Math.max(1,Math.min(e,this.count-this.options.visible+1)))!==this.index&&this._super(e)},_handleControlClick:function(t){var i=e(t.target).closest(this.selectors.control).data("toImage");switch(t.preventDefault(),i){case"next":this.next();break;case"previous":this.previous();break;default:this.show(parseInt(i,10))}},_updateControls:function(){this._super();var e=this.options;this.$element.find(this.selectors.next)[this.index+e.visible-1>=this.count?"addClass":"removeClass"](e.classes.disabled)}})}),define("components/disqus-count",["jquery","managers/page-vars","version!fly/managers/debug",window.CnetPageVars.services.disqus.enabled?"version!fly/components/disqus-count":""],function(e,t,i){i=i.init("disqusCount"),t.services.disqus.enabled&&e.widget("cnet.disqusCount",e.fly.disqusCount,{options:{shortname:t.disqus.shortname,disqusIdentifier:"",disqusZeroCommentsText:"Post a comment",disqusOneCommentText:"Comment"},refreshCounts:function(){var s=this,n=s.options.disqusIdentifier,a='[data-component="disqusCount"][data-disqus-identifier="'+n+'"] [data-item="buttonText"]',r='.sharebarRedesign [data-component="disqusCount"][data-disqus-identifier="'+n+'"]',o='[data-component="disqusCount"][data-disqus-identifier="'+n+'"] [data-item="iconText"]';e.ajax({type:"GET",url:"https://disqus.com/api/3.0/threads/details.json?api_key="+t.disqus.publicKey+"&thread:ident="+n+"&forum="+t.disqus.shortname,dataType:"jsonp",timeout:5e3,success:function(t){var n=t.response.posts,l="99+";if(n<=1){l="0";var d=s.options.disqusZeroCommentsText;1==n&&(l="1",d=s.options.disqusOneCommentText),null!=d&&e(a).text(d)}else n>1&&n<=99&&(l=n.toString());e(r).text(l),e(o).text(l),i.log("Replaced comment count with "+l)},error:function(t,n,l){"timeout"==l?(e(a).text(s.options.disqusZeroCommentsText),e(r).text(0),e(o).text(0)):i.log(l)}})}})}),define("managers/third-party/social-flags",["managers/page-vars"],function(e){return{enabled:{facebook:e.services.facebook&&e.services.facebook.enabled,google:!0,linkedIn:e.services.linkedin&&e.services.linkedin.enabled,pinterest:e.services.pinterest&&e.services.linkedin.pinterest,twitter:e.services.twitterwidget&&e.services.linkedin.twitterwidget,disqus:e.services.disqus&&e.services.linkedin.disqus}}}),define("managers/third-party/twitter",["jquery","version!fly/managers/debug","managers/third-party/social-flags","managers/global-functions","managers/tealium"],function(e,t,i,s,n){t=t.init("twitter");var a=!1,r={onInit:null};return{init:function(n){var o=this;i.enabled.twitter&&(e.extend(!0,r,n),a?r.onInit&&r.onInit():(window.twttr=e.extend(!0,{_e:[],ready:function(e){window.twttr._e.push(e)}},window.twttr),twttr.ready(function(){a=!0,o.setupEvents(),r.onInit&&r.onInit(),t.log("Initialized")}),s.gdprConsentCallback("script_twitter",function(){require(["twitter"])},{},"social")))},parse:function(){a?twttr.widgets.load():t.log("Parse failed -- not initialized yet")},isInitialized:function(){return a},setupEvents:function(){var e=this;twttr.events.bind("follow",function(i){t.log("Followed");e.trackFollow({})}),twttr.events.bind("tweet",function(i){t.log("Tweeted");e.trackTweet({})})},trackFollow:function(t){n.trackSocial(e.extend({socialService:"twitter",event:"connect",eventt:"followcnet",socialId:9},t))},trackTweet:function(t){n.trackSocial(e.extend({socialService:"twitter",event:"share",eventt:"socialsite",socialId:8},t))}}}),define("pages/desktop/article_video_test",["main.desktop","managers/recommendation","components/fixate","components/iframe-hover-fix","components/toc-nav","components/toggle","components/touch-menu-hover","components/sticky-element","components/form-trim","components/lazyload-images","components/modal-enlarge-image","utils/function-natives","components/article","components/page","components/sliding-element","components/sticky-column","components/selfish-scroll","components/update-area","components/sticky-leader","components/track-download","components/social-tracking","components/external-link","components/mobile-footer-link","quantum/videoPlayer","quantum/inviewElement","components/ellipsis","components/image-gallery","components/image-gallery-modal","components/shortcode-gallery","version!libs/jquery/dotdotdot","version!fly/components/image-gallery","components/disqus-count","components/sharebar","managers/edition-notifications","managers/third-party/social","managers/third-party/twitter"],function(e,t){t.registerOnScroll()});