define(["jquery","version!fly/managers/debug","managers/tealium","managers/page-vars","version!fly/components/base"],function(e,t,a,i){t=t.init("leadsTracker"),e.widget("cnet.leadsTracker",e.fly.base,{options:{appendViewguid:!0,fireTrackingPing:!0,numNodes:3,trackingData:{},dwLinktag:null,leadsTrackerSelector:"a[data-component=leadsTracker]"},viewguid:null,commerceClickPlaceholder:"___COM_CLICK_ID___",_create:function(){this._setup(),this.viewguid=i.guid,this.options.appendViewguid&&this.viewguid&&(this.$element.attr("href",this.$element.attr("href").replace("___VIEW_GUID___",this.viewguid)),this.options.trackingData.destUrl=this.options.trackingData.destUrl.replace("___VIEW_GUID___",this.viewguid)),this.options.fireTrackingPing&&this._setupEvents()},_setupEvents:function(){var c=this,r={pdguid:"productId",assetguid:"articleId",assettitle:"articleTitle",ttag:"qp.ttag",topicguid:"_topicPrimaryId",promoHed:"productName"};this.$element.on("mousedown",function(l){if(0==l.button||1==l.button||2==l.button)try{var n=c.options.trackingData?c.options.trackingData:c.options,d=e(this).parent()[0].classList.value;c._setCommerceClickId(),i.tracking.data.commerceClickId&&(e(this).attr("href",e(this).attr("href").replace(c.commerceClickPlaceholder,i.tracking.data.commerceClickId.replaceAll("-",""))),n.destUrl=n.destUrl.replace(c.commerceClickPlaceholder,i.tracking.data.commerceClickId.replaceAll("-","")));var o={_topicPrimaryId:n.topic?n.topic:"",articleType:i.tracking.data.articleType?i.tracking.data.articleType:"deal",articleId:n.articleId?n.articleId:n.assetguid,_campaign:n.ttag?"ttag:"+n.ttag:null,commerceClickId:i.tracking.data.commerceClickId?i.tracking.data.commerceClickId:"",_leadcpc:n.leadcpc,dwLinkTag:n.dwLinkTag||a.getDwTag(e(l.target),c.options.numNodes),eventTarget:(d?"."+d.replaceAll(" ",".")+" ":"")+c.options.leadsTrackerSelector,eventObject:l},s=this.href.split("?"),g=s.length>1?s[1].split("&"):{};e.each(g,function(e,t){var a="string"==typeof t?t.split("="):t,i=r[a[0]]||a[0];o[i]=a[1]});var m=e.extend(o,n);a.trackLead(m),setTimeout(e.proxy(function(){i.tracking.data.commerceClickId&&(e(this).attr("href",e(this).attr("href").replace(i.tracking.data.commerceClickId.replaceAll("-",""),c.commerceClickPlaceholder)),n.destUrl=n.destUrl.replace(i.tracking.data.commerceClickId.replaceAll("-",""),c.commerceClickPlaceholder))},this),500)}catch(e){t.log("Unable to parse tracking url",e)}})},_setCommerceClickId:function(){var e=window.uuid();utag_data.commerceClickId=e,i.tracking.data.commerceClickId=e}})});